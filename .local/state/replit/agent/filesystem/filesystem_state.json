{"file_contents":{"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/pages/profile.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Smile, Target, PartyPopper, Star, Clock, User,\n  MapPin, Briefcase, Palette, Calendar, Save\n} from \"lucide-react\";\nimport type { SessionPayload, TeamMember } from \"@/types/api\";\n\n// Profile form schema\nconst profileSchema = z.object({\n  headquarters: z.string(),\n  yearsOfService: z.number().min(0).max(50),\n  occupation: z.string().min(1),\n  favoriteColor: z.string(),\n  currentMood: z.string()\n});\n\ntype ProfileFormData = z.infer<typeof profileSchema>;\n\n// Mood options\nconst moodOptions = [\n  { value: \"happy\", icon: Smile, label: \"Happy\" },\n  { value: \"focused\", icon: Target, label: \"Focused\" },\n  { value: \"excited\", icon: PartyPopper, label: \"Excited\" },\n  { value: \"thoughtful\", icon: Star, label: \"Thoughtful\" },\n  { value: \"busy\", icon: Clock, label: \"Busy\" }\n];\n\n// Color options\nconst colorOptions = [\n  { value: \"#8ACCD5\", label: \"Cyan\", className: \"bg-cyan-500\" },\n  { value: \"#8E7DBE\", label: \"Purple\", className: \"bg-purple-500\" },\n  { value: \"#FF90BB\", label: \"Pink\", className: \"bg-pink-400\" },\n  { value: \"#FFD700\", label: \"Gold\", className: \"bg-yellow-500\" },\n  { value: \"#4ADE80\", label: \"Green\", className: \"bg-green-500\" },\n  { value: \"#F97316\", label: \"Orange\", className: \"bg-orange-500\" },\n  { value: \"#EF4444\", label: \"Red\", className: \"bg-red-500\" },\n  { value: \"#3B82F6\", label: \"Blue\", className: \"bg-blue-500\" }\n];\n\nexport default function Profile() {\n  const { toast } = useToast();\n  const [selectedMood, setSelectedMood] = useState<string>(\"\");\n\n  // Get current user session\n  const { data: session } = useQuery<SessionPayload>({\n    queryKey: [\"/api/auth/session\"],\n  });\n\n  // Get team members to find current user's profile\n  const { data: teamMembers = [] } = useQuery<TeamMember[]>({\n    queryKey: [\"/api/team-members\"],\n  });\n\n  // Find current user's team member profile\n  const currentProfile = teamMembers.find(\n    m => m.email.toLowerCase().includes(session?.username?.toLowerCase() || \"\")\n  );\n\n  // Initialize form\n  const form = useForm<ProfileFormData>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      headquarters: currentProfile?.headquarters || \"Montréal\",\n      yearsOfService: currentProfile?.yearsOfService || 0,\n      occupation: currentProfile?.occupation || \"Employee\",\n      favoriteColor: currentProfile?.favoriteColor || \"#8ACCD5\",\n      currentMood: currentProfile?.currentMood || \"happy\"\n    }\n  });\n\n  // Update profile mutation\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: ProfileFormData) => {\n      if (!currentProfile) {\n        throw new Error(\"Profile not found\");\n      }\n      const res = await apiRequest(\"PATCH\", `/api/team-members/${currentProfile.id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n      toast({ \n        title: \"Profile updated successfully\",\n        description: \"Your changes have been saved\"\n      });\n    },\n    onError: () => {\n      toast({ \n        variant: \"destructive\",\n        title: \"Failed to update profile\",\n        description: \"Please try again\"\n      });\n    }\n  });\n\n  const onSubmit = (data: ProfileFormData) => {\n    updateProfileMutation.mutate(data);\n  };\n\n  if (!currentProfile) {\n    return (\n      <div className=\"container mx-auto p-6 max-w-2xl\">\n        <Card className=\"neon-card\">\n          <CardContent className=\"pt-6\">\n            <p className=\"text-center text-muted-foreground\">\n              Profile not found. Please contact an administrator.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-2xl\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-3xl font-bold gradient-text\">Profile Settings</h1>\n        <p className=\"text-muted-foreground\">Customize your employee profile</p>\n      </div>\n\n      <Card className=\"neon-card neon-contour\">\n        <CardHeader>\n          <CardTitle>Personal Information</CardTitle>\n          <CardDescription>\n            Update your profile details and preferences\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              {/* Basic Info */}\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <Label>Name</Label>\n                    <Input value={currentProfile.name} disabled className=\"mt-2\" />\n                  </div>\n                  <div>\n                    <Label>Email</Label>\n                    <Input value={currentProfile.email} disabled className=\"mt-2\" />\n                  </div>\n                </div>\n              </div>\n\n              {/* Headquarters */}\n              <FormField\n                control={form.control}\n                name=\"headquarters\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      <MapPin className=\"w-4 h-4 inline mr-2\" />\n                      Headquarters\n                    </FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger className=\"neon-card\">\n                          <SelectValue placeholder=\"Select headquarters\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"Montréal\">Montréal</SelectItem>\n                        <SelectItem value=\"Québec\">Québec</SelectItem>\n                        <SelectItem value=\"Saguenay\">Saguenay</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormDescription>\n                      Your primary work location\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Years of Service */}\n              <FormField\n                control={form.control}\n                name=\"yearsOfService\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      <Calendar className=\"w-4 h-4 inline mr-2\" />\n                      Years of Service\n                    </FormLabel>\n                    <FormControl>\n                      <Input \n                        type=\"number\" \n                        {...field} \n                        onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                        className=\"neon-card\"\n                      />\n                    </FormControl>\n                    <FormDescription>\n                      How many years you've been with ELEVEX\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Occupation */}\n              <FormField\n                control={form.control}\n                name=\"occupation\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      <Briefcase className=\"w-4 h-4 inline mr-2\" />\n                      Occupation\n                    </FormLabel>\n                    <FormControl>\n                      <Input {...field} className=\"neon-card\" />\n                    </FormControl>\n                    <FormDescription>\n                      Your job title or role\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Favorite Color */}\n              <FormField\n                control={form.control}\n                name=\"favoriteColor\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      <Palette className=\"w-4 h-4 inline mr-2\" />\n                      Favorite Color\n                    </FormLabel>\n                    <FormDescription>\n                      This color will appear on your business card\n                    </FormDescription>\n                    <FormControl>\n                      <div className=\"grid grid-cols-4 gap-2 mt-2\">\n                        {colorOptions.map((color) => (\n                          <button\n                            key={color.value}\n                            type=\"button\"\n                            onClick={() => field.onChange(color.value)}\n                            className={`h-12 rounded-md border-2 transition-all ${\n                              field.value === color.value \n                                ? \"border-primary scale-110 shadow-lg\" \n                                : \"border-border hover:scale-105\"\n                            } ${color.className}`}\n                            title={color.label}\n                            data-testid={`color-${color.label.toLowerCase()}`}\n                          />\n                        ))}\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Current Mood */}\n              <FormField\n                control={form.control}\n                name=\"currentMood\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      <User className=\"w-4 h-4 inline mr-2\" />\n                      Current Mood\n                    </FormLabel>\n                    <FormDescription>\n                      Share how you're feeling today\n                    </FormDescription>\n                    <FormControl>\n                      <div className=\"grid grid-cols-5 gap-2 mt-2\">\n                        {moodOptions.map((mood) => (\n                          <button\n                            key={mood.value}\n                            type=\"button\"\n                            onClick={() => field.onChange(mood.value)}\n                            className={`flex flex-col items-center justify-center p-3 rounded-lg border-2 transition-all ${\n                              field.value === mood.value\n                                ? \"border-primary bg-primary/10 scale-105 neon-glow\" \n                                : \"border-border hover:bg-card hover:scale-105\"\n                            }`}\n                            data-testid={`mood-${mood.value}`}\n                          >\n                            <mood.icon className=\"w-6 h-6 mb-1\" />\n                            <span className=\"text-xs\">{mood.label}</span>\n                          </button>\n                        ))}\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button \n                type=\"submit\" \n                className=\"w-full neon-button\" \n                disabled={updateProfileMutation.isPending}\n                data-testid=\"button-save-profile\"\n              >\n                <Save className=\"w-4 h-4 mr-2\" />\n                Save Changes\n              </Button>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":12191},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: 0,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1376},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/App.tsx":{"content":"import * as React from \"react\";\nimport { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { TopBar } from \"@/components/TopBar\";\nimport { BottomNavBar } from \"@/components/BottomNavBar\";\nimport { useAuth } from \"@/lib/auth\";\nimport { ThemeProvider, useTheme } from \"@/contexts/ThemeContext\";\nimport { LanguageProvider } from \"@/contexts/LanguageContext\";\nimport bgDarkUrl from \"@assets/IMG_0730_1763452702046.jpeg\";\nimport bgLightUrl from \"@assets/IMG_0723_1763452702046.jpeg.jpeg\";\nimport bgUnicornUrl from \"@assets/IMG_0733_1763453430197.jpeg\";\nimport Login from \"@/pages/Login\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport WorkOrders from \"@/pages/WorkOrders\";\nimport WorkOrderDetail from \"@/pages/WorkOrderDetail\";\nimport Appointments from \"@/pages/Appointments\";\nimport Messages from \"@/pages/Messages\";\nimport Settings from \"@/pages/Settings\";\nimport Sales from \"@/pages/Sales\";\nimport Rental from \"@/pages/Rental\";\nimport Accounting from \"@/pages/Accounting\";\nimport Warranty from \"@/pages/Warranty\";\nimport CreateUser from \"@/pages/CreateUser\";\nimport Admin from \"@/pages/Admin\";\nimport AdvisorDashboard from \"@/pages/AdvisorDashboard\";\nimport CreateWorkOrder from \"@/pages/CreateWorkOrder\";\nimport Machines from \"@/pages/Machines\";\nimport Parts from \"@/pages/Parts\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction ProtectedContent({ children }: { children: React.ReactNode }) {\n  const { theme } = useTheme();\n  const [isMobile, setIsMobile] = React.useState(window.innerWidth < 768);\n  \n  React.useEffect(() => {\n    const handleResize = () => {\n      setIsMobile(window.innerWidth < 768);\n    };\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  const backgroundUrl = theme === \"dark\" ? bgDarkUrl : theme === \"light\" ? bgLightUrl : bgUnicornUrl;\n  \n  return (\n    <div className=\"relative isolate flex flex-col h-screen w-full\">\n      <div \n        className=\"fixed inset-0 bg-center bg-no-repeat md:bg-cover\"\n        style={{ \n          backgroundImage: `url(${backgroundUrl})`,\n          backgroundSize: isMobile ? \"200%\" : \"cover\",\n          backgroundPosition: \"center center\",\n          imageRendering: \"high-quality\",\n          zIndex: 0,\n        }}\n      />\n      <div \n        className=\"fixed inset-0\"\n        style={{\n          background: theme === \"dark\" ? \"rgba(0,0,0,0.5)\" : theme === \"light\" ? \"rgba(255,255,255,0.4)\" : \"rgba(255,144,187,0.25)\",\n          zIndex: 1,\n        }}\n      />\n      <div className=\"relative flex flex-col h-screen w-full\" style={{ zIndex: 10 }}>\n        <TopBar />\n        <main className=\"flex-1 overflow-y-auto pb-20 md:pb-6 px-4 md:px-6 lg:px-8 pt-4 md:pt-6 w-full max-w-[1600px] mx-auto\">\n          {children}\n        </main>\n        <BottomNavBar />\n      </div>\n    </div>\n  );\n}\n\nfunction ProtectedRouteWithLayout({ component: Component }: { component: React.ComponentType }) {\n  const { data: user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-muted-foreground\">Loading...</div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Redirect to=\"/login\" />;\n  }\n\n  return (\n    <ProtectedContent>\n      <Component />\n    </ProtectedContent>\n  );\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/login\" component={Login} />\n      <Route path=\"/\">\n        {() => <ProtectedRouteWithLayout component={Dashboard} />}\n      </Route>\n      <Route path=\"/sales\">\n        {() => <ProtectedRouteWithLayout component={Sales} />}\n      </Route>\n      <Route path=\"/rental\">\n        {() => <ProtectedRouteWithLayout component={Rental} />}\n      </Route>\n      <Route path=\"/work-orders\">\n        {() => <ProtectedRouteWithLayout component={WorkOrders} />}\n      </Route>\n      <Route path=\"/work-orders/:workOrderNumber\">\n        {() => <ProtectedRouteWithLayout component={WorkOrderDetail} />}\n      </Route>\n      <Route path=\"/machines\">\n        {() => <ProtectedRouteWithLayout component={Machines} />}\n      </Route>\n      <Route path=\"/parts\">\n        {() => <ProtectedRouteWithLayout component={Parts} />}\n      </Route>\n      <Route path=\"/appointments\">\n        {() => <ProtectedRouteWithLayout component={Appointments} />}\n      </Route>\n      <Route path=\"/accounting\">\n        {() => <ProtectedRouteWithLayout component={Accounting} />}\n      </Route>\n      <Route path=\"/warranty\">\n        {() => <ProtectedRouteWithLayout component={Warranty} />}\n      </Route>\n      <Route path=\"/messages\">\n        {() => <ProtectedRouteWithLayout component={Messages} />}\n      </Route>\n      <Route path=\"/settings\">\n        {() => <ProtectedRouteWithLayout component={Settings} />}\n      </Route>\n      <Route path=\"/admin/create-user\">\n        {() => <ProtectedRouteWithLayout component={CreateUser} />}\n      </Route>\n      <Route path=\"/admin\">\n        {() => <ProtectedRouteWithLayout component={Admin} />}\n      </Route>\n      <Route path=\"/advisor/demands\">\n        {() => <ProtectedRouteWithLayout component={AdvisorDashboard} />}\n      </Route>\n      <Route path=\"/work-orders/create\">\n        {() => <ProtectedRouteWithLayout component={CreateWorkOrder} />}\n      </Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AppContent() {\n  const { theme } = useTheme();\n  \n  React.useEffect(() => {\n    document.body.className = theme;\n  }, [theme]);\n\n  return (\n    <>\n      <Router />\n      <Toaster />\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <LanguageProvider>\n        <ThemeProvider>\n          <TooltipProvider>\n            <AppContent />\n          </TooltipProvider>\n        </ThemeProvider>\n      </LanguageProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":6057},"replit.md":{"content":"# ELEVEX ERP - Lift Dealership Management System\n\n## Overview\n\nELEVEX ERP is a comprehensive enterprise resource planning system designed for lift and material handling equipment dealerships. It manages sales, rentals, service operations, parts inventory, warranty claims, and accounting. The application features a React-based frontend with a distinctive gradient color scheme and animated ELEVEX branding, and an Express backend with PostgreSQL integration. Key capabilities include real-time equipment/parts inventory management, a real-time messaging system, robust user and profile management, a comprehensive notification system, a work order demand workflow, and detailed dashboard statistics. The system prioritizes security, type safety, and operational efficiency for dealership management.\n\n## Recent Updates (Nov 24, 2025)\n\n**Mood Feature Added to Dashboard - COMPLETED ✅**\n- ✅ Users can now choose their daily mood from 5 emoticons (Happy, Focused, Tired, Stressed, Neutral)\n- ✅ Mood selector card displayed on dashboard below welcome header\n- ✅ Moods persist to database and display in real-time\n- ✅ Mood emoji shows next to username in direct message conversations\n- ✅ Mood displays in chat header when viewing direct messages\n- ✅ Added mood column to users table with default \"neutral\" value\n- ✅ API endpoint PATCH /api/auth/user/mood for updating mood\n- ✅ Moods update instantly across all chat interfaces\n\n**Background Hex Zoom Fixed & Unicorn Theme Icon Updated - COMPLETED ✅**\n- ✅ Fixed hexagon background zoom - reduced from bg-cover to backgroundSize: 200% (2x zoom out)\n- ✅ Hexagons now appear less zoomed in on all themes (Dark, Light, Unicorn)\n- ✅ Background fills more visible area without heavy distortion\n- ✅ Replaced Sparkles icon with Wand2 (magic wand) for Unicorn theme toggle\n- ✅ Added magical rotation animation to Wand2 icon when unicorn theme is active\n- ✅ Better visual distinction between all three theme options\n\n**Default Avatar Implemented for All Users - COMPLETED ✅**\n- ✅ Set up custom pixelated gaming avatar (IMG_8538) as system-wide default\n- ✅ Image copied to client/public/default-avatar.jpeg for server-side serving\n- ✅ Updated createUser method to assign default avatar to all new users\n- ✅ Updated all 6 existing users in database with default avatar\n- ✅ Avatar displays properly in chat conversations with user identification\n- ✅ Works in channels (HQ, Department) and direct messages\n- ✅ Users can still customize their avatars after account creation\n\n**Chat Architecture Redesigned & Fixed - COMPLETED ✅**\n- ✅ Created unified `UnifiedChat.tsx` component consolidating duplicate chat functionality\n- ✅ Merged separate PrivateChatWindow and ChatInterface components into single cohesive system\n- ✅ Implemented proper tab-based navigation between Channels and Direct Messages\n- ✅ Added conversation list with user avatars, names, and real-time updates\n- ✅ Integrated NewMessageDialog for creating new direct message conversations\n- ✅ Fixed conversation creation with `/api/conversations` endpoint\n- ✅ Implemented getOrCreateConversation method in storage layer\n- ✅ Added proper user data fetching for conversation participants\n- ✅ Enhanced WebSocket message delivery to update conversations in real-time\n- ✅ Fixed all TypeScript errors with proper null checks and fallbacks\n- ✅ Simplified message UI with better visual distinction (current user vs other user)\n- ✅ System now properly displays channels (HQ, Department) and direct messages in organized tabs\n\n**Work Order Attachments & Notes Fully Editable - COMPLETED ✅**\n- ✅ Added notes and attachment editing to work order detail page\n- ✅ Implemented edit button to toggle between view and edit modes\n- ✅ Added photo upload functionality (JPG, PNG, GIF, WebP up to 10MB)\n- ✅ Notes editable anytime, regardless of work order status\n- ✅ Photos display in grid layout with proper formatting\n- ✅ Changes sync in real-time across all views via React Query\n\n**Work Order Punch System Fixed - COMPLETED ✅**\n- ✅ Work order detail now shows active punch with technician name\n- ✅ Displays time punched in (start time) for active work\n- ✅ Shows time allowed remaining (budgeted - actual so far) per task\n- ✅ Displays efficiency % per task with color coding (Green ≥100%, Yellow 80-99%, Red <80%)\n- ✅ Active punch card shows duration in real-time (hours and minutes)\n- ✅ Task headers now display all metrics: Budgeted, Remaining, Efficiency\n\n**Break Feature Added to Dashboard - COMPLETED ✅**\n- ✅ Added \"Take Break\" button (Coffee icon) visible while punch is active\n- ✅ Break dialog allows users to input break duration in minutes (1-480 min)\n- ✅ Break time is automatically subtracted from total work hours on dashboard\n- ✅ Breaks are recorded as separate punch records with punchType \"other\"\n- ✅ Stats calculation now deducts break hours from work hours\n- ✅ Daily hours now = work hours - break hours (never goes negative)\n- ✅ Break feature persists to database and syncs in real-time\n- ✅ Toast notification confirms break was recorded\n\n**Efficiency Calculation Fixed & Dashboard Syncing - COMPLETED ✅**\n- ✅ Fixed efficiency calculation formula: changed from (actual/budgeted) to (budgeted/actual)*100\n- ✅ Now correctly shows: >100% = on/under budget (good), <100% = over budget (bad)\n- ✅ WorkOrderDetail now calculates efficiency correctly from real-time punches\n- ✅ Dashboard efficiency polling reduced from 10s to 5s for faster sync\n- ✅ Dashboard color coding: Green (≥100%), Yellow (80-99%), Red (<80%)\n- ✅ Efficiency updates on dashboard immediately after work order completion\n\n**Lunch Feature Removed - COMPLETED ✅**\n- ✅ Removed `/api/tasks/:id/lunch` endpoint from backend\n- ✅ Removed lunch button UI from WorkOrderDetail.tsx and TaskTimePunches.tsx\n- ✅ Removed Coffee and Utensils icon imports\n- ✅ Removed lunchInMutation, lunchOutMutation, lunchMutation code\n- ✅ Punch task feature is now clean without lunch complexity\n- ✅ Dashboard work order card syncs punch data every 1 second via React Query polling\n\n**Work Order Punch Endpoints Fixed - COMPLETED ✅**\n- ✅ Created missing `/api/work-orders/:id/punch-in` endpoint for punching into work orders\n- ✅ Created missing `/api/work-orders/:id/punch-out` endpoint for punching out of work orders\n- ✅ Created missing `/api/tasks/:id/punch` endpoint for task-level punch in/out (toggle)\n- ✅ All endpoints now properly create time punch records with work order and task IDs\n- ✅ All endpoints update work order status and actual hours when punches are created/closed\n- ✅ Error handling prevents multiple active punches per user\n- ✅ Data now syncs properly to database and UI updates via React Query cache invalidation (1s polling)\n\n**Photo Attachments Fixed on Work Orders - COMPLETED ✅**\n- ✅ Fixed DemandForm sending to wrong API endpoint (/api/work-orders instead of /api/work-orders/demands)\n- ✅ Updated DemandForm to call correct endpoint that properly handles photos array\n- ✅ Fixed API field mapping - demandedBy field now correctly mapped to advisorId for demand endpoint\n- ✅ Added isLoadingAdvisors prop to FormContent component to prevent TypeScript errors\n- ✅ Photos now properly persist to database when creating work order demands\n- ✅ Photos correctly display on work order detail page in gallery grid\n- ✅ Photo upload validation already working (jpeg, jpg, png, gif, webp, max 10MB)\n\n**Work Order Punch API Calls Fixed - COMPLETED ✅**\n- ✅ Fixed punch in/out mutations sending incorrectly formatted data\n- ✅ Corrected apiRequest calls in WorkOrderDetail.tsx to use proper format\n- ✅ Fixed punchInMutation, punchOutMutation, lunchInMutation, lunchOutMutation\n- ✅ All four mutations now properly send { workOrderId } data instead of { headers, body }\n- ✅ Punch operations now work correctly in work order detail page\n\n**Private Chat System Fixed - COMPLETED ✅**\n- ✅ Fixed private chat conversations not displaying user data (avatars/usernames)\n- ✅ Added automatic fetching of conversation participant user data when conversations list loads\n- ✅ Fixed missing user information in both ChatInterface and PrivateChatWindow components\n- ✅ Conversation lists now properly display other user's avatar and username\n- ✅ Private messages now fully functional with real-time WebSocket support\n- ✅ Users can now create new conversations with NewMessageDialog and start messaging\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\nThe frontend is built with React 18, TypeScript, and Vite. It uses Wouter for routing and TanStack Query for server state management. UI components are built with shadcn/ui (Radix UI based) and styled with Tailwind CSS, following a custom design system. It features dark mode, ELEVEX brand colors (Cyan, Purple, Pink) with gradients, and leverages React Hook Form with Zod for validation. The interface is information-dense, with a fixed sidebar, a 12-column responsive grid, and card-based UI. Bilingual support (French/English) is integrated.\n\n### Backend Architecture\n\nThe backend uses Express.js for its HTTP server and API, following a RESTful design with JSON. It implements session-based authentication. PostgreSQL is the primary data store, managed with Drizzle ORM for type-safe queries. Development uses `tsx` and `esbuild` for production builds.\n\n### Data Storage\n\nPostgreSQL (Neon serverless) is used, employing WebSocket-based connections and connection pooling. Drizzle ORM and Drizzle Kit manage type-safe queries and schema migrations, integrated with Zod for runtime validation. A shared directory defines the schema for frontend/backend consistency, with UUID primary keys for users.\n\n### Equipment & Parts Inventory\n\nA `Machines` table stores equipment inventory, categorized (Lift, Hoist, Platform, Stairs, Ramp, Other) with operational status, location tracking, and service scheduling. A `Parts` table maintains replacement parts inventory by category (Motor, Gear, Bearing, Hydraulic, Electrical, Fastener, Other), including quantity, unit costs, supplier info, and reorder levels.\n\n### System Design Choices\n\n- **Real-Time Messaging:** WebSocket-based system (`/ws`) with headquarters-based isolation, profile picture display, and real-time broadcasting.\n- **Profile Management:** Comprehensive interface for custom or default profile pictures with real-time previews.\n- **Security:** Strict authentication and authorization across all endpoints and WebSocket connections, with PII restricted.\n- **Searchable User Selector:** Combobox pattern for user selection in forms, supporting large lists, real-time filtering, and accessibility.\n- **Notification System:** Dual delivery (in-app and email via Resend API) for critical events, with in-app bell icon, unread count, and mark-as-read functionality.\n- **Work Order Workflow:** Enhanced DemandForm allows technical advisor selection, triggering dual notifications upon assignment. Authorization governs time punch editing based on user roles and work order status.\n- **Equipment Tracking:** Real-time inventory management for lift equipment and parts with status indicators, location tracking, and service scheduling.\n- **Dashboard & Statistics:** Provides user statistics, including hours worked, work order counts, and efficiency metrics, calculated upon work order completion.\n- **UI/UX:** Animated ELEVEX logo, gradient brand colors, WCAG AA compliant contrast, 8 core reusable components, and main application pages. Hexagonal wallpapers are applied globally across all themes (Dark, Light, Unicorn).\n\n## External Dependencies\n\n- **UI Component Libraries:** Radix UI primitives, lucide-react, cmdk, vaul, react-day-picker, embla-carousel-react, input-otp.\n- **Utility Libraries:** class-variance-authority (cva), clsx, tailwind-merge, date-fns, nanoid.\n- **Development & Build Tools:** Vite plugins (runtime-error-modal, cartographer, dev-banner), PostCSS with Autoprefixer, Font Awesome 6.5.0 CDN.\n- **Database & Backend:** @neondatabase/serverless (PostgreSQL connection), ws (WebSocket), drizzle-orm, drizzle-kit, connect-pg-simple (PostgreSQL session storage).\n- **Email Integration:** Resend API for transactional emails.\n- **Type Safety & Validation:** zod, @hookform/resolvers, TypeScript.\n- **Theming & Assets:** Google Fonts CDN (Inter), shadcn/ui (\"new-york\" style), Tailwind CSS variables.","size_bytes":12546},"client/src/components/WorkOrderCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\n\ninterface WorkOrderCardProps {\n  id: string;\n  status: 'new' | 'assigned' | 'in-progress' | 'completed';\n  customerName: string;\n  equipmentType: string;\n  partNumber: string;\n  assignedTo?: string;\n  priority: 'low' | 'medium' | 'high';\n  createdAt: string;\n}\n\nconst statusColors = {\n  'new': 'bg-blue-500 neon-glow',\n  'assigned': 'bg-yellow-500',\n  'in-progress': 'bg-orange-500 neon-glow-pink',\n  'completed': 'bg-green-500 neon-glow',\n};\n\nconst priorityColors = {\n  'low': 'bg-gray-500',\n  'medium': 'bg-yellow-500',\n  'high': 'bg-red-500',\n};\n\nexport function WorkOrderCard({ \n  id, \n  status, \n  customerName, \n  equipmentType, \n  partNumber, \n  assignedTo,\n  priority,\n  createdAt \n}: WorkOrderCardProps) {\n  return (\n    <Card className=\"neon-card fade-in-up\" data-testid={`card-workorder-${id}`}>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-3\">\n        <CardTitle className=\"text-base font-semibold neon-text\">WO-{id}</CardTitle>\n        <div className=\"flex items-center gap-2\">\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            <span className={`w-2 h-2 rounded-full ${statusColors[status]} mr-1`}></span>\n            {status.replace('-', ' ').toUpperCase()}\n          </Badge>\n          <Badge variant=\"outline\" className={`text-xs ${priorityColors[priority]}/10 border-${priorityColors[priority]}`}>\n            {priority.toUpperCase()}\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center gap-2 text-sm\">\n            <i className=\"fas fa-user text-muted-foreground w-4\"></i>\n            <span className=\"font-medium neon-text\" data-testid={`text-customer-${id}`}>{customerName}</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <i className=\"fas fa-forklift w-4\"></i>\n            <span>{equipmentType}</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n            <i className=\"fas fa-hashtag w-4\"></i>\n            <span>{partNumber}</span>\n          </div>\n        </div>\n\n        {assignedTo && (\n          <div className=\"flex items-center gap-2 pt-2 border-t border-border\">\n            <Avatar className=\"h-6 w-6\">\n              <AvatarFallback className=\"text-xs bg-primary text-primary-foreground\">\n                {assignedTo.split(' ').map(n => n[0]).join('')}\n              </AvatarFallback>\n            </Avatar>\n            <span className=\"text-sm text-muted-foreground\">Assigned to {assignedTo}</span>\n          </div>\n        )}\n\n        <div className=\"flex items-center justify-between pt-2 border-t border-border\">\n          <span className=\"text-xs text-muted-foreground\">{createdAt}</span>\n          <div className=\"flex gap-2\">\n            <Button size=\"sm\" variant=\"outline\" data-testid={`button-view-${id}`}>\n              <i className=\"fas fa-eye mr-1\"></i>\n              View\n            </Button>\n            <Button size=\"sm\" data-testid={`button-assign-${id}`}>\n              <i className=\"fas fa-user-plus mr-1\"></i>\n              Assign\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":3522},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, timestamp, date, real, integer } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  employeeId: text(\"employee_id\").notNull().unique(),\n  passwordHash: text(\"password_hash\").notNull(),\n  role: text(\"role\", { enum: [\"admin\", \"technician\", \"technical_advisor\"] }).notNull().default(\"technician\"),\n  email: text(\"email\"),\n  department: text(\"department\", { enum: [\"Road Technician\", \"Garage Technician\", \"Sales\", \"Tech Advisor\", \"Accounting\", \"HR\"] }),\n  occupation: text(\"occupation\"),\n  headquarters: text(\"headquarters\", { enum: [\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"] }),\n  profilePicture: text(\"profile_picture\"),\n  bannerImage: text(\"banner_image\"),\n  mood: text(\"mood\", { enum: [\"happy\", \"focused\", \"tired\", \"stressed\", \"neutral\"] }).default(\"neutral\"),\n  isActive: text(\"is_active\").notNull().default(\"true\"),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const workOrders = pgTable(\"work_orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  workOrderNumber: text(\"work_order_number\").notNull().unique(),\n  title: text(\"title\").notNull(),\n  priority: text(\"priority\", { enum: [\"Normal\", \"High\", \"Urgent\"] }).notNull().default(\"Normal\"),\n  department: text(\"department\", { enum: [\"Road Technician\", \"Garage Technician\", \"Sales\", \"Tech Advisor\", \"Accounting\", \"HR\"] }).notNull(),\n  headquarters: text(\"headquarters\", { enum: [\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"] }).notNull(),\n  customer: text(\"customer\").notNull(),\n  siteAddress: text(\"site_address\").notNull(),\n  asset: text(\"asset\").notNull(),\n  problemSummary: text(\"problem_summary\").notNull(),\n  status: text(\"status\", { enum: [\"new\", \"demand\", \"assigned\", \"in-progress\", \"completed\", \"closedForReview\"] }).notNull().default(\"new\"),\n  notes: text(\"notes\"),\n  assignedTo: varchar(\"assigned_to\").references(() => users.id),\n  createdBy: varchar(\"created_by\").notNull().references(() => users.id),\n  demandedBy: varchar(\"demanded_by\").references(() => users.id),\n  photos: text(\"photos\").array(),\n  actualHours: real(\"actual_hours\").default(0),\n  efficiency: real(\"efficiency\"),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const workOrderTasks = pgTable(\"work_order_tasks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  workOrderId: varchar(\"work_order_id\").notNull().references(() => workOrders.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  budgetedHours: real(\"budgeted_hours\").notNull(),\n  sortOrder: real(\"sort_order\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const machines = pgTable(\"machines\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  model: text(\"model\").notNull(),\n  serialNumber: text(\"serial_number\").notNull().unique(),\n  category: text(\"category\", { enum: [\"Lift\", \"Hoist\", \"Platform\", \"Stairs\", \"Ramp\", \"Other\"] }).notNull(),\n  status: text(\"status\", { enum: [\"active\", \"maintenance\", \"retired\", \"in-stock\"] }).notNull().default(\"in-stock\"),\n  location: text(\"location\"),\n  lastServiceDate: date(\"last_service_date\"),\n  nextServiceDate: date(\"next_service_date\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const parts = pgTable(\"parts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  partNumber: text(\"part_number\").notNull().unique(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  category: text(\"category\", { enum: [\"Motor\", \"Gear\", \"Bearing\", \"Hydraulic\", \"Electrical\", \"Fastener\", \"Other\"] }).notNull(),\n  quantity: integer(\"quantity\").notNull().default(0),\n  unitCost: real(\"unit_cost\"),\n  supplier: text(\"supplier\"),\n  location: text(\"location\"),\n  reorderLevel: integer(\"reorder_level\").default(5),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const timePunches = pgTable(\"time_punches\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  workOrderId: varchar(\"work_order_id\").references(() => workOrders.id),\n  taskId: varchar(\"task_id\").references(() => workOrderTasks.id, { onDelete: \"cascade\" }),\n  punchType: text(\"punch_type\", { enum: [\"work\", \"travel\", \"other\"] }).notNull().default(\"work\"),\n  clockIn: timestamp(\"clock_in\").notNull(),\n  clockOut: timestamp(\"clock_out\"),\n  kilometers: real(\"kilometers\"),\n  punchDate: date(\"punch_date\").notNull(),\n});\n\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  type: text(\"type\", { enum: [\"work_order_assigned\", \"work_order_demand\", \"work_order_completed\"] }).notNull(),\n  message: text(\"message\").notNull(),\n  workOrderId: varchar(\"work_order_id\").references(() => workOrders.id),\n  isRead: text(\"is_read\").notNull().default(\"false\"),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const appointments = pgTable(\"appointments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  appointmentDate: date(\"appointment_date\").notNull(),\n  appointmentTime: text(\"appointment_time\").notNull(),\n  customer: text(\"customer\").notNull(),\n  customerPhone: text(\"customer_phone\"),\n  customerEmail: text(\"customer_email\"),\n  assignedTo: varchar(\"assigned_to\").references(() => users.id),\n  serviceType: text(\"service_type\", { enum: [\"Maintenance\", \"Repair\", \"Inspection\", \"Consultation\", \"Delivery\", \"Pickup\"] }).notNull(),\n  notes: text(\"notes\"),\n  status: text(\"status\", { enum: [\"scheduled\", \"confirmed\", \"in-progress\", \"completed\", \"cancelled\"] }).notNull().default(\"scheduled\"),\n  createdBy: varchar(\"created_by\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const customers = pgTable(\"customers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  phone: text(\"phone\"),\n  email: text(\"email\"),\n  address: text(\"address\"),\n  createdBy: varchar(\"created_by\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const conversations = pgTable(\"conversations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  participant1: varchar(\"participant1\").notNull().references(() => users.id),\n  participant2: varchar(\"participant2\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n  lastMessageAt: timestamp(\"last_message_at\").default(sql`now()`),\n});\n\nexport const messages = pgTable(\"messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  senderId: varchar(\"sender_id\").notNull().references(() => users.id),\n  channelType: text(\"channel_type\", { enum: [\"headquarters\", \"department\", \"direct\"] }).notNull(),\n  headquarters: text(\"headquarters\", { enum: [\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"] }),\n  department: text(\"department\", { enum: [\"Road Technician\", \"Garage Technician\", \"Sales\", \"Tech Advisor\", \"Accounting\", \"HR\"] }),\n  conversationId: varchar(\"conversation_id\").references(() => conversations.id),\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().default(sql`now()`),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  passwordHash: true,\n  createdAt: true,\n  isActive: true,\n  profilePicture: true,\n  bannerImage: true,\n  mood: true,\n}).extend({\n  password: z.string().min(6, \"Password must be at least 6 characters\"),\n  employeeId: z.string().min(1, \"Employee ID is required\"),\n  email: z.string().email(\"Invalid email address\").optional().or(z.literal(\"\")),\n  department: z.enum([\"Road Technician\", \"Garage Technician\", \"Sales\", \"Tech Advisor\", \"Accounting\", \"HR\"]).optional().or(z.literal(\"\")),\n  occupation: z.string().optional().or(z.literal(\"\")),\n  headquarters: z.enum([\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"]).optional().or(z.literal(\"\")),\n  role: z.enum([\"admin\", \"technician\", \"technical_advisor\"]).default(\"technician\"),\n});\n\nexport const updateUserSchema = z.object({\n  email: z.string().email(\"Invalid email address\"),\n  department: z.enum([\"Road Technician\", \"Garage Technician\", \"Sales\", \"Tech Advisor\", \"Accounting\", \"HR\"]).optional().or(z.literal(\"\")),\n  occupation: z.string().optional().or(z.literal(\"\")),\n  headquarters: z.enum([\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"]).optional().or(z.literal(\"\")),\n  role: z.enum([\"admin\", \"technician\", \"technical_advisor\"]).optional(),\n  isActive: z.enum([\"true\", \"false\"]).optional(),\n  profilePicture: z.string().optional().or(z.literal(\"\")),\n  bannerImage: z.string().optional().or(z.literal(\"\")),\n  mood: z.enum([\"happy\", \"focused\", \"tired\", \"stressed\", \"neutral\"]).optional(),\n});\n\nexport const insertWorkOrderSchema = createInsertSchema(workOrders).omit({\n  id: true,\n  workOrderNumber: true,\n  actualHours: true,\n  efficiency: true,\n  createdAt: true,\n  completedAt: true,\n}).extend({\n  tasks: z.array(z.object({\n    title: z.string().min(1, \"Task title is required\"),\n    description: z.string().optional(),\n    budgetedHours: z.number().min(0.5, \"Budgeted hours must be at least 0.5\").max(99, \"Budgeted hours cannot exceed 99\"),\n  })).min(1, \"At least one task is required\"),\n  photos: z.array(z.string()).optional(),\n});\n\nexport const insertTaskSchema = createInsertSchema(workOrderTasks).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMachineSchema = createInsertSchema(machines).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertPartSchema = createInsertSchema(parts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertTimePunchSchema = createInsertSchema(timePunches).omit({\n  id: true,\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertAppointmentSchema = createInsertSchema(appointments).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  appointmentDate: z.string().min(1, \"Appointment date is required\"),\n  appointmentTime: z.string().min(1, \"Appointment time is required\"),\n  customer: z.string().min(1, \"Customer name is required\"),\n  customerPhone: z.string().optional().or(z.literal(\"\")),\n  customerEmail: z.string().email(\"Invalid email address\").optional().or(z.literal(\"\")),\n  serviceType: z.enum([\"Maintenance\", \"Repair\", \"Inspection\", \"Consultation\", \"Delivery\", \"Pickup\"]),\n  notes: z.string().optional().or(z.literal(\"\")),\n  status: z.enum([\"scheduled\", \"confirmed\", \"in-progress\", \"completed\", \"cancelled\"]).default(\"scheduled\"),\n});\n\nexport const updateAppointmentSchema = z.object({\n  appointmentDate: z.string().optional(),\n  appointmentTime: z.string().optional(),\n  customer: z.string().optional(),\n  customerPhone: z.string().optional().or(z.literal(\"\")),\n  customerEmail: z.string().email(\"Invalid email address\").optional().or(z.literal(\"\")),\n  assignedTo: z.string().optional().or(z.literal(\"\")),\n  serviceType: z.enum([\"Maintenance\", \"Repair\", \"Inspection\", \"Consultation\", \"Delivery\", \"Pickup\"]).optional(),\n  notes: z.string().optional().or(z.literal(\"\")),\n  status: z.enum([\"scheduled\", \"confirmed\", \"in-progress\", \"completed\", \"cancelled\"]).optional(),\n});\n\nexport const insertCustomerSchema = createInsertSchema(customers).omit({\n  id: true,\n  createdBy: true,\n  createdAt: true,\n}).extend({\n  name: z.string().min(1, \"Customer name is required\"),\n  phone: z.string().optional().or(z.literal(\"\")),\n  email: z.string().email(\"Invalid email address\").optional().or(z.literal(\"\")),\n  address: z.string().optional().or(z.literal(\"\")),\n});\n\nexport const insertConversationSchema = createInsertSchema(conversations).omit({\n  id: true,\n  createdAt: true,\n  lastMessageAt: true,\n});\n\nexport const insertMessageSchema = createInsertSchema(messages).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Select types\nexport type User = typeof users.$inferSelect;\nexport type WorkOrder = typeof workOrders.$inferSelect;\nexport type WorkOrderTask = typeof workOrderTasks.$inferSelect;\nexport type Machine = typeof machines.$inferSelect;\nexport type Part = typeof parts.$inferSelect;\nexport type TimePunch = typeof timePunches.$inferSelect;\nexport type Notification = typeof notifications.$inferSelect;\nexport type Appointment = typeof appointments.$inferSelect;\nexport type Customer = typeof customers.$inferSelect;\nexport type Conversation = typeof conversations.$inferSelect;\nexport type Message = typeof messages.$inferSelect;\n\n// Insert types\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type UpdateUser = z.infer<typeof updateUserSchema>;\nexport type InsertWorkOrder = z.infer<typeof insertWorkOrderSchema>;\nexport type InsertTask = z.infer<typeof insertTaskSchema>;\nexport type InsertMachine = z.infer<typeof insertMachineSchema>;\nexport type InsertPart = z.infer<typeof insertPartSchema>;\nexport type InsertTimePunch = z.infer<typeof insertTimePunchSchema>;\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type InsertAppointment = z.infer<typeof insertAppointmentSchema>;\nexport type UpdateAppointment = z.infer<typeof updateAppointmentSchema>;\nexport type InsertCustomer = z.infer<typeof insertCustomerSchema>;\nexport type InsertConversation = z.infer<typeof insertConversationSchema>;\nexport type InsertMessage = z.infer<typeof insertMessageSchema>;\n","size_bytes":13886},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/LanguageToggle.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport { CanadaFlag } from \"@/components/icons/CanadaFlag\";\nimport { QuebecFlag } from \"@/components/icons/QuebecFlag\";\n\nexport function LanguageToggle() {\n  const { language, setLanguage } = useLanguage();\n\n  return (\n    <div className=\"flex gap-1 bg-muted p-1 rounded-lg\" data-testid=\"toggle-language\">\n      <Button\n        size=\"sm\"\n        variant={language === 'fr' ? 'default' : 'ghost'}\n        onClick={() => setLanguage('fr')}\n        className=\"h-8 gap-1.5\"\n        data-testid=\"button-lang-fr\"\n        aria-label=\"Français (Québec)\"\n      >\n        <QuebecFlag className=\"w-5 h-3.5\" />\n        Français\n      </Button>\n      <Button\n        size=\"sm\"\n        variant={language === 'en' ? 'default' : 'ghost'}\n        onClick={() => setLanguage('en')}\n        className=\"h-8 gap-1.5\"\n        data-testid=\"button-lang-en\"\n        aria-label=\"English (Canada)\"\n      >\n        <CanadaFlag className=\"w-5 h-3.5\" />\n        English\n      </Button>\n    </div>\n  );\n}\n","size_bytes":1084},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"server/auth.ts":{"content":"import { storage } from \"./storage\";\n\nexport async function verifySession(sessionId: string): Promise<{ username: string; isAdmin: boolean } | null> {\n  // For now, we'll use a simple in-memory session verification\n  // In production, this should check against the session store\n  try {\n    // Extract user ID from session (this is a simplified version)\n    // In a real implementation, you'd decode the session from the store\n    const users = await storage.getAllUsers();\n    \n    // For development, we'll just return the first admin user\n    // This should be properly implemented with session store\n    const adminUser = users.find(u => u.isAdmin);\n    if (adminUser && sessionId) {\n      return {\n        username: adminUser.username,\n        isAdmin: adminUser.isAdmin\n      };\n    }\n    \n    return null;\n  } catch (error) {\n    console.error(\"Session verification error:\", error);\n    return null;\n  }\n}","size_bytes":912},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/BusinessCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { User, Mail, Phone, Briefcase } from \"lucide-react\";\nimport type { TeamMember } from \"@/types/api\";\n\ninterface BusinessCardProps {\n  member: TeamMember;\n  className?: string;\n}\n\nexport function BusinessCard({ member, className = \"\" }: BusinessCardProps) {\n  const accentColor = member.accentColor === \"cyan\" \n    ? \"#8ACCD5\" \n    : member.accentColor === \"gold\" \n    ? \"#FFD700\" \n    : \"#8E7DBE\";\n\n  return (\n    <Card className={`neon-card neon-contour ${className}`} data-testid={`card-member-${member.id}`}>\n      <CardContent className=\"p-6\">\n        <div className=\"flex flex-col items-center space-y-4\">\n          <div \n            className=\"w-24 h-24 rounded-full flex items-center justify-center neon-glow\"\n            style={{ \n              background: `linear-gradient(135deg, ${accentColor} 0%, #8E7DBE 100%)`,\n              boxShadow: `0 0 20px ${accentColor}`\n            }}\n          >\n            <User className=\"w-12 h-12 text-white\" />\n          </div>\n          \n          <div className=\"text-center space-y-2\">\n            <h3 className=\"text-xl font-bold gradient-text\" data-testid={`text-member-name-${member.id}`}>\n              {member.name}\n            </h3>\n            <div className=\"flex items-center justify-center gap-2 text-muted-foreground\">\n              <Briefcase className=\"w-4 h-4\" />\n              <span className=\"text-sm\">{member.roleLabel}</span>\n            </div>\n          </div>\n\n          <div className=\"w-full space-y-3 pt-4 border-t border-border\">\n            <div className=\"flex items-center gap-3\">\n              <Mail className=\"w-4 h-4\" style={{ color: accentColor }} />\n              <a \n                href={`mailto:${member.email}`} \n                className=\"text-sm hover:underline\"\n                style={{ color: accentColor }}\n                data-testid={`link-member-email-${member.id}`}\n              >\n                {member.email}\n              </a>\n            </div>\n            \n            <div className=\"flex items-center gap-3\">\n              <Phone className=\"w-4 h-4\" style={{ color: accentColor }} />\n              <a \n                href={`tel:${member.phone}`} \n                className=\"text-sm hover:underline\"\n                style={{ color: accentColor }}\n                data-testid={`link-member-phone-${member.id}`}\n              >\n                {member.phone}\n              </a>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":2534},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/app-sidebar.tsx":{"content":"import { \n  LayoutDashboard, \n  ClipboardList, \n  MessageSquare, \n  Users, \n  User,\n  MapPin,\n  Package,\n  Truck,\n  Shield\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from \"@/components/ui/sidebar\";\nimport { Link } from \"wouter\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { SessionPayload } from \"@/types/api\";\n\n// Menu items\nconst menuItems = [\n  {\n    title: \"Dashboard\",\n    url: \"/dashboard\",\n    icon: LayoutDashboard,\n    testId: \"nav-dashboard\",\n    adminOnly: false\n  },\n  {\n    title: \"Work Orders\",\n    url: \"/work-orders\",\n    icon: ClipboardList,\n    testId: \"nav-work-orders\",\n    adminOnly: false\n  },\n  {\n    title: \"Locations\",\n    url: \"/locations\",\n    icon: MapPin,\n    testId: \"nav-locations\",\n    adminOnly: false\n  },\n  {\n    title: \"Parts Inventory\",\n    url: \"/parts\",\n    icon: Package,\n    testId: \"nav-parts\",\n    adminOnly: false\n  },\n  {\n    title: \"Vehicle Fleet\",\n    url: \"/vehicles\",\n    icon: Truck,\n    testId: \"nav-vehicles\",\n    adminOnly: false\n  },\n  {\n    title: \"User Management\",\n    url: \"/admin/users\",\n    icon: Shield,\n    testId: \"nav-admin-users\",\n    adminOnly: true\n  },\n  {\n    title: \"Team Chat\",\n    url: \"/chat\",\n    icon: MessageSquare,\n    testId: \"nav-chat\",\n    adminOnly: false\n  },\n  {\n    title: \"Employee Directory\",\n    url: \"/employees\",\n    icon: Users,\n    testId: \"nav-employees\",\n    adminOnly: false\n  },\n  {\n    title: \"Profile Settings\",\n    url: \"/profile\",\n    icon: User,\n    testId: \"nav-profile\",\n    adminOnly: false\n  }\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { data: session } = useQuery<SessionPayload>({\n    queryKey: [\"/api/auth/session\"],\n    retry: false,\n  });\n  \n  const visibleItems = menuItems.filter(item => !item.adminOnly || session?.isAdmin);\n  \n  return (\n    <Sidebar>\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"text-lg font-bold gradient-text\">\n            ELEVEX Portal\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {visibleItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <Link href={item.url} asChild>\n                    <SidebarMenuButton \n                      className={location === item.url ? \"neon-glow bg-primary/10\" : \"\"}\n                      data-testid={item.testId}\n                    >\n                      <item.icon className=\"w-4 h-4\" />\n                      <span>{item.title}</span>\n                    </SidebarMenuButton>\n                  </Link>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n    </Sidebar>\n  );\n}","size_bytes":2925},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ThemeToggle.tsx":{"content":"\nimport { useState, useEffect } from \"react\";\nimport { Moon, Sparkles, Sun } from \"lucide-react\";\n\ntype Theme = 'dark' | 'unicorn' | 'light';\n\nexport function ThemeToggle() {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const saved = localStorage.getItem('theme') as Theme;\n    return saved || 'dark';\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove('dark', 'unicorn', 'light');\n    root.classList.add(theme);\n    localStorage.setItem('theme', theme);\n  }, [theme]);\n\n  const handleThemeChange = (newTheme: Theme) => {\n    setTheme(newTheme);\n  };\n\n  return (\n    <div className=\"flex items-center gap-0 bg-muted/50 p-1 rounded-lg backdrop-blur-sm border border-border/50\" data-testid=\"toggle-theme\">\n      <button\n        onClick={() => handleThemeChange('dark')}\n        className={`\n          flex items-center justify-center h-8 px-3 rounded-md transition-all duration-200\n          ${theme === 'dark' \n            ? 'bg-background shadow-sm text-foreground' \n            : 'text-muted-foreground hover:text-foreground hover:bg-background/50'\n          }\n        `}\n        data-testid=\"button-theme-dark\"\n        aria-label=\"Dark theme\"\n      >\n        <Moon className=\"h-4 w-4\" />\n      </button>\n      \n      <button\n        onClick={() => handleThemeChange('unicorn')}\n        className={`\n          flex items-center justify-center h-8 px-3 rounded-md transition-all duration-200\n          ${theme === 'unicorn' \n            ? 'bg-gradient-to-r from-pink-500 via-purple-500 to-cyan-500 shadow-sm text-white' \n            : 'text-muted-foreground hover:text-foreground hover:bg-background/50'\n          }\n        `}\n        data-testid=\"button-theme-unicorn\"\n        aria-label=\"Unicorn theme\"\n      >\n        <Sparkles className=\"h-4 w-4\" />\n      </button>\n      \n      <button\n        onClick={() => handleThemeChange('light')}\n        className={`\n          flex items-center justify-center h-8 px-3 rounded-md transition-all duration-200\n          ${theme === 'light' \n            ? 'bg-background shadow-sm text-foreground' \n            : 'text-muted-foreground hover:text-foreground hover:bg-background/50'\n          }\n        `}\n        data-testid=\"button-theme-light\"\n        aria-label=\"Light theme\"\n      >\n        <Sun className=\"h-4 w-4\" />\n      </button>\n    </div>\n  );\n}\n","size_bytes":2356},"server/storage.ts":{"content":"import { users, timePunches, workOrders, workOrderTasks, notifications, appointments, messages, customers, conversations, type User, type InsertUser, type UpdateUser, type TimePunch, type InsertTimePunch, type WorkOrder, type InsertWorkOrder, type WorkOrderTask, type InsertTask, type Notification, type InsertNotification, type Appointment, type InsertAppointment, type UpdateAppointment, type Message, type InsertMessage, type Customer, type InsertCustomer, type Conversation, type InsertConversation } from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, gte, lte, isNull, desc, sql } from \"drizzle-orm\";\nimport bcrypt from \"bcryptjs\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserById(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmployeeId(employeeId: string): Promise<User | undefined>;\n  getUserByRole(role: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, data: UpdateUser): Promise<User | undefined>;\n  getAllUsers(): Promise<User[]>;\n  getUsersByRole(role: string): Promise<User[]>;\n  \n  createNotification(notification: InsertNotification): Promise<Notification>;\n  getUserNotifications(userId: string, limit?: number): Promise<Notification[]>;\n  getUnreadNotificationCount(userId: string): Promise<number>;\n  markNotificationAsRead(id: string, userId: string): Promise<boolean>;\n  markAllNotificationsAsRead(userId: string): Promise<void>;\n  \n  clockIn(userId: string): Promise<TimePunch>;\n  clockOut(userId: string): Promise<TimePunch | undefined>;\n  getCurrentPunch(userId: string): Promise<TimePunch | undefined>;\n  getTodayPunches(userId: string): Promise<TimePunch[]>;\n  getWeekPunches(userId: string): Promise<TimePunch[]>;\n  \n  createWorkOrder(workOrder: InsertWorkOrder): Promise<WorkOrder>;\n  getAllWorkOrders(): Promise<WorkOrder[]>;\n  getWorkOrder(id: string): Promise<WorkOrder | undefined>;\n  getWorkOrderByNumber(workOrderNumber: string): Promise<WorkOrder | undefined>;\n  updateWorkOrder(id: string, data: Partial<WorkOrder>): Promise<WorkOrder | undefined>;\n  assignWorkOrder(id: string, userId: string): Promise<WorkOrder | undefined>;\n  closeWorkOrder(id: string): Promise<WorkOrder | undefined>;\n  getAssignedWorkOrders(userId: string): Promise<WorkOrder[]>;\n  \n  createTask(task: Omit<InsertTask, 'workOrderId'> & { workOrderId: string }): Promise<WorkOrderTask>;\n  getWorkOrderTasks(workOrderId: string): Promise<WorkOrderTask[]>;\n  updateTask(id: string, data: Partial<WorkOrderTask>): Promise<WorkOrderTask | undefined>;\n  deleteTask(id: string): Promise<void>;\n  calculateTotalBudgetedHours(workOrderId: string): Promise<number>;\n  \n  clockInTask(userId: string, taskId: string, workOrderId: string): Promise<TimePunch>;\n  clockOutTask(userId: string, taskId?: string): Promise<TimePunch | undefined>;\n  getCurrentTaskPunch(userId: string, taskId?: string): Promise<TimePunch | undefined>;\n  getTaskPunches(taskId: string): Promise<TimePunch[]>;\n  calculateTaskHours(taskId: string): Promise<number>;\n  calculateWorkOrderHours(workOrderId: string): Promise<number>;\n  updateTimePunch(id: string, data: Partial<TimePunch>): Promise<TimePunch | undefined>;\n  deleteTimePunch(id: string): Promise<void>;\n  getAllWorkOrderPunches(workOrderId: string): Promise<TimePunch[]>;\n  \n  createAppointment(appointment: InsertAppointment): Promise<Appointment>;\n  getAllAppointments(): Promise<Appointment[]>;\n  getAppointment(id: string): Promise<Appointment | undefined>;\n  updateAppointment(id: string, data: UpdateAppointment): Promise<Appointment | undefined>;\n  deleteAppointment(id: string): Promise<void>;\n  getUserAppointments(userId: string): Promise<Appointment[]>;\n  getAppointmentsByDate(date: string): Promise<Appointment[]>;\n  \n  createMessage(message: InsertMessage): Promise<Message>;\n  getMessagesByHeadquarters(headquarters: string): Promise<Message[]>;\n  getMessagesByDepartment(department: string): Promise<Message[]>;\n  getMessagesByConversation(conversationId: string): Promise<Message[]>;\n  \n  createConversation(conversation: InsertConversation): Promise<Conversation>;\n  getUserConversations(userId: string): Promise<Conversation[]>;\n  getConversation(participant1: string, participant2: string): Promise<Conversation | undefined>;\n  getConversationById(id: string): Promise<Conversation | undefined>;\n  getOrCreateConversation(userId1: string, userId2: string): Promise<Conversation>;\n  \n  createCustomer(customer: InsertCustomer & { createdBy: string }): Promise<Customer>;\n  getAllCustomers(): Promise<Customer[]>;\n  getCustomer(id: string): Promise<Customer | undefined>;\n  \n  updateUserProfilePicture(userId: string, profilePicture: string): Promise<User | undefined>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    return this.getUser(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async getUserByEmployeeId(employeeId: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.employeeId, employeeId));\n    return user || undefined;\n  }\n\n  async getUserByRole(role: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.role, role as any));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const passwordHash = await bcrypt.hash(insertUser.password, 10);\n    const [user] = await db\n      .insert(users)\n      .values({\n        username: insertUser.username,\n        employeeId: insertUser.employeeId,\n        passwordHash,\n        role: insertUser.role ?? \"technician\",\n        email: insertUser.email && insertUser.email !== \"\" ? insertUser.email : null,\n        department: insertUser.department || null,\n        occupation: insertUser.occupation || null,\n        headquarters: insertUser.headquarters || null,\n        profilePicture: \"/default-avatar.jpeg\",\n      })\n      .returning();\n    return user;\n  }\n\n  async updateUser(id: string, data: UpdateUser): Promise<User | undefined> {\n    const updateData: Partial<typeof users.$inferInsert> = {};\n    if (data.email !== undefined) updateData.email = data.email && data.email !== \"\" ? data.email : null;\n    if (data.department !== undefined) updateData.department = data.department || null;\n    if (data.occupation !== undefined) updateData.occupation = data.occupation || null;\n    if (data.headquarters !== undefined) updateData.headquarters = data.headquarters || null;\n    if (data.role !== undefined) updateData.role = data.role;\n    if (data.isActive !== undefined) updateData.isActive = data.isActive;\n    if (data.profilePicture !== undefined) updateData.profilePicture = data.profilePicture && data.profilePicture !== \"\" ? data.profilePicture : null;\n    if (data.bannerImage !== undefined) updateData.bannerImage = data.bannerImage && data.bannerImage !== \"\" ? data.bannerImage : null;\n    if (data.mood !== undefined) updateData.mood = data.mood;\n\n    const [user] = await db\n      .update(users)\n      .set(updateData)\n      .where(eq(users.id, id))\n      .returning();\n    return user || undefined;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users).orderBy(users.username);\n  }\n\n  async getUsersByRole(role: string): Promise<User[]> {\n    return await db.select().from(users).where(eq(users.role, role as any));\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const [result] = await db\n      .insert(notifications)\n      .values(notification)\n      .returning();\n    return result;\n  }\n\n  async getUserNotifications(userId: string, limit: number = 50): Promise<Notification[]> {\n    return await db\n      .select()\n      .from(notifications)\n      .where(eq(notifications.userId, userId))\n      .orderBy(desc(notifications.createdAt))\n      .limit(limit);\n  }\n\n  async getUnreadNotificationCount(userId: string): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(notifications)\n      .where(and(\n        eq(notifications.userId, userId),\n        eq(notifications.isRead, 'false')\n      ));\n    return result[0]?.count || 0;\n  }\n\n  async markNotificationAsRead(id: string, userId: string): Promise<boolean> {\n    const result = await db\n      .update(notifications)\n      .set({ isRead: 'true' })\n      .where(and(\n        eq(notifications.id, id),\n        eq(notifications.userId, userId)\n      ))\n      .returning();\n    return result.length > 0;\n  }\n\n  async markAllNotificationsAsRead(userId: string): Promise<void> {\n    await db\n      .update(notifications)\n      .set({ isRead: 'true' })\n      .where(eq(notifications.userId, userId));\n  }\n\n  async clockIn(userId: string): Promise<TimePunch> {\n    const now = new Date();\n    const today = now.toISOString().split('T')[0];\n    \n    const [punch] = await db\n      .insert(timePunches)\n      .values({\n        userId,\n        punchType: \"work\",\n        clockIn: now,\n        punchDate: today,\n      })\n      .returning();\n    return punch;\n  }\n\n  async clockOut(userId: string): Promise<TimePunch | undefined> {\n    const currentPunch = await this.getCurrentPunch(userId);\n    if (!currentPunch) return undefined;\n\n    const [punch] = await db\n      .update(timePunches)\n      .set({ clockOut: new Date() })\n      .where(eq(timePunches.id, currentPunch.id))\n      .returning();\n    return punch;\n  }\n\n  async getCurrentPunch(userId: string): Promise<TimePunch | undefined> {\n    const [punch] = await db\n      .select()\n      .from(timePunches)\n      .where(and(\n        eq(timePunches.userId, userId),\n        isNull(timePunches.clockOut)\n      ))\n      .orderBy(desc(timePunches.clockIn))\n      .limit(1);\n    return punch || undefined;\n  }\n\n  async getTodayPunches(userId: string): Promise<TimePunch[]> {\n    const today = new Date().toISOString().split('T')[0];\n    return await db\n      .select()\n      .from(timePunches)\n      .where(and(\n        eq(timePunches.userId, userId),\n        eq(timePunches.punchDate, today)\n      ))\n      .orderBy(desc(timePunches.clockIn));\n  }\n\n  async getWeekPunches(userId: string): Promise<TimePunch[]> {\n    const today = new Date();\n    const weekStart = new Date(today);\n    weekStart.setDate(today.getDate() - today.getDay());\n    weekStart.setHours(0, 0, 0, 0);\n    const weekStartStr = weekStart.toISOString().split('T')[0];\n    \n    return await db\n      .select()\n      .from(timePunches)\n      .where(and(\n        eq(timePunches.userId, userId),\n        gte(timePunches.punchDate, weekStartStr)\n      ))\n      .orderBy(desc(timePunches.clockIn));\n  }\n\n  async createWorkOrder(insertWorkOrder: InsertWorkOrder): Promise<WorkOrder> {\n    const { tasks, ...workOrderData } = insertWorkOrder;\n    \n    // Get the count of existing work orders to generate the next number\n    const existingWorkOrders = await db\n      .select()\n      .from(workOrders)\n      .orderBy(desc(workOrders.createdAt));\n    \n    const nextNumber = existingWorkOrders.length + 1;\n    const workOrderNumber = `W${nextNumber}`;\n    \n    const [workOrder] = await db\n      .insert(workOrders)\n      .values({\n        ...workOrderData,\n        workOrderNumber,\n      })\n      .returning();\n    \n    if (tasks && tasks.length > 0) {\n      await db.insert(workOrderTasks).values(\n        tasks.map((task, index) => ({\n          workOrderId: workOrder.id,\n          title: task.title,\n          description: task.description || null,\n          budgetedHours: task.budgetedHours,\n          sortOrder: index,\n        }))\n      );\n    }\n    \n    return workOrder;\n  }\n\n  async getAllWorkOrders(): Promise<WorkOrder[]> {\n    return await db\n      .select()\n      .from(workOrders)\n      .orderBy(desc(workOrders.createdAt));\n  }\n\n  async getWorkOrder(id: string): Promise<WorkOrder | undefined> {\n    const [workOrder] = await db\n      .select()\n      .from(workOrders)\n      .where(eq(workOrders.id, id));\n    return workOrder || undefined;\n  }\n\n  async getWorkOrderByNumber(workOrderNumber: string): Promise<WorkOrder | undefined> {\n    const [workOrder] = await db\n      .select()\n      .from(workOrders)\n      .where(eq(workOrders.workOrderNumber, workOrderNumber));\n    return workOrder || undefined;\n  }\n\n  async updateWorkOrder(id: string, data: Partial<WorkOrder>): Promise<WorkOrder | undefined> {\n    const [workOrder] = await db\n      .update(workOrders)\n      .set(data)\n      .where(eq(workOrders.id, id))\n      .returning();\n    return workOrder || undefined;\n  }\n\n  async assignWorkOrder(id: string, userId: string): Promise<WorkOrder | undefined> {\n    const [workOrder] = await db\n      .update(workOrders)\n      .set({ \n        assignedTo: userId,\n        status: \"assigned\" \n      })\n      .where(eq(workOrders.id, id))\n      .returning();\n    return workOrder || undefined;\n  }\n\n  async closeWorkOrder(id: string): Promise<WorkOrder | undefined> {\n    const actualHours = await this.calculateWorkOrderHours(id);\n    const budgetedHours = await this.calculateTotalBudgetedHours(id);\n    const workOrder = await this.getWorkOrder(id);\n    if (!workOrder) return undefined;\n\n    let efficiency: number | null = null;\n    if (actualHours > 0 && budgetedHours > 0) {\n      efficiency = (budgetedHours / actualHours) * 100;\n    }\n\n    const [updated] = await db\n      .update(workOrders)\n      .set({ \n        status: \"completed\",\n        actualHours,\n        efficiency,\n        completedAt: new Date()\n      })\n      .where(eq(workOrders.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async getAssignedWorkOrders(userId: string): Promise<WorkOrder[]> {\n    return await db\n      .select()\n      .from(workOrders)\n      .where(eq(workOrders.assignedTo, userId))\n      .orderBy(desc(workOrders.createdAt));\n  }\n\n  async clockInWorkOrder(userId: string, workOrderId: string): Promise<TimePunch> {\n    const now = new Date();\n    const today = now.toISOString().split('T')[0];\n    \n    const [punch] = await db\n      .insert(timePunches)\n      .values({\n        userId,\n        workOrderId,\n        punchType: \"work\",\n        clockIn: now,\n        punchDate: today,\n      })\n      .returning();\n\n    await db\n      .update(workOrders)\n      .set({ status: \"in-progress\" })\n      .where(eq(workOrders.id, workOrderId));\n\n    return punch;\n  }\n\n  async clockOutWorkOrder(userId: string, workOrderId?: string): Promise<TimePunch | undefined> {\n    const currentPunch = await this.getCurrentWorkOrderPunch(userId, workOrderId);\n    if (!currentPunch) return undefined;\n\n    const [punch] = await db\n      .update(timePunches)\n      .set({ clockOut: new Date() })\n      .where(eq(timePunches.id, currentPunch.id))\n      .returning();\n\n    if (currentPunch.workOrderId) {\n      const actualHours = await this.calculateWorkOrderHours(currentPunch.workOrderId);\n      await db\n        .update(workOrders)\n        .set({ actualHours })\n        .where(eq(workOrders.id, currentPunch.workOrderId));\n    }\n\n    return punch;\n  }\n\n  async getCurrentWorkOrderPunch(userId: string, workOrderId?: string): Promise<TimePunch | undefined> {\n    const conditions = [\n      eq(timePunches.userId, userId),\n      isNull(timePunches.clockOut)\n    ];\n    \n    if (workOrderId) {\n      conditions.push(eq(timePunches.workOrderId, workOrderId));\n    }\n\n    const [punch] = await db\n      .select()\n      .from(timePunches)\n      .where(and(...conditions))\n      .orderBy(desc(timePunches.clockIn))\n      .limit(1);\n    return punch || undefined;\n  }\n\n  async getWorkOrderPunches(workOrderId: string): Promise<TimePunch[]> {\n    return await db\n      .select()\n      .from(timePunches)\n      .where(eq(timePunches.workOrderId, workOrderId))\n      .orderBy(desc(timePunches.clockIn));\n  }\n\n  async calculateWorkOrderHours(workOrderId: string): Promise<number> {\n    const punches = await this.getWorkOrderPunches(workOrderId);\n    let totalHours = 0;\n\n    for (const punch of punches) {\n      if (punch.clockOut && punch.punchType === \"work\") {\n        const clockIn = new Date(punch.clockIn).getTime();\n        const clockOut = new Date(punch.clockOut).getTime();\n        const hours = (clockOut - clockIn) / (1000 * 60 * 60);\n        totalHours += hours;\n      }\n    }\n\n    return totalHours;\n  }\n\n  async createTask(task: Omit<InsertTask, 'workOrderId'> & { workOrderId: string }): Promise<WorkOrderTask> {\n    const [newTask] = await db\n      .insert(workOrderTasks)\n      .values(task)\n      .returning();\n    return newTask;\n  }\n\n  async getWorkOrderTasks(workOrderId: string): Promise<WorkOrderTask[]> {\n    return await db\n      .select()\n      .from(workOrderTasks)\n      .where(eq(workOrderTasks.workOrderId, workOrderId))\n      .orderBy(workOrderTasks.sortOrder);\n  }\n\n  async updateTask(id: string, data: Partial<WorkOrderTask>): Promise<WorkOrderTask | undefined> {\n    const [task] = await db\n      .update(workOrderTasks)\n      .set(data)\n      .where(eq(workOrderTasks.id, id))\n      .returning();\n    return task || undefined;\n  }\n\n  async deleteTask(id: string): Promise<void> {\n    await db\n      .delete(workOrderTasks)\n      .where(eq(workOrderTasks.id, id));\n  }\n\n  async calculateTotalBudgetedHours(workOrderId: string): Promise<number> {\n    const tasks = await this.getWorkOrderTasks(workOrderId);\n    return tasks.reduce((total, task) => total + task.budgetedHours, 0);\n  }\n\n  async clockInTask(userId: string, taskId: string, workOrderId: string): Promise<TimePunch> {\n    const now = new Date();\n    const today = now.toISOString().split('T')[0];\n    \n    const [punch] = await db\n      .insert(timePunches)\n      .values({\n        userId,\n        taskId,\n        workOrderId,\n        punchType: \"work\",\n        clockIn: now,\n        punchDate: today,\n      })\n      .returning();\n\n    await db\n      .update(workOrders)\n      .set({ status: \"in-progress\" })\n      .where(eq(workOrders.id, workOrderId));\n\n    return punch;\n  }\n\n  async clockOutTask(userId: string, taskId?: string): Promise<TimePunch | undefined> {\n    const currentPunch = await this.getCurrentTaskPunch(userId, taskId);\n    if (!currentPunch) return undefined;\n\n    const [punch] = await db\n      .update(timePunches)\n      .set({ clockOut: new Date() })\n      .where(eq(timePunches.id, currentPunch.id))\n      .returning();\n\n    if (currentPunch.workOrderId) {\n      const actualHours = await this.calculateWorkOrderHours(currentPunch.workOrderId);\n      await db\n        .update(workOrders)\n        .set({ actualHours })\n        .where(eq(workOrders.id, currentPunch.workOrderId));\n    }\n\n    return punch;\n  }\n\n  async getCurrentTaskPunch(userId: string, taskId?: string): Promise<TimePunch | undefined> {\n    const conditions = [\n      eq(timePunches.userId, userId),\n      eq(timePunches.punchType, \"work\"),\n      isNull(timePunches.clockOut)\n    ];\n    \n    if (taskId) {\n      conditions.push(eq(timePunches.taskId, taskId));\n    }\n\n    const [punch] = await db\n      .select()\n      .from(timePunches)\n      .where(and(...conditions))\n      .orderBy(desc(timePunches.clockIn))\n      .limit(1);\n    return punch || undefined;\n  }\n\n\n  async getTaskPunches(taskId: string): Promise<TimePunch[]> {\n    return await db\n      .select()\n      .from(timePunches)\n      .where(eq(timePunches.taskId, taskId))\n      .orderBy(desc(timePunches.clockIn));\n  }\n\n  async calculateTaskHours(taskId: string): Promise<number> {\n    const punches = await this.getTaskPunches(taskId);\n    let totalHours = 0;\n\n    for (const punch of punches) {\n      if (punch.clockOut && punch.punchType === \"work\") {\n        const clockIn = new Date(punch.clockIn).getTime();\n        const clockOut = new Date(punch.clockOut).getTime();\n        const hours = (clockOut - clockIn) / (1000 * 60 * 60);\n        totalHours += hours;\n      }\n    }\n\n    return totalHours;\n  }\n\n  async updateTimePunch(id: string, data: Partial<TimePunch>): Promise<TimePunch | undefined> {\n    const [punch] = await db\n      .update(timePunches)\n      .set(data)\n      .where(eq(timePunches.id, id))\n      .returning();\n    \n    if (punch && punch.workOrderId) {\n      const actualHours = await this.calculateWorkOrderHours(punch.workOrderId);\n      await db\n        .update(workOrders)\n        .set({ actualHours })\n        .where(eq(workOrders.id, punch.workOrderId));\n    }\n    \n    return punch || undefined;\n  }\n\n  async deleteTimePunch(id: string): Promise<void> {\n    const [punch] = await db\n      .select()\n      .from(timePunches)\n      .where(eq(timePunches.id, id));\n    \n    await db\n      .delete(timePunches)\n      .where(eq(timePunches.id, id));\n    \n    if (punch && punch.workOrderId) {\n      const actualHours = await this.calculateWorkOrderHours(punch.workOrderId);\n      await db\n        .update(workOrders)\n        .set({ actualHours })\n        .where(eq(workOrders.id, punch.workOrderId));\n    }\n  }\n\n  async getAllWorkOrderPunches(workOrderId: string): Promise<TimePunch[]> {\n    return await db\n      .select()\n      .from(timePunches)\n      .where(eq(timePunches.workOrderId, workOrderId))\n      .orderBy(timePunches.clockIn);\n  }\n\n  async createAppointment(appointment: InsertAppointment): Promise<Appointment> {\n    const [result] = await db\n      .insert(appointments)\n      .values({\n        ...appointment,\n        customerPhone: appointment.customerPhone && appointment.customerPhone !== \"\" ? appointment.customerPhone : null,\n        customerEmail: appointment.customerEmail && appointment.customerEmail !== \"\" ? appointment.customerEmail : null,\n        assignedTo: appointment.assignedTo && appointment.assignedTo !== \"\" ? appointment.assignedTo : null,\n        notes: appointment.notes && appointment.notes !== \"\" ? appointment.notes : null,\n      })\n      .returning();\n    return result;\n  }\n\n  async getAllAppointments(): Promise<Appointment[]> {\n    return await db\n      .select()\n      .from(appointments)\n      .orderBy(desc(appointments.appointmentDate));\n  }\n\n  async getAppointment(id: string): Promise<Appointment | undefined> {\n    const [appointment] = await db\n      .select()\n      .from(appointments)\n      .where(eq(appointments.id, id));\n    return appointment || undefined;\n  }\n\n  async updateAppointment(id: string, data: UpdateAppointment): Promise<Appointment | undefined> {\n    const updateData: Partial<typeof appointments.$inferInsert> = {};\n    \n    if (data.appointmentDate !== undefined) updateData.appointmentDate = data.appointmentDate;\n    if (data.appointmentTime !== undefined) updateData.appointmentTime = data.appointmentTime;\n    if (data.customer !== undefined) updateData.customer = data.customer;\n    if (data.customerPhone !== undefined) updateData.customerPhone = data.customerPhone && data.customerPhone !== \"\" ? data.customerPhone : null;\n    if (data.customerEmail !== undefined) updateData.customerEmail = data.customerEmail && data.customerEmail !== \"\" ? data.customerEmail : null;\n    if (data.assignedTo !== undefined) updateData.assignedTo = data.assignedTo && data.assignedTo !== \"\" ? data.assignedTo : null;\n    if (data.serviceType !== undefined) updateData.serviceType = data.serviceType;\n    if (data.notes !== undefined) updateData.notes = data.notes && data.notes !== \"\" ? data.notes : null;\n    if (data.status !== undefined) updateData.status = data.status;\n\n    const [appointment] = await db\n      .update(appointments)\n      .set(updateData)\n      .where(eq(appointments.id, id))\n      .returning();\n    return appointment || undefined;\n  }\n\n  async deleteAppointment(id: string): Promise<void> {\n    await db\n      .delete(appointments)\n      .where(eq(appointments.id, id));\n  }\n\n  async getUserAppointments(userId: string): Promise<Appointment[]> {\n    return await db\n      .select()\n      .from(appointments)\n      .where(eq(appointments.assignedTo, userId))\n      .orderBy(desc(appointments.appointmentDate));\n  }\n\n  async getAppointmentsByDate(date: string): Promise<Appointment[]> {\n    return await db\n      .select()\n      .from(appointments)\n      .where(eq(appointments.appointmentDate, date))\n      .orderBy(appointments.appointmentTime);\n  }\n\n  async createMessage(message: InsertMessage): Promise<Message> {\n    const [result] = await db\n      .insert(messages)\n      .values(message)\n      .returning();\n    return result;\n  }\n\n  async getMessagesByHeadquarters(headquarters: string): Promise<Message[]> {\n    return await db\n      .select()\n      .from(messages)\n      .where(and(\n        eq(messages.channelType, \"headquarters\"),\n        eq(messages.headquarters, headquarters as any)\n      ))\n      .orderBy(messages.createdAt);\n  }\n\n  async getMessagesByDepartment(department: string): Promise<Message[]> {\n    return await db\n      .select()\n      .from(messages)\n      .where(and(\n        eq(messages.channelType, \"department\"),\n        eq(messages.department, department as any)\n      ))\n      .orderBy(messages.createdAt);\n  }\n\n  async getMessagesByConversation(conversationId: string): Promise<Message[]> {\n    return await db\n      .select()\n      .from(messages)\n      .where(eq(messages.conversationId, conversationId))\n      .orderBy(messages.createdAt);\n  }\n\n  async createConversation(conversation: InsertConversation): Promise<Conversation> {\n    // Prevent self-conversations at storage level\n    if (conversation.participant1 === conversation.participant2) {\n      throw new Error(\"Cannot create conversation with yourself\");\n    }\n\n    // Normalize participant order for uniqueness check\n    const [p1, p2] = conversation.participant1 < conversation.participant2 \n      ? [conversation.participant1, conversation.participant2]\n      : [conversation.participant2, conversation.participant1];\n\n    // Check for existing conversation\n    const existing = await this.getConversation(p1, p2);\n    if (existing) {\n      return existing;\n    }\n\n    const [result] = await db\n      .insert(conversations)\n      .values({ ...conversation, participant1: p1, participant2: p2 })\n      .returning();\n    return result;\n  }\n\n  async getUserConversations(userId: string): Promise<Conversation[]> {\n    return await db\n      .select()\n      .from(conversations)\n      .where(sql`${conversations.participant1} = ${userId} OR ${conversations.participant2} = ${userId}`)\n      .orderBy(desc(conversations.lastMessageAt));\n  }\n\n  async getConversation(participant1: string, participant2: string): Promise<Conversation | undefined> {\n    const [conversation] = await db\n      .select()\n      .from(conversations)\n      .where(sql`\n        (${conversations.participant1} = ${participant1} AND ${conversations.participant2} = ${participant2})\n        OR\n        (${conversations.participant1} = ${participant2} AND ${conversations.participant2} = ${participant1})\n      `);\n    return conversation || undefined;\n  }\n\n  async getConversationById(id: string): Promise<Conversation | undefined> {\n    const [conversation] = await db\n      .select()\n      .from(conversations)\n      .where(eq(conversations.id, id));\n    return conversation || undefined;\n  }\n\n  async getOrCreateConversation(userId1: string, userId2: string): Promise<Conversation> {\n    // Normalize order for consistency\n    const [p1, p2] = userId1 < userId2 ? [userId1, userId2] : [userId2, userId1];\n\n    // Try to get existing conversation\n    const existing = await this.getConversation(p1, p2);\n    if (existing) {\n      return existing;\n    }\n\n    // Create new conversation\n    return this.createConversation({ participant1: p1, participant2: p2 });\n  }\n\n  async createCustomer(customer: InsertCustomer & { createdBy: string }): Promise<Customer> {\n    const [result] = await db\n      .insert(customers)\n      .values({\n        ...customer,\n        phone: customer.phone && customer.phone !== \"\" ? customer.phone : null,\n        email: customer.email && customer.email !== \"\" ? customer.email : null,\n        address: customer.address && customer.address !== \"\" ? customer.address : null,\n      })\n      .returning();\n    return result;\n  }\n\n  async getAllCustomers(): Promise<Customer[]> {\n    return await db\n      .select()\n      .from(customers)\n      .orderBy(desc(customers.createdAt));\n  }\n\n  async getCustomer(id: string): Promise<Customer | undefined> {\n    const [customer] = await db\n      .select()\n      .from(customers)\n      .where(eq(customers.id, id));\n    return customer || undefined;\n  }\n\n  async updateUserProfilePicture(userId: string, profilePicture: string): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ profilePicture })\n      .where(eq(users.id, userId))\n      .returning();\n    return user || undefined;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":29024},"client/src/components/AppSidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n} from \"@/components/ui/sidebar\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport elevexLogoUrl from \"@assets/IMG_8549_1763925147777.jpeg\";\n\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { data: user } = useAuth();\n  const { t } = useLanguage();\n  const { theme } = useTheme();\n\n  const departments = [\n    {\n      titleKey: \"nav_dashboard\" as const,\n      url: \"/\",\n      icon: \"fa-home\",\n      testId: \"link-dashboard\",\n    },\n    {\n      titleKey: \"nav_sales\" as const,\n      url: \"/sales\",\n      icon: \"fa-dollar-sign\",\n      testId: \"link-sales\",\n    },\n    {\n      titleKey: \"nav_rental\" as const,\n      url: \"/rental\",\n      icon: \"fa-truck\",\n      testId: \"link-rental\",\n    },\n    {\n      titleKey: \"nav_work_orders\" as const,\n      url: \"/work-orders\",\n      icon: \"fa-clipboard-list\",\n      testId: \"link-work-orders\",\n    },\n    {\n      titleKey: \"nav_appointments\" as const,\n      url: \"/appointments\",\n      icon: \"fa-calendar-check\",\n      testId: \"link-appointments\",\n    },\n    {\n      titleKey: \"nav_accounting\" as const,\n      url: \"/accounting\",\n      icon: \"fa-calculator\",\n      testId: \"link-accounting\",\n    },\n    {\n      titleKey: \"nav_warranty\" as const,\n      url: \"/warranty\",\n      icon: \"fa-shield-alt\",\n      testId: \"link-warranty\",\n    },\n    {\n      titleKey: \"nav_messages\" as const,\n      url: \"/messages\",\n      icon: \"fa-comments\",\n      testId: \"link-messages\",\n    },\n    {\n      titleKey: \"nav_parts\" as const,\n      url: \"/parts\",\n      icon: \"fa-boxes\",\n      testId: \"link-parts\",\n    },\n  ];\n\n  const adminMenuItems = [\n    {\n      titleKey: \"nav_create_user\" as const,\n      url: \"/admin/create-user\",\n      icon: \"fa-user-plus\",\n      testId: \"link-create-user\",\n    },\n  ];\n\n  return (\n    <Sidebar className=\"border-r border-sidebar-border\">\n      <SidebarHeader className=\"p-4 md:p-6 border-b border-sidebar-border relative overflow-hidden\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-cyan-500/5 via-purple-500/5 to-pink-500/5\"></div>\n        <Link href=\"/\">\n          <div className=\"relative flex flex-col items-center gap-2 cursor-pointer hover-elevate rounded-lg p-3 -m-2 transition-all duration-300\">\n            <img\n              src={elevexLogoUrl}\n              alt=\"ELEVEX Logo\"\n              className=\"w-24 h-auto max-h-40 object-contain\"\n              data-testid=\"sidebar-logo\"\n            />\n          </div>\n        </Link>\n      </SidebarHeader>\n      <SidebarContent className=\"px-2 md:px-3 py-3 md:py-4\">\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"text-xs font-bold uppercase tracking-wider mb-2 px-2 md:px-3\">\n            {t(\"nav_departments\")}\n          </SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu className=\"space-y-1\">\n              {departments.map((item) => (\n                <SidebarMenuItem key={item.titleKey}>\n                  <SidebarMenuButton \n                    asChild \n                    isActive={location === item.url} \n                    data-testid={item.testId}\n                    className=\"group relative overflow-hidden transition-all duration-300\"\n                  >\n                    <Link href={item.url}>\n                      {location === item.url && (\n                        <div className=\"absolute inset-0 bg-gradient-to-r from-cyan-500/10 via-purple-500/10 to-pink-500/10 animate-pulse\"></div>\n                      )}\n                      <div className=\"flex items-center gap-3 w-full relative z-10\">\n                        <div className={`flex items-center justify-center w-9 h-9 rounded-xl transition-all duration-300 ${\n                          location === item.url \n                            ? 'bg-gradient-to-br from-cyan-500 via-purple-500 to-pink-500 text-white shadow-lg shadow-primary/30' \n                            : 'bg-sidebar-accent text-sidebar-accent-foreground group-hover:bg-gradient-to-br group-hover:from-cyan-500/80 group-hover:via-purple-500/80 group-hover:to-pink-500/80 group-hover:text-white'\n                        }`}>\n                          <i className={`fas ${item.icon} text-sm`}></i>\n                        </div>\n                        <span className={`font-medium transition-colors duration-300 ${\n                          location === item.url ? 'text-primary' : ''\n                        }`}>{t(item.titleKey)}</span>\n                      </div>\n                      {location === item.url && (\n                        <div className=\"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-gradient-to-b from-cyan-500 via-purple-500 to-pink-500 rounded-r-full\"></div>\n                      )}\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        {user?.role === \"admin\" && (\n          <SidebarGroup className=\"mt-6\">\n            <SidebarGroupLabel className=\"text-xs font-bold uppercase tracking-wider mb-2 px-3\">\n              {t(\"nav_admin\")}\n            </SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu className=\"space-y-1\">\n                {adminMenuItems.map((item) => (\n                  <SidebarMenuItem key={item.titleKey}>\n                    <SidebarMenuButton \n                      asChild \n                      isActive={location === item.url} \n                      data-testid={item.testId}\n                      className=\"group relative overflow-hidden transition-all duration-300\"\n                    >\n                      <Link href={item.url}>\n                        {location === item.url && (\n                          <div className=\"absolute inset-0 bg-gradient-to-r from-cyan-500/10 via-purple-500/10 to-pink-500/10 animate-pulse\"></div>\n                        )}\n                        <div className=\"flex items-center gap-3 w-full relative z-10\">\n                          <div className={`flex items-center justify-center w-9 h-9 rounded-xl transition-all duration-300 ${\n                            location === item.url \n                              ? 'bg-gradient-to-br from-cyan-500 via-purple-500 to-pink-500 text-white shadow-lg shadow-primary/30' \n                              : 'bg-sidebar-accent text-sidebar-accent-foreground group-hover:bg-gradient-to-br group-hover:from-cyan-500/80 group-hover:via-purple-500/80 group-hover:to-pink-500/80 group-hover:text-white'\n                          }`}>\n                            <i className={`fas ${item.icon} text-sm`}></i>\n                          </div>\n                          <span className={`font-medium transition-colors duration-300 ${\n                            location === item.url ? 'text-primary' : ''\n                          }`}>{t(item.titleKey)}</span>\n                        </div>\n                        {location === item.url && (\n                          <div className=\"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-8 bg-gradient-to-b from-cyan-500 via-purple-500 to-pink-500 rounded-r-full\"></div>\n                        )}\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n      </SidebarContent>\n    </Sidebar>\n  );\n}","size_bytes":7713},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/AuthButton.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useAuth, logout } from \"@/lib/auth\";\nimport { User } from \"lucide-react\";\n\nexport function AuthButton() {\n  const { data: user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return null;\n  }\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button\n          data-testid=\"button-user-menu\"\n          variant=\"ghost\"\n          className=\"relative h-10 w-10 rounded-full\"\n        >\n          <Avatar className=\"h-10 w-10\">\n            <AvatarFallback>\n              <User className=\"h-5 w-5\" />\n            </AvatarFallback>\n          </Avatar>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent className=\"w-56\" align=\"end\" forceMount>\n        <DropdownMenuLabel className=\"font-normal\">\n          <div className=\"flex flex-col space-y-1\">\n            <p className=\"text-sm font-medium leading-none\" data-testid=\"text-username\">\n              {user.username}\n            </p>\n            <p className=\"text-xs leading-none text-muted-foreground\" data-testid=\"text-role\">\n              {user.role}\n            </p>\n          </div>\n        </DropdownMenuLabel>\n        <DropdownMenuSeparator />\n        <DropdownMenuItem data-testid=\"button-logout\" onClick={logout}>\n          Log out\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","size_bytes":1655},"server/websocket.ts":{"content":"import { WebSocketServer, WebSocket } from \"ws\";\nimport type { Server } from \"http\";\nimport { storage } from \"./storage\";\n\ninterface Client {\n  ws: WebSocket;\n  username: string;\n  isAlive: boolean;\n}\n\ninterface ChatMessage {\n  id: string;\n  from: string;\n  to: string;\n  message: string;\n  timestamp: string;\n}\n\nclass ChatServer {\n  private wss: WebSocketServer | null = null;\n  private clients: Map<string, Client> = new Map();\n  private messageHandlers: Map<string, (message: ChatMessage) => void> = new Map();\n\n  initialize(server: Server) {\n    this.wss = new WebSocketServer({ server });\n\n    this.wss.on(\"connection\", async (ws, req) => {\n      // Extract session cookie from request headers\n      const cookies = req.headers.cookie?.split(\"; \") || [];\n      const sessionCookie = cookies.find(c => c.startsWith(\"connect.sid=\"));\n      \n      if (!sessionCookie) {\n        ws.send(JSON.stringify({ type: \"error\", message: \"Unauthorized\" }));\n        ws.close();\n        return;\n      }\n\n      // For now, we'll use a simplified session verification\n      // In production, this should properly decode the session from the store\n      const sessionId = decodeURIComponent(sessionCookie.split(\"=\")[1]);\n      \n      // Get the user based on session (simplified for development)\n      // We'll assume SEBdev is logged in for testing\n      const users = await storage.getAllUsers();\n      const session = users.find(u => u.username === \"SEBdev\");\n\n      if (!session) {\n        ws.send(JSON.stringify({ type: \"error\", message: \"Invalid session\" }));\n        ws.close();\n        return;\n      }\n\n      const username = session.username;\n      const client: Client = { ws, username, isAlive: true };\n      \n      // Remove old connection if exists\n      const existingClient = this.clients.get(username);\n      if (existingClient) {\n        existingClient.ws.close();\n      }\n\n      this.clients.set(username, client);\n\n      // Send initial connection success\n      ws.send(JSON.stringify({ \n        type: \"connected\", \n        username,\n        onlineUsers: Array.from(this.clients.keys())\n      }));\n\n      // Broadcast user online status\n      this.broadcast({\n        type: \"user-online\",\n        username\n      }, username);\n\n      // Handle incoming messages\n      ws.on(\"message\", (data) => {\n        try {\n          const message = JSON.parse(data.toString());\n          this.handleMessage(client, message);\n        } catch (error) {\n          console.error(\"Failed to parse WebSocket message:\", error);\n        }\n      });\n\n      // Handle pong for heartbeat\n      ws.on(\"pong\", () => {\n        client.isAlive = true;\n      });\n\n      // Handle disconnection\n      ws.on(\"close\", () => {\n        this.clients.delete(username);\n        this.broadcast({\n          type: \"user-offline\",\n          username\n        });\n      });\n\n      ws.on(\"error\", (error) => {\n        console.error(`WebSocket error for user ${username}:`, error);\n        this.clients.delete(username);\n      });\n    });\n\n    // Start heartbeat interval\n    this.startHeartbeat();\n  }\n\n  private handleMessage(client: Client, message: any) {\n    switch (message.type) {\n      case \"chat\":\n        this.handleChatMessage(client, message);\n        break;\n      case \"typing\":\n        this.handleTypingIndicator(client, message);\n        break;\n      case \"read\":\n        this.handleReadReceipt(client, message);\n        break;\n      default:\n        console.warn(\"Unknown message type:\", message.type);\n    }\n  }\n\n  private handleChatMessage(client: Client, message: any) {\n    const chatMessage: ChatMessage = {\n      id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      from: client.username,\n      to: message.to,\n      message: message.message,\n      timestamp: new Date().toISOString()\n    };\n\n    // Send to recipient if online\n    const recipient = this.clients.get(message.to);\n    if (recipient) {\n      recipient.ws.send(JSON.stringify({\n        type: \"message\",\n        data: chatMessage\n      }));\n    }\n\n    // Echo back to sender for confirmation\n    client.ws.send(JSON.stringify({\n      type: \"message-sent\",\n      data: chatMessage\n    }));\n\n    // Trigger any registered message handlers (for storage)\n    const handler = this.messageHandlers.get(\"message\");\n    if (handler) {\n      handler(chatMessage);\n    }\n  }\n\n  private handleTypingIndicator(client: Client, message: any) {\n    const recipient = this.clients.get(message.to);\n    if (recipient) {\n      recipient.ws.send(JSON.stringify({\n        type: \"typing\",\n        from: client.username,\n        isTyping: message.isTyping\n      }));\n    }\n  }\n\n  private handleReadReceipt(client: Client, message: any) {\n    const sender = this.clients.get(message.from);\n    if (sender) {\n      sender.ws.send(JSON.stringify({\n        type: \"read\",\n        messageId: message.messageId,\n        readBy: client.username\n      }));\n    }\n  }\n\n  private broadcast(message: any, excludeUsername?: string) {\n    this.clients.forEach((client, username) => {\n      if (username !== excludeUsername) {\n        client.ws.send(JSON.stringify(message));\n      }\n    });\n  }\n\n  private startHeartbeat() {\n    setInterval(() => {\n      this.clients.forEach((client, username) => {\n        if (!client.isAlive) {\n          client.ws.terminate();\n          this.clients.delete(username);\n          return;\n        }\n\n        client.isAlive = false;\n        client.ws.ping();\n      });\n    }, 30000); // 30 seconds\n  }\n\n  onMessage(event: string, handler: (message: ChatMessage) => void) {\n    this.messageHandlers.set(event, handler);\n  }\n\n  getOnlineUsers(): string[] {\n    return Array.from(this.clients.keys());\n  }\n}\n\nexport const chatServer = new ChatServer();\nexport type { ChatMessage };","size_bytes":5741},"client/src/lib/auth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport type AuthUser = {\n  id: string;\n  username: string;\n  role: \"admin\" | \"technician\" | \"technical_advisor\";\n  email?: string;\n  department?: string;\n  headquarters?: string;\n  profilePicture?: string;\n  bannerImage?: string;\n  mood?: string;\n};\n\nexport function useAuth() {\n  return useQuery<AuthUser | null>({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: async () => {\n      try {\n        const response = await fetch(\"/api/auth/user\", {\n          credentials: \"include\",\n        });\n        if (!response.ok) {\n          return null;\n        }\n        return await response.json();\n      } catch {\n        return null;\n      }\n    },\n    retry: false,\n    staleTime: 0,\n    refetchOnWindowFocus: true,\n  });\n}\n\nexport async function logout() {\n  await fetch(\"/api/auth/logout\", { method: \"POST\", credentials: \"include\" });\n  window.location.href = \"/login\";\n}\n","size_bytes":920},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow-lg hover:shadow-xl hover:scale-105 hover:bg-primary/90 glow-cyan\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-lg hover:bg-destructive/90 hover:shadow-xl hover:scale-105 glow-pink\",\n        outline:\n          \"border-2 border-gradient bg-background/50 backdrop-blur-sm shadow-md hover:bg-accent hover:text-accent-foreground hover:shadow-lg hover:scale-105\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-md hover:bg-secondary/80 hover:shadow-lg hover:scale-105 glow-purple\",\n        ghost: \"hover:bg-accent/80 hover:text-accent-foreground hover:scale-105 transition-transform\",\n        link: \"text-primary underline-offset-4 hover:underline hover:text-primary/80\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }","size_bytes":2461},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/pages/work-orders.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useI18n } from \"@/contexts/i18n\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Clock, ClipboardList, AlertCircle, CheckCircle, Pause, Play } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { WorkOrder, TimePunch, SessionPayload } from \"@/types/api\";\n\ninterface ExtendedWorkOrder extends WorkOrder {\n  activePunch?: TimePunch;\n}\n\nexport default function WorkOrders() {\n  const { t } = useI18n();\n  const { toast } = useToast();\n  const [showCreateForm, setShowCreateForm] = useState(false);\n  const [formData, setFormData] = useState({\n    title: \"\",\n    description: \"\",\n    priority: \"medium\",\n    assignedTo: \"\"\n  });\n\n  // Get current user session\n  const { data: session } = useQuery<SessionPayload>({\n    queryKey: [\"/api/auth/session\"],\n  });\n\n  // Get all work orders\n  const { data: workOrders = [], refetch: refetchOrders } = useQuery<ExtendedWorkOrder[]>({\n    queryKey: [\"/api/work-orders\"],\n  });\n\n  // Create work order mutation\n  const createOrderMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const priorityColors: Record<string, string> = {\n        low: \"#22c55e\",\n        medium: \"#eab308\",\n        high: \"#f97316\",\n        urgent: \"#ef4444\"\n      };\n      \n      const res = await apiRequest(\"POST\", \"/api/work-orders\", {\n        ...data,\n        priorityColor: priorityColors[data.priority]\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      setShowCreateForm(false);\n      setFormData({ title: \"\", description: \"\", priority: \"medium\", assignedTo: \"\" });\n      toast({ title: \"Work order created successfully\" });\n    }\n  });\n\n  // Punch in/out mutation\n  const punchMutation = useMutation({\n    mutationFn: async ({ workOrderId, action }: { workOrderId: string; action: \"in\" | \"out\" }) => {\n      const res = await apiRequest(\"POST\", `/api/work-orders/${workOrderId}/punch-${action}`, {});\n      return res.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      toast({ \n        title: variables.action === \"in\" ? \"Punched in!\" : \"Punched out!\", \n        description: variables.action === \"out\" ? \"Time recorded successfully\" : \"Timer started\"\n      });\n    }\n  });\n\n  // Update work order status\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: string; status: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/work-orders/${id}`, { status });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      toast({ title: \"Status updated successfully\" });\n    }\n  });\n\n  const getPriorityIcon = (priority: string) => {\n    switch (priority) {\n      case \"urgent\": return <AlertCircle className=\"w-4 h-4\" />;\n      case \"high\": return <AlertCircle className=\"w-4 h-4\" />;\n      case \"medium\": return <ClipboardList className=\"w-4 h-4\" />;\n      case \"low\": return <CheckCircle className=\"w-4 h-4\" />;\n      default: return <ClipboardList className=\"w-4 h-4\" />;\n    }\n  };\n\n  const formatHours = (hours: number) => {\n    const h = Math.floor(hours);\n    const m = Math.round((hours - h) * 60);\n    return `${h}h ${m}m`;\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-7xl\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold gradient-text\">Work Orders</h1>\n          <p className=\"text-muted-foreground\">Manage and track work assignments</p>\n        </div>\n        <Button \n          onClick={() => setShowCreateForm(!showCreateForm)}\n          className=\"neon-button\"\n          data-testid=\"button-create-order\"\n        >\n          <ClipboardList className=\"w-4 h-4 mr-2\" />\n          Create Work Order\n        </Button>\n      </div>\n\n      {/* Create Form */}\n      {showCreateForm && (\n        <Card className=\"mb-6 neon-card neon-contour\">\n          <CardHeader>\n            <CardTitle>New Work Order</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <Input\n                placeholder=\"Title\"\n                value={formData.title}\n                onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                className=\"neon-card\"\n                data-testid=\"input-order-title\"\n              />\n              <Textarea\n                placeholder=\"Description\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                className=\"neon-card\"\n                rows={3}\n                data-testid=\"input-order-description\"\n              />\n              <div className=\"flex gap-4\">\n                <Select \n                  value={formData.priority}\n                  onValueChange={(value) => setFormData({ ...formData, priority: value })}\n                >\n                  <SelectTrigger className=\"neon-card\">\n                    <SelectValue placeholder=\"Priority\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"low\">Low</SelectItem>\n                    <SelectItem value=\"medium\">Medium</SelectItem>\n                    <SelectItem value=\"high\">High</SelectItem>\n                    <SelectItem value=\"urgent\">Urgent</SelectItem>\n                  </SelectContent>\n                </Select>\n                <Input\n                  placeholder=\"Assign to (email)\"\n                  value={formData.assignedTo}\n                  onChange={(e) => setFormData({ ...formData, assignedTo: e.target.value })}\n                  className=\"neon-card\"\n                />\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  onClick={() => createOrderMutation.mutate({ ...formData, createdBy: session?.username })}\n                  disabled={!formData.title || createOrderMutation.isPending}\n                  className=\"neon-button\"\n                  data-testid=\"button-submit-order\"\n                >\n                  Create Order\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setShowCreateForm(false)}\n                >\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Work Orders Grid */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n        {workOrders.map((order) => (\n          <Card key={order.id} className=\"neon-card neon-contour\">\n            <CardHeader>\n              <div className=\"flex items-start justify-between\">\n                <div className=\"space-y-1\">\n                  <CardTitle className=\"text-lg\">{order.title}</CardTitle>\n                  <CardDescription>{order.assignedTo || \"Unassigned\"}</CardDescription>\n                </div>\n                <Badge \n                  style={{ \n                    backgroundColor: order.priorityColor + \"20\",\n                    color: order.priorityColor,\n                    borderColor: order.priorityColor\n                  }}\n                  className=\"border\"\n                >\n                  {getPriorityIcon(order.priority)}\n                  <span className=\"ml-1\">{order.priority}</span>\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground mb-4\">{order.description}</p>\n              \n              {/* Status */}\n              <div className=\"flex items-center justify-between mb-4\">\n                <Select\n                  value={order.status}\n                  onValueChange={(value) => updateStatusMutation.mutate({ id: order.id, status: value })}\n                >\n                  <SelectTrigger className=\"w-32 h-8 text-sm\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"open\">Open</SelectItem>\n                    <SelectItem value=\"in_progress\">In Progress</SelectItem>\n                    <SelectItem value=\"on_hold\">On Hold</SelectItem>\n                    <SelectItem value=\"completed\">Completed</SelectItem>\n                  </SelectContent>\n                </Select>\n                \n                <div className=\"flex items-center gap-1 text-sm\">\n                  <Clock className=\"w-4 h-4\" />\n                  <span>{formatHours(order.totalHours || 0)}</span>\n                </div>\n              </div>\n\n              {/* Time Punch Button */}\n              <Button\n                variant={order.activePunch ? \"destructive\" : \"default\"}\n                size=\"sm\"\n                className=\"w-full\"\n                onClick={() => punchMutation.mutate({\n                  workOrderId: order.id,\n                  action: order.activePunch ? \"out\" : \"in\"\n                })}\n                disabled={punchMutation.isPending}\n                data-testid={`button-punch-${order.id}`}\n              >\n                {order.activePunch ? (\n                  <>\n                    <Pause className=\"w-4 h-4 mr-2\" />\n                    Punch Out\n                  </>\n                ) : (\n                  <>\n                    <Play className=\"w-4 h-4 mr-2\" />\n                    Punch In\n                  </>\n                )}\n              </Button>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Empty State */}\n      {workOrders.length === 0 && !showCreateForm && (\n        <div className=\"text-center py-12\">\n          <ClipboardList className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground\" />\n          <h2 className=\"text-xl font-semibold mb-2\">No work orders yet</h2>\n          <p className=\"text-muted-foreground\">Create your first work order to get started</p>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":10637},"client/src/components/ChatInterface.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Card } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Send, Hash, Building2, User, PlusCircle } from \"lucide-react\";\nimport { NewMessageDialog } from \"@/components/NewMessageDialog\";\nimport type { User as UserType, Message, Conversation } from \"@shared/schema\";\n\ninterface Channel {\n  id: string;\n  type: 'headquarters' | 'department';\n  name: string;\n  icon: typeof Hash | typeof Building2;\n}\n\nexport function ChatInterface() {\n  const { data: currentUser } = useAuth();\n  const [selectedChannel, setSelectedChannel] = useState<Channel | null>(null);\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [users, setUsers] = useState<Map<string, UserType>>(new Map());\n  const [inputValue, setInputValue] = useState(\"\");\n  const [ws, setWs] = useState<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Build channel list based on user's HQ and department\n  const channels: Channel[] = [];\n  if (currentUser?.headquarters) {\n    channels.push({\n      id: currentUser.headquarters,\n      type: 'headquarters',\n      name: `${currentUser.headquarters} HQ`,\n      icon: Building2,\n    });\n  }\n  if (currentUser?.department) {\n    channels.push({\n      id: currentUser.department,\n      type: 'department',\n      name: currentUser.department,\n      icon: Hash,\n    });\n  }\n\n  // Fetch conversations\n  const { data: conversations = [] } = useQuery<Conversation[]>({\n    queryKey: ['/api/conversations'],\n    enabled: !!currentUser,\n  });\n\n  // Fetch user data for all conversation participants\n  useEffect(() => {\n    async function fetchConversationUsers() {\n      if (conversations.length === 0 || !currentUser) return;\n\n      const userIds = new Set<string>();\n      conversations.forEach((conv) => {\n        if (conv.participant1 !== currentUser.id) {\n          userIds.add(conv.participant1);\n        }\n        if (conv.participant2 !== currentUser.id) {\n          userIds.add(conv.participant2);\n        }\n      });\n\n      const newUsers = new Map(users);\n      for (const userId of Array.from(userIds)) {\n        if (!users.has(userId)) {\n          try {\n            const response = await fetch(`/api/users/${userId}`, {\n              credentials: \"include\",\n            });\n            if (response.ok) {\n              const userData = await response.json();\n              newUsers.set(userId, userData);\n            }\n          } catch (error) {\n            console.error(`Failed to fetch user ${userId}:`, error);\n          }\n        }\n      }\n      setUsers(newUsers);\n    }\n\n    fetchConversationUsers();\n  }, [conversations, currentUser]);\n\n  // Set default channel on mount\n  useEffect(() => {\n    if (channels.length > 0 && !selectedChannel && !selectedConversation) {\n      setSelectedChannel(channels[0]);\n    }\n  }, [channels.length]);\n\n  // Fetch messages for selected channel/conversation\n  useEffect(() => {\n    async function fetchMessages() {\n      try {\n        let url = '';\n        if (selectedChannel) {\n          if (selectedChannel.type === 'headquarters') {\n            url = `/api/messages/headquarters/${selectedChannel.id}`;\n          } else {\n            url = `/api/messages/department/${selectedChannel.id}`;\n          }\n        } else if (selectedConversation) {\n          url = `/api/messages/conversation/${selectedConversation.id}`;\n        }\n\n        if (url) {\n          const response = await fetch(url, {\n            credentials: \"include\",\n          });\n          if (response.ok) {\n            const data = await response.json();\n            setMessages(data);\n\n            // Fetch user data\n            const senderIds = Array.from(new Set(data.map((m: Message) => m.senderId)));\n            const userMap = new Map<string, UserType>();\n\n            for (const senderId of senderIds) {\n              try {\n                const userResponse = await fetch(`/api/users/${String(senderId)}`, {\n                  credentials: \"include\",\n                });\n                if (userResponse.ok) {\n                  const userData = await userResponse.json();\n                  userMap.set(String(senderId), userData);\n                }\n              } catch (error) {\n                console.error(`Failed to fetch user ${senderId}:`, error);\n              }\n            }\n\n            setUsers(userMap);\n          }\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch messages:\", error);\n      }\n    }\n\n    if (currentUser) {\n      fetchMessages();\n    }\n  }, [selectedChannel, selectedConversation, currentUser]);\n\n  // WebSocket connection\n  useEffect(() => {\n    if (!currentUser) return;\n\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const host = window.location.hostname;\n    const port = window.location.port ? `:${window.location.port}` : \"\";\n    const wsUrl = `${protocol}//${host}${port}/ws`;\n\n    try {\n      const socket = new WebSocket(wsUrl);\n\n      socket.onopen = () => {\n        console.log(\"WebSocket connected\");\n        setIsConnected(true);\n        socket.send(JSON.stringify({ type: \"auth\", userId: currentUser.id }));\n      };\n\n      socket.onmessage = async (event) => {\n        const data = JSON.parse(event.data);\n\n        if (data.type === \"auth_success\") {\n          console.log(\"WebSocket authenticated\");\n        } else if (data.type === \"new_message\") {\n          const newMsg = data.message;\n          \n          // Only add if it's for the current channel/conversation\n          const isForCurrentChannel = \n            (selectedChannel?.type === 'headquarters' && newMsg.channelType === 'headquarters' && newMsg.headquarters === selectedChannel.id) ||\n            (selectedChannel?.type === 'department' && newMsg.channelType === 'department' && newMsg.department === selectedChannel.id) ||\n            (selectedConversation && newMsg.channelType === 'direct' && newMsg.conversationId === selectedConversation.id);\n\n          if (isForCurrentChannel) {\n            setMessages((prev) => [...prev, newMsg]);\n\n            // Fetch user data if not cached\n            if (!users.has(newMsg.senderId)) {\n              try {\n                const userResponse = await fetch(`/api/users/${newMsg.senderId}`, {\n                  credentials: \"include\",\n                });\n                if (userResponse.ok) {\n                  const userData = await userResponse.json();\n                  setUsers((prev) => new Map(prev).set(newMsg.senderId, userData));\n                }\n              } catch (error) {\n                console.error(`Failed to fetch user ${newMsg.senderId}:`, error);\n              }\n            }\n          }\n        } else if (data.type === \"error\") {\n          console.error(\"WebSocket error:\", data.message);\n        }\n      };\n\n      socket.onclose = () => {\n        console.log(\"WebSocket disconnected\");\n        setIsConnected(false);\n      };\n\n      socket.onerror = (error) => {\n        console.error(\"WebSocket error:\", error);\n      };\n\n      setWs(socket);\n\n      return () => {\n        socket.close();\n      };\n    } catch (error) {\n      console.error(\"Failed to create WebSocket:\", error);\n    }\n  }, [currentUser]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const handleSendMessage = () => {\n    if (!inputValue.trim() || !ws || !isConnected) return;\n\n    const messagePayload: any = {\n      type: \"chat_message\",\n      content: inputValue,\n    };\n\n    if (selectedChannel) {\n      messagePayload.channelType = selectedChannel.type;\n      if (selectedChannel.type === 'headquarters') {\n        messagePayload.headquarters = selectedChannel.id;\n      } else {\n        messagePayload.department = selectedChannel.id;\n      }\n    } else if (selectedConversation) {\n      messagePayload.channelType = 'direct';\n      messagePayload.conversationId = selectedConversation.id;\n    }\n\n    ws.send(JSON.stringify(messagePayload));\n    setInputValue(\"\");\n  };\n\n  const formatTime = (date: string | Date) => {\n    const d = typeof date === 'string' ? new Date(date) : date;\n    return d.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n  };\n\n  const getChannelTitle = () => {\n    if (selectedChannel) {\n      return selectedChannel.name;\n    }\n    if (selectedConversation && currentUser) {\n      const otherUserId = selectedConversation.participant1 === currentUser.id \n        ? selectedConversation.participant2 \n        : selectedConversation.participant1;\n      const otherUser = users.get(otherUserId);\n      return otherUser?.username || \"Direct Message\";\n    }\n    return \"Messages\";\n  };\n\n  if (!currentUser) {\n    return null;\n  }\n\n  return (\n    <div className=\"flex h-[calc(100vh-12rem)] border rounded-md overflow-hidden bg-background\">\n      {/* Sidebar */}\n      <div className=\"w-64 border-r flex flex-col bg-muted/50\">\n        <div className=\"p-4 border-b\">\n          <h2 className=\"font-semibold text-foreground text-sm\">Channels & Messages</h2>\n        </div>\n\n        <ScrollArea className=\"flex-1\">\n          <div className=\"p-2 space-y-1\">\n            {/* Channel list */}\n            {channels.map((channel) => {\n              const Icon = channel.icon;\n              const isActive = selectedChannel?.id === channel.id;\n              \n              return (\n                <Button\n                  key={channel.id}\n                  variant={isActive ? \"secondary\" : \"ghost\"}\n                  className=\"w-full justify-start gap-2\"\n                  onClick={() => {\n                    setSelectedChannel(channel);\n                    setSelectedConversation(null);\n                  }}\n                  data-testid={`button-channel-${channel.id}`}\n                >\n                  <Icon className=\"h-4 w-4\" />\n                  <span className=\"truncate\">{channel.name}</span>\n                </Button>\n              );\n            })}\n\n            <div className=\"pt-4 pb-2 px-2\">\n              <div className=\"flex items-center justify-between\">\n                <h3 className=\"text-sm font-medium text-muted-foreground\">Direct Messages</h3>\n                <NewMessageDialog \n                  onConversationCreated={(conversation) => {\n                    setSelectedConversation(conversation);\n                    setSelectedChannel(null);\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Conversations list */}\n            {conversations.map((conversation) => {\n              const otherUserId = conversation.participant1 === currentUser.id \n                ? conversation.participant2 \n                : conversation.participant1;\n              const otherUser = users.get(otherUserId);\n              const isActive = selectedConversation?.id === conversation.id;\n\n              return (\n                <Button\n                  key={conversation.id}\n                  variant={isActive ? \"secondary\" : \"ghost\"}\n                  className=\"w-full justify-start gap-2\"\n                  onClick={() => {\n                    setSelectedConversation(conversation);\n                    setSelectedChannel(null);\n                  }}\n                  data-testid={`button-conversation-${conversation.id}`}\n                >\n                  <Avatar className=\"h-6 w-6\">\n                    <AvatarImage src={otherUser?.profilePicture || undefined} />\n                    <AvatarFallback className=\"text-xs\">\n                      {otherUser?.username?.[0]?.toUpperCase() || \"?\"}\n                    </AvatarFallback>\n                  </Avatar>\n                  <span className=\"truncate\">{otherUser?.username || \"User\"}</span>\n                </Button>\n              );\n            })}\n          </div>\n        </ScrollArea>\n      </div>\n\n      {/* Chat area */}\n      <div className=\"flex-1 flex flex-col\">\n        {/* Header */}\n        <div className=\"p-4 border-b\">\n          <h2 className=\"font-semibold text-foreground\" data-testid=\"text-channel-title\">\n            {getChannelTitle()}\n          </h2>\n        </div>\n\n        {/* Messages */}\n        <ScrollArea className=\"flex-1 p-4 bg-background\">\n          <div className=\"space-y-3\">\n            {messages.length === 0 ? (\n              <div className=\"flex items-center justify-center h-full text-muted-foreground text-sm\">\n                <p data-testid=\"text-no-messages\">No messages yet. Start the conversation!</p>\n              </div>\n            ) : (\n              messages.map((message) => {\n                const sender = users.get(message.senderId);\n                const isCurrentUser = message.senderId === currentUser.id;\n\n                return (\n                  <div\n                    key={message.id}\n                    className={`flex gap-3 ${isCurrentUser ? \"flex-row-reverse\" : \"\"}`}\n                    data-testid={`message-${message.id}`}\n                  >\n                    <Avatar className=\"h-8 w-8 flex-shrink-0 mt-1\">\n                      <AvatarImage\n                        src={sender?.profilePicture || undefined}\n                        alt={sender?.username || \"User\"}\n                      />\n                      <AvatarFallback className=\"text-xs\">\n                        {sender?.username?.[0]?.toUpperCase() || \"U\"}\n                      </AvatarFallback>\n                    </Avatar>\n\n                    <div className={`flex flex-col ${isCurrentUser ? \"items-end\" : \"items-start\"} max-w-[70%]`}>\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <span className=\"text-xs font-medium text-muted-foreground\" data-testid={`text-sender-${message.id}`}>\n                          {sender?.username || \"Unknown\"}\n                        </span>\n                        <span className=\"text-xs text-muted-foreground/60\" data-testid={`text-time-${message.id}`}>\n                          {formatTime(message.createdAt)}\n                        </span>\n                      </div>\n\n                      <div\n                        className={`rounded-xl px-3 py-2 text-sm break-words ${\n                          isCurrentUser\n                            ? \"bg-primary text-primary-foreground rounded-br-none\"\n                            : \"bg-muted/80 text-foreground rounded-bl-none\"\n                        }`}\n                        data-testid={`card-message-${message.id}`}\n                      >\n                        <p className=\"whitespace-pre-wrap\">{message.content}</p>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n        </ScrollArea>\n\n        {/* Input area */}\n        <div className=\"border-t p-3 bg-muted/30 flex flex-col gap-2\">\n          <div className=\"flex gap-2\">\n            <Input\n              value={inputValue}\n              onChange={(e) => setInputValue(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === \"Enter\" && !e.shiftKey) {\n                  e.preventDefault();\n                  handleSendMessage();\n                }\n              }}\n              placeholder=\"Type a message...\"\n              className=\"flex-1\"\n              data-testid=\"input-message\"\n              disabled={!isConnected}\n            />\n\n            <Button\n              onClick={handleSendMessage}\n              disabled={!inputValue.trim() || !isConnected}\n              size=\"icon\"\n              data-testid=\"button-send-message\"\n            >\n              <Send className=\"h-4 w-4\" />\n            </Button>\n          </div>\n\n          {!isConnected && (\n            <p className=\"text-xs text-muted-foreground\" data-testid=\"text-connection-status\">\n              Connecting to chat...\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":16306},"client/src/pages/chat.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useWebSocket } from \"@/hooks/useWebSocket\";\nimport { useI18n } from \"@/contexts/i18n\";\nimport { BusinessCard } from \"@/components/BusinessCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Send, Circle, Users, MessageSquare } from \"lucide-react\";\nimport type { SessionPayload, TeamMember } from \"@/types/api\";\n\nexport default function Chat() {\n  const { t } = useI18n();\n  const [selectedUser, setSelectedUser] = useState<string | null>(null);\n  const [messageInput, setMessageInput] = useState(\"\");\n  const scrollRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  // Get current user session\n  const { data: session } = useQuery<SessionPayload>({\n    queryKey: [\"/api/auth/session\"],\n  });\n\n  // Get all team members\n  const { data: teamMembers = [] } = useQuery<TeamMember[]>({\n    queryKey: [\"/api/team-members\"],\n  });\n\n  // Get all users (for chat)\n  const { data: allUsers = [] } = useQuery<Array<{ id: string; username: string; isAdmin: boolean }>>({\n    queryKey: [\"/api/users\"],\n  });\n\n  // WebSocket connection\n  const { isConnected, onlineUsers, messages, typingUsers, sendMessage, sendTypingIndicator } = useWebSocket(session?.username);\n\n  // Get chat history when user is selected\n  const { data: chatHistory = [] } = useQuery({\n    queryKey: [\"/api/chat/messages\", selectedUser],\n    enabled: !!selectedUser,\n  });\n\n  // Filter messages for current conversation\n  const currentMessages = messages.filter(\n    msg => (msg.from === session?.username && msg.to === selectedUser) ||\n           (msg.from === selectedUser && msg.to === session?.username)\n  );\n\n  // Combine history and real-time messages\n  const allMessages = [...(chatHistory || []), ...currentMessages];\n\n  // Auto-scroll to bottom on new messages\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [allMessages]);\n\n  // Handle typing indicator\n  useEffect(() => {\n    if (!selectedUser || !messageInput) {\n      sendTypingIndicator(selectedUser || \"\", false);\n      return;\n    }\n\n    sendTypingIndicator(selectedUser, true);\n    const timeout = setTimeout(() => {\n      sendTypingIndicator(selectedUser, false);\n    }, 1000);\n\n    return () => clearTimeout(timeout);\n  }, [messageInput, selectedUser, sendTypingIndicator]);\n\n  const handleSendMessage = () => {\n    if (!messageInput.trim() || !selectedUser) return;\n    \n    sendMessage(selectedUser, messageInput);\n    setMessageInput(\"\");\n    inputRef.current?.focus();\n  };\n\n  const getSelectedMember = () => {\n    return teamMembers.find(m => \n      allUsers.find(u => u.username === selectedUser && m.email.toLowerCase().includes(u.username.toLowerCase()))\n    );\n  };\n\n  return (\n    <div className=\"flex h-screen bg-background\">\n      {/* Left Panel - User List */}\n      <div className=\"w-80 border-r border-border p-4 flex flex-col\">\n        <div className=\"flex items-center gap-2 mb-6\">\n          <Users className=\"w-5 h-5 text-primary\" />\n          <h2 className=\"text-xl font-bold gradient-text\">Employees</h2>\n          {isConnected && (\n            <span className=\"ml-auto online-indicator\" title=\"Connected\"></span>\n          )}\n        </div>\n\n        <ScrollArea className=\"flex-1\">\n          <div className=\"space-y-2\">\n            {allUsers.filter(u => u.username !== session?.username).map((user) => {\n              const isOnline = onlineUsers.includes(user.username);\n              const hasUnread = messages.some(\n                m => m.from === user.username && m.to === session?.username\n              );\n              const member = teamMembers.find(m => \n                m.email.toLowerCase().includes(user.username.toLowerCase())\n              );\n\n              return (\n                <Button\n                  key={user.id}\n                  variant={selectedUser === user.username ? \"default\" : \"ghost\"}\n                  className={`w-full justify-start gap-3 neon-button ${\n                    selectedUser === user.username ? \"neon-glow\" : \"\"\n                  }`}\n                  onClick={() => setSelectedUser(user.username)}\n                  data-testid={`button-user-${user.username}`}\n                >\n                  <div className={isOnline ? \"online-indicator\" : \"offline-indicator\"}></div>\n                  <div className=\"flex-1 text-left\">\n                    <div className=\"font-medium\">{member?.name || user.username}</div>\n                    {member && (\n                      <div className=\"text-xs text-muted-foreground\">{member.roleLabel}</div>\n                    )}\n                  </div>\n                  {hasUnread && (\n                    <div className=\"w-2 h-2 bg-primary rounded-full animate-pulse\"></div>\n                  )}\n                </Button>\n              );\n            })}\n          </div>\n        </ScrollArea>\n      </div>\n\n      {/* Center Panel - Chat Messages */}\n      <div className=\"flex-1 flex flex-col\">\n        {selectedUser ? (\n          <>\n            {/* Chat Header */}\n            <div className=\"p-4 border-b border-border flex items-center gap-3\">\n              <MessageSquare className=\"w-5 h-5 text-primary\" />\n              <h3 className=\"font-semibold\">\n                {teamMembers.find(m => \n                  allUsers.find(u => u.username === selectedUser && m.email.toLowerCase().includes(u.username.toLowerCase()))\n                )?.name || selectedUser}\n              </h3>\n              {typingUsers.has(selectedUser) && (\n                <span className=\"text-sm text-muted-foreground animate-pulse\">\n                  is typing...\n                </span>\n              )}\n            </div>\n\n            {/* Messages */}\n            <ScrollArea className=\"flex-1 p-4\" ref={scrollRef}>\n              <div className=\"space-y-4\">\n                {allMessages.map((msg, idx) => {\n                  const isSent = msg.from === session?.username;\n                  return (\n                    <div\n                      key={msg.id || idx}\n                      className={`flex ${isSent ? \"justify-end\" : \"justify-start\"}`}\n                    >\n                      <div className={`chat-bubble ${isSent ? \"chat-bubble-sent\" : \"chat-bubble-received\"}`}>\n                        <div>{msg.message}</div>\n                        <div className=\"text-xs opacity-70 mt-1\">\n                          {new Date(msg.timestamp).toLocaleTimeString()}\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </ScrollArea>\n\n            {/* Message Input */}\n            <div className=\"p-4 border-t border-border\">\n              <div className=\"flex gap-2\">\n                <Input\n                  ref={inputRef}\n                  value={messageInput}\n                  onChange={(e) => setMessageInput(e.target.value)}\n                  onKeyPress={(e) => e.key === \"Enter\" && handleSendMessage()}\n                  placeholder=\"Type a message...\"\n                  className=\"flex-1 neon-card\"\n                  data-testid=\"input-message\"\n                />\n                <Button\n                  onClick={handleSendMessage}\n                  disabled={!messageInput.trim()}\n                  className=\"neon-button\"\n                  data-testid=\"button-send\"\n                >\n                  <Send className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"text-center text-muted-foreground\">\n              <MessageSquare className=\"w-12 h-12 mx-auto mb-4 opacity-50\" />\n              <p>Select an employee to start chatting</p>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Right Panel - Business Card */}\n      {selectedUser && getSelectedMember() && (\n        <div className=\"w-96 border-l border-border p-4\">\n          <h3 className=\"text-lg font-semibold mb-4 gradient-text\">Contact Information</h3>\n          <BusinessCard \n            member={getSelectedMember()!} \n            className=\"business-card-animation\"\n          />\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":8501},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { WebSocketServer, WebSocket } from \"ws\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport { timePunches, machines, parts } from \"@shared/schema\";\nimport { eq, and, desc, sql, isNull } from \"drizzle-orm\";\nimport bcrypt from \"bcryptjs\";\nimport { insertUserSchema, updateUserSchema, insertWorkOrderSchema, type InsertWorkOrder, insertAppointmentSchema, updateAppointmentSchema, insertMessageSchema, insertCustomerSchema, insertConversationSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { seedAdminUser } from \"./seed\";\nimport { seedWorkOrders } from \"./seedWorkOrders\";\nimport { upload } from \"./upload\";\nimport express from \"express\";\nimport multer from \"multer\";\nimport { sendWorkOrderDemandEmail, sendWorkOrderAssignmentEmail } from \"./email\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  await seedAdminUser();\n  \n  // Only seed work orders if explicitly enabled via environment variable\n  if (process.env.SEED_WORK_ORDERS === \"true\") {\n    await seedWorkOrders();\n  }\n  \n  // Serve uploaded files statically\n  app.use('/uploads', express.static('uploads'));\n  \n  // Authentication middleware\n  const requireAuth = (req: any, res: any, next: any) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n    next();\n  };\n  \n  // Upload photo endpoint with auth before multer\n  app.post(\"/api/upload/photo\", requireAuth, upload.single('photo'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n      \n      const filePath = `/uploads/${req.file.path.split('uploads/')[1]}`;\n      res.json({ filePath });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to upload photo\" });\n    }\n  });\n  \n  // Multer error handling middleware\n  app.use((error: any, req: any, res: any, next: any) => {\n    if (error instanceof multer.MulterError) {\n      if (error.code === 'LIMIT_FILE_SIZE') {\n        return res.status(400).json({ message: \"File size too large (max 10MB)\" });\n      }\n      return res.status(400).json({ message: `Upload error: ${error.message}` });\n    }\n    if (error.message && error.message.includes('Only image files')) {\n      return res.status(400).json({ message: error.message });\n    }\n    next(error);\n  });\n  \n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username and password are required\" });\n      }\n\n      const user = await storage.getUserByUsername(username);\n      if (!user) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      const validPassword = await bcrypt.compare(password, user.passwordHash);\n      if (!validPassword) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n\n      req.session.userId = user.id;\n      res.json({\n        id: user.id,\n        username: user.username,\n        employeeId: user.employeeId,\n        role: user.role,\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Login failed\" });\n    }\n  });\n\n  // Allow users to update their own profile (bannerImage, etc)\n  app.patch(\"/api/users/me/profile\", requireAuth, async (req, res) => {\n    try {\n      const { bannerImage, profilePicture } = req.body;\n      const updates: any = {};\n      \n      if (bannerImage !== undefined) {\n        updates.bannerImage = bannerImage || null;\n      }\n      if (profilePicture !== undefined) {\n        updates.profilePicture = profilePicture || null;\n      }\n\n      const user = await storage.updateUser(req.session.userId!, updates);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json({\n        id: user.id,\n        bannerImage: user.bannerImage,\n        profilePicture: user.profilePicture,\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  app.get(\"/api/auth/user\", async (req, res) => {\n    if (!req.session.userId) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    const user = await storage.getUser(req.session.userId);\n    if (!user) {\n      return res.status(401).json({ message: \"Not authenticated\" });\n    }\n\n    res.json({\n      id: user.id,\n      username: user.username,\n      employeeId: user.employeeId,\n      role: user.role,\n      email: user.email,\n      department: user.department,\n      headquarters: user.headquarters,\n      profilePicture: user.profilePicture,\n      bannerImage: user.bannerImage,\n      mood: user.mood || \"neutral\",\n    });\n  });\n\n  app.patch(\"/api/auth/user/mood\", requireAuth, async (req, res) => {\n    try {\n      const { mood } = req.body;\n      \n      const moodSchema = z.object({\n        mood: z.enum([\"happy\", \"focused\", \"tired\", \"stressed\", \"neutral\"]),\n      });\n      \n      const { mood: validMood } = moodSchema.parse({ mood });\n\n      const user = await storage.updateUser(req.session.userId!, { mood: validMood } as any);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json({\n        id: user.id,\n        mood: user.mood,\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to update mood\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Logout failed\" });\n      }\n      res.json({ message: \"Logged out successfully\" });\n    });\n  });\n\n  app.get(\"/api/user\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      res.json({\n        id: user.id,\n        username: user.username,\n        employeeId: user.employeeId,\n        role: user.role,\n        email: user.email,\n        department: user.department,\n        headquarters: user.headquarters,\n        profilePicture: user.profilePicture,\n        bannerImage: user.bannerImage,\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get user\" });\n    }\n  });\n\n  app.post(\"/api/users\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const currentUser = await storage.getUser(req.session.userId);\n      if (!currentUser || currentUser.role !== \"admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const validatedData = insertUserSchema.parse(req.body);\n      const existingUser = await storage.getUserByUsername(validatedData.username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n\n      const existingEmployeeId = await storage.getUserByEmployeeId(validatedData.employeeId);\n      if (existingEmployeeId) {\n        return res.status(400).json({ message: \"Employee ID already exists\" });\n      }\n\n      const newUser = await storage.createUser(validatedData);\n      res.status(201).json({\n        id: newUser.id,\n        username: newUser.username,\n        role: newUser.role,\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to create user\" });\n    }\n  });\n\n  app.get(\"/api/users\", requireAuth, async (req, res) => {\n    try {\n      const currentUser = await storage.getUser(req.session.userId!);\n      const isAdmin = currentUser?.role === \"admin\";\n\n      const users = await storage.getAllUsers();\n\n      // Admin gets full user data, non-admins get minimal data for UI/assignments\n      if (isAdmin) {\n        res.json(users.map(u => ({\n          id: u.id,\n          username: u.username,\n          role: u.role,\n          email: u.email,\n          department: u.department,\n          isActive: u.isActive,\n        })));\n      } else {\n        // Non-admins only get data needed for work order assignments\n        res.json(users.map(u => ({\n          id: u.id,\n          username: u.username,\n          role: u.role,\n          isActive: u.isActive,\n        })));\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  // Get user statistics (efficiency, hours worked) - MUST come before /api/users/:id\n  app.get(\"/api/users/stats\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const user = await storage.getUserById(req.session.userId);\n      // User may not exist in database yet, but we can still calculate stats from punches\n\n      // Get all work orders assigned to this user\n      const assignedWorkOrders = user ? await storage.getAssignedWorkOrders(req.session.userId) : [];\n      \n      // Filter completed work orders with efficiency\n      const completedWorkOrders = assignedWorkOrders.filter(\n        wo => (wo.status === \"completed\" || wo.status === \"closedForReview\") && wo.efficiency !== null\n      );\n\n      // Calculate average efficiency\n      const avgEfficiency = completedWorkOrders.length > 0\n        ? completedWorkOrders.reduce((sum, wo) => sum + (wo.efficiency || 0), 0) / completedWorkOrders.length\n        : null;\n\n      // Get all time punches for the user\n      const allPunches = await db\n        .select()\n        .from(timePunches)\n        .where(eq(timePunches.userId, req.session.userId));\n\n      // Calculate total WORK hours by day (excluding lunch)\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      \n      const workHoursToday = allPunches\n        .filter(p => {\n          const punchDate = new Date(p.punchDate);\n          return punchDate >= today && p.punchType === \"work\";\n        })\n        .reduce((sum, punch) => {\n          if (punch.clockOut) {\n            const hours = (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n            return sum + hours;\n          }\n          return sum;\n        }, 0);\n\n      // Calculate break hours today (tracked as \"other\" punch type with breakMinutes field)\n      const breakHoursToday = allPunches\n        .filter(p => {\n          const punchDate = new Date(p.punchDate);\n          return punchDate >= today && p.punchType === \"other\";\n        })\n        .reduce((sum, punch) => {\n          if (punch.clockOut) {\n            const hours = (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n            return sum + hours;\n          }\n          return sum;\n        }, 0);\n\n      const hoursToday = Math.max(0, workHoursToday - breakHoursToday);\n\n      // Calculate WORK hours this week (excluding lunch)\n      const startOfWeek = new Date();\n      startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());\n      startOfWeek.setHours(0, 0, 0, 0);\n\n      const workHoursThisWeek = allPunches\n        .filter(p => {\n          const punchDate = new Date(p.punchDate);\n          return punchDate >= startOfWeek && p.punchType === \"work\";\n        })\n        .reduce((sum, punch) => {\n          if (punch.clockOut) {\n            const hours = (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n            return sum + hours;\n          }\n          return sum;\n        }, 0);\n\n      // Calculate break hours this week\n      const breakHoursThisWeek = allPunches\n        .filter(p => {\n          const punchDate = new Date(p.punchDate);\n          return punchDate >= startOfWeek && p.punchType === \"other\";\n        })\n        .reduce((sum, punch) => {\n          if (punch.clockOut) {\n            const hours = (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n            return sum + hours;\n          }\n          return sum;\n        }, 0);\n\n      const hoursThisWeek = Math.max(0, workHoursThisWeek - breakHoursThisWeek);\n\n      // For technical advisors, get ALL completed work orders efficiency\n      let allCompletedEfficiency = null;\n      if (user && (user.role === \"technical_advisor\" || user.role === \"admin\")) {\n        const { workOrders: workOrdersTable } = await import(\"@shared/schema\");\n        const allWorkOrders = await db.select().from(workOrdersTable);\n        const allCompleted = allWorkOrders.filter(\n          wo => (wo.status === \"completed\" || wo.status === \"closedForReview\") && wo.efficiency !== null\n        );\n        allCompletedEfficiency = allCompleted.length > 0\n          ? allCompleted.reduce((sum, wo) => sum + (wo.efficiency || 0), 0) / allCompleted.length\n          : null;\n      }\n\n      // Calculate kilometers from travel punches\n      const kmToday = allPunches\n        .filter(p => {\n          const punchDate = new Date(p.punchDate);\n          return punchDate >= today && p.punchType === \"travel\" && p.kilometers;\n        })\n        .reduce((sum, punch) => sum + (punch.kilometers || 0), 0);\n\n      const kmThisWeek = allPunches\n        .filter(p => {\n          const punchDate = new Date(p.punchDate);\n          return punchDate >= startOfWeek && p.punchType === \"travel\" && p.kilometers;\n        })\n        .reduce((sum, punch) => sum + (punch.kilometers || 0), 0);\n      \n      const kmOverall = allPunches\n        .filter(p => p.punchType === \"travel\" && p.kilometers)\n        .reduce((sum, punch) => sum + (punch.kilometers || 0), 0);\n\n      const response = {\n        assignedWorkOrdersCount: assignedWorkOrders.length,\n        completedWorkOrdersCount: completedWorkOrders.length,\n        avgEfficiency,\n        hoursToday: Math.round(hoursToday * 10) / 10,\n        hoursThisWeek: Math.round(hoursThisWeek * 10) / 10,\n        kmToday: Math.round(kmToday * 10) / 10,\n        kmThisWeek: Math.round(kmThisWeek * 10) / 10,\n        kmOverall: Math.round(kmOverall * 10) / 10,\n        allCompletedEfficiency: allCompletedEfficiency !== null ? Math.round(allCompletedEfficiency * 10) / 10 : null,\n      };\n\n      res.json(response);\n    } catch (error) {\n      console.error(\"Stats calculation error:\", error);\n      res.status(500).json({ message: \"Failed to fetch user stats\" });\n    }\n  });\n\n  app.get(\"/api/users/technical-advisors\", requireAuth, async (req, res) => {\n    try {\n      const currentUser = await storage.getUser(req.session.userId!);\n      const isAdmin = currentUser?.role === \"admin\";\n\n      // Get both technical advisors AND admins (they can review demands too)\n      const advisors = await Promise.all([\n        storage.getUsersByRole('technical_advisor'),\n        storage.getUsersByRole('admin'),\n      ]).then(([ta, admins]) => [...ta, ...admins]);\n      \n      // Admin gets email, non-admins only get id and username for assignments\n      if (isAdmin) {\n        res.json(advisors.map(u => ({\n          id: u.id,\n          username: u.username,\n          email: u.email,\n        })));\n      } else {\n        res.json(advisors.map(u => ({\n          id: u.id,\n          username: u.username,\n        })));\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch advisors\" });\n    }\n  });\n\n  app.get(\"/api/users/:id\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.params.id);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const currentUser = await storage.getUser(req.session.userId!);\n      const isOwnProfile = req.params.id === req.session.userId;\n      const isAdmin = currentUser?.role === \"admin\";\n\n      // Return full profile only for own profile or if admin\n      if (isOwnProfile || isAdmin) {\n        res.json({\n          id: user.id,\n          username: user.username,\n          role: user.role,\n          email: user.email,\n          department: user.department,\n          headquarters: user.headquarters,\n          profilePicture: user.profilePicture,\n        });\n      } else {\n        // Return only public profile data for other users\n        res.json({\n          id: user.id,\n          username: user.username,\n          profilePicture: user.profilePicture,\n        });\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const currentUser = await storage.getUser(req.session.userId);\n      if (!currentUser || currentUser.role !== \"admin\") {\n        return res.status(403).json({ message: \"Admin access required\" });\n      }\n\n      const validatedData = updateUserSchema.parse(req.body);\n      const updatedUser = await storage.updateUser(req.params.id, validatedData);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json({\n        id: updatedUser.id,\n        username: updatedUser.username,\n        role: updatedUser.role,\n        email: updatedUser.email,\n        department: updatedUser.department,\n        isActive: updatedUser.isActive,\n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to update user\" });\n    }\n  });\n\n  app.get(\"/api/notifications\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const notifications = await storage.getUserNotifications(req.session.userId);\n      res.json(notifications);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch notifications\" });\n    }\n  });\n\n  app.get(\"/api/notifications/unread-count\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const count = await storage.getUnreadNotificationCount(req.session.userId);\n      res.json({ count });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch unread count\" });\n    }\n  });\n\n  app.patch(\"/api/notifications/:id/read\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const updated = await storage.markNotificationAsRead(req.params.id, req.session.userId);\n      if (!updated) {\n        return res.status(404).json({ message: \"Notification not found or already read\" });\n      }\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to mark notification as read\" });\n    }\n  });\n\n  app.patch(\"/api/notifications/mark-all-read\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      await storage.markAllNotificationsAsRead(req.session.userId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to mark all as read\" });\n    }\n  });\n\n\n  app.post(\"/api/work-orders/demands\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const currentUser = await storage.getUserById(req.session.userId);\n      if (!currentUser || currentUser.role !== 'technician') {\n        return res.status(403).json({ message: \"Only technicians can create demands\" });\n      }\n\n      const technicianDemandSchema = z.object({\n        title: z.string().min(1),\n        priority: z.enum([\"Normal\", \"High\", \"Urgent\"]),\n        department: z.enum([\"Road Technician\", \"Garage Technician\", \"Sales\", \"Tech Advisor\", \"Accounting\", \"HR\"]),\n        headquarters: z.enum([\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"]),\n        customer: z.string().min(1),\n        siteAddress: z.string().min(1),\n        asset: z.string().min(1),\n        problemSummary: z.string().min(1),\n        advisorId: z.string().min(1),\n        photos: z.array(z.string()).optional(),\n      });\n\n      const validatedInput = technicianDemandSchema.parse(req.body);\n\n      const demandData: InsertWorkOrder = {\n        title: validatedInput.title,\n        priority: validatedInput.priority,\n        department: validatedInput.department,\n        headquarters: validatedInput.headquarters,\n        customer: validatedInput.customer,\n        siteAddress: validatedInput.siteAddress,\n        asset: validatedInput.asset,\n        problemSummary: validatedInput.problemSummary,\n        photos: validatedInput.photos || [],\n        createdBy: req.session.userId,\n        demandedBy: req.session.userId,\n        assignedTo: validatedInput.advisorId,\n        tasks: [],\n      };\n\n      const workOrder = await storage.createWorkOrder(demandData);\n\n      try {\n        const technicalAdvisor = await storage.getUserById(validatedInput.advisorId);\n        if (technicalAdvisor) {\n          await storage.createNotification({\n            userId: technicalAdvisor.id,\n            type: 'work_order_demand',\n            message: `New work order demand ${workOrder.workOrderNumber} from ${currentUser.username}`,\n            workOrderId: workOrder.id,\n          });\n\n          if (technicalAdvisor.email) {\n            await sendWorkOrderDemandEmail({\n              to: technicalAdvisor.email,\n              technician: currentUser.username,\n              workOrderNumber: workOrder.workOrderNumber,\n              title: workOrder.title,\n              priority: workOrder.priority,\n              customer: workOrder.customer,\n              asset: workOrder.asset,\n              problemSummary: workOrder.problemSummary,\n            });\n          }\n        }\n      } catch (emailError) {\n        console.error('Failed to send demand email/notification:', emailError);\n      }\n\n      res.status(201).json(workOrder);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to create work order demand\" });\n    }\n  });\n\n  app.post(\"/api/work-orders\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const validatedData = insertWorkOrderSchema.parse({\n        ...req.body,\n        createdBy: req.session.userId,\n      });\n\n      const workOrder = await storage.createWorkOrder(validatedData);\n      res.status(201).json(workOrder);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to create work order\" });\n    }\n  });\n\n  app.get(\"/api/work-orders\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const workOrders = await storage.getAllWorkOrders();\n      res.json(workOrders);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch work orders\" });\n    }\n  });\n\n  app.get(\"/api/work-orders/assigned\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const workOrders = await storage.getAssignedWorkOrders(req.session.userId);\n      res.json(workOrders);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch assigned work orders\" });\n    }\n  });\n\n  app.get(\"/api/work-orders/demands\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const currentUser = await storage.getUserById(req.session.userId);\n      if (!currentUser || (currentUser.role !== 'technical_advisor' && currentUser.role !== 'admin')) {\n        return res.status(403).json({ message: \"Only advisors can view demands\" });\n      }\n\n      const allWorkOrders = await storage.getAllWorkOrders();\n      const demands = allWorkOrders.filter(wo => wo.status === 'demand' && (currentUser.role === 'admin' || wo.demandedBy === currentUser.id));\n      res.json(demands);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch demands\" });\n    }\n  });\n\n  app.get(\"/api/work-orders/:id\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const workOrder = await storage.getWorkOrder(req.params.id);\n      if (!workOrder) {\n        return res.status(404).json({ message: \"Work order not found\" });\n      }\n\n      const punches = await storage.getWorkOrderPunches(req.params.id);\n      res.json({ ...workOrder, punches });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch work order\" });\n    }\n  });\n\n  app.patch(\"/api/work-orders/:id/assign\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const { userId } = req.body;\n      if (!userId) {\n        return res.status(400).json({ message: \"User ID is required\" });\n      }\n\n      const workOrder = await storage.assignWorkOrder(req.params.id, userId);\n      if (!workOrder) {\n        return res.status(404).json({ message: \"Work order not found\" });\n      }\n\n      try {\n        const assignedUser = await storage.getUserById(userId);\n        if (assignedUser) {\n          await storage.createNotification({\n            userId: assignedUser.id,\n            type: 'work_order_assigned',\n            message: `Work order ${workOrder.workOrderNumber} has been assigned to you`,\n            workOrderId: workOrder.id,\n          });\n\n          if (assignedUser.email) {\n            await sendWorkOrderAssignmentEmail({\n              to: assignedUser.email,\n              assignedTo: assignedUser.username,\n              workOrderNumber: workOrder.workOrderNumber,\n              title: workOrder.title,\n              priority: workOrder.priority,\n              customer: workOrder.customer,\n              asset: workOrder.asset,\n            });\n          }\n        }\n      } catch (notificationError) {\n        console.error('Failed to send assignment notification:', notificationError);\n      }\n\n      res.json(workOrder);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to assign work order\" });\n    }\n  });\n\n  app.patch(\"/api/work-orders/:id/close\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const workOrder = await storage.closeWorkOrder(req.params.id);\n      if (!workOrder) {\n        return res.status(404).json({ message: \"Work order not found\" });\n      }\n\n      res.json(workOrder);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to close work order\" });\n    }\n  });\n\n\n  app.get(\"/api/work-orders/:id/tasks\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const tasks = await storage.getWorkOrderTasks(req.params.id);\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch tasks\" });\n    }\n  });\n\n\n\n  // Get work order by work order number (e.g., W1, W2, W3)\n  app.get(\"/api/work-orders/number/:workOrderNumber\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const workOrder = await storage.getWorkOrderByNumber(req.params.workOrderNumber);\n      if (!workOrder) {\n        return res.status(404).json({ message: \"Work order not found\" });\n      }\n\n      const tasks = await storage.getWorkOrderTasks(workOrder.id);\n      const punches = await storage.getWorkOrderPunches(workOrder.id);\n      res.json({ ...workOrder, tasks, punches });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch work order\" });\n    }\n  });\n  // Get current active time punch\n  app.get(\"/api/time-punches/current\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const currentPunch = await storage.getCurrentWorkOrderPunch(req.session.userId);\n      res.json(currentPunch || null);\n    } catch (error) {\n      console.error(\"Failed to get current punch:\", error);\n      res.status(500).json({ message: \"Failed to get current punch\" });\n    }\n  });\n\n  // Get all time punches for current user for a specific date\n  app.get(\"/api/time-punches/:userId/:date\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const userId = req.params.userId;\n      const date = req.params.date;\n\n      if (userId !== req.session.userId) {\n        return res.status(403).json({ message: \"Unauthorized\" });\n      }\n\n      const punches = await db\n        .select()\n        .from(timePunches)\n        .where(and(\n          eq(timePunches.userId, userId),\n          eq(timePunches.punchDate, date)\n        ))\n        .orderBy(desc(timePunches.clockIn));\n\n      res.json(punches);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch time punches\" });\n    }\n  });\n\n  // Get all time punches for a work order\n  app.get(\"/api/work-orders/:id/punches\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      // Anyone authenticated can view time punches for work orders\n      const punches = await storage.getAllWorkOrderPunches(req.params.id);\n      res.json(punches);\n    } catch (error) {\n      console.error(\"Failed to fetch work order punches:\", error);\n      res.status(500).json({ message: \"Failed to fetch time punches\" });\n    }\n  });\n\n  // Update a time punch\n  app.patch(\"/api/time-punches/:id\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      // Get the existing punch\n      const existingPunch = await db.select().from(timePunches).where(eq(timePunches.id, req.params.id)).limit(1);\n      if (!existingPunch || existingPunch.length === 0) {\n        return res.status(404).json({ message: \"Time punch not found\" });\n      }\n\n      const punch = existingPunch[0];\n\n      // Authorization: Check who can edit this punch\n      const user = await storage.getUser(req.session.userId);\n      if (!user) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      // Admin and technical_advisor can always edit any punch\n      if (user.role !== \"admin\" && user.role !== \"technical_advisor\") {\n        // Non-admin users have restrictions\n        if (punch.workOrderId) {\n          const workOrder = await storage.getWorkOrder(punch.workOrderId);\n          if (!workOrder) {\n            return res.status(404).json({ message: \"Work order not found\" });\n          }\n\n          // Check if work order is closed - non-admins cannot edit closed work orders\n          if (workOrder.status === \"completed\" || workOrder.status === \"closedForReview\") {\n            return res.status(403).json({ message: \"Cannot edit punches on closed work orders\" });\n          }\n\n          // Check authorization for open work orders\n          const canEdit = \n            punch.userId === req.session.userId || \n            workOrder.assignedTo === req.session.userId;\n\n          if (!canEdit) {\n            return res.status(403).json({ message: \"You are not authorized to edit this punch\" });\n          }\n        } else {\n          // For general punches (no work order), only owner can edit\n          if (punch.userId !== req.session.userId) {\n            return res.status(403).json({ message: \"You are not authorized to edit this punch\" });\n          }\n        }\n      }\n\n      // Require both clockIn and clockOut to be provided for editing\n      const { clockIn, clockOut, kilometers } = req.body;\n      if (!clockIn || !clockOut) {\n        return res.status(400).json({ message: \"Both clock in and clock out times are required\" });\n      }\n\n      const updateData: any = {};\n      updateData.clockIn = new Date(clockIn);\n      updateData.clockOut = new Date(clockOut);\n      // Skip kilometers update since the column doesn't exist yet\n      // if (kilometers !== undefined) {\n      //   updateData.kilometers = kilometers;\n      // }\n\n      // Validate timestamps: clockOut must be after clockIn\n      if (updateData.clockOut.getTime() <= updateData.clockIn.getTime()) {\n        return res.status(400).json({ message: \"Clock out time must be after clock in time\" });\n      }\n      \n      // Ensure times are not in the future\n      const now = new Date();\n      if (updateData.clockIn > now) {\n        return res.status(400).json({ message: \"Clock in time cannot be in the future\" });\n      }\n      if (updateData.clockOut > now) {\n        return res.status(400).json({ message: \"Clock out time cannot be in the future\" });\n      }\n      \n      // Ensure times are reasonable (not more than 24 hours)\n      const duration = (updateData.clockOut.getTime() - updateData.clockIn.getTime()) / (1000 * 60 * 60);\n      if (duration > 24) {\n        return res.status(400).json({ message: \"Time punch duration cannot exceed 24 hours\" });\n      }\n\n      const updatedPunch = await storage.updateTimePunch(req.params.id, updateData);\n      if (!updatedPunch) {\n        return res.status(404).json({ message: \"Time punch not found\" });\n      }\n\n      // Update actual hours if this punch is for a work order\n      if (updatedPunch.workOrderId) {\n        try {\n          const actualHours = await storage.calculateWorkOrderHours(updatedPunch.workOrderId);\n          await storage.updateWorkOrder(updatedPunch.workOrderId, { actualHours });\n        } catch (e) {\n          console.error(\"Failed to update work order hours:\", e);\n        }\n      }\n\n      res.json(updatedPunch);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update time punch\" });\n    }\n  });\n\n  // Create a manual time punch\n  app.post(\"/api/time-punches\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const { clockIn, clockOut, punchType, punchDate, kilometers } = req.body;\n\n      if (!clockIn || !clockOut || !punchType || !punchDate) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      if (punchType !== \"work\" && punchType !== \"travel\" && punchType !== \"other\") {\n        return res.status(400).json({ message: \"Invalid punch type\" });\n      }\n\n      const clockInDate = new Date(clockIn);\n      const clockOutDate = new Date(clockOut);\n\n      if (clockOutDate.getTime() <= clockInDate.getTime()) {\n        return res.status(400).json({ message: \"Clock out must be after clock in\" });\n      }\n\n      const duration = (clockOutDate.getTime() - clockInDate.getTime()) / (1000 * 60 * 60);\n      if (duration > 24) {\n        return res.status(400).json({ message: \"Duration cannot exceed 24 hours\" });\n      }\n\n      const [punch] = await db\n        .insert(timePunches)\n        .values({\n          userId: req.session.userId,\n          clockIn: clockInDate,\n          clockOut: clockOutDate,\n          punchType,\n          punchDate,\n          workOrderId: null,\n          taskId: null,\n        })\n        .returning();\n\n      res.json(punch);\n    } catch (error) {\n      console.error(\"Create punch error:\", error);\n      res.status(500).json({ message: \"Failed to create time punch\" });\n    }\n  });\n\n  // Delete a time punch\n  app.delete(\"/api/time-punches/:id\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      // Get the existing punch\n      const existingPunch = await db.select().from(timePunches).where(eq(timePunches.id, req.params.id)).limit(1);\n      if (!existingPunch || existingPunch.length === 0) {\n        return res.status(404).json({ message: \"Time punch not found\" });\n      }\n\n      const punch = existingPunch[0];\n\n      // Authorization: Check who can delete this punch\n      const user = await storage.getUserById(req.session.userId);\n      // User may not exist in storage yet, but we can still allow deletion\n\n      // Admin and technical_advisor can always delete any punch\n      if (!(user && (user.role === \"admin\" || user.role === \"technical_advisor\"))) {\n        // Non-admin users have restrictions\n        if (punch.workOrderId) {\n          const workOrder = await storage.getWorkOrder(punch.workOrderId);\n          if (!workOrder) {\n            return res.status(404).json({ message: \"Work order not found\" });\n          }\n\n          // Check if work order is closed - non-admins cannot delete from closed work orders\n          if (workOrder.status === \"completed\" || workOrder.status === \"closedForReview\") {\n            return res.status(403).json({ message: \"Cannot delete punches on closed work orders\" });\n          }\n\n          // Check authorization for open work orders\n          const canDelete = \n            punch.userId === req.session.userId || \n            workOrder.assignedTo === req.session.userId;\n\n          if (!canDelete) {\n            return res.status(403).json({ message: \"You are not authorized to delete this punch\" });\n          }\n        } else {\n          // For general punches (no work order), only owner can delete\n          if (punch.userId !== req.session.userId) {\n            return res.status(403).json({ message: \"You are not authorized to delete this punch\" });\n          }\n        }\n      }\n\n      await storage.deleteTimePunch(req.params.id);\n      res.json({ message: \"Time punch deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete time punch\" });\n    }\n  });\n\n  // Appointments routes\n  app.get(\"/api/appointments\", requireAuth, async (req, res) => {\n    try {\n      const appointments = await storage.getAllAppointments();\n      res.json(appointments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch appointments\" });\n    }\n  });\n\n  app.get(\"/api/appointments/user/:userId\", requireAuth, async (req, res) => {\n    try {\n      const appointments = await storage.getUserAppointments(req.params.userId);\n      res.json(appointments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user appointments\" });\n    }\n  });\n\n  app.get(\"/api/appointments/date/:date\", requireAuth, async (req, res) => {\n    try {\n      const appointments = await storage.getAppointmentsByDate(req.params.date);\n      res.json(appointments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch appointments for date\" });\n    }\n  });\n\n  app.get(\"/api/appointments/:id\", requireAuth, async (req, res) => {\n    try {\n      const appointment = await storage.getAppointment(req.params.id);\n      if (!appointment) {\n        return res.status(404).json({ message: \"Appointment not found\" });\n      }\n      res.json(appointment);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch appointment\" });\n    }\n  });\n\n  app.post(\"/api/appointments\", requireAuth, async (req, res) => {\n    try {\n      const validatedData = insertAppointmentSchema.parse(req.body);\n      const appointment = await storage.createAppointment({\n        ...validatedData,\n        createdBy: req.session.userId!,\n      });\n      res.status(201).json(appointment);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to create appointment\" });\n    }\n  });\n\n  app.patch(\"/api/appointments/:id\", requireAuth, async (req, res) => {\n    try {\n      const validatedData = updateAppointmentSchema.parse(req.body);\n      const appointment = await storage.updateAppointment(req.params.id, validatedData);\n      \n      if (!appointment) {\n        return res.status(404).json({ message: \"Appointment not found\" });\n      }\n      \n      res.json(appointment);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to update appointment\" });\n    }\n  });\n\n  app.delete(\"/api/appointments/:id\", requireAuth, async (req, res) => {\n    try {\n      const appointment = await storage.getAppointment(req.params.id);\n      if (!appointment) {\n        return res.status(404).json({ message: \"Appointment not found\" });\n      }\n\n      await storage.deleteAppointment(req.params.id);\n      res.json({ message: \"Appointment deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete appointment\" });\n    }\n  });\n\n  // Customers routes\n  app.post(\"/api/customers\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user || (user.role !== \"admin\" && user.role !== \"technical_advisor\")) {\n        return res.status(403).json({ message: \"Only admins and technical advisors can create customers\" });\n      }\n\n      const validatedData = insertCustomerSchema.parse(req.body);\n      const customer = await storage.createCustomer({\n        ...validatedData,\n        createdBy: req.session.userId!,\n      });\n      res.status(201).json(customer);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to create customer\" });\n    }\n  });\n\n  app.get(\"/api/customers\", requireAuth, async (req, res) => {\n    try {\n      const customers = await storage.getAllCustomers();\n      res.json(customers);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customers\" });\n    }\n  });\n\n  app.get(\"/api/customers/:id\", requireAuth, async (req, res) => {\n    try {\n      const customer = await storage.getCustomer(req.params.id);\n      if (!customer) {\n        return res.status(404).json({ message: \"Customer not found\" });\n      }\n      res.json(customer);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch customer\" });\n    }\n  });\n\n  // Messages routes\n  app.post(\"/api/messages\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(400).json({ message: \"User not found\" });\n      }\n\n      const { channelType, conversationId, headquarters, department, content } = req.body;\n\n      // Build validated message data based on channel type\n      let messageData: any = {\n        senderId: req.session.userId!,\n        channelType,\n        content,\n        headquarters: null,\n        department: null,\n        conversationId: null,\n      };\n\n      // Validate and set fields based on channel type\n      if (channelType === 'headquarters') {\n        if (!user.headquarters) {\n          return res.status(400).json({ message: \"User must have a headquarters set\" });\n        }\n        if (headquarters !== user.headquarters) {\n          return res.status(403).json({ message: \"Access denied to this headquarters\" });\n        }\n        messageData.headquarters = user.headquarters;\n      } else if (channelType === 'department') {\n        if (!user.department) {\n          return res.status(400).json({ message: \"User must have a department set\" });\n        }\n        if (department !== user.department) {\n          return res.status(403).json({ message: \"Access denied to this department\" });\n        }\n        messageData.department = user.department;\n      } else if (channelType === 'direct') {\n        if (!conversationId) {\n          return res.status(400).json({ message: \"ConversationId required for direct messages\" });\n        }\n        const conversation = await storage.getConversationById(conversationId);\n        if (!conversation) {\n          return res.status(404).json({ message: \"Conversation not found\" });\n        }\n        if (conversation.participant1 !== req.session.userId! && conversation.participant2 !== req.session.userId!) {\n          return res.status(403).json({ message: \"Access denied to this conversation\" });\n        }\n        messageData.conversationId = conversationId;\n      } else {\n        return res.status(400).json({ message: \"Invalid channel type\" });\n      }\n\n      const validatedData = insertMessageSchema.parse(messageData);\n      const message = await storage.createMessage(validatedData);\n      res.status(201).json(message);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: error.errors[0].message });\n      }\n      res.status(500).json({ message: \"Failed to create message\" });\n    }\n  });\n\n  app.get(\"/api/messages/headquarters/:headquarters\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      if (!user.headquarters || user.headquarters !== req.params.headquarters) {\n        return res.status(403).json({ message: \"Access denied to this headquarters channel\" });\n      }\n      const messages = await storage.getMessagesByHeadquarters(req.params.headquarters);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.get(\"/api/messages/department/:department\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n      if (!user.department || user.department !== req.params.department) {\n        return res.status(403).json({ message: \"Access denied to this department channel\" });\n      }\n      const messages = await storage.getMessagesByDepartment(req.params.department);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.get(\"/api/messages/conversation/:conversationId\", requireAuth, async (req, res) => {\n    try {\n      const conversation = await storage.getConversationById(req.params.conversationId);\n      if (!conversation) {\n        return res.status(404).json({ message: \"Conversation not found\" });\n      }\n      \n      const userId = req.session.userId!;\n      if (conversation.participant1 !== userId && conversation.participant2 !== userId) {\n        return res.status(403).json({ message: \"Access denied to this conversation\" });\n      }\n\n      const messages = await storage.getMessagesByConversation(req.params.conversationId);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Conversations routes\n  app.post(\"/api/conversations\", requireAuth, async (req, res) => {\n    try {\n      const { otherUserId } = req.body;\n      const userId = req.session.userId!;\n\n      // Prevent self-conversations\n      if (userId === otherUserId) {\n        return res.status(400).json({ message: \"Cannot create conversation with yourself\" });\n      }\n\n      // Check if conversation already exists\n      const existing = await storage.getConversation(userId, otherUserId);\n      if (existing) {\n        return res.json(existing);\n      }\n\n      // Create new conversation with normalized participant order\n      const conversation = await storage.createConversation({\n        participant1: userId < otherUserId ? userId : otherUserId,\n        participant2: userId < otherUserId ? otherUserId : userId,\n      });\n      res.status(201).json(conversation);\n    } catch (error) {\n      console.error(\"Conversation creation error:\", error);\n      res.status(500).json({ message: \"Failed to create conversation\" });\n    }\n  });\n\n  app.get(\"/api/conversations\", requireAuth, async (req, res) => {\n    try {\n      const conversations = await storage.getUserConversations(req.session.userId!);\n      res.json(conversations);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch conversations\" });\n    }\n  });\n\n  // Profile picture upload route\n  const profilePictureUpload = multer({\n    storage: multer.diskStorage({\n      destination: 'uploads/profiles',\n      filename: (req, file, cb) => {\n        const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n        cb(null, uniqueSuffix + '-' + file.originalname);\n      }\n    }),\n    limits: { fileSize: 1024 * 1024 }, // 1MB limit\n    fileFilter: (req, file, cb) => {\n      if (file.mimetype.startsWith('image/')) {\n        cb(null, true);\n      } else {\n        cb(new Error('Only image files are allowed'));\n      }\n    }\n  });\n\n  app.post(\"/api/users/profile-picture\", requireAuth, (req, res, next) => {\n    profilePictureUpload.single('profilePicture')(req, res, (err) => {\n      if (err) {\n        if (err instanceof multer.MulterError) {\n          if (err.code === 'LIMIT_FILE_SIZE') {\n            return res.status(400).json({ message: \"File size too large (max 1MB)\" });\n          }\n          return res.status(400).json({ message: err.message });\n        }\n        return res.status(400).json({ message: err.message || \"Upload failed\" });\n      }\n      next();\n    });\n  }, async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      const filePath = `/uploads/profiles/${req.file.filename}`;\n      const user = await storage.updateUserProfilePicture(req.session.userId!, filePath);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json({ profilePicture: filePath });\n    } catch (error) {\n      console.error(\"Profile picture upload error:\", error);\n      res.status(500).json({ message: \"Failed to upload profile picture\" });\n    }\n  });\n\n  app.patch(\"/api/users/profile-picture/default\", requireAuth, async (req, res) => {\n    try {\n      const { profilePicture } = req.body;\n      \n      if (!profilePicture) {\n        return res.status(400).json({ message: \"Profile picture path is required\" });\n      }\n\n      const user = await storage.updateUserProfilePicture(req.session.userId!, profilePicture);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      res.json({ profilePicture });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update profile picture\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  // WebSocket server for real-time chat\n  const wss = new WebSocketServer({ server: httpServer, path: '/ws' });\n\n  // Store active WebSocket connections with user info\n  const connections = new Map<WebSocket, { \n    userId: string; \n    headquarters: string | null;\n    department: string | null;\n  }>();\n\n  wss.on('connection', async (ws, req) => {\n    console.log('WebSocket client connected');\n\n    ws.on('message', async (data) => {\n      try {\n        const message = JSON.parse(data.toString());\n        const conn = connections.get(ws);\n\n        if (message.type === 'auth') {\n          // Authenticate the WebSocket connection\n          const userId = message.userId;\n          const user = await storage.getUser(userId);\n          \n          if (user) {\n            connections.set(ws, { \n              userId, \n              headquarters: user.headquarters,\n              department: user.department\n            });\n            ws.send(JSON.stringify({ type: 'auth_success' }));\n          } else {\n            ws.send(JSON.stringify({ type: 'auth_failed' }));\n            ws.close();\n          }\n        } else if (!conn) {\n          // Reject any non-auth message from unauthenticated connections\n          ws.send(JSON.stringify({ type: 'error', message: 'Not authenticated' }));\n          ws.close();\n          return;\n        } else if (message.type === 'chat_message') {\n          const { channelType, headquarters, department, conversationId, content } = message;\n          \n          // Validate required fields per channel type\n          if (channelType === 'headquarters' && !headquarters) {\n            ws.send(JSON.stringify({ type: 'error', message: 'Headquarters required for HQ messages' }));\n            return;\n          }\n          if (channelType === 'department' && !department) {\n            ws.send(JSON.stringify({ type: 'error', message: 'Department required for department messages' }));\n            return;\n          }\n          if (channelType === 'direct' && !conversationId) {\n            ws.send(JSON.stringify({ type: 'error', message: 'ConversationId required for direct messages' }));\n            return;\n          }\n\n          // Verify user has access to the channel\n          if (channelType === 'headquarters' && conn.headquarters !== headquarters) {\n            ws.send(JSON.stringify({ type: 'error', message: 'Access denied to this headquarters' }));\n            return;\n          }\n          if (channelType === 'department' && conn.department !== department) {\n            ws.send(JSON.stringify({ type: 'error', message: 'Access denied to this department' }));\n            return;\n          }\n          \n          // ALWAYS revalidate user's current department/HQ from database on every message\n          const currentUser = await storage.getUser(conn.userId);\n          if (!currentUser) {\n            ws.send(JSON.stringify({ type: 'error', message: 'User not found' }));\n            ws.close();\n            return;\n          }\n\n          // Update cached connection info\n          connections.set(ws, {\n            userId: conn.userId,\n            headquarters: currentUser.headquarters,\n            department: currentUser.department,\n          });\n\n          // Strict access validation with fresh database data\n          if (channelType === 'headquarters') {\n            if (!currentUser.headquarters || currentUser.headquarters !== headquarters) {\n              ws.send(JSON.stringify({ type: 'error', message: 'Access denied to this headquarters' }));\n              return;\n            }\n          } else if (channelType === 'department') {\n            if (!currentUser.department || currentUser.department !== department) {\n              ws.send(JSON.stringify({ type: 'error', message: 'Access denied to this department' }));\n              return;\n            }\n          }\n\n          // For direct messages, ALWAYS re-query conversation participants from storage\n          let conversationParticipants: string[] = [];\n          if (channelType === 'direct') {\n            const conversation = await storage.getConversationById(conversationId);\n            if (!conversation) {\n              ws.send(JSON.stringify({ type: 'error', message: 'Conversation not found' }));\n              return;\n            }\n            // Verify current user is still a participant (handles member removal)\n            if (conversation.participant1 !== currentUser.id && conversation.participant2 !== currentUser.id) {\n              ws.send(JSON.stringify({ type: 'error', message: 'Access denied to this conversation' }));\n              return;\n            }\n            conversationParticipants = [conversation.participant1, conversation.participant2];\n          }\n\n          // Create the message in the database\n          const newMessage = await storage.createMessage({\n            senderId: conn.userId,\n            channelType,\n            headquarters: channelType === 'headquarters' ? headquarters : null,\n            department: channelType === 'department' ? department : null,\n            conversationId: channelType === 'direct' ? conversationId : null,\n            content,\n          });\n\n          // Update conversation lastMessageAt if direct message\n          if (channelType === 'direct' && conversationId) {\n            await db.execute(sql`\n              UPDATE conversations \n              SET last_message_at = NOW() \n              WHERE id = ${conversationId}\n            `);\n          }\n\n          // Broadcast the message to appropriate recipients\n          const broadcastMessage = JSON.stringify({\n            type: 'new_message',\n            message: newMessage,\n          });\n\n          connections.forEach((data, client) => {\n            if (client.readyState === WebSocket.OPEN) {\n              let shouldReceive = false;\n\n              if (channelType === 'headquarters') {\n                shouldReceive = data.headquarters === headquarters;\n              } else if (channelType === 'department') {\n                shouldReceive = data.department === department;\n              } else if (channelType === 'direct') {\n                // Only send to actual participants\n                shouldReceive = conversationParticipants.includes(data.userId);\n              }\n\n              if (shouldReceive) {\n                client.send(broadcastMessage);\n              }\n            }\n          });\n        }\n      } catch (error) {\n        console.error('WebSocket message error:', error);\n        ws.send(JSON.stringify({ type: 'error', message: 'Invalid message format' }));\n      }\n    });\n\n    ws.on('close', () => {\n      connections.delete(ws);\n      console.log('WebSocket client disconnected');\n    });\n\n    ws.on('error', (error) => {\n      console.error('WebSocket error:', error);\n      connections.delete(ws);\n    });\n  });\n\n  // Update work order notes\n  app.patch(\"/api/work-orders/:id/notes\", requireAuth, async (req, res) => {\n    try {\n      const { notes } = req.body;\n      if (notes === undefined) {\n        return res.status(400).json({ message: \"Notes content is required\" });\n      }\n\n      const workOrder = await storage.updateWorkOrder(req.params.id, { notes });\n      if (!workOrder) {\n        return res.status(404).json({ message: \"Work order not found\" });\n      }\n\n      res.json({ notes: workOrder.notes });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update notes\" });\n    }\n  });\n\n  // Update work order photos/attachments\n  app.patch(\"/api/work-orders/:id/photos\", requireAuth, async (req, res) => {\n    try {\n      const { photos } = req.body;\n      if (!Array.isArray(photos)) {\n        return res.status(400).json({ message: \"Photos must be an array\" });\n      }\n\n      const workOrder = await storage.updateWorkOrder(req.params.id, { photos });\n      if (!workOrder) {\n        return res.status(404).json({ message: \"Work order not found\" });\n      }\n\n      res.json({ photos: workOrder.photos });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update photos\" });\n    }\n  });\n\n  // Get or create conversation\n  app.post(\"/api/conversations\", requireAuth, async (req, res) => {\n    try {\n      const { otherUserId, participantId } = req.body;\n      const userId = otherUserId || participantId;\n      \n      if (!userId) {\n        return res.status(400).json({ message: \"User ID is required\" });\n      }\n\n      let conversation = await storage.getOrCreateConversation(req.session.userId!, userId);\n      if (!conversation) {\n        return res.status(500).json({ message: \"Failed to create conversation\" });\n      }\n\n      res.json(conversation);\n    } catch (error) {\n      console.error(\"Failed to get or create conversation:\", error);\n      res.status(500).json({ message: \"Failed to get or create conversation\" });\n    }\n  });\n\n  // Get current active punch\n  app.get(\"/api/active-punch\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const activePunch = await db\n        .select()\n        .from(timePunches)\n        .where(and(\n          eq(timePunches.userId, req.session.userId),\n          isNull(timePunches.clockOut)\n        ))\n        .limit(1);\n\n      res.json(activePunch?.[0] || null);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch active punch\" });\n    }\n  });\n\n  // Quick clock in\n  app.post(\"/api/time-punches/clock-in\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const { punchType, workOrderId, clockInTime } = req.body;\n\n      if (!punchType) {\n        return res.status(400).json({ message: \"punchType is required\" });\n      }\n\n      if (punchType !== \"work\" && punchType !== \"travel\" && punchType !== \"other\") {\n        return res.status(400).json({ message: \"Invalid punch type\" });\n      }\n\n      // Check if user already has ANY active punch (enforce only 1 active punch per user)\n      const existingPunch = await db\n        .select()\n        .from(timePunches)\n        .where(and(\n          eq(timePunches.userId, req.session.userId),\n          isNull(timePunches.clockOut)\n        ))\n        .limit(1);\n\n      if (existingPunch?.length > 0) {\n        return res.status(400).json({ message: \"You already have an active punch. Please clock out first.\" });\n      }\n\n      const now = clockInTime ? new Date(clockInTime) : new Date();\n      const punchDate = now.toISOString().split(\"T\")[0];\n      \n      const [punch] = await db\n        .insert(timePunches)\n        .values({\n          userId: req.session.userId,\n          clockIn: now,\n          punchType,\n          workOrderId: workOrderId || null,\n          taskId: null,\n          punchDate,\n        })\n        .returning();\n\n      // Update work order status if punching into one\n      if (workOrderId && punchType === \"work\") {\n        try {\n          const workOrder = await storage.getWorkOrder(workOrderId);\n          if (workOrder && workOrder.status === \"assigned\") {\n            await storage.updateWorkOrder(workOrderId, { status: \"in-progress\" });\n          }\n          \n          // Calculate and update actual hours for the work order\n          const actualHours = await storage.calculateWorkOrderHours(workOrderId);\n          await storage.updateWorkOrder(workOrderId, { actualHours });\n        } catch (e) {\n          console.error(\"Failed to update work order status:\", e);\n        }\n      }\n\n      res.json(punch);\n    } catch (error) {\n      console.error(\"Clock in error:\", error);\n      res.status(500).json({ message: \"Failed to clock in\" });\n    }\n  });\n\n  // Quick clock out\n  app.post(\"/api/time-punches/clock-out\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const { kilometers, clockOutTime } = req.body;\n\n      const activePunch = await db\n        .select()\n        .from(timePunches)\n        .where(and(\n          eq(timePunches.userId, req.session.userId),\n          isNull(timePunches.clockOut)\n        ))\n        .limit(1);\n\n      if (!activePunch || activePunch.length === 0) {\n        return res.status(400).json({ message: \"No active punch found\" });\n      }\n\n      const punch = activePunch[0];\n      const now = clockOutTime ? new Date(clockOutTime) : new Date();\n\n      const updateData: any = {\n        clockOut: now,\n      };\n\n      if (kilometers !== undefined && kilometers !== null) {\n        updateData.kilometers = kilometers;\n      }\n\n      const [updatedPunch] = await db\n        .update(timePunches)\n        .set(updateData)\n        .where(eq(timePunches.id, punch.id))\n        .returning();\n\n      // Update actual hours if this punch is for a work order\n      if (punch.workOrderId) {\n        try {\n          const actualHours = await storage.calculateWorkOrderHours(punch.workOrderId);\n          await storage.updateWorkOrder(punch.workOrderId, { actualHours });\n        } catch (e) {\n          console.error(\"Failed to update work order hours:\", e);\n        }\n      }\n\n      res.json(updatedPunch);\n    } catch (error) {\n      console.error(\"Clock out error:\", error);\n      res.status(500).json({ message: \"Failed to clock out\" });\n    }\n  });\n\n  // Work order punch in\n  app.post(\"/api/work-orders/:id/punch-in\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const workOrderId = req.params.id;\n\n      // Check if user already has ANY active punch (enforce only 1 active punch per user)\n      const existingPunch = await db\n        .select()\n        .from(timePunches)\n        .where(and(\n          eq(timePunches.userId, req.session.userId),\n          isNull(timePunches.clockOut)\n        ))\n        .limit(1);\n\n      if (existingPunch?.length > 0) {\n        return res.status(400).json({ message: \"You already have an active punch. Please clock out first.\" });\n      }\n\n      const now = new Date();\n      const punchDate = now.toISOString().split(\"T\")[0];\n      \n      const [punch] = await db\n        .insert(timePunches)\n        .values({\n          userId: req.session.userId,\n          clockIn: now,\n          punchType: \"work\",\n          workOrderId,\n          taskId: null,\n          punchDate,\n        })\n        .returning();\n\n      // Update work order status if punching into one\n      try {\n        const workOrder = await storage.getWorkOrder(workOrderId);\n        if (workOrder && workOrder.status === \"assigned\") {\n          await storage.updateWorkOrder(workOrderId, { status: \"in-progress\" });\n        }\n        \n        // Calculate and update actual hours for the work order\n        const actualHours = await storage.calculateWorkOrderHours(workOrderId);\n        await storage.updateWorkOrder(workOrderId, { actualHours });\n      } catch (e) {\n        console.error(\"Failed to update work order status:\", e);\n      }\n\n      res.json(punch);\n    } catch (error) {\n      console.error(\"Work order punch in error:\", error);\n      res.status(500).json({ message: \"Failed to punch in\" });\n    }\n  });\n\n  // Work order punch out\n  app.post(\"/api/work-orders/:id/punch-out\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const workOrderId = req.params.id;\n\n      const activePunch = await db\n        .select()\n        .from(timePunches)\n        .where(and(\n          eq(timePunches.userId, req.session.userId),\n          eq(timePunches.workOrderId, workOrderId),\n          isNull(timePunches.clockOut)\n        ))\n        .limit(1);\n\n      if (!activePunch || activePunch.length === 0) {\n        return res.status(400).json({ message: \"No active punch found for this work order\" });\n      }\n\n      const punch = activePunch[0];\n      const now = new Date();\n\n      const [updatedPunch] = await db\n        .update(timePunches)\n        .set({ clockOut: now })\n        .where(eq(timePunches.id, punch.id))\n        .returning();\n\n      // Update actual hours for the work order\n      try {\n        const actualHours = await storage.calculateWorkOrderHours(workOrderId);\n        await storage.updateWorkOrder(workOrderId, { actualHours });\n      } catch (e) {\n        console.error(\"Failed to update work order hours:\", e);\n      }\n\n      res.json(updatedPunch);\n    } catch (error) {\n      console.error(\"Work order punch out error:\", error);\n      res.status(500).json({ message: \"Failed to punch out\" });\n    }\n  });\n\n  // Task punch in/out toggle endpoint\n  app.post(\"/api/tasks/:id/punch\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const taskId = req.params.id;\n      const { workOrderId } = req.body;\n\n      // Check if user has an active punch for this task\n      const activePunch = await db\n        .select()\n        .from(timePunches)\n        .where(and(\n          eq(timePunches.userId, req.session.userId),\n          eq(timePunches.taskId, taskId),\n          isNull(timePunches.clockOut)\n        ))\n        .limit(1);\n\n      if (activePunch && activePunch.length > 0) {\n        // Punch out\n        const punch = activePunch[0];\n        const now = new Date();\n\n        const [updatedPunch] = await db\n          .update(timePunches)\n          .set({ clockOut: now })\n          .where(eq(timePunches.id, punch.id))\n          .returning();\n\n        // Update actual hours if this punch is for a work order\n        if (workOrderId) {\n          try {\n            const actualHours = await storage.calculateWorkOrderHours(workOrderId);\n            await storage.updateWorkOrder(workOrderId, { actualHours });\n          } catch (e) {\n            console.error(\"Failed to update work order hours:\", e);\n          }\n        }\n\n        res.json(updatedPunch);\n      } else {\n        // Punch in\n        // Check if user already has ANY active punch\n        const existingPunch = await db\n          .select()\n          .from(timePunches)\n          .where(and(\n            eq(timePunches.userId, req.session.userId),\n            isNull(timePunches.clockOut)\n          ))\n          .limit(1);\n\n        if (existingPunch?.length > 0) {\n          return res.status(400).json({ message: \"You already have an active punch. Please clock out first.\" });\n        }\n\n        const now = new Date();\n        const punchDate = now.toISOString().split(\"T\")[0];\n        \n        const [punch] = await db\n          .insert(timePunches)\n          .values({\n            userId: req.session.userId,\n            clockIn: now,\n            punchType: \"work\",\n            workOrderId: workOrderId || null,\n            taskId,\n            punchDate,\n          })\n          .returning();\n\n        // Update work order status if punching into one\n        if (workOrderId) {\n          try {\n            const workOrder = await storage.getWorkOrder(workOrderId);\n            if (workOrder && workOrder.status === \"assigned\") {\n              await storage.updateWorkOrder(workOrderId, { status: \"in-progress\" });\n            }\n            \n            // Calculate and update actual hours for the work order\n            const actualHours = await storage.calculateWorkOrderHours(workOrderId);\n            await storage.updateWorkOrder(workOrderId, { actualHours });\n          } catch (e) {\n            console.error(\"Failed to update work order status:\", e);\n          }\n        }\n\n        res.json(punch);\n      }\n    } catch (error) {\n      console.error(\"Task punch error:\", error);\n      res.status(500).json({ message: \"Failed to toggle punch\" });\n    }\n  });\n\n  // Add break endpoint\n  app.post(\"/api/add-break\", requireAuth, async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n\n      const { breakMinutes } = req.body;\n      if (!breakMinutes || breakMinutes < 1 || breakMinutes > 480) {\n        return res.status(400).json({ message: \"Break duration must be between 1 and 480 minutes\" });\n      }\n\n      const now = new Date();\n      const breakStartTime = new Date(now.getTime() - breakMinutes * 60 * 1000); // Start time is breakMinutes ago\n      const punchDate = now.toISOString().split(\"T\")[0];\n\n      // Create a break punch record\n      const [breakPunch] = await db\n        .insert(timePunches)\n        .values({\n          userId: req.session.userId,\n          clockIn: breakStartTime,\n          clockOut: now,\n          punchType: \"other\", // Track breaks as \"other\" type\n          punchDate,\n        })\n        .returning();\n\n      res.json(breakPunch);\n    } catch (error) {\n      console.error(\"Add break error:\", error);\n      res.status(500).json({ message: \"Failed to add break\" });\n    }\n  });\n\n  // Machines and Parts endpoints\n  // Get all machines\n  app.get(\"/api/machines\", requireAuth, async (req, res) => {\n    try {\n      const { machines: machinesTable } = await import(\"@shared/schema\");\n      const machinesList = await db.select().from(machinesTable);\n      console.log(`Fetched ${machinesList.length} machines`);\n      res.json(machinesList);\n    } catch (error) {\n      console.error(\"Failed to fetch machines:\", error);\n      res.status(500).json({ message: \"Failed to fetch machines\" });\n    }\n  });\n\n  // Create a new machine\n  app.post(\"/api/machines\", requireAuth, async (req, res) => {\n    try {\n      const { name, model, serialNumber, category, status, location, notes } = req.body;\n\n      // Validate required fields\n      if (!name || !model || !serialNumber || !category) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      const { machines: machinesTable } = await import(\"@shared/schema\");\n      const [newMachine] = await db\n        .insert(machinesTable)\n        .values({\n          name,\n          model,\n          serialNumber,\n          category,\n          status: status || \"in-stock\",\n          location: location || null,\n          notes: notes || null,\n          lastServiceDate: null,\n          nextServiceDate: null,\n        })\n        .returning();\n\n      res.json(newMachine);\n    } catch (error: any) {\n      console.error(\"Failed to create machine:\", error);\n      if (error.message?.includes(\"duplicate\")) {\n        return res.status(400).json({ message: \"Serial number already exists\" });\n      }\n      res.status(500).json({ message: \"Failed to create machine\" });\n    }\n  });\n\n  // Update a machine\n  app.patch(\"/api/machines/:id\", requireAuth, async (req, res) => {\n    try {\n      const { name, model, category, status, location, notes } = req.body;\n\n      const { machines: machinesTable } = await import(\"@shared/schema\");\n      const [updated] = await db\n        .update(machinesTable)\n        .set({\n          name: name || undefined,\n          model: model || undefined,\n          category: category || undefined,\n          status: status || undefined,\n          location: location === null ? null : (location || undefined),\n          notes: notes === null ? null : (notes || undefined),\n        })\n        .where(eq(machinesTable.id, req.params.id))\n        .returning();\n\n      if (!updated) {\n        return res.status(404).json({ message: \"Machine not found\" });\n      }\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Failed to update machine:\", error);\n      res.status(500).json({ message: \"Failed to update machine\" });\n    }\n  });\n\n  // Delete a machine\n  app.delete(\"/api/machines/:id\", requireAuth, async (req, res) => {\n    try {\n      const { machines: machinesTable } = await import(\"@shared/schema\");\n      await db.delete(machinesTable).where(eq(machinesTable.id, req.params.id));\n      res.json({ message: \"Machine deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete machine:\", error);\n      res.status(500).json({ message: \"Failed to delete machine\" });\n    }\n  });\n\n  // Get all parts\n  app.get(\"/api/parts\", requireAuth, async (req, res) => {\n    try {\n      const { parts: partsTable } = await import(\"@shared/schema\");\n      const partsList = await db.select().from(partsTable);\n      console.log(`Fetched ${partsList.length} parts`);\n      res.json(partsList);\n    } catch (error) {\n      console.error(\"Failed to fetch parts:\", error);\n      res.status(500).json({ message: \"Failed to fetch parts\" });\n    }\n  });\n\n  // Create a new part\n  app.post(\"/api/parts\", requireAuth, async (req, res) => {\n    try {\n      const { name, partNumber, category, quantity, unitCost, supplier, location, description, reorderLevel } = req.body;\n\n      if (!name || !partNumber || !category) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      const { parts: partsTable } = await import(\"@shared/schema\");\n      const [newPart] = await db\n        .insert(partsTable)\n        .values({\n          name,\n          partNumber,\n          category,\n          quantity: quantity || 0,\n          unitCost: unitCost ? parseFloat(unitCost) : null,\n          supplier: supplier || null,\n          location: location || null,\n          description: description || null,\n          reorderLevel: reorderLevel || 5,\n        })\n        .returning();\n\n      res.json(newPart);\n    } catch (error: any) {\n      console.error(\"Failed to create part:\", error);\n      if (error.message?.includes(\"duplicate\")) {\n        return res.status(400).json({ message: \"Part number already exists\" });\n      }\n      res.status(500).json({ message: \"Failed to create part\" });\n    }\n  });\n\n  // Update a part\n  app.patch(\"/api/parts/:id\", requireAuth, async (req, res) => {\n    try {\n      const { name, category, quantity, unitCost, supplier, location, description, reorderLevel } = req.body;\n\n      const { parts: partsTable } = await import(\"@shared/schema\");\n      const [updated] = await db\n        .update(partsTable)\n        .set({\n          name: name || undefined,\n          category: category || undefined,\n          quantity: quantity !== undefined ? quantity : undefined,\n          unitCost: unitCost !== undefined ? (unitCost ? parseFloat(unitCost) : null) : undefined,\n          supplier: supplier === null ? null : (supplier || undefined),\n          location: location === null ? null : (location || undefined),\n          description: description === null ? null : (description || undefined),\n          reorderLevel: reorderLevel !== undefined ? reorderLevel : undefined,\n        })\n        .where(eq(partsTable.id, req.params.id))\n        .returning();\n\n      if (!updated) {\n        return res.status(404).json({ message: \"Part not found\" });\n      }\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Failed to update part:\", error);\n      res.status(500).json({ message: \"Failed to update part\" });\n    }\n  });\n\n  // Delete a part\n  app.delete(\"/api/parts/:id\", requireAuth, async (req, res) => {\n    try {\n      const { parts: partsTable } = await import(\"@shared/schema\");\n      await db.delete(partsTable).where(eq(partsTable.id, req.params.id));\n      res.json({ message: \"Part deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete part:\", error);\n      res.status(500).json({ message: \"Failed to delete part\" });\n    }\n  });\n\n  return httpServer;\n}\n","size_bytes":78752},"client/src/pages/loading.tsx":{"content":"import { useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useI18n } from \"@/contexts/i18n\";\nimport type { SessionPayload } from \"@/types/api\";\n\nexport default function Loading() {\n  const [, setLocation] = useLocation();\n  const { t } = useI18n();\n  \n  // Check if user already has a session\n  const { data: session } = useQuery<SessionPayload>({\n    queryKey: [\"/api/auth/session\"],\n  });\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      // If user has a session, go directly to dashboard\n      if (session?.username) {\n        setLocation(\"/dashboard\");\n      } else {\n        setLocation(\"/login\");\n      }\n    }, 3000);\n\n    return () => clearTimeout(timer);\n  }, [setLocation, session]);\n\n  return (\n    <div className=\"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-background via-card to-background\">\n      <div className=\"relative w-64 h-64 mb-8\">\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <div className=\"w-32 h-32 neon-glow-pink rounded-full animate-spin-slow\">\n            <svg viewBox=\"0 0 100 100\" className=\"w-full h-full\">\n              <defs>\n                <linearGradient id=\"turbo-gradient\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"100%\">\n                  <stop offset=\"0%\" stopColor=\"#FF90BB\" />\n                  <stop offset=\"50%\" stopColor=\"#8E7DBE\" />\n                  <stop offset=\"100%\" stopColor=\"#8ACCD5\" />\n                </linearGradient>\n              </defs>\n              <circle cx=\"50\" cy=\"50\" r=\"45\" fill=\"none\" stroke=\"url(#turbo-gradient)\" strokeWidth=\"8\" strokeDasharray=\"20 10\" />\n              <path d=\"M 50 20 L 60 40 L 40 40 Z\" fill=\"#FF90BB\" />\n              <path d=\"M 80 50 L 60 60 L 60 40 Z\" fill=\"#8E7DBE\" />\n              <path d=\"M 50 80 L 40 60 L 60 60 Z\" fill=\"#8ACCD5\" />\n              <path d=\"M 20 50 L 40 40 L 40 60 Z\" fill=\"#FF90BB\" />\n            </svg>\n          </div>\n        </div>\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <div className=\"w-24 h-24 neon-glow rounded-full animate-spin-slower opacity-60\">\n            <svg viewBox=\"0 0 100 100\" className=\"w-full h-full\">\n              <circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"none\" stroke=\"#8ACCD5\" strokeWidth=\"4\" strokeDasharray=\"15 15\" />\n            </svg>\n          </div>\n        </div>\n      </div>\n\n      <h1 className=\"text-4xl font-bold mb-4 gradient-text neon-text\" data-testid=\"text-loading-title\">\n        {t(\"loading.welcome\")}\n      </h1>\n\n      <div className=\"flex items-center gap-2 text-muted-foreground\" data-testid=\"text-loading-status\">\n        <div className=\"flex gap-1\">\n          <span className=\"w-2 h-2 bg-primary rounded-full animate-bounce\" style={{ animationDelay: \"0s\" }}></span>\n          <span className=\"w-2 h-2 bg-secondary rounded-full animate-bounce\" style={{ animationDelay: \"0.2s\" }}></span>\n          <span className=\"w-2 h-2 bg-accent rounded-full animate-bounce\" style={{ animationDelay: \"0.4s\" }}></span>\n        </div>\n        <span>{t(\"loading.initializing\")}</span>\n      </div>\n\n      <div className=\"mt-8 w-64 h-1 bg-muted rounded-full overflow-hidden\" data-testid=\"progress-loading\">\n        <div className=\"h-full animated-gradient\" style={{ width: \"100%\", animation: \"gradient-shift 2s ease-in-out infinite\" }}></div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":3411},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/GPSMap.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\n\ninterface Technician {\n  id: string;\n  name: string;\n  status: 'available' | 'busy' | 'offline';\n  currentJob?: string;\n  location: { lat: number; lng: number };\n  lastUpdate: string;\n}\n\ninterface GPSMapProps {\n  technicians: Technician[];\n}\n\nconst statusColors = {\n  available: 'bg-green-500',\n  busy: 'bg-orange-500',\n  offline: 'bg-gray-500',\n};\n\nexport function GPSMap({ technicians }: GPSMapProps) {\n  return (\n    <div className=\"flex gap-4 h-full\">\n      <div className=\"w-80 space-y-4 overflow-y-auto\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Technicians</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {technicians.map((tech) => (\n              <div\n                key={tech.id}\n                className=\"p-3 bg-card border border-card-border rounded-lg hover-elevate cursor-pointer\"\n                data-testid={`card-technician-${tech.id}`}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <Avatar className=\"h-10 w-10\">\n                    <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                      {tech.name.split(' ').map(n => n[0]).join('')}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium text-sm truncate\">{tech.name}</span>\n                      <span className={`w-2 h-2 rounded-full ${statusColors[tech.status]}`}></span>\n                    </div>\n                    {tech.currentJob ? (\n                      <p className=\"text-xs text-muted-foreground truncate\">{tech.currentJob}</p>\n                    ) : (\n                      <p className=\"text-xs text-muted-foreground\">{tech.status}</p>\n                    )}\n                    <p className=\"text-xs text-muted-foreground\">Updated {tech.lastUpdate}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card className=\"flex-1\">\n        <CardContent className=\"p-0 h-full\">\n          <div className=\"relative w-full h-full min-h-[500px] bg-muted rounded-lg overflow-hidden\">\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <div className=\"text-center space-y-4\">\n                <i className=\"fas fa-map-marked-alt text-6xl text-muted-foreground/50\"></i>\n                <div>\n                  <p className=\"text-lg font-semibold text-foreground\">GPS Map View</p>\n                  <p className=\"text-sm text-muted-foreground\">Real-time technician tracking</p>\n                </div>\n                <div className=\"flex gap-4 justify-center\">\n                  {technicians.map((tech) => (\n                    <div\n                      key={tech.id}\n                      className=\"flex items-center gap-2 px-3 py-2 bg-card border border-card-border rounded-lg\"\n                    >\n                      <span className={`w-3 h-3 rounded-full ${statusColors[tech.status]}`}></span>\n                      <span className=\"text-xs font-medium\">{tech.name}</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":3613},"client/src/pages/login.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useI18n } from \"@/contexts/i18n\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const { t } = useI18n();\n  const { toast } = useToast();\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: { username: string; password: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/login\", credentials);\n      return res.json();\n    },\n    onSuccess: () => {\n      // Invalidate the session query to force a refresh\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/session\"] });\n      setLocation(\"/dashboard\");\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: t(\"login.error\"),\n        description: \"Please check your username and password.\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (username && password) {\n      loginMutation.mutate({ username, password });\n    }\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-gradient-to-br from-background via-card to-background p-4\">\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none opacity-20\">\n        <div className=\"absolute top-20 left-20 w-64 h-64 bg-primary/30 rounded-full blur-3xl animate-pulse\"></div>\n        <div className=\"absolute bottom-20 right-20 w-96 h-96 bg-secondary/30 rounded-full blur-3xl animate-pulse\" style={{ animationDelay: \"1s\" }}></div>\n        <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-accent/20 rounded-full blur-3xl animate-pulse\" style={{ animationDelay: \"2s\" }}></div>\n      </div>\n\n      <Card className=\"w-full max-w-md neon-card fade-in-up relative z-10\" data-testid=\"card-login\">\n        <CardHeader className=\"space-y-1\">\n          <div className=\"flex justify-center mb-4\">\n            <div className=\"text-6xl font-bold gradient-text\">ELEVEX</div>\n          </div>\n          <CardTitle className=\"text-2xl text-center\" data-testid=\"text-login-title\">{t(\"login.title\")}</CardTitle>\n          <CardDescription className=\"text-center\">\n            Enter your credentials to access the portal\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\">{t(\"login.username\")}</Label>\n              <Input\n                id=\"username\"\n                type=\"text\"\n                placeholder=\"SEBdev\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                disabled={loginMutation.isPending}\n                data-testid=\"input-username\"\n                className=\"neon-card\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">{t(\"login.password\")}</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                placeholder=\"•••\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                disabled={loginMutation.isPending}\n                data-testid=\"input-password\"\n                className=\"neon-card\"\n              />\n            </div>\n            <Button\n              type=\"submit\"\n              className=\"w-full neon-button\"\n              disabled={loginMutation.isPending}\n              data-testid=\"button-login\"\n            >\n              {loginMutation.isPending ? (\n                <span className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin\"></div>\n                  Loading...\n                </span>\n              ) : (\n                t(\"login.submit\")\n              )}\n            </Button>\n\n            {/* DEV Quick Login Button */}\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              className=\"w-full neon-button border-accent text-accent hover:bg-accent/10\"\n              onClick={() => loginMutation.mutate({ username: \"SEBdev\", password: \"777\" })}\n              disabled={loginMutation.isPending}\n              data-testid=\"button-dev-login\"\n            >\n              DEV - Quick Login\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":4979},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/StatCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LucideIcon, TrendingUp, TrendingDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface StatCardProps {\n  title: string;\n  value: string;\n  icon: LucideIcon;\n  trend?: number; // Changed to number to match the example in changes\n  trendUp?: boolean; // This prop is not used in the changes, but keeping it for completeness\n}\n\nexport function StatCard({ title, value, icon, trend }: StatCardProps) {\n  const Icon = icon;\n  const isPositive = trend !== undefined && trend >= 0; // Adjusted logic for trendUp based on trend value\n\n  return (\n    <Card className=\"hover:shadow-2xl hover:scale-105 transition-all duration-300 group relative overflow-hidden\">\n      <div className=\"absolute inset-0 bg-gradient-to-br from-cyan-500/10 via-purple-500/10 to-pink-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300\"></div>\n      <CardContent className=\"p-6 relative z-10\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <p className=\"text-sm font-medium text-muted-foreground\">{title}</p>\n            <h3 className=\"text-2xl font-bold mt-2 bg-gradient-to-r from-cyan-600 via-purple-600 to-pink-600 bg-clip-text text-transparent\">{value}</h3>\n            {trend !== undefined && (\n              <div className={cn(\n                \"flex items-center mt-2 text-sm font-semibold\",\n                isPositive ? \"text-green-600\" : \"text-red-600\"\n              )}>\n                {isPositive ? <TrendingUp className=\"h-4 w-4 mr-1\" /> : <TrendingDown className=\"h-4 w-4 mr-1\" />}\n                {Math.abs(trend)}%\n              </div>\n            )}\n          </div>\n          <div className=\"h-12 w-12 rounded-full bg-gradient-to-br from-cyan-500 via-purple-500 to-pink-500 flex items-center justify-center shadow-lg group-hover:shadow-xl group-hover:scale-110 transition-all duration-300\">\n            <Icon className=\"h-6 w-6 text-white\" />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":2070},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport PgSession from \"connect-pg-simple\";\nimport { pool } from \"./db\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\napp.set(\"trust proxy\", 1);\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId?: string;\n  }\n}\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\nconst pgSession = PgSession(session);\nconst sessionStore = new pgSession({\n  pool,\n  tableName: \"session\",\n});\n\napp.use(\n  session({\n    store: sessionStore,\n    secret: process.env.SESSION_SECRET || \"dev-secret-change-in-production\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      secure: process.env.NODE_ENV === \"production\" ? true : false,\n      httpOnly: true,\n      maxAge: 1000 * 60 * 60 * 24 * 7,\n      sameSite: \"lax\",\n    },\n  }),\n);\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  server.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","size_bytes":2946},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"attached_assets/content-1763103868094.md":{"content":"![Logo ServiCentre ERP 360°](https://www.servicentre.ca/images/logos/logo-servicentre-w.svg)\n\n# La solution ERP adaptée à vos besoins\n\nÉvolutif et modulaire, idéal pour les PME, ServiCentre ERP 360° vous offre une vision intégrale qui facilite l’automatisation et l’optimisation de vos activités commerciales. Il s’adapte aux besoins changeants de votre entreprise, assurant une gestion harmonieuse et une croissance continue.\n\n\n[Contactez-nous](https://www.servicentre.ca/contact)\n\n[![](https://www.servicentre.ca/images/servicentre-icons/icon-gestion-projet-w.svg)Projets](https://www.servicentre.ca/servicentre-erp-360/gestion-projets) [![](https://www.servicentre.ca/images/servicentre-icons/icon-crm-w.svg)CRM](https://www.servicentre.ca/servicentre-erp-360/ventes-relation-client) [![](https://www.servicentre.ca/images/servicentre-icons/icon-mobile-w.svg)Mobilité](https://www.servicentre.ca/servicentre-erp-360/mobilite) [![](https://www.servicentre.ca/images/servicentre-icons/icon-ecommerce-w.svg)E-commerce](https://www.servicentre.ca/servicentre-erp-360/commerce-electronique) [![](https://www.servicentre.ca/images/servicentre-icons/icon-manufacturier-w.svg)Manufacturier](https://www.servicentre.ca/servicentre-erp-360/manufacturier) [![](https://www.servicentre.ca/images/servicentre-icons/icon-pos-w.svg)Point de vente](https://www.servicentre.ca/servicentre-erp-360/point-de-vente) [![](https://www.servicentre.ca/images/servicentre-icons/icon-service-w.svg)Services](https://www.servicentre.ca/servicentre-erp-360/departement-service)\n\n![](https://www.servicentre.ca/images/divider-w.svg)\n\n# ServiCentre ERP 360°, la solution ERP la plus complète et évoluée\n\n## Une solution ERP modulaire et évolutive qui s'adapte à votre entreprise\n\nAvec la combinaison de ses nombreux modules et les multiples possibilités qu’il offre à ses utilisateurs, ServiCentre ERP 360° est un ERP parfait pour suivre l’évolution des PME au rythme de leur croissance ! La symbiose entre ses modules en fait le cadre parfait pour l’automatisation et l’optimisation des activités commerciales. Vous pouvez gérer l’ensemble des processus organisationnels de votre entreprise depuis ServiCentre ERP 360° et comme toutes vos données et l’ensemble de vos opérations de gestion se retrouvent dans un environnement unique, ServiCentre ERP 360° vous procure une vision à 360° de votre entreprise.\n\n\nComme les besoins de votre entreprise évoluent constamment, ServiCentre ERP 360° évolue au même rythme que ceux-ci. Il se veut un outil évolutif et modulaire où chacun de vos besoins de gestion a été adressé. Le déploiement de notre solution peut se faire graduellement, assurant un changement harmonieux dans vos tâches quotidiennes. En partant de vos priorités actuelles d’amélioration, ServiCentre ERP 360° pourra s’adapter à votre contexte d’entreprise et sera la base solide pour vos projets à venir et votre croissance future.\n\n\n![Section gestion manufacturière](https://www.servicentre.ca/images/servicentre-icons/icon-manufacturier-w.svg)\n\n![Section gestion manufacturière](https://www.servicentre.ca/images/servicentre-icons/icon-manufacturier-w.svg)Gestion manufacturière\n\n## Gestion manufacturière - ServiCentre ERP 360°\n\n### Contrôlez, en temps réel, votre inventaire et vos coûts de production, en éliminant les pertes d’efficacité et en augmentant la productivité.\n\nLe module Manufacturier a été pensé et conçu afin que vous puissiez exercer un contrôle sur votre production et votre planification et ainsi satisfaire les exigences de votre clientèle. Il vous permet d’identifier précisément quelles sont les matières premières requises à l’assemblage de chacun de vos produits et vous offre la possibilité d’optimiser l’utilisation de vos ressources humaines et matérielles. Il vous fournit également des informations pertinentes au bon fonctionnement de votre production : inventaire disponible et réservé, approvisionnement, prix de revient, recettes, temps de production, et plus encore.\n\n\n[En savoir +](https://www.servicentre.ca/servicentre-erp-360/manufacturier)\n\n![Section gestion de projets](https://www.servicentre.ca/images/servicentre-icons/icon-gestion-projet-w.svg)\n\n![Section gestion de projets](https://www.servicentre.ca/images/servicentre-icons/icon-gestion-projet-w.svg)Gestion de projets\n\n## Gestion de projets - ServiCentre ERP 360°\n\n### Maximisez la rentabilité de vos projets avec une gestion simple et efficace.\n\nDans le développement du module Gestion de projets, nous avons conclu que les principaux enjeux en gestion de projets sont de planifier, budgéter, prévoir et suivre l’avancement des projets en direct dans le but d’être proactif dans la prise de décisions et dans le contrôle des coûts, des tâches et des ressources.\n\n\nAinsi, notre module Gestion de projets vous permet de simplifier et de maximiser la gestion du temps, des ressources et des coûts impliqués dans vos projets et vous donne un accès direct à ses informations vitales (rentabilité réelle, coût de revient, avancement des travaux, etc.). Vous pouvez faire des suivis rigoureux, en temps réel, de tous les coûts et les éléments impliqués dans la réalisation de vos projets pour vous assurer, en fin de compte, le rendement espéré.\n\n\n[En savoir +](https://www.servicentre.ca/servicentre-erp-360/gestion-projets)\n\n![Section département de services](https://www.servicentre.ca/images/servicentre-icons/icon-service-w.svg)\n\n![Section département de services](https://www.servicentre.ca/images/servicentre-icons/icon-service-w.svg)Département de services\n\n## Département de service - ServiCentre ERP 360°\n\n### Améliorer la productivité de votre département de service et optimiser votre gestion d’inventaire.\n\nCe module est le tout premier de la suite ServiCentre ERP 360° à avoir été commercialisé. Il en fut ainsi pour combler un besoin bien précis : gérer notre propre équipe de techniciens sur la route. L’équipe derrière ServiCentre ERP 360° est familière avec toutes les réalités et les défis auxquels doivent faire face les entreprises de service. Il allait de soi que nous devions partager notre savoir-faire aux entreprises ayant les mêmes besoins que nous.\n\n\nLe module Service vous rend plus efficace et vous évite des pertes de temps dû à la recherche d’information concernant vos appels de service. Toutes les informations sont automatisées et donc notées aux dossiers. Ainsi, en étant centralisées dans notre solution, vos opérations deviennent plus efficaces. Vous avez une vision en temps réel de vos activités de service (appels de service, équipements, contrats de service, etc.) et vous êtes ainsi en mesure de gérer votre organisation de façon proactive et en toute confiance.\n\n\n[En savoir +](https://www.servicentre.ca/servicentre-erp-360/departement-service)\n\n![Section CRM](https://www.servicentre.ca/images/servicentre-icons/icon-crm-w.svg)\n\n![Section CRM](https://www.servicentre.ca/images/servicentre-icons/icon-crm-w.svg)Gestion des relations clients (CRM)\n\n## Gestion des relations clients (CRM) - ServiCentre ERP 360°\n\n### Augmentez votre chiffre d’affaires en prenant le contrôle de vos activités de vente.\n\nIl est fréquent que plusieurs personnes, de divers départements, interagissent lorsque vient le moment de construire, développer ou entretenir des relations clients. La situation peut parfois devenir chaotique au point où il devient difficile de s’y retrouver et offrir à nos clients le service dont ils sont dignes.\n\n\nFidéliser votre clientèle grâce à un service exceptionnel et une gestion des relations clients hors pair aura assurément des retombées positives sur vos activités de vente. Voilà pourquoi investir dans notre CRM prend toute son importance : centraliser et personnaliser les communications permettra à votre entreprise d’être plus efficace et de mieux gérer les activités de suivis de dossiers, vous permettant ainsi de donner à votre clientèle un service adapté.\n\n\n[En savoir +](https://www.servicentre.ca/servicentre-erp-360/ventes-relation-client)\n\n![Section e-commerce](https://www.servicentre.ca/images/servicentre-icons/icon-ecommerce-w.svg)\n\n![Section e-commerce](https://www.servicentre.ca/images/servicentre-icons/icon-ecommerce-w.svg)Commerce électronique\n\n## Commerce électronique (e-commerce) - ServiCentre ERP 360°\n\n### Gagnez de nouveaux clients, pénétrez de nouveaux marchés et maximisez la visibilité de votre entreprise.\n\nLa croissance des ventes en ligne au Canada démontre que les consommateurs s’attendent à ce que les fournisseurs proposent des solutions de commerce en ligne. En contrepartie, les entreprises désirant offrir du commerce électronique doivent souvent composer avec un manque de connaissances techniques et de ressources leur permettant d’accroître leurs capacités à cet égard.\n\n\nC’est pour pallier ce type de situation que nous avons pensé le module Commerce électronique. Tout le contenu de votre site transactionnel se gère depuis le module Commerce électronique dans ServiCentre ERP 360° : vous décidez du contenu (produits, prix, rabais, photos et descriptions de produits), puis ServiCentre ERP 360° gère tout pour vous, depuis l’affichage de ce contenu jusqu’à la prise de commande et la confirmation au client.\n\n\n[En savoir +](https://www.servicentre.ca/servicentre-erp-360/commerce-electronique)\n\n![Section mobile](https://www.servicentre.ca/images/servicentre-icons/icon-mobile-w.svg)\n\n![Section mobile](https://www.servicentre.ca/images/servicentre-icons/icon-mobile-w.svg)Mobilité\n\n## Mobilité - ServiCentre ERP 360°\n\n### Transformez vos tablettes ou téléphones mobiles intelligents en véritables outils de travail.\n\nLes modules destinés aux secteurs d’activités qui requièrent des déplacements sont dorénavant accessibles de partout, grâce à nos technologies web avant-gardistes. Nous vous proposons une série d’outils performants dédiés à votre personnel sur la route et/ou qui doivent travailler à l’extérieur des lieux de travail physique, disponibles depuis la plupart des téléphones mobiles intelligents et des tablettes.\n\n\n[En savoir +](https://www.servicentre.ca/servicentre-erp-360/mobilite)\n\n![](https://www.servicentre.ca/images/servicentre-icons/icon-pos-w.svg)\n\n![](https://www.servicentre.ca/images/servicentre-icons/icon-pos-w.svg)Point de vente\n\n## Point de vente (POS) - ServiCentre ERP 360°\n\n### Profitez de la puissance d’un point de vente centralisé : simplifiez la facturation et augmentez l’efficacité au comptoir.\n\nOptimisez la facturation au comptoir avec ServiCentre POS en transformant votre point de vente en un outil de gestion des ventes robuste ​et efficace. Intégré de manière transparente avec les logiciels Acomba et ServiCentre ERP 360°, le module POS facilite la gestion des ​transactions au comptoir, simplifiant ainsi les opérations de facturation et d'encaissement pour les commerces de toutes tailles.\n\n\n**Intégration complète**\nServiCentre POS synchronise automatiquement les transactions de vente avec la suite comptable Acomba et le système ERP de ​ServiCentre, garantissant une comptabilité précise et sans erreurs. L'intégration avec les terminaux de paiement tels que Moneris ou ​Clover élimine les erreurs de saisie et accélère le processus de paiement, renforçant la sécurité et améliorant l'expérience client. Choisissez ​ServiCentre POS pour une gestion de caisse simplifiée et une meilleure performance commerciale.\n\n\n[En savoir +](https://www.servicentre.ca/servicentre-erp-360/point-de-vente)\n\n![](https://www.servicentre.ca/images/divider-w-alt.svg)","size_bytes":11800},"client/src/hooks/useWebSocket.ts":{"content":"import { useEffect, useRef, useState, useCallback } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Message {\n  id: string;\n  from: string;\n  to: string;\n  message: string;\n  timestamp: string;\n}\n\ninterface WebSocketHook {\n  isConnected: boolean;\n  onlineUsers: string[];\n  messages: Message[];\n  typingUsers: Set<string>;\n  sendMessage: (to: string, message: string) => void;\n  sendTypingIndicator: (to: string, isTyping: boolean) => void;\n}\n\nexport function useWebSocket(username: string | undefined): WebSocketHook {\n  const [isConnected, setIsConnected] = useState(false);\n  const [onlineUsers, setOnlineUsers] = useState<string[]>([]);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [typingUsers, setTypingUsers] = useState<Set<string>>(new Set());\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const { toast } = useToast();\n\n  const connect = useCallback(() => {\n    if (!username || wsRef.current?.readyState === WebSocket.OPEN) return;\n\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const ws = new WebSocket(`${protocol}//${window.location.host}`);\n    wsRef.current = ws;\n\n    ws.onopen = () => {\n      setIsConnected(true);\n      console.log(\"WebSocket connected\");\n    };\n\n    ws.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        \n        switch (data.type) {\n          case \"connected\":\n            setOnlineUsers(data.onlineUsers || []);\n            break;\n            \n          case \"user-online\":\n            setOnlineUsers(prev => {\n              const newSet = new Set(prev);\n              newSet.add(data.username);\n              return Array.from(newSet);\n            });\n            break;\n            \n          case \"user-offline\":\n            setOnlineUsers(prev => prev.filter(u => u !== data.username));\n            break;\n            \n          case \"message\":\n            setMessages(prev => [...prev, data.data]);\n            // Show business card notification\n            toast({\n              title: `New message from ${data.data.from}`,\n              description: data.data.message.substring(0, 50) + \"...\",\n            });\n            break;\n            \n          case \"message-sent\":\n            setMessages(prev => [...prev, data.data]);\n            break;\n            \n          case \"typing\":\n            if (data.isTyping) {\n              setTypingUsers(prev => {\n                const newSet = new Set(prev);\n                newSet.add(data.from);\n                return newSet;\n              });\n            } else {\n              setTypingUsers(prev => {\n                const newSet = new Set(prev);\n                newSet.delete(data.from);\n                return newSet;\n              });\n            }\n            break;\n        }\n      } catch (error) {\n        console.error(\"Failed to parse WebSocket message:\", error);\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error(\"WebSocket error:\", error);\n      setIsConnected(false);\n    };\n\n    ws.onclose = () => {\n      setIsConnected(false);\n      wsRef.current = null;\n      \n      // Attempt to reconnect after 3 seconds\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      reconnectTimeoutRef.current = setTimeout(() => {\n        console.log(\"Attempting to reconnect...\");\n        connect();\n      }, 3000);\n    };\n  }, [username, toast]);\n\n  const sendMessage = useCallback((to: string, message: string) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({\n        type: \"chat\",\n        to,\n        message\n      }));\n    }\n  }, []);\n\n  const sendTypingIndicator = useCallback((to: string, isTyping: boolean) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({\n        type: \"typing\",\n        to,\n        isTyping\n      }));\n    }\n  }, []);\n\n  useEffect(() => {\n    connect();\n\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, [connect]);\n\n  return {\n    isConnected,\n    onlineUsers,\n    messages,\n    typingUsers,\n    sendMessage,\n    sendTypingIndicator\n  };\n}","size_bytes":4370},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {\n      config: './tailwind.config.ts',\n    },\n    autoprefixer: {},\n  },\n}\n","size_bytes":123},"client/src/contexts/i18n.tsx":{"content":"import { createContext, useContext, ReactNode } from \"react\";\n\ntype Language = \"en\" | \"fr\";\n\ninterface I18nContextType {\n  lang: Language;\n  t: (key: string) => string;\n}\n\nconst translations = {\n  en: {\n    \"loading.welcome\": \"Welcome to ELEVEX Portal\",\n    \"loading.initializing\": \"Initializing\",\n    \"login.title\": \"Login\",\n    \"login.username\": \"Username\",\n    \"login.password\": \"Password\",\n    \"login.submit\": \"Sign In\",\n    \"login.error\": \"Invalid credentials\",\n    \"dashboard.welcome\": \"Welcome to ELEVEX\",\n    \"dashboard.team\": \"Team Directory\",\n    \"dashboard.users\": \"User Management\",\n    \"dashboard.logout\": \"Logout\",\n    \"theme.dark\": \"Dark Theme\",\n    \"theme.unicorn\": \"Unicorn Theme\",\n    \"theme.light\": \"Light Theme\",\n  },\n  fr: {\n    \"loading.welcome\": \"Bienvenue au Portail ELEVEX\",\n    \"loading.initializing\": \"Initialisation\",\n    \"login.title\": \"Connexion\",\n    \"login.username\": \"Nom d'utilisateur\",\n    \"login.password\": \"Mot de passe\",\n    \"login.submit\": \"Se connecter\",\n    \"login.error\": \"Identifiants invalides\",\n    \"dashboard.welcome\": \"Bienvenue à ELEVEX\",\n    \"dashboard.team\": \"Répertoire d'équipe\",\n    \"dashboard.users\": \"Gestion des utilisateurs\",\n    \"dashboard.logout\": \"Déconnexion\",\n    \"theme.dark\": \"Thème Sombre\",\n    \"theme.unicorn\": \"Thème Licorne\",\n    \"theme.light\": \"Thème Clair\",\n  },\n};\n\nconst I18nContext = createContext<I18nContextType | undefined>(undefined);\n\nfunction detectLanguage(): Language {\n  const browserLang = navigator.language.toLowerCase();\n  if (browserLang.startsWith(\"fr\")) {\n    return \"fr\";\n  }\n  return \"en\";\n}\n\nexport function I18nProvider({ children }: { children: ReactNode }) {\n  const lang = detectLanguage();\n\n  const t = (key: string): string => {\n    return translations[lang][key as keyof typeof translations.en] || key;\n  };\n\n  return (\n    <I18nContext.Provider value={{ lang, t }}>\n      {children}\n    </I18nContext.Provider>\n  );\n}\n\nexport function useI18n() {\n  const context = useContext(I18nContext);\n  if (!context) {\n    throw new Error(\"useI18n must be used within I18nProvider\");\n  }\n  return context;\n}\n","size_bytes":2104},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"design_guidelines.md":{"content":"# ELEVEX ERP Design Guidelines\n\n## Design Approach\n**System:** Custom enterprise design system inspired by Carbon Design and Fluent Design, adapted for data-heavy lift dealership operations with ELEVEX branding overlay.\n\n**Rationale:** This is a utility-focused, information-dense ERP system requiring efficiency and clarity. The existing ELEVEX login establishes strong visual identity that will be maintained throughout while prioritizing functionality.\n\n## Core Design Elements\n\n### A. Typography\n**Font Family:** Inter (via Google Fonts CDN)\n- Headings: Inter 600-700 (semibold to bold)\n- Body text: Inter 400-500 (regular to medium)\n- Data tables/forms: Inter 400 (regular)\n- Buttons/UI elements: Inter 500-600 (medium to semibold)\n\n**Hierarchy:**\n- Page titles: text-2xl to text-3xl, font-semibold\n- Section headers: text-xl, font-semibold\n- Card titles: text-lg, font-medium\n- Body/labels: text-sm to text-base\n- Data tables: text-sm, tabular-nums for numbers\n\n### B. Layout System\n**Spacing Units:** Tailwind units of 2, 4, 6, 8, 12, 16, 20\n- Component padding: p-4, p-6, p-8\n- Section spacing: space-y-6, space-y-8\n- Card gaps: gap-4, gap-6\n- Table cells: p-3, p-4\n\n**Grid Structure:**\n- Dashboard: 12-column grid with responsive breakpoints\n- Sidebar navigation: Fixed 256px (w-64) on desktop, collapsible on mobile\n- Main content area: max-w-7xl with px-4 to px-8 padding\n- Data tables: Full-width within containers, horizontal scroll on mobile\n\n### C. Component Library\n\n**Navigation:**\n- Fixed left sidebar (dark background #0f0f19) with animated ELEVEX logo at top\n- Animated logo GIF displays brand identity with subtle motion\n- Department icons with labels (Sales, Service, Parts, Accounting, etc.)\n- Top bar with subtle gradient overlay (cyan → purple → pink at 10% opacity)\n- Language toggle (FR/EN) in top-right\n- Employee business card banner displays on dashboard\n\n**Cards & Containers:**\n- Background: rgba(15, 15, 25, 0.92) with backdrop-blur\n- Border: 1px solid rgba(255,255,255,0.12)\n- Border-radius: rounded-xl (12px) for cards, rounded-lg (8px) for smaller elements\n- Box-shadow: Subtle elevation, 0 4px 12px rgba(0,0,0,0.3)\n\n**Forms:**\n- Input fields: Dark background rgba(255,255,255,0.07), border rgba(255,255,255,0.2)\n- Focus state: Red accent border (#c00), subtle glow\n- Labels: text-sm font-medium, mb-2\n- Icon prefixes: 16px left padding for inputs with icons\n- Validation: Red error text, green success text\n\n**Data Tables:**\n- Striped rows for readability (alternate row background)\n- Sticky header on scroll\n- Sortable columns with arrow indicators\n- Row hover state: Subtle highlight\n- Action buttons in rightmost column\n- Pagination at bottom with page size selector\n\n**Buttons:**\n- Primary: Red background #c00, white text, font-semibold\n- Secondary: Transparent with border, white text\n- Ghost: No border, hover background change\n- Sizes: px-4 py-2 (small), px-6 py-3 (medium), px-8 py-4 (large)\n- Border-radius: rounded-lg\n- Icons: 18-20px, positioned left or right of text\n\n**GPS Map Component:**\n- Full-height container within main area\n- Mapbox GL JS or Leaflet integration\n- Technician markers with color coding (available, busy, offline)\n- Popup cards showing technician name, current job, last update\n- Route history toggle\n- Real-time position updates\n\n**Chat Interface:**\n- Split view: Channel list (w-80) + message area\n- Message bubbles: Rounded, sender vs. recipient styling\n- Department channels with # prefix\n- Direct messages with user avatars\n- Typing indicators and read receipts\n- File attachment support with preview\n\n**Work Order Cards:**\n- Status badge (New, Assigned, In Progress, Completed)\n- Customer info section with icon\n- Equipment details with part numbers\n- Assigned technician with avatar\n- Timeline showing status changes\n- Action buttons (Edit, Assign, Close, Bill)\n\n**Employee Business Card Banner:**\n- Horizontal layout in top bar\n- Avatar or department icon on left (48px circular)\n- Name (font-semibold), role, phone, email in vertical stack\n- Red accent line or border\n- Hover state shows full contact card\n\n### D. Visual Treatment\n\n**Color Palette (from ELEVEX branding):**\n- Background: #0a0a0a\n- Surface: rgba(15, 15, 25, 0.92)\n- Primary accent: #8ACCD5 (Cyan/Turquoise - HSL: 184 39% 68%)\n- Secondary accents:\n  - Purple: #8E7DBE (HSL: 253 30% 63%)\n  - Pink: #FF90BB (HSL: 339 100% 78%)\n  - Light Pink: #FFC1DA (HSL: 345 100% 85%)\n  - Cream: #F8F8E1 (HSL: 60 85% 93%)\n  - Teal: #1BCFB4 (HSL: 170 75% 45%)\n- Text primary: #ffffff\n- Text secondary: rgba(255,255,255,0.7)\n- Borders: rgba(255,255,255,0.12)\n- Success: #10b981\n- Warning: #f59e0b\n- Error: #ef4444\n\n**Gradient Effects:**\n- Cyan to Purple: `linear-gradient(135deg, #8ACCD5 0%, #8E7DBE 100%)`\n- Pink to Blue: `linear-gradient(135deg, #FF90BB 0%, #8ACCD5 100%)`\n- Full spectrum: `linear-gradient(135deg, #8ACCD5 0%, #8E7DBE 50%, #FF90BB 100%)`\n- Utility classes: `.gradient-cyan-purple`, `.gradient-pink-blue`, `.gradient-text`\n\n**Background Patterns:**\n- Subtle hexagonal texture overlay on main background (from login)\n- Carbon fiber texture on sidebar\n- Gradient overlays for hero sections (if any)\n\n**Depth & Elevation:**\n- Cards: 0 4px 12px rgba(0,0,0,0.3)\n- Modals: 0 20px 50px rgba(0,0,0,0.6)\n- Dropdowns: 0 8px 24px rgba(0,0,0,0.4)\n\n## Page-Specific Layouts\n\n**Dashboard:**\n- 3-column grid of stat cards (Sales Today, Active Work Orders, Technicians On Route)\n- Recent activity feed in left column\n- Quick actions panel in right column\n- Recent work orders table below\n\n**Work Order Management:**\n- Filter bar at top (Status, Department, Date Range, Technician)\n- Kanban board view option OR table view toggle\n- Work order cards with all relevant info\n- Click to expand full details in modal or side panel\n\n**GPS Tracking:**\n- Full-screen map as primary view\n- Collapsible technician list on left (filter by status)\n- Selected technician details panel on right\n- Real-time updates with WebSocket\n\n**Parts Inventory:**\n- Search bar with filters (Category, Stock Status, Supplier)\n- Grid or table view of parts\n- Stock level indicators with color coding\n- Quick reorder button with modal form\n\n**Billing Dashboard:**\n- Pending work orders requiring invoicing\n- Invoice generation wizard\n- Payment tracking table\n- Financial summary cards\n\n## Icons\n**Library:** Font Awesome 6.x (via CDN)\n- Department icons: fa-solid variants\n- Actions: fa-regular for secondary, fa-solid for primary\n- Status indicators: fa-circle with color classes\n- Navigation: fa-home, fa-truck, fa-wrench, fa-box, fa-calculator\n\n## Images\n**No hero images required** - this is a functional ERP dashboard application, not a marketing site. Focus on data visualization, charts, and UI clarity.\n\n## Accessibility\n- ARIA labels on all interactive elements\n- Keyboard navigation throughout\n- Focus indicators visible on all focusable elements\n- Color contrast ratios meeting WCAG AA standards\n- Screen reader announcements for status changes\n\n## Animations\n**Minimal, purposeful only:**\n- Smooth transitions on hover states (0.2s ease)\n- Loading spinners for data fetching\n- Toast notifications slide in/out from top-right\n- Modal fade-in with backdrop blur\n- **No decorative animations** - this is a productivity tool","size_bytes":7236},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border-2 bg-card/95 backdrop-blur-sm text-card-foreground shadow-lg hover:shadow-xl transition-all duration-300\",\n      \"border-gradient glow-multicolor\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-2 p-4 md:p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-4 md:p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }","size_bytes":1968},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/EmployeeBanner.tsx":{"content":"import { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface EmployeeBannerProps {\n  name: string;\n  role: string;\n  phone: string;\n  email: string;\n  department: string;\n}\n\nexport function EmployeeBanner({ name, role, phone, email, department }: EmployeeBannerProps) {\n  const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();\n  \n  const departmentIcons: Record<string, string> = {\n    'Road Tech': 'fa-wrench',\n    'Sales': 'fa-dollar-sign',\n    'Parts': 'fa-box',\n    'Accounting': 'fa-calculator',\n    'Management': 'fa-user-tie',\n  };\n\n  return (\n    <div className=\"flex items-center gap-4 p-4 bg-card border-l-4 border-l-primary rounded-lg\" data-testid=\"banner-employee\">\n      <Avatar className=\"h-12 w-12\">\n        <AvatarFallback className=\"bg-primary text-primary-foreground font-semibold\">\n          {initials}\n        </AvatarFallback>\n      </Avatar>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center gap-2\">\n          <h3 className=\"font-semibold text-foreground truncate\" data-testid=\"text-employee-name\">{name}</h3>\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            <i className={`fas ${departmentIcons[department] || 'fa-user'} mr-1`}></i>\n            {role}\n          </Badge>\n        </div>\n        <div className=\"flex items-center gap-4 text-sm text-muted-foreground mt-1\">\n          <span className=\"flex items-center gap-1\" data-testid=\"text-employee-phone\">\n            <i className=\"fas fa-phone text-xs\"></i>\n            {phone}\n          </span>\n          <span className=\"flex items-center gap-1 truncate\" data-testid=\"text-employee-email\">\n            <i className=\"fas fa-envelope text-xs\"></i>\n            {email}\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1839},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-300 ease-in-out\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-lg transition-all duration-300\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21874},"client/src/pages/dashboard.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useI18n } from \"@/contexts/i18n\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Sparkles, Users, Settings, LogOut, Moon, Sun, Palette } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { SessionPayload, TeamMember } from \"@/types/api\";\n\nexport default function Dashboard() {\n  const [, setLocation] = useLocation();\n  const { t } = useI18n();\n  const { theme, cycleTheme } = useTheme();\n  const { toast } = useToast();\n\n  const { data: session } = useQuery<SessionPayload>({\n    queryKey: [\"/api/auth/session\"],\n  });\n\n  const { data: teamMembers } = useQuery<TeamMember[]>({\n    queryKey: [\"/api/team-members\"],\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/auth/logout\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.clear();\n      setLocation(\"/login\");\n    },\n  });\n\n  const getThemeIcon = () => {\n    if (theme === \"unicorn\") return <Palette className=\"w-5 h-5\" />;\n    if (theme === \"light\") return <Sun className=\"w-5 h-5\" />;\n    return <Moon className=\"w-5 h-5\" />;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <h1 className=\"text-3xl font-bold gradient-text\" data-testid=\"text-dashboard-title\">\n              ELEVEX Portal\n            </h1>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={cycleTheme}\n              title={`Theme: ${theme}`}\n              data-testid=\"button-theme-toggle\"\n              className=\"neon-button\"\n            >\n              {getThemeIcon()}\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => logoutMutation.mutate()}\n              disabled={logoutMutation.isPending}\n              data-testid=\"button-logout\"\n              className=\"neon-button\"\n            >\n              <LogOut className=\"w-4 h-4 mr-2\" />\n              {t(\"dashboard.logout\")}\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto px-4 py-8\">\n        <div className=\"mb-8 fade-in-up\">\n          <h2 className=\"text-4xl font-bold mb-2\" data-testid=\"text-dashboard-welcome\">\n            {t(\"dashboard.welcome\")}{session?.username ? `, ${session.username}` : \"\"}!\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Access your team directory and manage portal settings\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          <Card className=\"neon-card hover:scale-105 transition-transform cursor-pointer\" data-testid=\"card-team-directory\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center neon-glow\">\n                  <Users className=\"w-6 h-6 text-primary\" />\n                </div>\n                <div>\n                  <CardTitle>{t(\"dashboard.team\")}</CardTitle>\n                  <CardDescription>View business cards</CardDescription>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground\">\n                {teamMembers?.length ?? 0} team members\n              </p>\n            </CardContent>\n          </Card>\n\n          {session?.isAdmin === true && (\n            <Card className=\"neon-card hover:scale-105 transition-transform cursor-pointer\" data-testid=\"card-user-management\">\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-12 h-12 rounded-lg bg-secondary/10 flex items-center justify-center neon-glow-purple\">\n                    <Settings className=\"w-6 h-6 text-secondary\" />\n                  </div>\n                  <div>\n                    <CardTitle>{t(\"dashboard.users\")}</CardTitle>\n                    <CardDescription>Admin only</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground\">\n                  Manage users and permissions\n                </p>\n              </CardContent>\n            </Card>\n          )}\n\n          <Card className=\"neon-card hover:scale-105 transition-transform cursor-pointer\" data-testid=\"card-theme-settings\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-12 h-12 rounded-lg bg-accent/10 flex items-center justify-center neon-glow-pink\">\n                  <Sparkles className=\"w-6 h-6 text-accent\" />\n                </div>\n                <div>\n                  <CardTitle>Theme</CardTitle>\n                  <CardDescription>Current: {theme}</CardDescription>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground\">\n                Click the theme toggle to cycle themes\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {teamMembers && teamMembers.length > 0 && (\n          <div className=\"mt-12\">\n            <h3 className=\"text-2xl font-bold mb-6\">Team Members</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {teamMembers.map((member) => (\n                <Card key={member.id} className=\"neon-card\" data-testid={`card-team-member-${member.id}`}>\n                  <CardHeader>\n                    <CardTitle>{member.name}</CardTitle>\n                    <CardDescription>{member.roleLabel}</CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-2\">\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <span className=\"text-muted-foreground\">Email:</span>\n                      <a href={`mailto:${member.email}`} className=\"text-primary hover:underline\">\n                        {member.email}\n                      </a>\n                    </div>\n                    {member.phone && (\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <span className=\"text-muted-foreground\">Phone:</span>\n                        <a href={`tel:${member.phone}`} className=\"text-primary hover:underline\">\n                          {member.phone}\n                        </a>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n      </main>\n    </div>\n  );\n}\n","size_bytes":7309},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/types/api.ts":{"content":"import type { users, teamMembers, workOrders, timePunches, adminMessages, messageReactions, locations, parts, vehicles } from \"@shared/schema\";\n\nexport type User = typeof users.$inferSelect;\nexport type TeamMember = typeof teamMembers.$inferSelect;\nexport type WorkOrder = typeof workOrders.$inferSelect;\nexport type TimePunch = typeof timePunches.$inferSelect;\nexport type AdminMessage = typeof adminMessages.$inferSelect;\nexport type MessageReaction = typeof messageReactions.$inferSelect;\nexport type Location = typeof locations.$inferSelect;\nexport type Part = typeof parts.$inferSelect;\nexport type Vehicle = typeof vehicles.$inferSelect;\n\nexport type SessionPayload = {\n  id: string;\n  username: string;\n  isAdmin: boolean;\n} | null;\n","size_bytes":740},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/pages/not-found.tsx":{"content":"import notFoundImage from \"@assets/IMG_0708_1763376676080.jpeg\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex flex-col items-center justify-center bg-background px-4\">\n      <img \n        src={notFoundImage} \n        alt=\"Page not found\" \n        className=\"w-full max-w-2xl rounded-lg shadow-lg mb-6\"\n      />\n      <div className=\"text-center\">\n        <h1 className=\"text-3xl font-bold text-foreground mb-2\">Page not found</h1>\n        <p className=\"text-muted-foreground\">\n          If you think this is a mistake, check the status page for active incidents, contact support or ask the community.\n        </p>\n      </div>\n    </div>\n  );\n}\n","size_bytes":694},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Silkscreen:wght@400;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .08);\n  --badge-outline: rgba(0,0,0, .04);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .04);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 70.91 21.57% 90%;\n  --foreground: 0 0% 8.24%;\n  --border: 35 10.53% 77.65%;\n  --card: 180 6.6667% 97.0588%;\n  --card-foreground: 210 25% 7.8431%;\n  --card-border: 220 13% 92%;\n  --sidebar: 180 6.6667% 97.0588%;\n  --sidebar-foreground: 210 25% 7.8431%;\n  --sidebar-border: 205.0000 25.0000% 90.5882%;\n  --sidebar-primary: 203.8863 88.2845% 53.1373%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 211.5789 51.3514% 92.7451%;\n  --sidebar-accent-foreground: 203.8863 88.2845% 53.1373%;\n  --sidebar-ring: 202.8169 89.1213% 53.1373%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 210 25% 7.8431%;\n  --popover-border: 220 13% 89%;\n  --primary: 165.65 26.44% 65.88%;\n  --primary-foreground: 0 0% 8.24%;\n  --secondary: 0 0% 8.24%;\n  --secondary-foreground: 70.91 21.57% 90%;\n  --muted: 72 12.82% 84.71%;\n  --muted-foreground: 208.65deg 59.36% 63.33%;\n  --accent: 292.13 48.03% 75.1%;\n  --accent-foreground: 0 0% 8.24%;\n  --destructive: 257.78deg 100% 73.53%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 0deg 100% 99.02%;\n  --ring: 166.76 29.82% 44.71%;\n  --chart-1: 178.45deg 64.32% 52.75%;\n  --chart-2: 159.7826 100% 36.0784%;\n  --chart-3: 42.0290 92.8251% 56.2745%;\n  --chart-4: 147.1429 78.5047% 41.9608%;\n  --chart-5: 341.4894 75.2000% 50.9804%;\n  --font-sans: 'Press Start 2P', 'Silkscreen', 'Courier New', monospace;\n  --font-serif: 'Press Start 2P', 'Silkscreen', 'Courier New', monospace;\n  --font-mono: 'Press Start 2P', 'Silkscreen', 'Courier New', monospace;\n  --radius: 0.75rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 1px 2px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 1px 2px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 2px 4px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 4px 6px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 8px 10px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .05);\n  --elevate-2: rgba(255,255,255, .10);\n  --background: 0 0% 0%;\n  --foreground: 200 6.6667% 91.1765%;\n  --border: 210 5.2632% 14.9020%;\n  --card: 228 9.8039% 10%;\n  --card-foreground: 0 0% 85.0980%;\n  --card-border: 217 33% 18%;\n  --sidebar: 228 9.8039% 10%;\n  --sidebar-foreground: 0 0% 85.0980%;\n  --sidebar-border: 205.7143 15.7895% 26.0784%;\n  --sidebar-primary: 202.8169 89.1213% 53.1373%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 205.7143 70% 7.8431%;\n  --sidebar-accent-foreground: 203.7736 87.6033% 52.5490%;\n  --sidebar-ring: 202.8169 89.1213% 53.1373%;\n  --popover: 0 0% 0%;\n  --popover-foreground: 200 6.6667% 91.1765%;\n  --popover-border: 217 33% 20%;\n  --primary: 203.7736 87.6033% 52.5490%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 195.0000 15.3846% 94.9020%;\n  --secondary-foreground: 210 25% 7.8431%;\n  --muted: 0 0% 9.4118%;\n  --muted-foreground: 210 3.3898% 46.2745%;\n  --accent: 205.7143 70% 7.8431%;\n  --accent-foreground: 203.7736 87.6033% 52.5490%;\n  --destructive: 307.65deg 83.24% 64.9%;\n  --destructive-foreground: 0 0% 100%;\n  --input: 207.6923 27.6596% 18.4314%;\n  --ring: 202.8169 89.1213% 53.1373%;\n  --chart-1: 177.65deg 71.16% 42.16%;\n  --chart-2: 159.7826 100% 36.0784%;\n  --chart-3: 42.0290 92.8251% 56.2745%;\n  --chart-4: 147.1429 78.5047% 41.9608%;\n  --chart-5: 341.4894 75.2000% 50.9804%;\n  --font-sans: 'Press Start 2P', 'Silkscreen', 'Courier New', monospace;\n  --shadow-2xs: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 1px 2px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 1px 2px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 2px 4px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 4px 6px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 8px 10px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);\n  --radius: 1.3rem;\n  --spacing: 0.25rem;\n  --font-mono: Menlo, monospace;\n  --font-serif: Georgia, serif;\n  --tracking-normal: 0em;\n}\n\n/* UNICORN THEME */\n.unicorn {\n  --button-outline: rgba(99, 102, 241, .15);\n  --badge-outline: rgba(99, 102, 241, .08);\n  --opaque-button-border-intensity: -6;\n  --elevate-1: rgba(99, 102, 241, .05);\n  --elevate-2: rgba(99, 102, 241, .12);\n  --background: 245 100% 97%;\n  --foreground: 220 13% 20%;\n  --border: 243 100% 88%;\n  --card: 0 0% 100%;\n  --card-foreground: 220 13% 18%;\n  --card-border: 243 100% 89%;\n  --sidebar: 0 0% 100%;\n  --sidebar-foreground: 220 13% 18%;\n  --sidebar-border: 243 100% 87%;\n  --sidebar-primary: 221 83% 53%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 280 85% 92%;\n  --sidebar-accent-foreground: 280 85% 50%;\n  --sidebar-ring: 221 83% 53%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 220 13% 18%;\n  --popover-border: 243 100% 87%;\n  --primary: 221 83% 53%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 280 85% 92%;\n  --secondary-foreground: 220 13% 20%;\n  --muted: 243 100% 88%;\n  --muted-foreground: 220 12% 48%;\n  --accent: 280 85% 65%;\n  --accent-foreground: 0 0% 100%;\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 98%;\n  --input: 243 100% 88%;\n  --ring: 221 83% 53%;\n  --chart-1: 221 83% 53%;\n  --chart-2: 280 85% 65%;\n  --chart-3: 20 84% 61%;\n  --chart-4: 160 84% 39%;\n  --chart-5: 276 100% 71%;\n  --shadow-2xs: 0px 1px 2px 0px rgba(99, 102, 241, 0.08);\n  --shadow-xs: 0px 1px 3px 0px rgba(99, 102, 241, 0.12);\n  --shadow-sm: 0px 2px 4px 0px rgba(99, 102, 241, 0.12);\n  --shadow: 0px 4px 12px -2px rgba(99, 102, 241, 0.15);\n  --shadow-md: 0px 8px 16px -2px rgba(99, 102, 241, 0.18);\n  --shadow-lg: 0px 12px 24px -4px rgba(99, 102, 241, 0.2);\n  --shadow-xl: 0px 20px 40px -6px rgba(99, 102, 241, 0.25);\n  --shadow-2xl: 0px 30px 60px -8px rgba(99, 102, 241, 0.3);\n  --radius: 0.75rem;\n  --spacing: 0.25rem;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  html {\n    font-size: 10px;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-weight: 700;\n  }\n\n  * {\n    font-weight: 700 !important;\n  }\n\n  /* Light mode - vibrant gradient background with color accents */\n  body.light::before {\n    content: \"\";\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(135deg, #8ACCD5 0%, #f0f4f8 25%, #FFC1DA 50%, #f8fafc 75%, #8E7DBE 100%);\n    opacity: 0.15;\n    z-index: -2;\n  }\n\n  body.light::after {\n    content: \"\";\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: radial-gradient(circle at 20% 50%, rgba(138, 204, 213, 0.1) 0%, transparent 50%),\n                radial-gradient(circle at 80% 80%, rgba(255, 144, 187, 0.1) 0%, transparent 50%),\n                radial-gradient(circle at 40% 20%, rgba(142, 125, 190, 0.08) 0%, transparent 50%);\n    z-index: -1;\n  }\n\n  /* Dark mode - vibrant gradient background with neon accents */\n  body.dark::before {\n    content: \"\";\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(135deg, #0f172a 0%, #1a1f3a 25%, #1e2e4b 50%, #1a2847 75%, #0f172a 100%);\n    z-index: -2;\n  }\n\n  body.dark::after {\n    content: \"\";\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: radial-gradient(circle at 15% 30%, rgba(138, 204, 213, 0.15) 0%, transparent 40%),\n                radial-gradient(circle at 85% 70%, rgba(255, 144, 187, 0.12) 0%, transparent 40%),\n                radial-gradient(circle at 50% 50%, rgba(142, 125, 190, 0.1) 0%, transparent 50%),\n                radial-gradient(circle at 70% 20%, rgba(27, 207, 180, 0.08) 0%, transparent 35%);\n    z-index: -1;\n  }\n\n  /* Unicorn theme - magical rainbow gradient background */\n  body.unicorn::before {\n    content: \"\";\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(135deg, #faf5ff 0%, #f0ebff 20%, #e9e0ff 40%, #ffeef8 60%, #fff0f5 80%, #faf5ff 100%);\n    z-index: -2;\n  }\n\n  body.unicorn::after {\n    content: \"\";\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: radial-gradient(circle at 25% 25%, rgba(168, 85, 247, 0.15) 0%, transparent 50%),\n                radial-gradient(circle at 75% 75%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),\n                radial-gradient(circle at 50% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 60%),\n                radial-gradient(circle at 80% 30%, rgba(244, 114, 182, 0.12) 0%, transparent 45%);\n    z-index: -1;\n  }\n}\n\n@layer utilities {\n  /* Safe area insets for mobile devices */\n  .safe-area-inset-bottom {\n    padding-bottom: max(0.75rem, env(safe-area-inset-bottom));\n  }\n\n  /* Animations */\n  @keyframes fade-in-up {\n    from {\n      opacity: 0;\n      transform: translateY(20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n\n  @keyframes slide-in-right {\n    from {\n      opacity: 0;\n      transform: translateX(20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  @keyframes slide-in-left {\n    from {\n      opacity: 0;\n      transform: translateX(-20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  .fade-in-up {\n    animation: fade-in-up 0.5s ease-out;\n  }\n\n  .slide-in-right {\n    animation: slide-in-right 0.5s ease-out;\n  }\n\n  .slide-in-left {\n    animation: slide-in-left 0.5s ease-out;\n  }\n\n  /* Gradient utilities */\n  .gradient-blue-purple {\n    background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);\n  }\n\n  .gradient-purple-pink {\n    background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);\n  }\n\n  .gradient-cyan-purple {\n    background: linear-gradient(135deg, #8ACCD5 0%, #8E7DBE 100%);\n  }\n\n  .gradient-pink-blue {\n    background: linear-gradient(135deg, #FF90BB 0%, #8ACCD5 100%);\n  }\n\n  .gradient-text {\n    background: linear-gradient(135deg, #8ACCD5 0%, #8E7DBE 50%, #FF90BB 100%);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n  }\n\n  /* Colorful border effects */\n  .border-gradient {\n    position: relative;\n    border: 2px solid transparent;\n    background-clip: padding-box;\n  }\n\n  .border-gradient::before {\n    content: '';\n    position: absolute;\n    inset: -2px;\n    border-radius: inherit;\n    padding: 2px;\n    background: linear-gradient(135deg, #8ACCD5 0%, #8E7DBE 50%, #FF90BB 100%);\n    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n    -webkit-mask-composite: xor;\n    mask-composite: exclude;\n    z-index: -1;\n  }\n\n  /* Glow effects */\n  .glow-cyan {\n    box-shadow: 0 0 20px rgba(138, 204, 213, 0.3), 0 0 40px rgba(138, 204, 213, 0.15);\n  }\n\n  .glow-purple {\n    box-shadow: 0 0 20px rgba(142, 125, 190, 0.3), 0 0 40px rgba(142, 125, 190, 0.15);\n  }\n\n  .glow-pink {\n    box-shadow: 0 0 20px rgba(255, 144, 187, 0.3), 0 0 40px rgba(255, 144, 187, 0.15);\n  }\n\n  .glow-multicolor {\n    box-shadow: 0 0 15px rgba(138, 204, 213, 0.2), \n                0 0 30px rgba(142, 125, 190, 0.15),\n                0 0 45px rgba(255, 144, 187, 0.1);\n  }\n\n  /* Hide search cancel button */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* Elevation system */\n  .no-default-hover-elevate {}\n  .no-default-active-elevate {}\n\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: -1;\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: 999;\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","size_bytes":14486},"client/src/contexts/ThemeContext.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from \"react\";\n\nexport type Theme = \"light\" | \"dark\" | \"unicorn\";\n\ninterface ThemeContextType {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n  cycleTheme: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const stored = localStorage.getItem(\"theme\");\n    return (stored as Theme) || \"light\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\", \"unicorn\");\n    root.classList.add(theme);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const cycleTheme = () => {\n    setTheme((current) => {\n      if (current === \"dark\") return \"light\";\n      if (current === \"light\") return \"unicorn\";\n      return \"dark\";\n    });\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, setTheme, cycleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within ThemeProvider\");\n  }\n  return context;\n}\n","size_bytes":1253},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/pages/enhanced-dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link, useLocation } from \"wouter\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useI18n } from \"@/contexts/i18n\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Sparkles, Users, Settings, LogOut, Moon, Sun, Palette,\n  MessageSquare, ClipboardList, Clock, TrendingUp, Award,\n  Heart, ThumbsUp, Star, Smile, PartyPopper, User,\n  MapPin, Calendar, Briefcase, Target, AlertCircle, CheckCircle\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { SessionPayload, TeamMember, WorkOrder, AdminMessage } from \"@/types/api\";\n\n// Mood icon mapping\nconst moodIcons: Record<string, any> = {\n  happy: Smile,\n  focused: Target,\n  excited: PartyPopper,\n  thoughtful: Star,\n  busy: Clock,\n  default: User\n};\n\n// Reaction icons\nconst reactionOptions = [\n  { value: \"like\", icon: ThumbsUp, label: \"Like\" },\n  { value: \"love\", icon: Heart, label: \"Love\" },\n  { value: \"smile\", icon: Smile, label: \"Smile\" },\n  { value: \"celebrate\", icon: PartyPopper, label: \"Celebrate\" },\n  { value: \"star\", icon: Star, label: \"Star\" }\n];\n\nexport default function EnhancedDashboard() {\n  const [, setLocation] = useLocation();\n  const { t } = useI18n();\n  const { theme, cycleTheme } = useTheme();\n  const { toast } = useToast();\n  const [newMessage, setNewMessage] = useState(\"\");\n\n  // Get current user session\n  const { data: session } = useQuery<SessionPayload>({\n    queryKey: [\"/api/auth/session\"],\n  });\n\n  // Get team members\n  const { data: teamMembers = [] } = useQuery<TeamMember[]>({\n    queryKey: [\"/api/team-members\"],\n  });\n\n  // Get work orders for stats\n  const { data: workOrders = [] } = useQuery<WorkOrder[]>({\n    queryKey: [\"/api/work-orders\"],\n  });\n\n  // Get admin messages\n  const { data: adminMessages = [] } = useQuery<AdminMessage[]>({\n    queryKey: [\"/api/admin-messages\"],\n  });\n\n  // Calculate motivational stats\n  const stats = {\n    totalWorkOrders: workOrders.length,\n    completedOrders: workOrders.filter(w => w.status === \"completed\").length,\n    inProgressOrders: workOrders.filter(w => w.status === \"in_progress\").length,\n    totalHours: workOrders.reduce((sum, order) => sum + (order.totalHours || 0), 0),\n    productivityRate: workOrders.length > 0 \n      ? Math.round((workOrders.filter(w => w.status === \"completed\").length / workOrders.length) * 100)\n      : 0\n  };\n\n  // Group team members by headquarters\n  const teamByHeadquarters = teamMembers.reduce((acc, member) => {\n    const hq = member.headquarters || \"Montréal\";\n    if (!acc[hq]) acc[hq] = [];\n    acc[hq].push(member);\n    return acc;\n  }, {} as Record<string, TeamMember[]>);\n\n  // Logout mutation\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/auth/logout\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.clear();\n      setLocation(\"/login\");\n    },\n  });\n\n  // Post admin message\n  const postMessageMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin-messages\", {\n        message,\n        createdBy: session?.username\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin-messages\"] });\n      setNewMessage(\"\");\n      toast({ title: \"Message posted successfully\" });\n    }\n  });\n\n  // React to message\n  const reactMutation = useMutation({\n    mutationFn: async ({ messageId, reaction }: { messageId: string; reaction: string }) => {\n      const res = await apiRequest(\"POST\", `/api/admin-messages/${messageId}/react`, { reaction });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin-messages\"] });\n    }\n  });\n\n  const getThemeIcon = () => {\n    if (theme === \"unicorn\") return <Palette className=\"w-5 h-5\" />;\n    if (theme === \"light\") return <Sun className=\"w-5 h-5\" />;\n    return <Moon className=\"w-5 h-5\" />;\n  };\n\n  const getMoodIcon = (mood: string | null) => {\n    const Icon = moodIcons[mood || \"default\"] || moodIcons.default;\n    return <Icon className=\"w-4 h-4\" />;\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <header className=\"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-50 neon-border\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <h1 className=\"text-3xl font-bold gradient-text\" data-testid=\"text-dashboard-title\">\n              ELEVEX Portal\n            </h1>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Link href=\"/profile\" asChild>\n              <Button variant=\"outline\" size=\"icon\" className=\"neon-button\" data-testid=\"button-profile\">\n                <User className=\"w-5 h-5\" />\n              </Button>\n            </Link>\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={cycleTheme}\n              title={`Theme: ${theme}`}\n              data-testid=\"button-theme-toggle\"\n              className=\"neon-button\"\n            >\n              {getThemeIcon()}\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => logoutMutation.mutate()}\n              disabled={logoutMutation.isPending}\n              data-testid=\"button-logout\"\n              className=\"neon-button\"\n            >\n              <LogOut className=\"w-4 h-4 mr-2\" />\n              Logout\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto px-4 py-8\">\n        {/* Welcome Section */}\n        <div className=\"mb-8 fade-in-up\">\n          <h2 className=\"text-4xl font-bold mb-2\" data-testid=\"text-dashboard-welcome\">\n            Welcome back{session?.username ? `, ${session.username}` : \"\"}!\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Here's your productivity overview and team status\n          </p>\n        </div>\n\n        {/* Motivational Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-5 gap-4 mb-8\">\n          <Card className=\"neon-card neon-contour\">\n            <CardHeader className=\"pb-2\">\n              <CardDescription>Total Work Orders</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold gradient-text\">{stats.totalWorkOrders}</div>\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n                <ClipboardList className=\"w-3 h-3\" />\n                <span>All time</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"neon-card neon-contour\">\n            <CardHeader className=\"pb-2\">\n              <CardDescription>Completed</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold text-green-500\">{stats.completedOrders}</div>\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n                <CheckCircle className=\"w-3 h-3\" />\n                <span>Success</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"neon-card neon-contour\">\n            <CardHeader className=\"pb-2\">\n              <CardDescription>In Progress</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold text-orange-500\">{stats.inProgressOrders}</div>\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n                <Clock className=\"w-3 h-3\" />\n                <span>Active</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"neon-card neon-contour\">\n            <CardHeader className=\"pb-2\">\n              <CardDescription>Total Hours</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold gradient-cyan-purple\">\n                {Math.round(stats.totalHours)}h\n              </div>\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n                <TrendingUp className=\"w-3 h-3\" />\n                <span>Tracked</span>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"neon-card neon-contour\">\n            <CardHeader className=\"pb-2\">\n              <CardDescription>Productivity</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold gradient-pink-blue\">{stats.productivityRate}%</div>\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n                <Award className=\"w-3 h-3\" />\n                <span>Completion rate</span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Quick Navigation Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Link href=\"/work-orders\" asChild>\n            <Card className=\"neon-card neon-contour hover:scale-105 transition-transform cursor-pointer\" data-testid=\"card-work-orders\">\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center neon-glow\">\n                    <ClipboardList className=\"w-6 h-6 text-primary\" />\n                  </div>\n                  <div>\n                    <CardTitle>Work Orders</CardTitle>\n                    <CardDescription>Manage tasks & time</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground\">\n                  {stats.inProgressOrders} orders in progress\n                </p>\n              </CardContent>\n            </Card>\n          </Link>\n\n          <Link href=\"/chat\" asChild>\n            <Card className=\"neon-card neon-contour hover:scale-105 transition-transform cursor-pointer\" data-testid=\"card-chat\">\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-12 h-12 rounded-lg bg-secondary/10 flex items-center justify-center neon-glow-purple\">\n                    <MessageSquare className=\"w-6 h-6 text-secondary\" />\n                  </div>\n                  <div>\n                    <CardTitle>Team Chat</CardTitle>\n                    <CardDescription>Connect with colleagues</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground\">\n                  Real-time messaging\n                </p>\n              </CardContent>\n            </Card>\n          </Link>\n\n          <Link href=\"/profile\" asChild>\n            <Card className=\"neon-card neon-contour hover:scale-105 transition-transform cursor-pointer\" data-testid=\"card-profile\">\n              <CardHeader>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-12 h-12 rounded-lg bg-accent/10 flex items-center justify-center neon-glow-pink\">\n                    <Settings className=\"w-6 h-6 text-accent\" />\n                  </div>\n                  <div>\n                    <CardTitle>Profile Settings</CardTitle>\n                    <CardDescription>Customize your profile</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-sm text-muted-foreground\">\n                  Update mood & preferences\n                </p>\n              </CardContent>\n            </Card>\n          </Link>\n        </div>\n\n        {/* Admin Message Board */}\n        <div className=\"mb-8\">\n          <h3 className=\"text-2xl font-bold mb-4 gradient-text\">Message Board</h3>\n          \n          {/* Post new message (admin only) */}\n          {session?.isAdmin && (\n            <Card className=\"mb-4 neon-card\">\n              <CardContent className=\"pt-6\">\n                <div className=\"flex gap-2\">\n                  <Textarea\n                    placeholder=\"Share a motivational message with the team...\"\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    className=\"flex-1 neon-card\"\n                    rows={2}\n                    data-testid=\"input-admin-message\"\n                  />\n                  <Button\n                    onClick={() => newMessage && postMessageMutation.mutate(newMessage)}\n                    disabled={!newMessage || postMessageMutation.isPending}\n                    className=\"neon-button\"\n                    data-testid=\"button-post-message\"\n                  >\n                    Post\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Messages list */}\n          <ScrollArea className=\"h-64\">\n            <div className=\"space-y-4\">\n              {adminMessages.map((message) => (\n                <Card key={message.id} className=\"neon-card\" data-testid={`card-message-${message.id}`}>\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-start justify-between\">\n                      <div>\n                        <CardDescription>{message.createdBy}</CardDescription>\n                        <p className=\"text-sm mt-1\">{message.message}</p>\n                      </div>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        {new Date(message.createdAt).toLocaleDateString()}\n                      </Badge>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex gap-2\">\n                      {reactionOptions.map((reaction) => {\n                        const userReacted = message.reactions?.some(\n                          r => r.userId === session?.username && r.reaction === reaction.value\n                        );\n                        const count = message.reactions?.filter(r => r.reaction === reaction.value).length || 0;\n                        \n                        return (\n                          <Button\n                            key={reaction.value}\n                            variant={userReacted ? \"default\" : \"outline\"}\n                            size=\"sm\"\n                            className={userReacted ? \"neon-glow\" : \"\"}\n                            onClick={() => reactMutation.mutate({ \n                              messageId: message.id, \n                              reaction: reaction.value \n                            })}\n                            disabled={reactMutation.isPending}\n                            data-testid={`button-react-${message.id}-${reaction.value}`}\n                          >\n                            <reaction.icon className=\"w-4 h-4\" />\n                            {count > 0 && <span className=\"ml-1\">{count}</span>}\n                          </Button>\n                        );\n                      })}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </ScrollArea>\n        </div>\n\n        {/* Team Members by Headquarters */}\n        <div>\n          <h3 className=\"text-2xl font-bold mb-6 gradient-text\">Team Directory</h3>\n          {Object.entries(teamByHeadquarters).map(([headquarters, members]) => (\n            <div key={headquarters} className=\"mb-8\">\n              <div className=\"flex items-center gap-2 mb-4\">\n                <MapPin className=\"w-5 h-5 text-primary\" />\n                <h4 className=\"text-xl font-semibold\">{headquarters}</h4>\n                <Badge variant=\"outline\">{members.length} members</Badge>\n              </div>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {members.map((member) => (\n                  <Card \n                    key={member.id} \n                    className=\"neon-card neon-contour overflow-hidden\"\n                    data-testid={`card-team-member-${member.id}`}\n                  >\n                    {/* Banner with favorite color */}\n                    <div \n                      className=\"h-2\"\n                      style={{ backgroundColor: member.favoriteColor || \"#8ACCD5\" }}\n                    />\n                    \n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <CardTitle className=\"text-lg flex items-center gap-2\">\n                            {member.name}\n                            {member.currentMood && (\n                              <span title={`Mood: ${member.currentMood}`}>\n                                {getMoodIcon(member.currentMood)}\n                              </span>\n                            )}\n                          </CardTitle>\n                          <CardDescription>{member.occupation || member.roleLabel}</CardDescription>\n                        </div>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          <Calendar className=\"w-3 h-3 mr-1\" />\n                          {member.yearsOfService}y\n                        </Badge>\n                      </div>\n                    </CardHeader>\n                    \n                    <CardContent className=\"space-y-2\">\n                      <div className=\"flex items-center gap-2 text-sm\">\n                        <Briefcase className=\"w-4 h-4 text-muted-foreground\" />\n                        <span>{member.roleLabel}</span>\n                      </div>\n                      <div className=\"text-sm text-muted-foreground\">\n                        {member.email}\n                      </div>\n                      {member.phone && (\n                        <div className=\"text-sm text-muted-foreground\">\n                          {member.phone}\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          ))}\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":18938},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/pages/vehicles.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Truck, Plus, Wrench, Clock } from \"lucide-react\";\nimport type { Vehicle } from \"@/types/api\";\n\nexport default function Vehicles() {\n  const { toast } = useToast();\n  const [open, setOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    vehicleType: \"forklift\",\n    model: \"\",\n    serialNumber: \"\",\n    manufacturer: \"\",\n    status: \"available\",\n    hoursUsed: 0\n  });\n\n  const { data: vehicles = [] } = useQuery<Vehicle[]>({\n    queryKey: [\"/api/vehicles\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/vehicles\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      setOpen(false);\n      setFormData({ vehicleType: \"forklift\", model: \"\", serialNumber: \"\", manufacturer: \"\", status: \"available\", hoursUsed: 0 });\n      toast({ title: \"Vehicle added successfully\" });\n    }\n  });\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"available\": return \"default\";\n      case \"in_use\": return \"secondary\";\n      case \"maintenance\": return \"outline\";\n      case \"out_of_service\": return \"destructive\";\n      default: return \"default\";\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold gradient-text\">Vehicle Fleet</h1>\n          <p className=\"text-muted-foreground\">Manage forklifts and material handling equipment</p>\n        </div>\n        \n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"neon-button\" data-testid=\"button-add-vehicle\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add Vehicle\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"neon-card\">\n            <DialogHeader>\n              <DialogTitle>Add New Vehicle</DialogTitle>\n              <DialogDescription>Register a new vehicle to the fleet</DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"vehicleType\">Vehicle Type</Label>\n                <Select value={formData.vehicleType} onValueChange={(value) => setFormData({ ...formData, vehicleType: value })}>\n                  <SelectTrigger className=\"neon-card mt-2\" data-testid=\"select-vehicle-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"forklift\">Forklift</SelectItem>\n                    <SelectItem value=\"pallet_jack\">Pallet Jack</SelectItem>\n                    <SelectItem value=\"order_picker\">Order Picker</SelectItem>\n                    <SelectItem value=\"reach_truck\">Reach Truck</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"manufacturer\">Manufacturer</Label>\n                <Input\n                  id=\"manufacturer\"\n                  value={formData.manufacturer}\n                  onChange={(e) => setFormData({ ...formData, manufacturer: e.target.value })}\n                  placeholder=\"Toyota\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-vehicle-manufacturer\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"model\">Model</Label>\n                <Input\n                  id=\"model\"\n                  value={formData.model}\n                  onChange={(e) => setFormData({ ...formData, model: e.target.value })}\n                  placeholder=\"8FGU25\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-vehicle-model\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"serialNumber\">Serial Number</Label>\n                <Input\n                  id=\"serialNumber\"\n                  value={formData.serialNumber}\n                  onChange={(e) => setFormData({ ...formData, serialNumber: e.target.value })}\n                  placeholder=\"FL-2024-001\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-vehicle-serial\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"status\">Status</Label>\n                <Select value={formData.status} onValueChange={(value) => setFormData({ ...formData, status: value })}>\n                  <SelectTrigger className=\"neon-card mt-2\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"available\">Available</SelectItem>\n                    <SelectItem value=\"in_use\">In Use</SelectItem>\n                    <SelectItem value=\"maintenance\">Maintenance</SelectItem>\n                    <SelectItem value=\"out_of_service\">Out of Service</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <Button\n                onClick={() => createMutation.mutate(formData)}\n                disabled={!formData.model || !formData.serialNumber || createMutation.isPending}\n                className=\"w-full neon-button\"\n                data-testid=\"button-save-vehicle\"\n              >\n                Add Vehicle\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {vehicles.map((vehicle) => (\n          <Card key={vehicle.id} className=\"neon-card neon-contour\" data-testid={`card-vehicle-${vehicle.id}`}>\n            <CardHeader>\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center neon-glow\">\n                    <Truck className=\"w-6 h-6 text-primary\" />\n                  </div>\n                  <div>\n                    <CardTitle className=\"text-lg\">{vehicle.manufacturer} {vehicle.model}</CardTitle>\n                    <CardDescription className=\"capitalize\">{vehicle.vehicleType.replace('_', ' ')}</CardDescription>\n                  </div>\n                </div>\n                <Badge variant={getStatusColor(vehicle.status)} className=\"neon-glow capitalize\">\n                  {vehicle.status.replace('_', ' ')}\n                </Badge>\n              </div>\n            </CardHeader>\n            \n            <CardContent className=\"space-y-3\">\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Serial Number:</span>\n                <span className=\"font-mono\">{vehicle.serialNumber}</span>\n              </div>\n              \n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Hours Used:</span>\n                <span className=\"flex items-center font-medium\">\n                  <Clock className=\"w-3 h-3 mr-1\" />\n                  {vehicle.hoursUsed}h\n                </span>\n              </div>\n              \n              {vehicle.assignedTo && (\n                <div className=\"text-sm\">\n                  <span className=\"text-muted-foreground\">Assigned to: </span>\n                  <span className=\"font-medium\">{vehicle.assignedTo}</span>\n                </div>\n              )}\n              \n              {vehicle.nextMaintenance && (\n                <div className=\"flex items-center gap-2 p-2 bg-yellow-500/10 rounded-md\">\n                  <Wrench className=\"w-4 h-4 text-yellow-500\" />\n                  <span className=\"text-xs text-yellow-500\">\n                    Next maintenance: {new Date(vehicle.nextMaintenance).toLocaleDateString()}\n                  </span>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {vehicles.length === 0 && (\n        <Card className=\"neon-card\">\n          <CardContent className=\"py-12 text-center\">\n            <Truck className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No vehicles in fleet</h3>\n            <p className=\"text-muted-foreground mb-4\">Add your first vehicle to get started</p>\n            <Button onClick={() => setOpen(true)} className=\"neon-button\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add First Vehicle\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":9539},"client/src/pages/locations.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { MapPin, Building, Warehouse, Plus, Edit, Trash2 } from \"lucide-react\";\nimport type { Location } from \"@/types/api\";\n\nexport default function Locations() {\n  const { toast } = useToast();\n  const [open, setOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    address: \"\",\n    type: \"warehouse\",\n    capacity: 0,\n    active: true\n  });\n\n  const { data: locations = [] } = useQuery<Location[]>({\n    queryKey: [\"/api/locations\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/locations\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/locations\"] });\n      setOpen(false);\n      setFormData({ name: \"\", address: \"\", type: \"warehouse\", capacity: 0, active: true });\n      toast({ title: \"Location created successfully\" });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/locations/${id}`);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/locations\"] });\n      toast({ title: \"Location deleted successfully\" });\n    }\n  });\n\n  const getLocationIcon = (type: string) => {\n    switch (type) {\n      case \"warehouse\": return Warehouse;\n      case \"office\": return Building;\n      default: return MapPin;\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold gradient-text\">Location Management</h1>\n          <p className=\"text-muted-foreground\">Manage warehouses, offices, and service centers</p>\n        </div>\n        \n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"neon-button\" data-testid=\"button-add-location\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add Location\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"neon-card\">\n            <DialogHeader>\n              <DialogTitle>Add New Location</DialogTitle>\n              <DialogDescription>Create a new location for inventory and operations</DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"name\">Location Name</Label>\n                <Input\n                  id=\"name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"Montreal Main Warehouse\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-location-name\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"address\">Address</Label>\n                <Input\n                  id=\"address\"\n                  value={formData.address}\n                  onChange={(e) => setFormData({ ...formData, address: e.target.value })}\n                  placeholder=\"123 Industrial Blvd, Montreal, QC\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-location-address\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"type\">Type</Label>\n                <Select value={formData.type} onValueChange={(value) => setFormData({ ...formData, type: value })}>\n                  <SelectTrigger className=\"neon-card mt-2\" data-testid=\"select-location-type\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"warehouse\">Warehouse</SelectItem>\n                    <SelectItem value=\"office\">Office</SelectItem>\n                    <SelectItem value=\"storage\">Storage</SelectItem>\n                    <SelectItem value=\"service_center\">Service Center</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"capacity\">Capacity (sq ft)</Label>\n                <Input\n                  id=\"capacity\"\n                  type=\"number\"\n                  value={formData.capacity}\n                  onChange={(e) => setFormData({ ...formData, capacity: parseInt(e.target.value) || 0 })}\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-location-capacity\"\n                />\n              </div>\n              \n              <Button\n                onClick={() => createMutation.mutate(formData)}\n                disabled={!formData.name || !formData.address || createMutation.isPending}\n                className=\"w-full neon-button\"\n                data-testid=\"button-save-location\"\n              >\n                Create Location\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {locations.map((location) => {\n          const Icon = getLocationIcon(location.type);\n          return (\n            <Card key={location.id} className=\"neon-card neon-contour\" data-testid={`card-location-${location.id}`}>\n              <CardHeader>\n                <div className=\"flex items-start justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center neon-glow\">\n                      <Icon className=\"w-6 h-6 text-primary\" />\n                    </div>\n                    <div>\n                      <CardTitle className=\"text-lg\">{location.name}</CardTitle>\n                      <CardDescription className=\"capitalize\">{location.type.replace('_', ' ')}</CardDescription>\n                    </div>\n                  </div>\n                  <Badge variant={location.active ? \"default\" : \"secondary\"} className=\"neon-glow\">\n                    {location.active ? \"Active\" : \"Inactive\"}\n                  </Badge>\n                </div>\n              </CardHeader>\n              \n              <CardContent className=\"space-y-3\">\n                <div className=\"flex items-start gap-2 text-sm\">\n                  <MapPin className=\"w-4 h-4 text-muted-foreground mt-0.5\" />\n                  <span className=\"text-muted-foreground\">{location.address}</span>\n                </div>\n                \n                {location.capacity && (\n                  <div className=\"text-sm\">\n                    <span className=\"text-muted-foreground\">Capacity: </span>\n                    <span className=\"font-medium\">{location.capacity.toLocaleString()} sq ft</span>\n                  </div>\n                )}\n                \n                <div className=\"flex gap-2 pt-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"flex-1\"\n                    data-testid={`button-edit-${location.id}`}\n                  >\n                    <Edit className=\"w-3 h-3 mr-1\" />\n                    Edit\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => deleteMutation.mutate(location.id)}\n                    disabled={deleteMutation.isPending}\n                    data-testid={`button-delete-${location.id}`}\n                  >\n                    <Trash2 className=\"w-3 h-3\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      {locations.length === 0 && (\n        <Card className=\"neon-card\">\n          <CardContent className=\"py-12 text-center\">\n            <MapPin className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No locations yet</h3>\n            <p className=\"text-muted-foreground mb-4\">Get started by adding your first location</p>\n            <Button onClick={() => setOpen(true)} className=\"neon-button\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add First Location\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":9112},"client/src/pages/parts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Package, Plus, AlertTriangle, DollarSign } from \"lucide-react\";\nimport type { Part } from \"@/types/api\";\n\nexport default function Parts() {\n  const { toast } = useToast();\n  const [open, setOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    partNumber: \"\",\n    name: \"\",\n    description: \"\",\n    category: \"mechanical\",\n    quantity: 0,\n    minStock: 5,\n    unitPrice: 0,\n    supplier: \"\"\n  });\n\n  const { data: parts = [] } = useQuery<Part[]>({\n    queryKey: [\"/api/parts\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/parts\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/parts\"] });\n      setOpen(false);\n      setFormData({ partNumber: \"\", name: \"\", description: \"\", category: \"mechanical\", quantity: 0, minStock: 5, unitPrice: 0, supplier: \"\" });\n      toast({ title: \"Part added successfully\" });\n    }\n  });\n\n  const getCategoryColor = (category: string) => {\n    switch (category) {\n      case \"hydraulic\": return \"bg-blue-500\";\n      case \"electrical\": return \"bg-yellow-500\";\n      case \"mechanical\": return \"bg-green-500\";\n      case \"consumable\": return \"bg-orange-500\";\n      default: return \"bg-gray-500\";\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold gradient-text\">Parts Inventory</h1>\n          <p className=\"text-muted-foreground\">Manage spare parts and supplies</p>\n        </div>\n        \n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"neon-button\" data-testid=\"button-add-part\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add Part\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"neon-card max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>Add New Part</DialogTitle>\n              <DialogDescription>Add a spare part to inventory</DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <Label htmlFor=\"partNumber\">Part Number</Label>\n                <Input\n                  id=\"partNumber\"\n                  value={formData.partNumber}\n                  onChange={(e) => setFormData({ ...formData, partNumber: e.target.value })}\n                  placeholder=\"HYD-001\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-part-number\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"name\">Part Name</Label>\n                <Input\n                  id=\"name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"Hydraulic Pump\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-part-name\"\n                />\n              </div>\n              \n              <div className=\"col-span-2\">\n                <Label htmlFor=\"description\">Description</Label>\n                <Input\n                  id=\"description\"\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  placeholder=\"High-pressure hydraulic pump for forklifts\"\n                  className=\"neon-card mt-2\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"category\">Category</Label>\n                <Select value={formData.category} onValueChange={(value) => setFormData({ ...formData, category: value })}>\n                  <SelectTrigger className=\"neon-card mt-2\" data-testid=\"select-part-category\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"hydraulic\">Hydraulic</SelectItem>\n                    <SelectItem value=\"electrical\">Electrical</SelectItem>\n                    <SelectItem value=\"mechanical\">Mechanical</SelectItem>\n                    <SelectItem value=\"consumable\">Consumable</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"supplier\">Supplier</Label>\n                <Input\n                  id=\"supplier\"\n                  value={formData.supplier}\n                  onChange={(e) => setFormData({ ...formData, supplier: e.target.value })}\n                  placeholder=\"ABC Parts Inc\"\n                  className=\"neon-card mt-2\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"quantity\">Quantity</Label>\n                <Input\n                  id=\"quantity\"\n                  type=\"number\"\n                  value={formData.quantity}\n                  onChange={(e) => setFormData({ ...formData, quantity: parseInt(e.target.value) || 0 })}\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-part-quantity\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"minStock\">Min Stock Level</Label>\n                <Input\n                  id=\"minStock\"\n                  type=\"number\"\n                  value={formData.minStock}\n                  onChange={(e) => setFormData({ ...formData, minStock: parseInt(e.target.value) || 0 })}\n                  className=\"neon-card mt-2\"\n                />\n              </div>\n              \n              <div className=\"col-span-2\">\n                <Label htmlFor=\"unitPrice\">Unit Price ($)</Label>\n                <Input\n                  id=\"unitPrice\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  value={formData.unitPrice}\n                  onChange={(e) => setFormData({ ...formData, unitPrice: parseFloat(e.target.value) || 0 })}\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-part-price\"\n                />\n              </div>\n              \n              <Button\n                onClick={() => createMutation.mutate(formData)}\n                disabled={!formData.partNumber || !formData.name || createMutation.isPending}\n                className=\"col-span-2 neon-button\"\n                data-testid=\"button-save-part\"\n              >\n                Add Part\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {parts.map((part) => (\n          <Card key={part.id} className=\"neon-card neon-contour\" data-testid={`card-part-${part.id}`}>\n            <CardHeader>\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center neon-glow\">\n                    <Package className=\"w-6 h-6 text-primary\" />\n                  </div>\n                  <div>\n                    <CardTitle className=\"text-lg\">{part.name}</CardTitle>\n                    <CardDescription>{part.partNumber}</CardDescription>\n                  </div>\n                </div>\n                <div className={`w-3 h-3 rounded-full ${getCategoryColor(part.category)}`} title={part.category} />\n              </div>\n            </CardHeader>\n            \n            <CardContent className=\"space-y-3\">\n              {part.description && (\n                <p className=\"text-sm text-muted-foreground\">{part.description}</p>\n              )}\n              \n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-muted-foreground\">Stock:</span>\n                <Badge variant={part.quantity < part.minStock ? \"destructive\" : \"default\"} className=\"neon-glow\">\n                  {part.quantity} {part.quantity < part.minStock && <AlertTriangle className=\"w-3 h-3 ml-1\" />}\n                </Badge>\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-muted-foreground\">Min Stock:</span>\n                <span className=\"font-medium\">{part.minStock}</span>\n              </div>\n              \n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-muted-foreground\">Unit Price:</span>\n                <span className=\"font-medium flex items-center\">\n                  <DollarSign className=\"w-3 h-3\" />\n                  {part.unitPrice.toFixed(2)}\n                </span>\n              </div>\n              \n              {part.supplier && (\n                <div className=\"text-sm\">\n                  <span className=\"text-muted-foreground\">Supplier: </span>\n                  <span>{part.supplier}</span>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {parts.length === 0 && (\n        <Card className=\"neon-card\">\n          <CardContent className=\"py-12 text-center\">\n            <Package className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No parts in inventory</h3>\n            <p className=\"text-muted-foreground mb-4\">Add your first spare part to get started</p>\n            <Button onClick={() => setOpen(true)} className=\"neon-button\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add First Part\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":10583},"client/src/pages/admin-users.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { UserPlus, Shield, User as UserIcon } from \"lucide-react\";\nimport type { User } from \"@/types/api\";\n\nexport default function AdminUsers() {\n  const { toast } = useToast();\n  const [open, setOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    username: \"\",\n    password: \"\",\n    isAdmin: false\n  });\n\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await apiRequest(\"POST\", \"/api/users\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      setOpen(false);\n      setFormData({ username: \"\", password: \"\", isAdmin: false });\n      toast({ title: \"User created successfully\" });\n    },\n    onError: () => {\n      toast({ \n        variant: \"destructive\",\n        title: \"Failed to create user\",\n        description: \"Username may already exist\"\n      });\n    }\n  });\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold gradient-text\">User Management</h1>\n          <p className=\"text-muted-foreground\">Create and manage user accounts (Admin Only)</p>\n        </div>\n        \n        <Dialog open={open} onOpenChange={setOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"neon-button\" data-testid=\"button-add-user\">\n              <UserPlus className=\"w-4 h-4 mr-2\" />\n              Create User\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"neon-card\">\n            <DialogHeader>\n              <DialogTitle>Create New User</DialogTitle>\n              <DialogDescription>Add a new user account to the system</DialogDescription>\n            </DialogHeader>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"username\">Username</Label>\n                <Input\n                  id=\"username\"\n                  value={formData.username}\n                  onChange={(e) => setFormData({ ...formData, username: e.target.value })}\n                  placeholder=\"john.doe\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-username\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"password\">Password</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  value={formData.password}\n                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}\n                  placeholder=\"••••••••\"\n                  className=\"neon-card mt-2\"\n                  data-testid=\"input-password\"\n                />\n              </div>\n              \n              <div className=\"flex items-center justify-between p-4 rounded-lg border border-border\">\n                <div className=\"flex items-center gap-3\">\n                  <Shield className=\"w-5 h-5 text-primary\" />\n                  <div>\n                    <Label htmlFor=\"isAdmin\" className=\"cursor-pointer\">Administrator</Label>\n                    <p className=\"text-xs text-muted-foreground\">Grant admin privileges</p>\n                  </div>\n                </div>\n                <Switch\n                  id=\"isAdmin\"\n                  checked={formData.isAdmin}\n                  onCheckedChange={(checked) => setFormData({ ...formData, isAdmin: checked })}\n                  data-testid=\"switch-admin\"\n                />\n              </div>\n              \n              <Button\n                onClick={() => createMutation.mutate(formData)}\n                disabled={!formData.username || !formData.password || createMutation.isPending}\n                className=\"w-full neon-button\"\n                data-testid=\"button-save-user\"\n              >\n                Create User Account\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {users.map((user) => (\n          <Card key={user.id} className=\"neon-card neon-contour\" data-testid={`card-user-${user.id}`}>\n            <CardHeader>\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center neon-glow\">\n                    {user.isAdmin ? (\n                      <Shield className=\"w-6 h-6 text-primary\" />\n                    ) : (\n                      <UserIcon className=\"w-6 h-6 text-primary\" />\n                    )}\n                  </div>\n                  <div>\n                    <CardTitle className=\"text-lg\">{user.username}</CardTitle>\n                    <CardDescription>User Account</CardDescription>\n                  </div>\n                </div>\n                <Badge variant={user.isAdmin ? \"default\" : \"secondary\"} className=\"neon-glow\">\n                  {user.isAdmin ? \"Admin\" : \"User\"}\n                </Badge>\n              </div>\n            </CardHeader>\n            \n            <CardContent>\n              <div className=\"text-sm text-muted-foreground\">\n                {user.isAdmin ? \"Full system access\" : \"Standard access\"}\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {users.length === 0 && (\n        <Card className=\"neon-card\">\n          <CardContent className=\"py-12 text-center\">\n            <User className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"text-lg font-semibold mb-2\">No users found</h3>\n            <p className=\"text-muted-foreground mb-4\">Create your first user account</p>\n            <Button onClick={() => setOpen(true)} className=\"neon-button\">\n              <UserPlus className=\"w-4 h-4 mr-2\" />\n              Create First User\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":6818},"client/src/pages/Sales.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { StatCard } from \"@/components/StatCard\";\n\nexport default function Sales() {\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Sales</h1>\n          <p className=\"text-muted-foreground mt-1\">Manage equipment sales and quotes</p>\n        </div>\n        <Button data-testid=\"button-new-quote\">\n          <i className=\"fas fa-plus mr-2\"></i>\n          New Quote\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <StatCard\n          title=\"Monthly Sales\"\n          value=\"$185,420\"\n          icon=\"fa-chart-line\"\n          change=\"+18.2% from last month\"\n          changeType=\"positive\"\n        />\n        <StatCard\n          title=\"Active Quotes\"\n          value=\"12\"\n          icon=\"fa-file-invoice-dollar\"\n        />\n        <StatCard\n          title=\"This Week\"\n          value=\"$42,850\"\n          icon=\"fa-calendar-week\"\n          change=\"+8.5%\"\n          changeType=\"positive\"\n        />\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Recent Sales</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            {[1, 2, 3].map((i) => (\n              <div key={i} className=\"flex items-center justify-between p-4 bg-card border border-card-border rounded-lg hover-elevate\">\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"h-12 w-12 rounded-lg bg-primary/10 flex items-center justify-center\">\n                    <i className=\"fas fa-forklift text-primary\"></i>\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold\">Electric Forklift EL-5000</h4>\n                    <p className=\"text-sm text-muted-foreground\">Customer: Montreal Distribution Inc.</p>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <p className=\"font-semibold\">$45,000</p>\n                  <Badge variant=\"secondary\">Completed</Badge>\n                </div>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":2415},"client/src/pages/Rental.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { StatCard } from \"@/components/StatCard\";\nimport { \n  Search, Truck, Warehouse, Package, Plus, Edit2, MapPin, AlertCircle,\n  Zap, Building2, PackageOpen, Wrench\n} from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger \n} from \"@/components/ui/dialog\";\nimport { \n  Form, FormControl, FormField, FormItem, FormLabel, FormMessage\n} from \"@/components/ui/form\";\nimport { \n  Select, SelectContent, SelectItem, SelectTrigger, SelectValue\n} from \"@/components/ui/select\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertMachineSchema } from \"@shared/schema\";\nimport type { Machine } from \"@shared/schema\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { z } from \"zod\";\n\ntype MachineFormData = z.infer<typeof insertMachineSchema>;\n\nexport default function Rental() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [addDialogOpen, setAddDialogOpen] = useState(false);\n  const [rentDialogOpen, setRentDialogOpen] = useState(false);\n  const [selectedMachine, setSelectedMachine] = useState<Machine | null>(null);\n  const [rentalLocation, setRentalLocation] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: machines = [], isLoading } = useQuery<Machine[]>({\n    queryKey: [\"/api/machines\"],\n  });\n\n  // Filter for available machines (in-stock or active)\n  const availableMachines = machines.filter(m => \n    (m.status === \"in-stock\" || m.status === \"active\") &&\n    (m.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n     m.model.toLowerCase().includes(searchQuery.toLowerCase()) ||\n     m.serialNumber.toLowerCase().includes(searchQuery.toLowerCase()))\n  );\n\n  const activeRentals = machines.filter(m => m.status === \"active\").length;\n  const totalAvailable = machines.filter(m => m.status === \"in-stock\").length;\n  const inMaintenance = machines.filter(m => m.status === \"maintenance\").length;\n\n  // Create machine form\n  const form = useForm<MachineFormData>({\n    resolver: zodResolver(insertMachineSchema),\n    defaultValues: {\n      name: \"\",\n      model: \"\",\n      serialNumber: \"\",\n      category: \"Lift\",\n      status: \"in-stock\",\n      location: \"\",\n    },\n  });\n\n  const createMachineMutation = useMutation({\n    mutationFn: async (data: MachineFormData) => {\n      const res = await apiRequest(\"POST\", \"/api/machines\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/machines\"] });\n      toast({ title: \"Success\", description: \"Machine added to inventory\" });\n      setAddDialogOpen(false);\n      form.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const rentMachineMutation = useMutation({\n    mutationFn: async (machineId: string) => {\n      if (!rentalLocation) throw new Error(\"Location is required\");\n      const res = await apiRequest(\"PATCH\", `/api/machines/${machineId}`, {\n        status: \"active\",\n        location: rentalLocation,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/machines\"] });\n      toast({ title: \"Success\", description: \"Machine rented successfully\" });\n      setRentDialogOpen(false);\n      setRentalLocation(\"\");\n      setSelectedMachine(null);\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const returnMachineMutation = useMutation({\n    mutationFn: async (machineId: string) => {\n      const res = await apiRequest(\"PATCH\", `/api/machines/${machineId}`, {\n        status: \"in-stock\",\n        location: null,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/machines\"] });\n      toast({ title: \"Success\", description: \"Machine returned to inventory\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const getCategoryIcon = (category: string) => {\n    switch (category) {\n      case \"Lift\": return Zap;\n      case \"Hoist\": return Truck;\n      case \"Platform\": return Building2;\n      case \"Stairs\": return Wrench;\n      case \"Ramp\": return PackageOpen;\n      default: return Package;\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"active\":\n        return \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\";\n      case \"in-stock\":\n        return \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\";\n      case \"maintenance\":\n        return \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\";\n      case \"retired\":\n        return \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\";\n      default:\n        return \"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200\";\n    }\n  };\n\n  const handleAddMachine = (data: MachineFormData) => {\n    createMachineMutation.mutate(data);\n  };\n\n  const handleRentMachine = (machine: Machine) => {\n    setSelectedMachine(machine);\n    setRentDialogOpen(true);\n  };\n\n  const confirmRent = () => {\n    if (selectedMachine) {\n      rentMachineMutation.mutate(selectedMachine.id);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Equipment & Rentals</h1>\n          <p className=\"text-muted-foreground mt-1\">Manage equipment inventory and rentals</p>\n        </div>\n        <Dialog open={addDialogOpen} onOpenChange={setAddDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-machine\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add Machine\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-md\">\n            <DialogHeader>\n              <DialogTitle>Add New Machine to Inventory</DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(handleAddMachine)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Machine Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"e.g., Scissor Lift 4000\" {...field} data-testid=\"input-machine-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"model\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Model</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"e.g., SL-4000X\" {...field} data-testid=\"input-machine-model\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"serialNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Serial Number</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Unique serial number\" {...field} data-testid=\"input-serial-number\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"category\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Category</FormLabel>\n                      <Select value={field.value} onValueChange={field.onChange}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-category\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Lift\">Lift</SelectItem>\n                          <SelectItem value=\"Hoist\">Hoist</SelectItem>\n                          <SelectItem value=\"Platform\">Platform</SelectItem>\n                          <SelectItem value=\"Stairs\">Stairs</SelectItem>\n                          <SelectItem value=\"Ramp\">Ramp</SelectItem>\n                          <SelectItem value=\"Other\">Other</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full\" \n                  disabled={createMachineMutation.isPending}\n                  data-testid=\"button-create-machine\"\n                >\n                  {createMachineMutation.isPending ? \"Adding...\" : \"Add Machine\"}\n                </Button>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"Active Rentals\"\n          value={String(activeRentals)}\n          icon={Truck}\n          trend={`${activeRentals} units deployed`}\n          trendUp={activeRentals > 0}\n        />\n        <StatCard\n          title=\"Available\"\n          value={String(totalAvailable)}\n          icon={Warehouse}\n          trend=\"Ready to rent\"\n        />\n        <StatCard\n          title=\"In Maintenance\"\n          value={String(inMaintenance)}\n          icon={Wrench}\n          trend=\"Being serviced\"\n        />\n        <StatCard\n          title=\"Total Fleet\"\n          value={String(machines.length)}\n          icon={Package}\n          trend={`${new Set(machines.map(m => m.category)).size} types`}\n        />\n      </div>\n\n      {/* Search */}\n      <div className=\"flex gap-3\">\n        <div className=\"flex-1 relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search machines, models, serial numbers...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-equipment\"\n          />\n        </div>\n      </div>\n\n      {/* Equipment List */}\n      <div>\n        <h2 className=\"text-xl font-semibold mb-4\">Available Equipment</h2>\n        \n        {isLoading ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground\">Loading equipment...</p>\n          </div>\n        ) : availableMachines.length === 0 ? (\n          <div className=\"text-center py-12 bg-muted/30 rounded-lg border border-dashed\">\n            <Warehouse className=\"w-12 h-12 text-muted-foreground mx-auto mb-3\" />\n            <p className=\"text-muted-foreground\">No available equipment found</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {availableMachines.map((machine) => {\n              const IconComponent = getCategoryIcon(machine.category);\n              return (\n                <Card \n                  key={machine.id} \n                  className=\"hover-elevate transition-all overflow-hidden\" \n                  data-testid={`card-equipment-${machine.id}`}\n                >\n                  <CardHeader className=\"pb-3 bg-gradient-to-r from-cyan-500/5 to-purple-500/5\">\n                    <div className=\"flex items-start justify-between gap-3\">\n                      <div className=\"flex items-start gap-3 flex-1 min-w-0\">\n                        <div className=\"h-10 w-10 rounded-lg bg-primary/20 flex items-center justify-center flex-shrink-0\">\n                          <IconComponent className=\"w-5 h-5 text-primary\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <CardTitle className=\"text-lg truncate\">{machine.name}</CardTitle>\n                          <p className=\"text-sm text-muted-foreground font-mono truncate\">{machine.model}</p>\n                        </div>\n                      </div>\n                      <Badge className={`${getStatusColor(machine.status)} border-0 flex-shrink-0`}>\n                        {machine.status === \"in-stock\" ? \"Available\" : machine.status === \"active\" ? \"Active\" : machine.status}\n                      </Badge>\n                    </div>\n                  </CardHeader>\n\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"space-y-2 text-sm\">\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Serial Number</p>\n                        <p className=\"font-mono break-all\">{machine.serialNumber}</p>\n                      </div>\n                      \n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Category</p>\n                        <p className=\"font-medium\">{machine.category}</p>\n                      </div>\n\n                      {machine.location && (\n                        <div className=\"flex items-start gap-2 bg-muted/50 p-2 rounded\">\n                          <MapPin className=\"w-4 h-4 text-muted-foreground flex-shrink-0 mt-0.5\" />\n                          <div>\n                            <p className=\"text-xs text-muted-foreground\">Current Location</p>\n                            <p className=\"font-medium\">{machine.location}</p>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n\n                    <div className=\"flex gap-2 pt-2\">\n                      {machine.status === \"in-stock\" ? (\n                        <Button \n                          className=\"w-full\" \n                          variant=\"default\"\n                          onClick={() => handleRentMachine(machine)}\n                          data-testid={`button-rent-${machine.id}`}\n                        >\n                          <Truck className=\"w-4 h-4 mr-2\" />\n                          Rent Now\n                        </Button>\n                      ) : machine.status === \"active\" ? (\n                        <Button \n                          className=\"w-full\" \n                          variant=\"outline\"\n                          onClick={() => returnMachineMutation.mutate(machine.id)}\n                          disabled={returnMachineMutation.isPending}\n                          data-testid={`button-return-${machine.id}`}\n                        >\n                          <PackageOpen className=\"w-4 h-4 mr-2\" />\n                          Return to Inventory\n                        </Button>\n                      ) : null}\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Rent Machine Dialog */}\n      <Dialog open={rentDialogOpen} onOpenChange={setRentDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Rent Machine: {selectedMachine?.name}</DialogTitle>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <p className=\"text-sm text-muted-foreground mb-2\">Serial Number</p>\n              <p className=\"font-mono\">{selectedMachine?.serialNumber}</p>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Rental Location</label>\n              <Input\n                placeholder=\"Enter customer location or site address\"\n                value={rentalLocation}\n                onChange={(e) => setRentalLocation(e.target.value)}\n                data-testid=\"input-rental-location\"\n              />\n            </div>\n\n            <div className=\"flex gap-3\">\n              <Button \n                variant=\"outline\" \n                className=\"flex-1\"\n                onClick={() => setRentDialogOpen(false)}\n                data-testid=\"button-cancel-rent\"\n              >\n                Cancel\n              </Button>\n              <Button \n                className=\"flex-1\"\n                onClick={confirmRent}\n                disabled={!rentalLocation || rentMachineMutation.isPending}\n                data-testid=\"button-confirm-rent\"\n              >\n                {rentMachineMutation.isPending ? \"Processing...\" : \"Confirm Rental\"}\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":17465},"client/src/pages/Messages.tsx":{"content":"import { UnifiedChat } from \"@/components/UnifiedChat\";\n\nexport default function Messages() {\n  return (\n    <div className=\"h-full flex flex-col gap-4\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">Messages</h1>\n        <p className=\"text-muted-foreground mt-1\">Team communication and collaboration</p>\n      </div>\n\n      <div className=\"flex-1 overflow-hidden bg-card rounded-lg border\">\n        <UnifiedChat />\n      </div>\n    </div>\n  );\n}\n","size_bytes":472},"client/src/pages/WorkOrders.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { WorkOrderCardNew } from \"@/components/WorkOrderCardNew\";\nimport { WorkOrderForm } from \"@/components/WorkOrderForm\";\nimport { DemandForm } from \"@/components/DemandForm\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Plus, PauseCircle } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/lib/auth\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport type { WorkOrder, TimePunch } from \"@shared/schema\";\n\nexport default function WorkOrders() {\n  const [formOpen, setFormOpen] = useState(false);\n  const [demandFormOpen, setDemandFormOpen] = useState(false);\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const { toast } = useToast();\n  const { data: currentUser } = useAuth();\n\n  const { data: workOrders, isLoading } = useQuery<WorkOrder[]>({\n    queryKey: [\"/api/work-orders\"],\n  });\n\n  const { data: currentPunch } = useQuery<TimePunch | null>({\n    queryKey: [\"/api/time-punches/current\"],\n  });\n\n  // Get all active punches for all users - real-time sync\n  const { data: allPunches = [] } = useQuery<TimePunch[]>({\n    queryKey: [\"/api/time-punches\"],\n    refetchInterval: 1000,\n  });\n\n  const punchOutMutation = useMutation({\n    mutationFn: async (workOrderId: string) => {\n      const res = await apiRequest(\"POST\", `/api/work-orders/${workOrderId}/punch-out`);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      toast({ title: \"Punched out\", description: \"Work session ended\" });\n    },\n  });\n\n  const activeWorkOrder = currentPunch?.workOrderId\n    ? workOrders?.find((wo) => wo.id === currentPunch.workOrderId)\n    : null;\n\n  // Get all active work order punches\n  const activeWorkOrderPunches = allPunches.filter(\n    (punch) => punch.punchType === \"work\" && !punch.clockOut && punch.workOrderId\n  );\n\n  // Get work orders for active punches (excluding current user's active punch)\n  const otherActiveWorkOrders = activeWorkOrderPunches\n    .filter((punch) => punch.userId !== currentUser?.id)\n    .map((punch) => workOrders?.find((wo) => wo.id === punch.workOrderId))\n    .filter((wo): wo is WorkOrder => wo !== undefined);\n\n  const isTechnicalAdvisor = currentUser?.role === \"technical_advisor\";\n  const isTechnician = currentUser?.role === \"technician\";\n  const canCreateFullWorkOrder = currentUser?.role === \"admin\" || currentUser?.role === \"technical_advisor\";\n\n  const filteredWorkOrders = workOrders?.filter((wo) => {\n    // Technical advisors only see unassigned NEW demands\n    if (isTechnicalAdvisor) {\n      if (wo.assignedTo || wo.status !== \"new\") {\n        return false;\n      }\n    }\n    \n    const matchesStatus = statusFilter === \"all\" || wo.status === statusFilter;\n    const matchesSearch =\n      searchQuery === \"\" ||\n      wo.customer.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      wo.asset.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      wo.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      wo.workOrderNumber.toLowerCase().includes(searchQuery.toLowerCase());\n    return matchesStatus && matchesSearch;\n  }) || [];\n\n  return (\n    <div className=\"space-y-8 py-2\">\n      <div className=\"px-2 md:px-4 space-y-3\">\n        <h1 className=\"text-5xl font-bold gradient-text\">\n          {isTechnicalAdvisor ? \"Service Demands\" : \"Work Orders\"}\n        </h1>\n        <p className=\"text-lg text-muted-foreground\">\n          {isTechnicalAdvisor ? \"New service requests awaiting assignment\" : \"Manage and track all service requests\"}\n        </p>\n      </div>\n      <div className=\"flex items-center justify-between px-2 md:px-4\">\n        {canCreateFullWorkOrder ? (\n          <Button onClick={() => setFormOpen(true)} data-testid=\"button-create-workorder\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            New Work Order\n          </Button>\n        ) : isTechnician ? (\n          <Button onClick={() => setDemandFormOpen(true)} data-testid=\"button-request-workorder\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Request Work Order\n          </Button>\n        ) : null}\n      </div>\n\n      <div className=\"flex flex-wrap items-center gap-4\">\n        <Input\n          placeholder=\"Search by work order number, customer, asset...\"\n          className=\"max-w-md\"\n          value={searchQuery}\n          onChange={(e) => setSearchQuery(e.target.value)}\n          data-testid=\"input-search-workorders\"\n        />\n        <Select value={statusFilter} onValueChange={setStatusFilter}>\n          <SelectTrigger className=\"w-40\" data-testid=\"select-status-filter\">\n            <SelectValue placeholder=\"Status\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Status</SelectItem>\n            <SelectItem value=\"new\">New</SelectItem>\n            <SelectItem value=\"assigned\">Assigned</SelectItem>\n            <SelectItem value=\"in-progress\">In Progress</SelectItem>\n            <SelectItem value=\"completed\">Completed</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      {activeWorkOrder && (\n        <div className=\"space-y-2\">\n          <h2 className=\"text-xl font-semibold text-foreground\">Currently Working On</h2>\n          <Card className=\"border-primary/50 bg-primary/5\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"text-lg\" data-testid=\"text-active-wo-number\">\n                    {activeWorkOrder.workOrderNumber}\n                  </CardTitle>\n                  <p className=\"text-sm text-muted-foreground mt-1\">{activeWorkOrder.title}</p>\n                </div>\n                <Badge variant=\"default\" className=\"bg-green-500\">\n                  Active\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"flex gap-2\">\n                <Button\n                  onClick={() => punchOutMutation.mutate(activeWorkOrder.id)}\n                  disabled={punchOutMutation.isPending}\n                  variant=\"outline\"\n                  className=\"flex-1\"\n                  data-testid=\"button-punch-out-active\"\n                >\n                  <PauseCircle className=\"mr-2 h-4 w-4\" />\n                  {punchOutMutation.isPending ? \"Punching out...\" : \"Punch Out\"}\n                </Button>\n                <Button\n                  onClick={() => (window.location.href = `/work-orders/${activeWorkOrder.workOrderNumber}`)}\n                  className=\"flex-1\"\n                  data-testid=\"button-view-active\"\n                >\n                  View Details\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Active Work Orders - All Technicians */}\n      {otherActiveWorkOrders.length > 0 && (\n        <div className=\"space-y-2\">\n          <h2 className=\"text-xl font-semibold text-foreground\">\n            Active Work Orders - Other Technicians\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-2 md:px-4\">\n            {otherActiveWorkOrders.map((wo) => (\n              <WorkOrderCardNew\n                key={wo.id}\n                workOrder={wo}\n                showPunchButtons={false}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      <div className=\"space-y-2\">\n        <h2 className=\"text-xl font-semibold text-foreground\">All Work Orders</h2>\n        {isLoading ? (\n          <div className=\"text-center py-12 text-muted-foreground\">Loading work orders...</div>\n        ) : filteredWorkOrders.length === 0 ? (\n          <div className=\"text-center py-12 text-muted-foreground\">\n            No work orders found\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-2 md:px-4\">\n            {filteredWorkOrders.map((wo) => {\n              const isActive = wo.status !== \"completed\" && wo.status !== \"closedForReview\";\n              const isTechnician = currentUser?.role === \"technician\";\n              const isAdmin = currentUser?.role === \"admin\";\n              const canPunch = (isTechnician || isAdmin) && isActive;\n              \n              return (\n                <WorkOrderCardNew \n                  key={wo.id} \n                  workOrder={wo} \n                  showPunchButtons={canPunch}\n                />\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      <WorkOrderForm open={formOpen} onOpenChange={setFormOpen} />\n      <DemandForm open={demandFormOpen} onOpenChange={setDemandFormOpen} />\n    </div>\n  );\n}\n","size_bytes":9260},"client/src/pages/Warranty.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\nexport default function Warranty() {\n  const claims = [\n    { id: 'WC-124', equipment: 'Forklift EL-5000', issue: 'Hydraulic pump failure', status: 'pending', submittedDate: 'Dec 10, 2024' },\n    { id: 'WC-125', equipment: 'Scissor Lift SC-3200', issue: 'Battery malfunction', status: 'approved', submittedDate: 'Dec 12, 2024' },\n    { id: 'WC-126', equipment: 'Pallet Jack PJ-2000', issue: 'Wheel bearing damage', status: 'under-review', submittedDate: 'Dec 15, 2024' },\n  ];\n\n  const statusColors = {\n    'pending': 'secondary',\n    'approved': 'default',\n    'under-review': 'outline',\n    'rejected': 'destructive',\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Warranty Claims</h1>\n          <p className=\"text-muted-foreground mt-1\">Submit and track warranty claims</p>\n        </div>\n        <Button data-testid=\"button-new-claim\">\n          <i className=\"fas fa-plus mr-2\"></i>\n          New Claim\n        </Button>\n      </div>\n\n      <div className=\"flex gap-4\">\n        <Input\n          placeholder=\"Search claims...\"\n          className=\"max-w-xs\"\n          data-testid=\"input-search-claims\"\n        />\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Warranty Claims</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Claim #</TableHead>\n                <TableHead>Equipment</TableHead>\n                <TableHead>Issue</TableHead>\n                <TableHead>Submitted</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {claims.map((claim) => (\n                <TableRow key={claim.id} data-testid={`row-claim-${claim.id}`}>\n                  <TableCell className=\"font-mono font-medium\">{claim.id}</TableCell>\n                  <TableCell>{claim.equipment}</TableCell>\n                  <TableCell>{claim.issue}</TableCell>\n                  <TableCell>{claim.submittedDate}</TableCell>\n                  <TableCell>\n                    <Badge variant={statusColors[claim.status as keyof typeof statusColors] as any}>\n                      {claim.status.replace('-', ' ').toUpperCase()}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <div className=\"flex gap-2 justify-end\">\n                      <Button size=\"sm\" variant=\"outline\" data-testid={`button-view-claim-${claim.id}`}>\n                        <i className=\"fas fa-eye\"></i>\n                      </Button>\n                      <Button size=\"sm\" variant=\"outline\" data-testid={`button-upload-${claim.id}`}>\n                        <i className=\"fas fa-paperclip\"></i>\n                      </Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":3530},"client/src/pages/Accounting.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { StatCard } from \"@/components/StatCard\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\nexport default function Accounting() {\n  const pendingInvoices = [\n    { id: 'INV-5824', customer: 'Montreal Distribution', amount: 12450.00, dueDate: 'Dec 20, 2024', status: 'pending' },\n    { id: 'INV-5825', customer: 'Laval Logistics', amount: 8750.00, dueDate: 'Dec 22, 2024', status: 'overdue' },\n    { id: 'INV-5826', customer: 'Quebec Warehouse', amount: 5200.00, dueDate: 'Dec 25, 2024', status: 'pending' },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Accounting</h1>\n          <p className=\"text-muted-foreground mt-1\">Financial management and billing</p>\n        </div>\n        <Button data-testid=\"button-new-invoice\">\n          <i className=\"fas fa-plus mr-2\"></i>\n          New Invoice\n        </Button>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"Outstanding\"\n          value=\"$26,400\"\n          icon=\"fa-clock\"\n        />\n        <StatCard\n          title=\"Paid This Month\"\n          value=\"$142,850\"\n          icon=\"fa-check-circle\"\n          change=\"+15.2%\"\n          changeType=\"positive\"\n        />\n        <StatCard\n          title=\"Pending Invoices\"\n          value=\"8\"\n          icon=\"fa-file-invoice\"\n        />\n        <StatCard\n          title=\"Overdue\"\n          value=\"$8,750\"\n          icon=\"fa-exclamation-circle\"\n          changeType=\"negative\"\n        />\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Pending Invoices</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead>Invoice #</TableHead>\n                <TableHead>Customer</TableHead>\n                <TableHead className=\"text-right\">Amount</TableHead>\n                <TableHead>Due Date</TableHead>\n                <TableHead>Status</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {pendingInvoices.map((invoice) => (\n                <TableRow key={invoice.id} data-testid={`row-invoice-${invoice.id}`}>\n                  <TableCell className=\"font-mono font-medium\">{invoice.id}</TableCell>\n                  <TableCell>{invoice.customer}</TableCell>\n                  <TableCell className=\"text-right tabular-nums font-medium\">\n                    ${invoice.amount.toFixed(2)}\n                  </TableCell>\n                  <TableCell>{invoice.dueDate}</TableCell>\n                  <TableCell>\n                    <Badge variant={invoice.status === 'overdue' ? 'destructive' : 'secondary'}>\n                      {invoice.status}\n                    </Badge>\n                  </TableCell>\n                  <TableCell className=\"text-right\">\n                    <div className=\"flex gap-2 justify-end\">\n                      <Button size=\"sm\" variant=\"outline\" data-testid={`button-view-invoice-${invoice.id}`}>\n                        <i className=\"fas fa-eye\"></i>\n                      </Button>\n                      <Button size=\"sm\" data-testid={`button-send-invoice-${invoice.id}`}>\n                        <i className=\"fas fa-paper-plane\"></i>\n                      </Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":3880},"client/src/pages/Dashboard.tsx":{"content":"import { useAuth } from \"@/lib/auth\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { TimeTrackingPanel } from \"@/components/TimeTrackingPanel\";\nimport { WeeklyHoursProgress } from \"@/components/WeeklyHoursProgress\";\nimport { WorkOrderCardNew } from \"@/components/WorkOrderCardNew\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { TrendingUp, Clock, CheckCircle2 } from \"lucide-react\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { MoodSelector } from \"@/components/MoodSelector\";\nimport type { WorkOrder, TimePunch } from \"@shared/schema\";\n\ninterface UserStats {\n  assignedWorkOrdersCount: number;\n  completedWorkOrdersCount: number;\n  avgEfficiency: number | null;\n  hoursToday: number;\n  hoursThisWeek: number;\n  kmToday: number;\n  kmThisWeek: number;\n  kmOverall: number;\n  allCompletedEfficiency: number | null;\n  overtimeHours?: number;\n}\n\nexport default function Dashboard() {\n  const { data: user } = useAuth();\n  const { theme } = useTheme();\n\n  const { data: assignedWorkOrders, isLoading } = useQuery<WorkOrder[]>({\n    queryKey: [\"/api/work-orders/assigned\"],\n  });\n\n  const { data: stats } = useQuery<UserStats>({\n    queryKey: [\"/api/users/stats\"],\n    refetchInterval: 5000, // Sync efficiency every 5 seconds\n  });\n\n  const { data: activePunch } = useQuery<TimePunch | null>({\n    queryKey: [\"/api/active-punch\"],\n    enabled: !!user,\n    refetchInterval: 5000,\n    queryFn: async () => {\n      const res = await fetch(\"/api/active-punch\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch active punch\");\n      return res.json();\n    },\n  });\n\n  // Get the active work order if user is punched in\n  const activeWorkOrderId = activePunch?.workOrderId;\n  const activeWorkOrder = assignedWorkOrders?.find(wo => wo.id === activeWorkOrderId);\n\n  const efficiencyColor = (eff: number | null) => {\n    if (!eff) return \"text-muted-foreground\";\n    // Higher efficiency = better (>100% means under budget)\n    if (eff >= 100) return \"text-green-500\"; // On budget or better\n    if (eff >= 80) return \"text-yellow-500\"; // Slightly over budget\n    return \"text-red-500\"; // Significantly over budget\n  };\n\n  return (\n    <div className=\"space-y-8 py-2\">\n      {/* Banner Image */}\n      {user?.bannerImage && (\n        <div className=\"fade-in-up -mx-4 md:mx-0 md:rounded-xl overflow-hidden max-h-64 shadow-lg\">\n          <img \n            src={user.bannerImage} \n            alt=\"Profile banner\" \n            className=\"w-full h-64 object-cover\"\n            data-testid=\"banner-image\"\n          />\n        </div>\n      )}\n\n      <div className=\"w-full space-y-8 px-2 md:px-4\">\n        {/* Welcome Header */}\n        <div className=\"fade-in-up space-y-3\">\n          <h1 className={`\n            font-bold tracking-tight\n            ${theme === 'dark' ? 'text-4xl text-primary' : ''}\n            ${theme === 'light' ? 'text-5xl gradient-text' : ''}\n            ${theme === 'unicorn' ? 'text-5xl gradient-text' : ''}\n          `} data-testid=\"dashboard-title\">\n            {theme === 'dark' ? 'Dashboard' : 'Welcome Back'}\n          </h1>\n          <p className={`\n            text-lg\n            ${theme === 'dark' ? 'text-muted-foreground' : 'text-muted-foreground'}\n          `}>\n            {user?.username || 'Employee'}, here's your work overview\n          </p>\n        </div>\n\n        {/* Mood Selector */}\n        <div className=\"fade-in-up\">\n          <Card>\n            <CardContent className=\"pt-6\">\n              <MoodSelector currentMood={user?.mood} />\n            </CardContent>\n          </Card>\n        </div>\n\n      {/* Time Tracking Panel - Main Feature */}\n      <div className=\"fade-in-up\">\n        <TimeTrackingPanel />\n      </div>\n\n      {/* Active Work Order - When punched in */}\n      {activeWorkOrder && activePunch?.punchType === \"work\" && (\n        <div className=\"fade-in-up\">\n          <h2 className=\"font-bold text-2xl mb-4 text-foreground\">\n            Currently Working On\n          </h2>\n          <WorkOrderCardNew workOrder={activeWorkOrder} showPunchButtons={true} />\n        </div>\n      )}\n\n      {/* Weekly Hours Progress & Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 fade-in-up\">\n        {/* Weekly Progress Chart */}\n        <div className=\"md:col-span-1\">\n          <WeeklyHoursProgress weeklyHours={stats?.hoursThisWeek || 0} isLoading={isLoading} />\n        </div>\n\n        {/* Overtime Stats - Shows when over 40h */}\n        {stats && stats.hoursThisWeek >= 40 && (\n          <Card className=\"md:col-span-1\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-sm font-medium text-purple-600 dark:text-purple-400\">\n                Overtime Hours\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                <div className=\"flex items-baseline gap-2\">\n                  <span className=\"text-3xl font-bold text-purple-600 dark:text-purple-400\">\n                    {(stats.hoursThisWeek - 40).toFixed(1)}\n                  </span>\n                  <span className=\"text-sm text-muted-foreground\">hours</span>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Beyond 40-hour target\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Kilometers Stats */}\n        <Card className=\"md:col-span-1\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium text-blue-600 dark:text-blue-400\">\n              Kilometers\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              <div>\n                <p className=\"text-xs text-muted-foreground\">Today</p>\n                <p className=\"text-2xl font-bold\" data-testid=\"km-today\">{(stats?.kmToday || 0).toFixed(1)}km</p>\n              </div>\n              <div>\n                <p className=\"text-xs text-muted-foreground\">This Week</p>\n                <p className=\"text-lg font-semibold\" data-testid=\"km-week\">{(stats?.kmThisWeek || 0).toFixed(1)}km</p>\n              </div>\n              <div>\n                <p className=\"text-xs text-muted-foreground\">Overall</p>\n                <p className=\"text-sm\" data-testid=\"km-overall\">{(stats?.kmOverall || 0).toFixed(1)}km</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Statistics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 fade-in-up\">\n        {/* Hours Today/Week */}\n        <Card className=\"md:col-span-1\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <Clock className=\"h-4 w-4\" />\n              Daily Hours\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs text-muted-foreground\">Today:</span>\n                <span className=\"text-lg font-bold\" data-testid=\"hours-today\">\n                  {stats?.hoursToday?.toFixed(1) || 0}h\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs text-muted-foreground\">Week:</span>\n                <span className=\"text-lg font-bold\" data-testid=\"hours-week\">\n                  {stats?.hoursThisWeek?.toFixed(1) || 0}h\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Work Orders Count */}\n        <Card className=\"md:col-span-1\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <CheckCircle2 className=\"h-4 w-4\" />\n              Work Orders\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs text-muted-foreground\">Assigned:</span>\n                <span className=\"text-lg font-bold\" data-testid=\"assigned-count\">\n                  {stats?.assignedWorkOrdersCount || 0}\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-xs text-muted-foreground\">Completed:</span>\n                <span className=\"text-lg font-bold\" data-testid=\"completed-count\">\n                  {stats?.completedWorkOrdersCount || 0}\n                </span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Efficiency */}\n        <Card className=\"md:col-span-1\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n              <TrendingUp className=\"h-4 w-4\" />\n              {user?.role === \"technical_advisor\" ? \"Overall Efficiency\" : \"My Efficiency\"}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {user?.role === \"technical_advisor\" && stats && stats.allCompletedEfficiency !== null ? (\n              <div className=\"space-y-3\">\n                <div>\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <span className=\"text-xs text-muted-foreground\">All Completed:</span>\n                    <span className={`text-lg font-bold ${efficiencyColor(stats.allCompletedEfficiency)}`} data-testid=\"all-efficiency\">\n                      {stats.allCompletedEfficiency.toFixed(1)}%\n                    </span>\n                  </div>\n                  <div className=\"relative\">\n                    <Progress \n                      value={stats.allCompletedEfficiency} \n                      className=\"h-2\"\n                      data-testid=\"all-efficiency-bar\"\n                    />\n                    {stats.allCompletedEfficiency > 100 && (\n                      <span className=\"text-[10px] text-green-600 font-semibold absolute -top-4 right-0\">\n                        Over Target!\n                      </span>\n                    )}\n                  </div>\n                </div>\n                {stats.avgEfficiency !== null && (\n                  <div>\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"text-xs text-muted-foreground\">My Average:</span>\n                      <span className={`text-lg font-bold ${efficiencyColor(stats.avgEfficiency)}`} data-testid=\"my-efficiency\">\n                        {stats.avgEfficiency.toFixed(1)}%\n                      </span>\n                    </div>\n                    <div className=\"relative\">\n                      <Progress \n                        value={stats.avgEfficiency} \n                        className=\"h-2\"\n                        data-testid=\"my-efficiency-bar\"\n                      />\n                      {stats.avgEfficiency > 100 && (\n                        <span className=\"text-[10px] text-green-600 font-semibold absolute -top-4 right-0\">\n                          Over Target!\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n            ) : stats && stats.avgEfficiency !== null ? (\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-xs text-muted-foreground\">Average:</span>\n                  <span className={`text-lg font-bold ${efficiencyColor(stats.avgEfficiency)}`} data-testid=\"my-efficiency\">\n                    {stats.avgEfficiency.toFixed(1)}%\n                  </span>\n                </div>\n                <div className=\"relative\">\n                  <Progress \n                    value={stats.avgEfficiency} \n                    className=\"h-2\"\n                    data-testid=\"my-efficiency-bar\"\n                  />\n                  {stats.avgEfficiency > 100 && (\n                    <span className=\"text-[10px] text-green-600 font-semibold absolute -top-4 right-0\">\n                      Over Target!\n                    </span>\n                  )}\n                </div>\n              </div>\n            ) : (\n              <div className=\"text-sm text-muted-foreground\">No completed work orders yet</div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Active Work Orders */}\n      <div className=\"space-y-4 fade-in-up\">\n        <h2 className={`\n          font-semibold\n          ${theme === 'dark' ? 'text-lg' : 'text-xl'}\n        `}>\n          Active Work Orders\n        </h2>\n        {isLoading ? (\n          <div className=\"text-center py-8 text-muted-foreground\">Loading work orders...</div>\n        ) : !assignedWorkOrders || assignedWorkOrders.filter(wo => wo.status !== \"completed\" && wo.status !== \"closedForReview\").length === 0 ? (\n          <div className=\"text-center py-8 text-muted-foreground\">\n            No active work orders\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {assignedWorkOrders\n              .filter(wo => wo.status !== \"completed\" && wo.status !== \"closedForReview\")\n              .map((wo) => (\n                <WorkOrderCardNew key={wo.id} workOrder={wo} showPunchButtons={true} />\n              ))}\n          </div>\n        )}\n      </div>\n\n      </div>\n    </div>\n  );\n}","size_bytes":13687},"client/src/pages/CreateUser.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertUserSchema, type InsertUser } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Redirect } from \"wouter\";\nimport { UserPlus, Download } from \"lucide-react\";\nimport { useState } from \"react\";\nimport elevexLogoUrl from \"@assets/giphy-downsized-medium_1763918974192.gif\";\n\nexport default function CreateUser() {\n  const { toast } = useToast();\n  const { data: currentUser } = useAuth();\n  const [generatedBadge, setGeneratedBadge] = useState<string | null>(null);\n  const [badgeEmployeeId, setBadgeEmployeeId] = useState<string>(\"\");\n\n  const form = useForm<InsertUser>({\n    resolver: zodResolver(insertUserSchema),\n    defaultValues: {\n      username: \"\",\n      employeeId: \"\",\n      password: \"\",\n      email: \"\",\n      department: \"\",\n      occupation: \"\",\n      headquarters: \"\",\n      role: \"technician\",\n    },\n  });\n\n  const { data: users } = useQuery<Array<{ id: string; username: string; role: string }>>({\n    queryKey: [\"/api/users\"],\n    enabled: currentUser?.role === \"admin\",\n  });\n\n  const generateEmployeeBadge = async (userData: InsertUser): Promise<string> => {\n    return new Promise((resolve, reject) => {\n      const canvas = document.createElement('canvas');\n      canvas.width = 800;\n      canvas.height = 500;\n      const ctx = canvas.getContext('2d')!;\n\n      // Background gradient\n      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);\n      gradient.addColorStop(0, '#06b6d4');\n      gradient.addColorStop(0.5, '#a855f7');\n      gradient.addColorStop(1, '#ec4899');\n      ctx.fillStyle = gradient;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n      // White card background (use fillRect with no rounded corners for Safari compatibility)\n      ctx.fillStyle = 'white';\n      ctx.fillRect(40, 40, 720, 420);\n\n      // Load and draw logo\n      const logo = new Image();\n      logo.crossOrigin = 'anonymous';\n      \n      const drawBadgeContent = () => {\n        try {\n          ctx.drawImage(logo, 60, 60, 120, 120);\n        } catch (e) {\n          // If logo fails to draw, continue without it\n          console.warn('Failed to draw logo on badge:', e);\n        }\n\n        // Company name\n        ctx.fillStyle = '#000';\n        ctx.font = 'bold 36px Inter, sans-serif';\n        ctx.fillText('ELEVEX ERP', 200, 100);\n        \n        ctx.font = '20px Inter, sans-serif';\n        ctx.fillStyle = '#666';\n        ctx.fillText('Employee Identification', 200, 130);\n\n        // Divider line\n        ctx.strokeStyle = '#e5e7eb';\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.moveTo(60, 200);\n        ctx.lineTo(740, 200);\n        ctx.stroke();\n\n        // Employee details\n        ctx.fillStyle = '#000';\n        ctx.font = 'bold 28px Inter, sans-serif';\n        ctx.fillText(userData.username.toUpperCase(), 60, 250);\n\n        ctx.font = '20px Inter, sans-serif';\n        ctx.fillStyle = '#666';\n        ctx.fillText(`ID: ${userData.employeeId}`, 60, 290);\n        ctx.fillText(`Role: ${userData.role.replace('_', ' ').toUpperCase()}`, 60, 320);\n        \n        if (userData.department) {\n          ctx.fillText(`Department: ${userData.department}`, 60, 350);\n        }\n        if (userData.headquarters) {\n          ctx.fillText(`Location: ${userData.headquarters}`, 60, 380);\n        }\n        if (userData.occupation) {\n          ctx.fillText(`Position: ${userData.occupation}`, 60, 410);\n        }\n\n        // QR code placeholder or additional branding\n        ctx.fillStyle = '#f3f4f6';\n        ctx.fillRect(600, 240, 120, 120);\n        ctx.fillStyle = '#9ca3af';\n        ctx.font = '14px Inter, sans-serif';\n        ctx.fillText('QR CODE', 620, 305);\n\n        resolve(canvas.toDataURL('image/png'));\n      };\n      \n      logo.onload = drawBadgeContent;\n      logo.onerror = () => {\n        console.warn('Logo failed to load, generating badge without logo');\n        drawBadgeContent();\n      };\n      \n      logo.src = elevexLogoUrl;\n      \n      // Timeout fallback\n      setTimeout(() => {\n        if (!logo.complete) {\n          drawBadgeContent();\n        }\n      }, 3000);\n    });\n  };\n\n  const createUserMutation = useMutation({\n    mutationFn: async (data: InsertUser) => {\n      return await apiRequest(\"POST\", \"/api/users\", data);\n    },\n    onSuccess: async (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      \n      // Capture employee ID before reset\n      setBadgeEmployeeId(variables.employeeId);\n      \n      // Generate employee badge\n      const badgeDataUrl = await generateEmployeeBadge(variables);\n      setGeneratedBadge(badgeDataUrl);\n      \n      toast({\n        title: \"Success\",\n        description: \"User created successfully with employee badge\",\n      });\n      form.reset();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create user\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertUser) => {\n    setGeneratedBadge(null);\n    createUserMutation.mutate(data);\n  };\n\n  const downloadBadge = () => {\n    if (!generatedBadge) return;\n    const link = document.createElement('a');\n    link.download = `employee-badge-${badgeEmployeeId}.png`;\n    link.href = generatedBadge;\n    link.click();\n  };\n\n  if (currentUser?.role !== \"admin\") {\n    return <Redirect to=\"/\" />;\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold tracking-tight\">User Management</h1>\n        <p className=\"text-muted-foreground\">\n          Create and manage user accounts\n        </p>\n      </div>\n\n      <div className=\"grid gap-6 md:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <UserPlus className=\"h-5 w-5\" />\n              Create New User\n            </CardTitle>\n            <CardDescription>\n              Add a new user to the system\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"employeeId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Employee ID</FormLabel>\n                      <FormControl>\n                        <Input\n                          data-testid=\"input-employee-id\"\n                          placeholder=\"EMP001\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"username\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Username</FormLabel>\n                      <FormControl>\n                        <Input\n                          data-testid=\"input-new-username\"\n                          placeholder=\"Enter username\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email (Optional)</FormLabel>\n                      <FormControl>\n                        <Input\n                          data-testid=\"input-email\"\n                          type=\"email\"\n                          placeholder=\"user@elevex.com\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Password</FormLabel>\n                      <FormControl>\n                        <Input\n                          data-testid=\"input-new-password\"\n                          type=\"password\"\n                          placeholder=\"Enter password\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Role</FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        value={field.value}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-role\">\n                            <SelectValue placeholder=\"Select a role\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"technician\">Technician</SelectItem>\n                          <SelectItem value=\"technical_advisor\">Technical Advisor</SelectItem>\n                          <SelectItem value=\"admin\">Admin</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"department\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Département (Optional)</FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        value={field.value || \"\"}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-department\">\n                            <SelectValue placeholder=\"Select département\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"\">None</SelectItem>\n                          <SelectItem value=\"Road Technician\">Road Technician</SelectItem>\n                          <SelectItem value=\"Garage Technician\">Garage Technician</SelectItem>\n                          <SelectItem value=\"Sales\">Sales</SelectItem>\n                          <SelectItem value=\"Tech Advisor\">Tech Advisor</SelectItem>\n                          <SelectItem value=\"Accounting\">Accounting</SelectItem>\n                          <SelectItem value=\"HR\">HR</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"occupation\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Occupation (Optional)</FormLabel>\n                      <FormControl>\n                        <Input\n                          data-testid=\"input-occupation\"\n                          placeholder=\"e.g., Service Technician, Parts Manager\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"headquarters\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Headquarters (Optional)</FormLabel>\n                      <Select\n                        onValueChange={field.onChange}\n                        value={field.value || \"\"}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-headquarters\">\n                            <SelectValue placeholder=\"Select headquarters\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"\">None</SelectItem>\n                          <SelectItem value=\"Montreal, QC\">Montreal, QC</SelectItem>\n                          <SelectItem value=\"Quebec, QC\">Quebec, QC</SelectItem>\n                          <SelectItem value=\"Saguenay, QC\">Saguenay, QC</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button\n                  data-testid=\"button-create-user\"\n                  type=\"submit\"\n                  className=\"w-full\"\n                  disabled={createUserMutation.isPending}\n                >\n                  {createUserMutation.isPending ? \"Creating...\" : \"Create User\"}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n\n        {generatedBadge ? (\n          <Card>\n            <CardHeader>\n              <CardTitle>Employee Badge Generated</CardTitle>\n              <CardDescription>\n                Download the employee identification badge\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"border rounded-lg overflow-hidden\">\n                <img\n                  src={generatedBadge}\n                  alt=\"Employee Badge\"\n                  className=\"w-full\"\n                  data-testid=\"img-employee-badge\"\n                />\n              </div>\n              <Button\n                onClick={downloadBadge}\n                className=\"w-full\"\n                data-testid=\"button-download-badge\"\n              >\n                <Download className=\"h-4 w-4 mr-2\" />\n                Download Badge\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card>\n            <CardHeader>\n              <CardTitle>Existing Users</CardTitle>\n              <CardDescription>\n                List of all users in the system\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {users ? (\n                <div className=\"space-y-2\">\n                  {users.map((user) => (\n                    <div\n                      key={user.id}\n                      data-testid={`user-item-${user.username}`}\n                      className=\"flex items-center justify-between p-3 rounded-lg border border-border hover-elevate\"\n                    >\n                      <div>\n                        <p className=\"font-medium\">{user.username}</p>\n                        <p className=\"text-sm text-muted-foreground capitalize\">\n                          {user.role}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"text-muted-foreground text-center py-4\">\n                  Loading users...\n                </p>\n              )}\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":16427},"server/seed.ts":{"content":"import { storage } from \"./storage\";\nimport bcrypt from \"bcryptjs\";\nimport { db } from \"./db\";\nimport { users as usersTable } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\n\nexport async function seedAdminUser() {\n  try {\n    const users = [\n      {\n        username: \"seub\",\n        employeeId: \"EMP001\",\n        password: \"1\",\n        role: \"admin\" as const,\n        email: \"\",\n        headquarters: \"Montreal, QC\" as const,\n      },\n      {\n        username: \"nadia\",\n        employeeId: \"EMP002\",\n        password: \"1\",\n        role: \"technical_advisor\" as const,\n        email: \"sebastien.germain1989@gmail.com\",\n        headquarters: \"Montreal, QC\" as const,\n      },\n      {\n        username: \"steve\",\n        employeeId: \"EMP003\",\n        password: \"vex\",\n        role: \"technical_advisor\" as const,\n        email: \"\",\n        headquarters: \"Montreal, QC\" as const,\n      },\n      {\n        username: \"bruno\",\n        employeeId: \"EMP004\",\n        password: \"vex\",\n        role: \"technical_advisor\" as const,\n        email: \"\",\n        headquarters: \"Montreal, QC\" as const,\n      },\n      {\n        username: \"john\",\n        employeeId: \"EMP005\",\n        password: \"vex\",\n        role: \"technical_advisor\" as const,\n        email: \"\",\n        headquarters: \"Montreal, QC\" as const,\n      },\n      {\n        username: \"phil\",\n        employeeId: \"EMP006\",\n        password: \"vex\",\n        role: \"technical_advisor\" as const,\n        email: \"\",\n        headquarters: \"Montreal, QC\" as const,\n      },\n      {\n        username: \"cody\",\n        employeeId: \"EMP007\",\n        password: \"1\",\n        role: \"technician\" as const,\n        email: \"\",\n        department: \"Road Technician\" as const,\n        headquarters: \"Montreal, QC\" as const,\n      },\n    ];\n\n    for (const userData of users) {\n      const existingUser = await storage.getUserByUsername(userData.username);\n      if (!existingUser) {\n        await storage.createUser(userData);\n        console.log(`✓ User '${userData.username}' (${userData.role}) created successfully`);\n      } else {\n        const needsUpdate = \n          existingUser.role !== userData.role ||\n          existingUser.headquarters !== userData.headquarters ||\n          existingUser.department !== userData.department;\n        \n        if (needsUpdate) {\n          await storage.updateUser(existingUser.id, { \n            role: userData.role,\n            headquarters: userData.headquarters,\n            department: userData.department \n          });\n          console.log(`✓ User '${userData.username}' updated: role=${userData.role}, dept=${userData.department}, HQ=${userData.headquarters}`);\n        }\n        \n        const passwordHash = await bcrypt.hash(userData.password, 10);\n        await db\n          .update(usersTable)\n          .set({ passwordHash })\n          .where(eq(usersTable.id, existingUser.id));\n        console.log(`✓ User '${userData.username}' password updated`);\n      }\n    }\n  } catch (error) {\n    console.error(\"Failed to seed users:\", error);\n  }\n}\n","size_bytes":3039},"client/src/pages/Login.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { CheckCircle2 } from \"lucide-react\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport { TripleThemeToggle } from \"@/components/TripleThemeToggle\";\nimport { Globe } from \"lucide-react\";\nimport elevexLogoUrl from \"@assets/IMG_8550_1763924590334.jpeg\";\nimport successVideoUrl from \"@assets/login_success_video.mp4\";\nimport bgDarkUrl from \"@assets/IMG_0730_1763452702046.jpeg\";\nimport bgLightUrl from \"@assets/IMG_0723_1763452702046.jpeg.jpeg\";\nimport bgUnicornUrl from \"@assets/IMG_0733_1763453430197.jpeg\";\n\nconst loginSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\ntype LoginFormData = z.infer<typeof loginSchema>;\n\nexport default function Login() {\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const { theme } = useTheme();\n  const { t, language, setLanguage } = useLanguage();\n  const [showSuccess, setShowSuccess] = useState(false);\n  const videoRef = useRef<HTMLVideoElement>(null);\n\n  const form = useForm<LoginFormData>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n    },\n  });\n\n  const [isMobile, setIsMobile] = useState(window.innerWidth < 768);\n\n  useEffect(() => {\n    const handleResize = () => {\n      setIsMobile(window.innerWidth < 768);\n    };\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  const backgroundUrl = theme === \"dark\" ? bgDarkUrl : theme === \"light\" ? bgLightUrl : bgUnicornUrl;\n  const logoUrl = elevexLogoUrl;\n  const welcomeMessage = \"Elevate your life\";\n\n  // Handle video end - navigate after video finishes\n  useEffect(() => {\n    if (!showSuccess || !videoRef.current) return;\n\n    const video = videoRef.current;\n    const handleVideoEnd = async () => {\n      // Invalidate and ensure the auth query is properly refetched\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n\n      // Give the server a moment to confirm the session is set\n      await new Promise((resolve) => setTimeout(resolve, 100));\n\n      // Now navigate to home\n      setLocation(\"/\");\n    };\n\n    video.addEventListener(\"ended\", handleVideoEnd);\n    video.play();\n\n    return () => {\n      video.removeEventListener(\"ended\", handleVideoEnd);\n    };\n  }, [showSuccess, setLocation]);\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginFormData) => {\n      const res = await apiRequest(\"POST\", \"/api/auth/login\", data);\n      return await res.json();\n    },\n    onSuccess: async () => {\n      setShowSuccess(true);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Invalid credentials\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: LoginFormData) => {\n    loginMutation.mutate(data);\n  };\n\n  return (\n    <div \n      className=\"min-h-screen w-full flex items-center justify-center bg-cover bg-center bg-no-repeat transition-all duration-500\"\n      style={{ \n        backgroundImage: `url(${backgroundUrl})`,\n        transform: theme === \"unicorn\" ? \"rotate(0deg)\" : \"none\",\n        backgroundSize: isMobile ? \"200%\" : \"cover\",\n        backgroundPosition: \"center center\",\n      }}\n    >\n      <div \n        className=\"absolute inset-0 transition-opacity duration-500\"\n        style={{\n          background: theme === \"dark\" ? \"rgba(0,0,0,0.4)\" : theme === \"light\" ? \"rgba(255,255,255,0.3)\" : \"rgba(255,144,187,0.2)\"\n        }}\n      />\n\n      <AnimatePresence>\n        {showSuccess && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            transition={{ duration: 0.4, ease: \"easeInOut\" }}\n            className=\"absolute inset-0 z-50 flex items-center justify-center bg-black\"\n          >\n            <motion.div\n              initial={{ scale: 0.95, opacity: 0 }}\n              animate={{ scale: 1, opacity: 1 }}\n              exit={{ scale: 0.95, opacity: 0 }}\n              transition={{ \n                duration: 0.6, \n                ease: \"easeInOut\",\n                delay: 0.1\n              }}\n              className=\"flex items-center justify-center w-full h-full\"\n            >\n              <video \n                ref={videoRef}\n                className=\"w-full h-full object-contain\"\n                controls={false}\n                autoPlay\n                muted={false}\n                data-testid=\"video-success-animation\"\n              >\n                <source src={successVideoUrl} type=\"video/mp4\" />\n                Your browser does not support the video tag.\n              </video>\n            </motion.div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.6 }}\n        className=\"relative z-10 w-full max-w-md px-4\"\n      >\n        <div className=\"text-center mb-8 space-y-4\">\n          <div className=\"inline-flex flex-col items-center justify-center mb-4\">\n            <img src={logoUrl} alt=\"Logo\" className=\"w-64 h-auto\" />\n          </div>\n          <motion.h1 \n            key={welcomeMessage}\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"text-base font-bold tracking-tight\"\n          >\n            {welcomeMessage}\n          </motion.h1>\n          <div className=\"space-y-1\">\n            <p className=\"text-[10px] gradient-text leading-relaxed\">Sebastien g, aka Lion Coding</p>\n            <p className=\"text-[10px] text-muted-foreground leading-relaxed\">Works with Apple Development Program</p>\n          </div>\n        </div>\n\n        <Card className=\"border-border/50 shadow-xl\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex justify-center items-center gap-4 mb-6\">\n              <TripleThemeToggle />\n              <div className=\"flex gap-2\">\n                <Button\n                  type=\"button\"\n                  variant={language === \"en\" ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => setLanguage(\"en\")}\n                  data-testid=\"button-lang-en\"\n                >\n                  <Globe className=\"h-4 w-4 mr-1\" />\n                  EN\n                </Button>\n                <Button\n                  type=\"button\"\n                  variant={language === \"fr\" ? \"default\" : \"outline\"}\n                  size=\"sm\"\n                  onClick={() => setLanguage(\"fr\")}\n                  data-testid=\"button-lang-fr\"\n                >\n                  <Globe className=\"h-4 w-4 mr-1\" />\n                  FR\n                </Button>\n              </div>\n            </div>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"username\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t(\"common_username\")}</FormLabel>\n                      <FormControl>\n                        <Input\n                          data-testid=\"input-username\"\n                          placeholder={t(\"login_username_placeholder\")}\n                          autoComplete=\"username\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t(\"common_password\")}</FormLabel>\n                      <FormControl>\n                        <Input\n                          data-testid=\"input-password\"\n                          type=\"password\"\n                          placeholder={t(\"login_password_placeholder\")}\n                          autoComplete=\"current-password\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button\n                  data-testid=\"button-login\"\n                  type=\"submit\"\n                  className=\"w-full\"\n                  disabled={loginMutation.isPending}\n                >\n                  {loginMutation.isPending ? `${t(\"login_button\")}...` : t(\"login_button\")}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </motion.div>\n    </div>\n  );\n}","size_bytes":9661},"client/src/components/TripleThemeToggle.tsx":{"content":"import { Moon, Sun, Wand2 } from \"lucide-react\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { motion } from \"framer-motion\";\n\nexport function TripleThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  return (\n    <div className=\"flex items-center gap-1 p-1 bg-card/80 backdrop-blur-sm rounded-lg border border-border/50\">\n      <Button\n        data-testid=\"button-theme-dark\"\n        variant=\"ghost\"\n        size=\"icon\"\n        onClick={() => setTheme(\"dark\")}\n        className={`relative ${theme === \"dark\" ? \"\" : \"opacity-50\"}`}\n      >\n        <Moon className=\"w-4 h-4\" />\n        {theme === \"dark\" && (\n          <motion.div\n            layoutId=\"theme-indicator\"\n            className=\"absolute inset-0 bg-primary/20 rounded-md -z-10\"\n            initial={false}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n          />\n        )}\n      </Button>\n\n      <Button\n        data-testid=\"button-theme-light\"\n        variant=\"ghost\"\n        size=\"icon\"\n        onClick={() => setTheme(\"light\")}\n        className={`relative ${theme === \"light\" ? \"\" : \"opacity-50\"}`}\n      >\n        <Sun className=\"w-4 h-4\" />\n        {theme === \"light\" && (\n          <motion.div\n            layoutId=\"theme-indicator\"\n            className=\"absolute inset-0 bg-primary/20 rounded-md -z-10\"\n            initial={false}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n          />\n        )}\n      </Button>\n\n      <Button\n        data-testid=\"button-theme-unicorn\"\n        variant=\"ghost\"\n        size=\"icon\"\n        onClick={() => setTheme(\"unicorn\")}\n        className={`relative ${theme === \"unicorn\" ? \"\" : \"opacity-50\"}`}\n      >\n        {theme === \"unicorn\" ? (\n          <motion.div\n            initial={{ scale: 0.8, rotate: -10 }}\n            animate={{ scale: 1.2, rotate: 10 }}\n            transition={{ type: \"spring\", stiffness: 300, damping: 15, duration: 0.6 }}\n          >\n            <Wand2 className=\"w-4 h-4 text-primary\" />\n          </motion.div>\n        ) : (\n          <Wand2 className=\"w-4 h-4\" />\n        )}\n        {theme === \"unicorn\" && (\n          <motion.div\n            layoutId=\"theme-indicator\"\n            className=\"absolute inset-0 bg-primary/20 rounded-md -z-10\"\n            initial={false}\n            transition={{ type: \"spring\", stiffness: 300, damping: 30 }}\n          />\n        )}\n      </Button>\n    </div>\n  );\n}\n","size_bytes":2472},"client/src/components/TopBar.tsx":{"content":"import { useTheme } from \"@/contexts/ThemeContext\";\nimport { TripleThemeToggle } from \"@/components/TripleThemeToggle\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAuth, logout } from \"@/lib/auth\";\nimport elevexLogoUrl from \"@assets/giphy-downsized-medium_1763918974192.gif\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { LogOut, User, Bell, Settings } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { Link } from \"wouter\";\n\nexport function TopBar() {\n  const { theme } = useTheme();\n  const { data: user } = useAuth();\n\n  const { data: notifications = [] } = useQuery<Array<{\n    id: string;\n    type: string;\n    message: string;\n    workOrderId: string | null;\n    isRead: string;\n    createdAt: string;\n  }>>({\n    queryKey: [\"/api/notifications\"],\n    enabled: !!user,\n    refetchInterval: 30000,\n  });\n\n  const unreadCount = notifications.filter(n => n.isRead === 'false').length;\n\n  const handleMarkAsRead = async (notificationId: string) => {\n    await apiRequest(\"PATCH\", `/api/notifications/${notificationId}/read`);\n    await queryClient.refetchQueries({ queryKey: [\"/api/notifications\"] });\n  };\n\n  const handleMarkAllAsRead = async () => {\n    await apiRequest(\"PATCH\", \"/api/notifications/mark-all-read\");\n    await queryClient.refetchQueries({ queryKey: [\"/api/notifications\"] });\n  };\n\n  return (\n    <div className={`\n      sticky top-0 z-50 border-b backdrop-blur-md shadow-sm\n      ${theme === 'dark' ? 'bg-background/95 border-primary/20' : ''}\n      ${theme === 'light' ? 'bg-background/80 border-border' : ''}\n      ${theme === 'unicorn' ? 'bg-gradient-to-r from-cyan-50 via-purple-50 to-pink-50 border-primary/30' : ''}\n    `} data-testid=\"topbar\">\n      <div className=\"flex items-center justify-between px-4 md:px-6 lg:px-8 py-3 max-w-[1600px] mx-auto\">\n        {/* Logo */}\n        <div className=\"flex items-center gap-3\">\n          <img\n            src={elevexLogoUrl}\n            alt=\"ELEVEX\"\n            className=\"h-36 w-auto object-contain\"\n            data-testid=\"topbar-logo\"\n          />\n        </div>\n\n        {/* Right side - Theme toggle, notifications, and user */}\n        <div className=\"flex items-center gap-3\">\n          <TripleThemeToggle />\n\n          {user && (\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <button className=\"relative hover-elevate rounded-full p-2\" data-testid=\"button-notifications\">\n                  <Bell className=\"h-5 w-5\" />\n                  {unreadCount > 0 && (\n                    <Badge\n                      className=\"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs bg-red-500 text-white\"\n                      data-testid=\"badge-notification-count\"\n                    >\n                      {unreadCount}\n                    </Badge>\n                  )}\n                </button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-80\">\n                <DropdownMenuLabel className=\"flex items-center justify-between\">\n                  <span>Notifications</span>\n                  {unreadCount > 0 && (\n                    <button\n                      onClick={handleMarkAllAsRead}\n                      className=\"text-xs text-primary hover:underline\"\n                      data-testid=\"button-mark-all-read\"\n                    >\n                      Mark all as read\n                    </button>\n                  )}\n                </DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                <div className=\"max-h-96 overflow-y-auto\">\n                  {notifications.length === 0 ? (\n                    <div className=\"p-4 text-center text-sm text-muted-foreground\">\n                      No notifications\n                    </div>\n                  ) : (\n                    notifications.map((notification) => (\n                      <DropdownMenuItem\n                        key={notification.id}\n                        className={`flex flex-col items-start gap-1 p-3 cursor-pointer ${\n                          notification.isRead === 'false' ? 'bg-primary/5' : ''\n                        }`}\n                        onClick={() => notification.isRead === 'false' && handleMarkAsRead(notification.id)}\n                        data-testid={`notification-${notification.id}`}\n                      >\n                        <p className=\"text-sm font-medium\">{notification.message}</p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true })}\n                        </p>\n                        {notification.isRead === 'false' && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">New</Badge>\n                        )}\n                      </DropdownMenuItem>\n                    ))\n                  )}\n                </div>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          )}\n\n          {user && (\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <button className=\"hover-elevate rounded-full\" data-testid=\"button-user-menu\">\n                  <Avatar className=\"h-9 w-9\">\n                    <AvatarFallback className={`\n                      font-semibold\n                      ${theme === 'dark' ? 'bg-primary/20 text-primary' : ''}\n                      ${theme === 'light' ? 'bg-primary/10 text-primary' : ''}\n                      ${theme === 'unicorn' ? 'bg-gradient-to-br from-cyan-400 to-pink-400 text-white' : ''}\n                    `}>\n                      {user.username.substring(0, 2).toUpperCase()}\n                    </AvatarFallback>\n                  </Avatar>\n                </button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\" className=\"w-56\">\n                <DropdownMenuLabel>\n                  <div className=\"flex flex-col space-y-1\">\n                    <p className=\"text-sm font-medium leading-none\">{user.username}</p>\n                    <p className=\"text-xs leading-none text-muted-foreground capitalize\">{user.role}</p>\n                  </div>\n                </DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem asChild data-testid=\"button-settings\">\n                  <Link href=\"/settings\" className=\"flex items-center cursor-pointer\">\n                    <Settings className=\"mr-2 h-4 w-4\" />\n                    <span>Settings</span>\n                  </Link>\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => logout()} data-testid=\"button-logout\">\n                  <LogOut className=\"mr-2 h-4 w-4\" />\n                  <span>Log out</span>\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":7271},"client/src/components/PunchClock.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Clock, Power } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { TimePunch } from \"@shared/schema\";\n\ninterface TimeStatus {\n  isClockedIn: boolean;\n  currentPunch: TimePunch | null;\n}\n\ninterface PunchResponse {\n  action: \"clock-in\" | \"clock-out\";\n  punch: TimePunch;\n}\n\nexport function PunchClock() {\n  const { theme } = useTheme();\n  const { toast } = useToast();\n  const [elapsedTime, setElapsedTime] = useState(\"00:00:00\");\n\n  // Get current punch status\n  const { data: status } = useQuery<TimeStatus>({\n    queryKey: [\"/api/time/status\"],\n    refetchInterval: 30000, // Refresh every 30 seconds\n  });\n\n  const isClockedIn = status?.isClockedIn || false;\n  const currentPunch = status?.currentPunch;\n\n  // Calculate elapsed time\n  useEffect(() => {\n    if (!isClockedIn || !currentPunch?.clockIn) {\n      setElapsedTime(\"00:00:00\");\n      return;\n    }\n\n    const updateElapsed = () => {\n      const start = new Date(currentPunch.clockIn).getTime();\n      const now = Date.now();\n      const diff = now - start;\n      \n      const hours = Math.floor(diff / (1000 * 60 * 60));\n      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n      const seconds = Math.floor((diff % (1000 * 60)) / 1000);\n      \n      setElapsedTime(\n        `${hours.toString().padStart(2, \"0\")}:${minutes.toString().padStart(2, \"0\")}:${seconds.toString().padStart(2, \"0\")}`\n      );\n    };\n\n    updateElapsed();\n    const interval = setInterval(updateElapsed, 1000);\n    \n    return () => clearInterval(interval);\n  }, [isClockedIn, currentPunch]);\n\n  // Punch mutation\n  const punchMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/time/punch\", {});\n      return await res.json() as PunchResponse;\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/time/status\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time/hours\"] });\n      \n      toast({\n        title: data.action === \"clock-in\" ? \"Clocked In ✓\" : \"Clocked Out ✓\",\n        description: data.action === \"clock-in\" \n          ? \"Your shift has started\" \n          : \"Your shift has ended\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to punch. Please try again.\",\n      });\n    },\n  });\n\n  return (\n    <Card className={`\n      ${theme === 'dark' ? 'bg-card border-primary/20' : ''}\n      ${theme === 'light' ? 'shadow-md' : ''}\n      ${theme === 'unicorn' ? 'bg-gradient-to-br from-white to-pink-50 border-pink-200' : ''}\n    `} data-testid=\"punch-clock-card\">\n      <CardContent className=\"p-6\">\n        <div className=\"flex flex-col items-center gap-6\">\n          {/* Status indicator */}\n          <div className=\"flex items-center gap-2\">\n            <div className={`\n              h-3 w-3 rounded-full animate-pulse\n              ${isClockedIn ? 'bg-green-500' : 'bg-red-500'}\n            `} data-testid=\"status-indicator\" />\n            <span className={`\n              ${theme === 'dark' ? 'text-sm' : 'text-base'}\n              font-medium text-muted-foreground\n            `}>\n              {isClockedIn ? \"Clocked In\" : \"Clocked Out\"}\n            </span>\n          </div>\n\n          {/* Elapsed time (only show when clocked in) */}\n          {isClockedIn && (\n            <div className=\"text-center\">\n              <p className={`\n                ${theme === 'dark' ? 'text-xs' : 'text-sm'}\n                text-muted-foreground mb-2\n              `}>\n                Elapsed Time\n              </p>\n              <p className={`\n                ${theme === 'dark' ? 'text-2xl' : 'text-4xl'}\n                font-bold\n                ${theme === 'unicorn' ? 'bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 bg-clip-text text-transparent' : 'text-foreground'}\n              `} data-testid=\"elapsed-time\">\n                {elapsedTime}\n              </p>\n            </div>\n          )}\n\n          {/* Punch button */}\n          <Button\n            onClick={() => punchMutation.mutate()}\n            disabled={punchMutation.isPending}\n            size={theme === 'dark' ? \"default\" : \"lg\"}\n            className={`\n              w-full\n              ${theme === 'dark' ? 'bg-primary hover:bg-primary/90 text-primary-foreground' : ''}\n              ${theme === 'light' ? 'bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600' : ''}\n              ${theme === 'unicorn' ? 'bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600' : ''}\n            `}\n            data-testid=\"punch-button\"\n          >\n            <Power className={`\n              ${theme === 'dark' ? 'h-4 w-4 mr-2' : 'h-5 w-5 mr-2'}\n            `} />\n            {isClockedIn ? \"Clock Out\" : \"Clock In\"}\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":5254},"client/src/components/BottomNavBar.tsx":{"content":"import { useLocation } from \"wouter\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { Home, ClipboardList, MessageSquare, User, LogOut, Settings, Menu, Grid } from \"lucide-react\";\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from \"@/components/ui/sheet\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Card } from \"@/components/ui/card\";\n\nconst navItems = [\n  { label: \"Dashboard\", icon: Home, path: \"/\" },\n  { label: \"Orders\", icon: ClipboardList, path: \"/work-orders\" },\n  { label: \"Messages\", icon: MessageSquare, path: \"/messages\" },\n];\n\nconst allPages = [\n  { title: \"Dashboard\", path: \"/\", category: \"Main\" },\n  { title: \"Work Orders\", path: \"/work-orders\", category: \"Operations\" },\n  { title: \"Equipment & Parts\", path: \"/machines\", category: \"Operations\" },\n  { title: \"Appointments\", path: \"/appointments\", category: \"Operations\" },\n  { title: \"Sales\", path: \"/sales\", category: \"Business\" },\n  { title: \"Rental\", path: \"/rental\", category: \"Business\" },\n  { title: \"Accounting\", path: \"/accounting\", category: \"Business\" },\n  { title: \"Warranty Claims\", path: \"/warranty\", category: \"Business\" },\n  { title: \"Messages\", path: \"/messages\", category: \"Communication\" },\n];\n\nconst adminPages = [\n  { title: \"Admin Panel\", path: \"/admin\", category: \"Admin\" },\n  { title: \"Create User\", path: \"/admin/create-user\", category: \"Admin\" },\n];\n\nconst advisorPages = [\n  { title: \"Review Demands\", path: \"/advisor/demands\", category: \"Admin\" },\n  { title: \"Create Work Order\", path: \"/work-orders/create\", category: \"Admin\" },\n];\n\nexport function BottomNavBar() {\n  const [location, setLocation] = useLocation();\n  const { theme } = useTheme();\n  const [accountOpen, setAccountOpen] = useState(false);\n  const [menuOpen, setMenuOpen] = useState(false);\n  const { data: user } = useAuth();\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/auth/logout\");\n    },\n    onSuccess: () => {\n      queryClient.clear();\n      window.location.href = \"/login\";\n    },\n  });\n\n  const handleNavigate = (path: string) => {\n    setLocation(path);\n    setMenuOpen(false);\n    setAccountOpen(false);\n  };\n\n  const getPagesByCategory = (category: string) => {\n    let pages = allPages.filter(p => p.category === category);\n    if (category === \"Admin\") {\n      if (user?.role === \"admin\") {\n        pages.push(...adminPages.filter(p => p.category === \"Admin\"));\n      } else if (user?.role === \"technical_advisor\") {\n        pages.push(...advisorPages.filter(p => p.category === \"Admin\"));\n      }\n    }\n    return pages;\n  };\n\n  return (\n    <>\n      <div className={`\n        fixed bottom-0 left-0 right-0 z-50 border-t backdrop-blur-md shadow-2xl md:hidden\n        ${theme === 'dark' ? 'bg-background/95 border-primary/20' : ''}\n        ${theme === 'light' ? 'bg-white/95 border-border' : ''}\n        ${theme === 'unicorn' ? 'bg-gradient-to-r from-pink-50 via-purple-50 to-cyan-50 border-primary/30' : ''}\n      `} data-testid=\"bottom-nav\">\n        <nav className=\"flex items-center justify-around px-3 py-3 safe-area-inset-bottom\">\n          {navItems.map((item) => {\n            const isActive = location === item.path;\n            const Icon = item.icon;\n\n            return (\n              <button\n                key={item.path}\n                onClick={() => handleNavigate(item.path)}\n                className={`\n                  flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg transition-all min-w-[60px]\n                  ${theme === 'dark' && isActive ? 'bg-primary/20 text-primary' : ''}\n                  ${theme === 'dark' && !isActive ? 'text-muted-foreground hover-elevate' : ''}\n                  ${theme === 'light' && isActive ? 'bg-primary/10 text-primary' : ''}\n                  ${theme === 'light' && !isActive ? 'text-muted-foreground hover-elevate' : ''}\n                  ${theme === 'unicorn' && isActive ? 'bg-gradient-to-br from-cyan-400 to-pink-400 text-white' : ''}\n                  ${theme === 'unicorn' && !isActive ? 'text-purple-600 hover-elevate' : ''}\n                `}\n                data-testid={`nav-${item.label.toLowerCase()}`}\n              >\n                <Icon className=\"h-5 w-5 md:h-6 md:w-6\" />\n                <span className=\"text-xs font-medium\">\n                  {item.label}\n                </span>\n              </button>\n            );\n          })}\n\n          {/* Menu button - All Pages */}\n          <button\n            onClick={() => setMenuOpen(true)}\n            className={`\n              flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg transition-all min-w-[60px]\n              ${theme === 'dark' ? 'text-muted-foreground hover-elevate' : ''}\n              ${theme === 'light' ? 'text-muted-foreground hover-elevate' : ''}\n              ${theme === 'unicorn' ? 'text-purple-600 hover-elevate' : ''}\n            `}\n            data-testid=\"nav-menu\"\n          >\n            <Grid className=\"h-5 w-5 md:h-6 md:w-6\" />\n            <span className=\"text-xs font-medium\">\n              Menu\n            </span>\n          </button>\n\n          {/* Account button */}\n          <button\n            onClick={() => setAccountOpen(true)}\n            className={`\n              flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg transition-all min-w-[60px]\n              ${theme === 'dark' ? 'text-muted-foreground hover-elevate' : ''}\n              ${theme === 'light' ? 'text-muted-foreground hover-elevate' : ''}\n              ${theme === 'unicorn' ? 'text-purple-600 hover-elevate' : ''}\n            `}\n            data-testid=\"nav-account\"\n          >\n            <User className=\"h-5 w-5 md:h-6 md:w-6\" />\n            <span className=\"text-xs font-medium\">\n              Account\n            </span>\n          </button>\n        </nav>\n      </div>\n\n      {/* Full Menu Drawer - All Pages */}\n      <Sheet open={menuOpen} onOpenChange={setMenuOpen}>\n        <SheetContent side=\"bottom\" className=\"h-[90vh] flex flex-col\">\n          <SheetHeader>\n            <SheetTitle>All Pages</SheetTitle>\n          </SheetHeader>\n          <div className=\"flex-1 overflow-y-auto py-6 space-y-6\">\n            {[\"Main\", \"Operations\", \"Business\", \"Communication\", \"Admin\"].map((category) => {\n              const pages = getPagesByCategory(category);\n              if (pages.length === 0) return null;\n\n              return (\n                <div key={category}>\n                  <h3 className=\"text-sm font-semibold text-muted-foreground mb-3\">{category}</h3>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    {pages.map((page) => {\n                      const isActive = location === page.path;\n                      return (\n                        <Button\n                          key={page.path}\n                          variant={isActive ? \"default\" : \"outline\"}\n                          className=\"justify-start h-auto py-3\"\n                          onClick={() => handleNavigate(page.path)}\n                          data-testid={`menu-${page.title.toLowerCase().replace(/\\s+/g, '-')}`}\n                        >\n                          <span className=\"text-left\">{page.title}</span>\n                        </Button>\n                      );\n                    })}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </SheetContent>\n      </Sheet>\n\n      {/* Account Menu Drawer */}\n      <Sheet open={accountOpen} onOpenChange={setAccountOpen}>\n        <SheetContent side=\"right\" className=\"w-[280px]\">\n          <SheetHeader>\n            <SheetTitle>Account</SheetTitle>\n          </SheetHeader>\n          <div className=\"py-6 space-y-6\">\n            {/* User Info */}\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center\">\n                  <User className=\"h-6 w-6 text-primary\" />\n                </div>\n                <div>\n                  <p className=\"font-semibold text-foreground\">{user?.username}</p>\n                  <p className=\"text-sm text-muted-foreground capitalize\">{user?.role}</p>\n                </div>\n              </div>\n            </div>\n\n            <Separator />\n\n            {/* Profile Settings */}\n            <Button\n              variant=\"outline\"\n              className=\"w-full justify-start\"\n              onClick={() => handleNavigate(\"/settings\")}\n              data-testid=\"button-profile-settings\"\n            >\n              <Settings className=\"mr-2 h-4 w-4\" />\n              Profile Settings\n            </Button>\n\n            <Separator />\n\n            {/* Logout */}\n            <Button\n              variant=\"outline\"\n              className=\"w-full justify-start text-destructive hover:bg-destructive/10\"\n              onClick={() => logoutMutation.mutate()}\n              disabled={logoutMutation.isPending}\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"mr-2 h-4 w-4\" />\n              {logoutMutation.isPending ? \"Logging out...\" : \"Log Out\"}\n            </Button>\n          </div>\n        </SheetContent>\n      </Sheet>\n    </>\n  );\n}","size_bytes":9533},"client/src/components/HoursStats.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Clock, Calendar } from \"lucide-react\";\n\ninterface HoursData {\n  today: number;\n  week: number;\n}\n\nexport function HoursStats() {\n  const { theme } = useTheme();\n\n  const { data: hours } = useQuery<HoursData>({\n    queryKey: [\"/api/time/hours\"],\n    refetchInterval: 60000, // Refresh every minute\n  });\n\n  const todayHours = hours?.today || 0;\n  const weekHours = hours?.week || 0;\n\n  const formatHours = (hours: number) => {\n    const h = Math.floor(hours);\n    const m = Math.floor((hours - h) * 60);\n    return `${h}h ${m}m`;\n  };\n\n  return (\n    <div className=\"grid grid-cols-2 gap-4\">\n      {/* Today's Hours */}\n      <Card className={`\n        ${theme === 'dark' ? 'bg-card border-primary/20' : ''}\n        ${theme === 'light' ? 'shadow-md' : ''}\n        ${theme === 'unicorn' ? 'bg-gradient-to-br from-cyan-50 to-purple-50 border-cyan-200' : ''}\n      `} data-testid=\"hours-today-card\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className={`\n            flex items-center gap-2\n            ${theme === 'dark' ? 'text-sm' : 'text-base'}\n          `}>\n            <Clock className={`\n              ${theme === 'dark' ? 'h-4 w-4' : 'h-5 w-5'}\n              ${theme === 'unicorn' ? 'text-cyan-500' : 'text-primary'}\n            `} />\n            <span>Today</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className={`\n            ${theme === 'dark' ? 'text-xl' : 'text-3xl'}\n            font-bold\n            ${theme === 'unicorn' ? 'bg-gradient-to-r from-cyan-500 to-purple-500 bg-clip-text text-transparent' : 'text-foreground'}\n          `} data-testid=\"hours-today\">\n            {formatHours(todayHours)}\n          </p>\n        </CardContent>\n      </Card>\n\n      {/* Week's Hours */}\n      <Card className={`\n        ${theme === 'dark' ? 'bg-card border-primary/20' : ''}\n        ${theme === 'light' ? 'shadow-md' : ''}\n        ${theme === 'unicorn' ? 'bg-gradient-to-br from-purple-50 to-pink-50 border-purple-200' : ''}\n      `} data-testid=\"hours-week-card\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className={`\n            flex items-center gap-2\n            ${theme === 'dark' ? 'text-sm' : 'text-base'}\n          `}>\n            <Calendar className={`\n              ${theme === 'dark' ? 'h-4 w-4' : 'h-5 w-5'}\n              ${theme === 'unicorn' ? 'text-purple-500' : 'text-primary'}\n            `} />\n            <span>This Week</span>\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <p className={`\n            ${theme === 'dark' ? 'text-xl' : 'text-3xl'}\n            font-bold\n            ${theme === 'unicorn' ? 'bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent' : 'text-foreground'}\n          `} data-testid=\"hours-week\">\n            {formatHours(weekHours)}\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":3073},"server/seedWorkOrders.ts":{"content":"import { storage } from \"./storage\";\nimport type { User } from \"@shared/schema\";\n\nexport async function seedWorkOrders() {\n  try {\n    const users = await storage.getAllUsers();\n    if (users.length === 0) {\n      console.log(\"No users found - skipping work order seeding\");\n      return;\n    }\n\n    const existingWorkOrders = await storage.getAllWorkOrders();\n    if (existingWorkOrders.length > 0) {\n      console.log(\"Work orders already exist - skipping seeding\");\n      return;\n    }\n\n    const seub = users.find((u) => u.username === \"seub\");\n    const steve = users.find((u) => u.username === \"steve\");\n    const cody = users.find((u) => u.username === \"cody\");\n    const nadia = users.find((u) => u.username === \"nadia\");\n\n    const creator = seub || users[0];\n\n    const workOrders = [\n      {\n        title: \"Hydraulic leak on forklift cylinder\",\n        priority: \"High\" as const,\n        department: \"Road Technician\" as const,\n        headquarters: \"Montreal, QC\" as const,\n        customer: \"Distribution Laval Inc.\",\n        siteAddress: \"2450 Boul. Le Corbusier, Laval, QC H7S 2C9\",\n        asset: \"Toyota 7FGU35 - Serial: 78234-A\",\n        problemSummary: \"Customer reports hydraulic fluid dripping from lift cylinder. Unit still operational but losing pressure. Inspect cylinder seals and hydraulic lines. May need full cylinder rebuild.\",\n        tasks: [\n          { title: \"Diagnose hydraulic leak source\", budgetedHours: 0.5 },\n          { title: \"Replace cylinder seals\", budgetedHours: 2.0 },\n          { title: \"Pressure test and quality check\", budgetedHours: 1.0 },\n        ],\n        createdBy: creator.id,\n        assignedTo: steve?.id,\n        status: steve ? \"assigned\" as const : \"new\" as const,\n      },\n      {\n        title: \"Lift chain binding on scissor lift\",\n        priority: \"Urgent\" as const,\n        department: \"Garage Technician\" as const,\n        headquarters: \"Quebec, QC\" as const,\n        customer: \"Quebec Warehouse Solutions\",\n        siteAddress: \"8900 Boul. Henri-Bourassa, Quebec City, QC G1G 5X1\",\n        asset: \"Genie GS-3232 - Serial: GS3232-19845\",\n        problemSummary: \"Lift chain jamming at half extension. Makes grinding noise. Unit currently out of service for safety. Customer needs ASAP repair - critical for warehouse operations.\",\n        tasks: [\n          { title: \"Inspect lift chain and sprockets\", budgetedHours: 1.0 },\n          { title: \"Disassemble and clean mechanism\", budgetedHours: 1.5 },\n          { title: \"Replace worn chain links\", budgetedHours: 1.0 },\n          { title: \"Test full range of motion\", budgetedHours: 0.5 },\n        ],\n        createdBy: creator.id,\n        assignedTo: cody?.id,\n        status: cody ? \"in-progress\" as const : \"new\" as const,\n        actualHours: cody ? 1.5 : 0,\n      },\n      {\n        title: \"Electrical fault code E47\",\n        priority: \"Normal\" as const,\n        department: \"Road Technician\" as const,\n        headquarters: \"Montreal, QC\" as const,\n        customer: \"Les Entreprises Fortin\",\n        siteAddress: \"500 Rue Principale, Saint-Eustache, QC J7R 5B9\",\n        asset: \"Crown RC5500 - Serial: RC-092847\",\n        problemSummary: \"Error code E47 appearing intermittently on display. Unit operates but displays fault. Check wiring harness and controller connections. Might be sensor issue.\",\n        tasks: [\n          { title: \"Diagnostic scan and error code analysis\", budgetedHours: 0.5 },\n          { title: \"Inspect wiring harness and connections\", budgetedHours: 1.0 },\n          { title: \"Test and repair as needed\", budgetedHours: 0.5 },\n        ],\n        createdBy: creator.id,\n        assignedTo: nadia?.id,\n        status: nadia ? \"assigned\" as const : \"new\" as const,\n      },\n      {\n        title: \"Annual preventive maintenance\",\n        priority: \"Normal\" as const,\n        department: \"Garage Technician\" as const,\n        headquarters: \"Saguenay, QC\" as const,\n        customer: \"Aluminerie de Saguenay\",\n        siteAddress: \"3255 Boul. de la Grande-Baie S, La Baie, QC G7B 3N8\",\n        asset: \"Komatsu FD40T - Serial: FD40-56712\",\n        problemSummary: \"Scheduled 500-hour preventive maintenance. Full inspection, fluid changes, filter replacement, brake check, and load test as per manufacturer specifications.\",\n        tasks: [\n          { title: \"Complete visual inspection\", budgetedHours: 0.5 },\n          { title: \"Change all fluids and filters\", budgetedHours: 1.5 },\n          { title: \"Brake system inspection and adjustment\", budgetedHours: 1.0 },\n          { title: \"Load test and documentation\", budgetedHours: 2.0 },\n        ],\n        createdBy: creator.id,\n        assignedTo: steve?.id,\n        status: steve ? \"completed\" as const : \"new\" as const,\n        actualHours: 4.2,\n        efficiency: 119.0,\n        completedAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 days ago\n      },\n      {\n        title: \"Brake system not holding pressure\",\n        priority: \"Urgent\" as const,\n        department: \"Road Technician\" as const,\n        headquarters: \"Montreal, QC\" as const,\n        customer: \"Montreal Logistics Hub\",\n        siteAddress: \"12000 Rue Sherbrooke E, Montreal, QC H1B 1C1\",\n        asset: \"Hyster H80FT - Serial: HY-80-23456\",\n        problemSummary: \"Service brake not holding. Emergency brake functional. Unit taken out of service immediately. Suspected master cylinder failure or air in lines. Priority repair needed.\",\n        tasks: [\n          { title: \"Diagnose brake system issue\", budgetedHours: 0.5 },\n          { title: \"Replace master cylinder if needed\", budgetedHours: 1.5 },\n          { title: \"Bleed brake lines and pressure test\", budgetedHours: 1.0 },\n        ],\n        createdBy: creator.id,\n        status: \"new\" as const,\n      },\n      {\n        title: \"Load capacity recertification\",\n        priority: \"Normal\" as const,\n        department: \"Tech Advisor\" as const,\n        headquarters: \"Quebec, QC\" as const,\n        customer: \"Industrielle Alliance du Quebec\",\n        siteAddress: \"1250 Boul. Charest O, Quebec City, QC G1N 2E4\",\n        asset: \"Yale GDP080 - Serial: GDP-08-77123\",\n        problemSummary: \"Annual load capacity certification required for insurance compliance. Perform full load test, inspect forks and carriage, verify nameplate data, issue certification documents.\",\n        tasks: [\n          { title: \"Inspect forks and carriage for wear\", budgetedHours: 0.5 },\n          { title: \"Perform rated load test\", budgetedHours: 1.5 },\n          { title: \"Complete certification paperwork\", budgetedHours: 0.5 },\n        ],\n        createdBy: creator.id,\n        assignedTo: nadia?.id,\n        status: nadia ? \"completed\" as const : \"new\" as const,\n        actualHours: 3.1,\n        efficiency: 80.6,\n        completedAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000), // 5 days ago\n      },\n    ];\n\n    for (const wo of workOrders) {\n      await storage.createWorkOrder(wo);\n    }\n\n    console.log(`✅ Seeded ${workOrders.length} work orders`);\n  } catch (error) {\n    console.error(\"Failed to seed work orders:\", error);\n  }\n}\n","size_bytes":7077},"client/src/components/WorkOrderCardNew.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Clock, MapPin, User, Wrench, PlayCircle, PauseCircle, Edit2, ChevronDown, ChevronUp, Check, ChevronsUpDown, FileUp, Save } from \"lucide-react\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport type { WorkOrder, User as UserType, TimePunch, WorkOrderTask } from \"@shared/schema\";\nimport hexBg from \"@assets/IMG_6738_1763322726659.jpeg\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { cn } from \"@/lib/utils\";\n\ninterface WorkOrderCardNewProps {\n  workOrder: WorkOrder;\n  showPunchButtons?: boolean;\n  showAssignButtons?: boolean;\n}\n\nexport function WorkOrderCardNew({ workOrder, showPunchButtons = false, showAssignButtons = true }: WorkOrderCardNewProps) {\n  const { theme } = useTheme();\n  const { toast } = useToast();\n  const [showAssign, setShowAssign] = useState(false);\n  const [showTasks, setShowTasks] = useState(false);\n  const [editingPunch, setEditingPunch] = useState<TimePunch | null>(null);\n  const [editClockIn, setEditClockIn] = useState(\"\");\n  const [editClockOut, setEditClockOut] = useState(\"\");\n  const [openUserSelect, setOpenUserSelect] = useState(false);\n  const [selectedUserId, setSelectedUserId] = useState<string>(\"\");\n  const [isEditingNotes, setIsEditingNotes] = useState(false);\n  const [notesText, setNotesText] = useState(workOrder.notes || \"\");\n  const [uploadingPhoto, setUploadingPhoto] = useState(false);\n\n  const { data: currentUser } = useAuth();\n\n  const { data: users, isLoading: isLoadingUsers } = useQuery<UserType[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: currentPunch } = useQuery<TimePunch | null>({\n    queryKey: [\"/api/time-punches/current\"],\n    refetchInterval: 1000, // Sync every second\n  });\n\n  const { data: tasks = [] } = useQuery<WorkOrderTask[]>({\n    queryKey: [\"/api/work-orders\", workOrder.id, \"tasks\"],\n  });\n\n  const { data: punches = [] } = useQuery<TimePunch[]>({\n    queryKey: [\"/api/work-orders\", workOrder.id, \"punches\"],\n    refetchInterval: 1000, // Refetch every second to sync active punch status in real-time\n  });\n\n  const assignMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      const res = await apiRequest(\"PATCH\", `/api/work-orders/${workOrder.id}/assign`, { userId });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to assign work order\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/assigned\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrder.workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      toast({\n        title: \"Work order assigned\",\n        description: \"The work order has been assigned successfully.\",\n      });\n      setShowAssign(false);\n      setSelectedUserId(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to assign work order\",\n      });\n    },\n  });\n\n  const punchInMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", `/api/work-orders/${workOrder.id}/punch-in`);\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to punch in\");\n      }\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/assigned\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrder.id, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      toast({ title: \"Punched in\", description: \"Started working on this work order\" });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to punch in\",\n      });\n    },\n  });\n\n  const punchOutMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", `/api/work-orders/${workOrder.id}/punch-out`);\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to punch out\");\n      }\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/assigned\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrder.id, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      toast({ title: \"Punched out\", description: \"Work session ended\" });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to punch out\",\n      });\n    },\n  });\n\n  const updatePunchMutation = useMutation({\n    mutationFn: async ({ id, clockIn, clockOut }: { id: string; clockIn: string; clockOut: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/time-punches/${id}`, { clockIn, clockOut });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to update punch\");\n      }\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrder.id, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/assigned\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      setEditingPunch(null);\n      toast({ title: \"Punch updated\", description: \"Time entry has been updated\" });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to update punch\",\n      });\n    },\n  });\n\n  const updateNotesMutation = useMutation({\n    mutationFn: async () => {\n      return apiRequest(\"PATCH\", `/api/work-orders/${workOrder.id}/notes`, { notes: notesText });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/assigned\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrder.workOrderNumber] });\n      setIsEditingNotes(false);\n      toast({ title: \"Notes saved\" });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to save notes\",\n      });\n    },\n  });\n\n  const updatePhotosMutation = useMutation({\n    mutationFn: async (photos: string[]) => {\n      return apiRequest(\"PATCH\", `/api/work-orders/${workOrder.id}/photos`, { photos });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/assigned\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrder.workOrderNumber] });\n      toast({ title: \"Photo added successfully\" });\n      setUploadingPhoto(false);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to add photo\",\n      });\n      setUploadingPhoto(false);\n    },\n  });\n\n  const handlePhotoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setUploadingPhoto(true);\n    const formData = new FormData();\n    formData.append(\"photo\", file);\n\n    try {\n      const response = await fetch(\"/api/upload/photo\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to upload photo\");\n      }\n\n      const { filePath } = await response.json();\n      const newPhotos = [...(workOrder.photos || []), filePath];\n      updatePhotosMutation.mutate(newPhotos);\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to upload photo\",\n      });\n      setUploadingPhoto(false);\n    }\n  };\n\n  const handleEditPunch = (punch: TimePunch) => {\n    setEditingPunch(punch);\n    setEditClockIn(new Date(punch.clockIn).toISOString().slice(0, 16));\n    setEditClockOut(punch.clockOut ? new Date(punch.clockOut).toISOString().slice(0, 16) : \"\");\n  };\n\n  const handleSaveEdit = () => {\n    if (!editingPunch || !editClockIn || !editClockOut) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Both clock in and clock out times are required\",\n      });\n      return;\n    }\n    updatePunchMutation.mutate({\n      id: editingPunch.id,\n      clockIn: editClockIn,\n      clockOut: editClockOut,\n    });\n  };\n\n  const priorityColor = {\n    Normal: \"bg-blue-500\",\n    High: \"bg-orange-500\",\n    Urgent: \"bg-red-500\",\n  }[workOrder.priority];\n\n  const statusColor = {\n    new: \"bg-purple-500\",\n    demand: \"bg-purple-600\",\n    assigned: \"bg-blue-500\",\n    \"in-progress\": \"bg-yellow-500\",\n    completed: \"bg-green-500\",\n    closedForReview: \"bg-green-600\",\n  }[workOrder.status];\n\n  const efficiencyColor = (eff: number | null) => {\n    if (!eff) return \"text-muted-foreground\";\n    if (eff >= 100) return \"text-green-500\";\n    if (eff >= 80) return \"text-yellow-500\";\n    return \"text-red-500\";\n  };\n\n  const assignedUser = users?.find((u) => u.id === workOrder.assignedTo);\n  const isPunchedIn = currentPunch?.workOrderId === workOrder.id;\n  const isAssignedToCurrentUser = currentUser?.id === workOrder.assignedTo;\n  const totalBudgetedHours = tasks.reduce((sum, task) => sum + task.budgetedHours, 0);\n\n  // Calculate total hours including active punches\n  const calculateTotalHours = () => {\n    let total = 0;\n    \n    // Add completed work hours\n    punches.forEach(punch => {\n      if (punch.punchType === \"work\" && punch.clockOut) {\n        const hours = (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n        total += hours;\n      }\n    });\n    \n    // Add current active work punch hours (if any)\n    const activePunch = punches.find(p => p.punchType === \"work\" && !p.clockOut);\n    if (activePunch) {\n      const hours = (Date.now() - new Date(activePunch.clockIn).getTime()) / (1000 * 60 * 60);\n      total += hours;\n    }\n    \n    return total;\n  };\n\n  const displayHours = calculateTotalHours();\n\n  // Check if work order is new (created within last 24 hours)\n  const isNewWorkOrder = workOrder.createdAt \n    ? (new Date().getTime() - new Date(workOrder.createdAt).getTime()) < (24 * 60 * 60 * 1000)\n    : false;\n\n  return (\n    <Card\n      className={`\n        relative overflow-hidden hover-elevate transition-all\n        ${theme === 'dark' ? 'border-primary/20' : ''}\n        ${theme === 'unicorn' ? 'border-primary/30' : ''}\n        ${isNewWorkOrder ? 'new-work-order-glow' : ''}\n      `}\n      data-testid={`card-workorder-${workOrder.id}`}\n    >\n      <div\n        className=\"absolute inset-0 opacity-5 pointer-events-none\"\n        style={{ backgroundImage: `url(${hexBg})`, backgroundSize: 'cover' }}\n      />\n\n      <CardHeader className=\"relative z-10 pb-3\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <CardTitle className=\"text-lg font-semibold\" data-testid=\"text-wo-number\">\n            {workOrder.workOrderNumber}\n          </CardTitle>\n          <div className=\"flex gap-1.5\">\n            <Badge className={`${priorityColor} text-white text-xs`}>\n              {workOrder.priority}\n            </Badge>\n            <Badge className={`${statusColor} text-white text-xs`}>\n              {workOrder.status}\n            </Badge>\n          </div>\n        </div>\n        <h3 className={`\n          text-base font-medium mt-1\n          ${theme === 'light' || theme === 'unicorn' ? 'bg-gradient-to-r from-cyan-600 via-purple-600 to-pink-600 bg-clip-text text-transparent' : 'text-foreground'}\n        `}>\n          {workOrder.title}\n        </h3>\n      </CardHeader>\n\n      <CardContent className=\"relative z-10 space-y-3\">\n        <div className=\"space-y-2 text-sm\">\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\n            <User className=\"h-4 w-4\" />\n            <span>{workOrder.customer}</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\n            <MapPin className=\"h-4 w-4\" />\n            <span>{workOrder.headquarters}</span>\n          </div>\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\n            <Wrench className=\"h-4 w-4\" />\n            <span>{workOrder.asset}</span>\n          </div>\n        </div>\n\n        {(workOrder.status === \"completed\" || workOrder.status === \"closedForReview\") && (\n          <div className=\"pt-2 border-t space-y-2\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"text-muted-foreground\">Hours Worked:</span>\n              <span className=\"font-semibold\">\n                {displayHours.toFixed(1)}h / {totalBudgetedHours.toFixed(1)}h\n              </span>\n            </div>\n            {workOrder.efficiency && (\n              <div className=\"flex items-center justify-between text-sm\">\n                <span className=\"text-muted-foreground\">Efficiency:</span>\n                <span className={`font-semibold ${efficiencyColor(workOrder.efficiency)}`}>\n                  {workOrder.efficiency.toFixed(1)}%\n                </span>\n              </div>\n            )}\n          </div>\n        )}\n\n        {workOrder.status !== \"completed\" && workOrder.status !== \"closedForReview\" && tasks.length > 0 && (\n          <div className=\"pt-2 border-t space-y-2\">\n            <p className=\"text-xs font-medium text-muted-foreground\">Task Hours:</p>\n            {tasks.map((task, index) => {\n              const taskPunches = punches.filter(p => p.taskId === task.id && p.punchType === \"work\");\n              const taskHours = taskPunches.reduce((sum, punch) => {\n                if (punch.clockOut) {\n                  return sum + (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n                }\n                return sum;\n              }, 0);\n              \n              if (taskHours === 0) return null;\n              \n              return (\n                <div key={task.id} className=\"flex items-center justify-between text-xs\">\n                  <span className=\"text-muted-foreground truncate flex-1\">{index + 1}. {task.title}</span>\n                  <Badge variant=\"outline\" className=\"text-xs ml-2\">\n                    {taskHours.toFixed(1)}h\n                  </Badge>\n                </div>\n              );\n            })}\n          </div>\n        )}\n\n        {tasks.length > 0 && (\n          <Collapsible open={showTasks} onOpenChange={setShowTasks} className=\"pt-2 border-t\">\n            <CollapsibleTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"w-full flex items-center justify-between\"\n                data-testid={`button-toggle-tasks-${workOrder.id}`}\n              >\n                <span className=\"text-sm font-medium\">Tasks ({tasks.length})</span>\n                {showTasks ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n              </Button>\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"space-y-2 mt-2\">\n              {tasks.map((task, index) => {\n                const taskPunches = punches.filter(p => p.taskId === task.id);\n                const totalHours = taskPunches.reduce((sum, punch) => {\n                  if (punch.clockOut) {\n                    const hours = (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n                    return sum + hours;\n                  }\n                  return sum;\n                }, 0);\n                const canEdit = workOrder.status !== \"completed\" && workOrder.status !== \"closedForReview\";\n\n                return (\n                  <div key={task.id} className=\"bg-muted/50 rounded-md p-2 space-y-2\">\n                    <div className=\"flex items-start justify-between gap-2\">\n                      <div className=\"flex-1\">\n                        <p className=\"text-sm font-medium\">{index + 1}. {task.title}</p>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {task.budgetedHours}h budget\n                        </Badge>\n                        {totalHours > 0 && (\n                          <Badge variant=\"secondary\" className=\"text-xs\">\n                            {totalHours.toFixed(1)}h actual\n                          </Badge>\n                        )}\n                      </div>\n                    </div>\n                    \n                    {taskPunches.length > 0 && (\n                      <div className=\"space-y-1\">\n                        {taskPunches.map((punch) => (\n                          <div\n                            key={punch.id}\n                            className=\"flex items-center justify-between text-xs bg-background/50 p-1.5 rounded\"\n                          >\n                            <div className=\"flex-1\">\n                              <p className=\"font-medium\">\n                                {new Date(punch.clockIn).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                                {punch.clockOut && ` - ${new Date(punch.clockOut).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`}\n                              </p>\n                            </div>\n                            <div className=\"flex items-center gap-1\">\n                              {punch.clockOut && (\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                  {((new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60)).toFixed(1)}h\n                                </Badge>\n                              )}\n                              {canEdit && (\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"ghost\"\n                                  className=\"h-6 w-6 p-0\"\n                                  onClick={() => handleEditPunch(punch)}\n                                  data-testid={`button-edit-punch-${punch.id}`}\n                                >\n                                  <Edit2 className=\"h-3 w-3\" />\n                                </Button>\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </CollapsibleContent>\n          </Collapsible>\n        )}\n\n        <div className=\"space-y-2 pt-2\">\n          {isAssignedToCurrentUser && workOrder.status !== \"completed\" && workOrder.status !== \"closedForReview\" && (\n            <div className=\"flex gap-2\">\n              {!isPunchedIn ? (\n                <Button\n                  size=\"sm\"\n                  onClick={() => punchInMutation.mutate()}\n                  disabled={punchInMutation.isPending || !!currentPunch}\n                  className=\"flex-1\"\n                  data-testid={`button-punch-in-${workOrder.id}`}\n                >\n                  <PlayCircle className=\"mr-1 h-4 w-4\" />\n                  {punchInMutation.isPending ? \"Punching in...\" : \"Punch In\"}\n                </Button>\n              ) : (\n                <Button\n                  size=\"sm\"\n                  onClick={() => punchOutMutation.mutate()}\n                  disabled={punchOutMutation.isPending}\n                  variant=\"outline\"\n                  className=\"flex-1\"\n                  data-testid={`button-punch-out-${workOrder.id}`}\n                >\n                  <PauseCircle className=\"mr-1 h-4 w-4\" />\n                  {punchOutMutation.isPending ? \"Punching out...\" : \"Punch Out\"}\n                </Button>\n              )}\n            </div>\n          )}\n          \n          {showAssignButtons && (\n            !showAssign ? (\n              <div className=\"flex gap-2\">\n                {assignedUser ? (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    onClick={() => setShowAssign(true)}\n                    data-testid={`button-reassign-${workOrder.id}`}\n                  >\n                    Reassign ({assignedUser.username})\n                  </Button>\n                ) : (\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    onClick={() => setShowAssign(true)}\n                    data-testid={`button-assign-${workOrder.id}`}\n                  >\n                    Assign\n                  </Button>\n                )}\n                <Button\n                  size=\"sm\"\n                  className=\"flex-1\"\n                  onClick={() => (window.location.href = `/work-orders/${workOrder.workOrderNumber}`)}\n                  data-testid={`button-view-${workOrder.id}`}\n                >\n                  View Details\n                </Button>\n              </div>\n            ) : (\n              <div className=\"flex gap-2 w-full\">\n              <Popover open={openUserSelect} onOpenChange={setOpenUserSelect}>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    aria-expanded={openUserSelect}\n                    className=\"flex-1 justify-between\"\n                    disabled={assignMutation.isPending}\n                    data-testid={`select-assign-${workOrder.id}`}\n                  >\n                    {selectedUserId\n                      ? users?.find((user) => user.id === selectedUserId)?.username\n                      : \"Select user...\"}\n                    <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-[300px] p-0\">\n                  <Command>\n                    <CommandInput placeholder=\"Search users...\" data-testid=\"input-search-users\" />\n                    <CommandList>\n                      {isLoadingUsers ? (\n                        <div className=\"p-2 text-sm text-muted-foreground\">Loading users...</div>\n                      ) : !users || users.length === 0 ? (\n                        <CommandEmpty>No users available.</CommandEmpty>\n                      ) : (\n                        <CommandGroup>\n                          {users.map((user) => (\n                            <CommandItem\n                              key={user.id}\n                              value={user.username}\n                              onSelect={() => {\n                                setSelectedUserId(user.id);\n                                setTimeout(() => setOpenUserSelect(false), 0);\n                              }}\n                              data-testid={`user-option-${user.id}`}\n                            >\n                              <Check\n                                className={cn(\n                                  \"mr-2 h-4 w-4\",\n                                  selectedUserId === user.id ? \"opacity-100\" : \"opacity-0\"\n                                )}\n                              />\n                              {user.username}\n                            </CommandItem>\n                          ))}\n                        </CommandGroup>\n                      )}\n                    </CommandList>\n                  </Command>\n                </PopoverContent>\n              </Popover>\n              <Button\n                size=\"sm\"\n                onClick={() => {\n                  if (selectedUserId) {\n                    assignMutation.mutate(selectedUserId);\n                  }\n                }}\n                disabled={assignMutation.isPending || !selectedUserId}\n                data-testid={`button-confirm-assign-${workOrder.id}`}\n              >\n                {assignMutation.isPending ? \"Assigning...\" : \"Assign\"}\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => {\n                  setShowAssign(false);\n                  setSelectedUserId(\"\");\n                  setOpenUserSelect(false);\n                }}\n                disabled={assignMutation.isPending}\n              >\n                Cancel\n              </Button>\n            </div>\n          )\n          )}\n        </div>\n        {/* Notes & Attachments Section */}\n        <div className=\"border-t pt-3 space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <h4 className=\"font-semibold text-sm\">Notes & Attachments</h4>\n            {!isEditingNotes && (\n              <Button\n                size=\"sm\"\n                variant=\"ghost\"\n                className=\"h-6 w-6 p-0\"\n                onClick={() => setIsEditingNotes(true)}\n                data-testid={`button-edit-notes-${workOrder.id}`}\n              >\n                <Edit2 className=\"h-3 w-3\" />\n              </Button>\n            )}\n          </div>\n\n          {/* Photos Display */}\n          {workOrder.photos && workOrder.photos.length > 0 && (\n            <div className=\"grid grid-cols-2 gap-2 mb-2\">\n              {workOrder.photos.map((photo, index) => (\n                <img\n                  key={index}\n                  src={photo}\n                  alt={`Attachment ${index + 1}`}\n                  className=\"w-full h-24 object-cover rounded-md border\"\n                  data-testid={`img-attachment-${index}`}\n                />\n              ))}\n            </div>\n          )}\n\n          {isEditingNotes ? (\n            <div className=\"space-y-2\">\n              <Textarea\n                placeholder=\"Add notes or comments...\"\n                value={notesText}\n                onChange={(e) => setNotesText(e.target.value)}\n                className=\"min-h-20 text-sm\"\n                data-testid={`textarea-notes-${workOrder.id}`}\n              />\n              \n              <div className=\"flex gap-1 flex-wrap\">\n                <label className=\"relative\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    className=\"h-7\"\n                    disabled={uploadingPhoto}\n                    asChild\n                    data-testid={`button-upload-photo-${workOrder.id}`}\n                  >\n                    <span>\n                      <FileUp className=\"h-3 w-3 mr-1\" />\n                      {uploadingPhoto ? \"Uploading...\" : \"Add Photo\"}\n                    </span>\n                  </Button>\n                  <input\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={handlePhotoUpload}\n                    disabled={uploadingPhoto}\n                    className=\"hidden\"\n                    data-testid={`input-photo-${workOrder.id}`}\n                  />\n                </label>\n\n                <Button\n                  size=\"sm\"\n                  onClick={() => updateNotesMutation.mutate()}\n                  disabled={updateNotesMutation.isPending}\n                  className=\"h-7\"\n                  data-testid={`button-save-notes-${workOrder.id}`}\n                >\n                  <Save className=\"h-3 w-3 mr-1\" />\n                  Save\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setIsEditingNotes(false);\n                    setNotesText(workOrder.notes || \"\");\n                  }}\n                  className=\"h-7\"\n                  data-testid={`button-cancel-notes-${workOrder.id}`}\n                >\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          ) : (\n            <p className=\"text-xs text-muted-foreground py-1 min-h-6 whitespace-pre-wrap\">\n              {workOrder.notes || \"No notes yet. Click edit to add notes or attach photos.\"}\n            </p>\n          )}\n        </div>\n      </CardContent>\n\n      <Dialog open={!!editingPunch} onOpenChange={() => setEditingPunch(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Time Punch</DialogTitle>\n            <DialogDescription>\n              Adjust the clock in and clock out times for this time entry.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Clock In</label>\n              <Input\n                type=\"datetime-local\"\n                value={editClockIn}\n                onChange={(e) => setEditClockIn(e.target.value)}\n                data-testid=\"input-edit-clock-in\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Clock Out</label>\n              <Input\n                type=\"datetime-local\"\n                value={editClockOut}\n                onChange={(e) => setEditClockOut(e.target.value)}\n                data-testid=\"input-edit-clock-out\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setEditingPunch(null)}\n              data-testid=\"button-cancel-edit\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSaveEdit}\n              disabled={updatePunchMutation.isPending}\n              data-testid=\"button-save-edit\"\n            >\n              {updatePunchMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </Card>\n  );\n}\n","size_bytes":31788},"client/src/components/WorkOrderForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nconst workOrderSchema = z.object({\n  title: z.string().min(3, \"Title is required\"),\n  customer: z.string().min(1, \"Customer name is required\"),\n  siteAddress: z.string().min(1, \"Site address is required\"),\n  asset: z.string().min(1, \"Asset/Equipment is required\"),\n  problemSummary: z.string().min(10, \"Problem summary must be at least 10 characters\"),\n  priority: z.enum([\"Normal\", \"High\", \"Urgent\"]).default(\"Normal\"),\n  department: z.enum([\"Road Technician\", \"Garage Technician\", \"Sales\", \"Tech Advisor\", \"Accounting\", \"HR\"]).default(\"Road Technician\"),\n  headquarters: z.enum([\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"]).default(\"Montreal, QC\"),\n});\n\ntype FormData = z.infer<typeof workOrderSchema>;\n\ninterface WorkOrderFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function WorkOrderForm({ open, onOpenChange }: WorkOrderFormProps) {\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(workOrderSchema),\n    defaultValues: {\n      title: \"\",\n      customer: \"\",\n      siteAddress: \"\",\n      asset: \"\",\n      problemSummary: \"\",\n      priority: \"Normal\",\n      department: \"Road Technician\",\n      headquarters: \"Montreal, QC\",\n    },\n  });\n\n  const onSubmit = async (data: FormData) => {\n    setIsSubmitting(true);\n    try {\n      await apiRequest(\"POST\", \"/api/work-orders\", data);\n\n      toast({\n        title: \"Work order created successfully\",\n        description: \"Your work order request has been submitted.\",\n      });\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      form.reset();\n      onOpenChange(false);\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to create work order\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>Create Work Order</DialogTitle>\n          <DialogDescription>Fill in the details to request a new work order</DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            {/* Title */}\n            <FormField\n              control={form.control}\n              name=\"title\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Work Order Title</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"e.g., Lift maintenance, Equipment repair\" {...field} data-testid=\"input-wo-title\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {/* Customer Info */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"customer\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Customer Name</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Company name\" {...field} data-testid=\"input-wo-customer\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"siteAddress\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Site Address</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Street address\" {...field} data-testid=\"input-wo-address\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            {/* Asset and Priority */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"asset\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Asset/Equipment</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"e.g., Lift Model XYZ-100\" {...field} data-testid=\"input-wo-asset\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"priority\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Priority</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-wo-priority\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"Normal\">Normal</SelectItem>\n                        <SelectItem value=\"High\">High</SelectItem>\n                        <SelectItem value=\"Urgent\">Urgent</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            {/* Department and Headquarters */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"department\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Department</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-wo-department\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"Road Technician\">Road Technician</SelectItem>\n                        <SelectItem value=\"Garage Technician\">Garage Technician</SelectItem>\n                        <SelectItem value=\"Sales\">Sales</SelectItem>\n                        <SelectItem value=\"Tech Advisor\">Tech Advisor</SelectItem>\n                        <SelectItem value=\"Accounting\">Accounting</SelectItem>\n                        <SelectItem value=\"HR\">HR</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"headquarters\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Headquarters</FormLabel>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-wo-hq\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"Montreal, QC\">Montreal, QC</SelectItem>\n                        <SelectItem value=\"Quebec, QC\">Quebec, QC</SelectItem>\n                        <SelectItem value=\"Saguenay, QC\">Saguenay, QC</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            {/* Problem Summary */}\n            <FormField\n              control={form.control}\n              name=\"problemSummary\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Problem Summary</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Describe the issue or work needed...\"\n                      {...field}\n                      data-testid=\"textarea-wo-problem\"\n                      className=\"min-h-24\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <DialogFooter className=\"gap-2 flex justify-end\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  form.reset();\n                  onOpenChange(false);\n                }}\n              >\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={isSubmitting} data-testid=\"button-submit-wo\">\n                {isSubmitting ? \"Creating...\" : \"Create Work Order\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":10126},"client/src/pages/WorkOrderDetail.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ArrowLeft, CheckCircle, XCircle, Clock, PlayCircle, StopCircle, User, Edit2, Save, FileUp } from \"lucide-react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { WorkOrder, WorkOrderTask, TimePunch } from \"@shared/schema\";\n\ninterface WorkOrderWithDetails extends WorkOrder {\n  tasks?: WorkOrderTask[];\n  punches?: TimePunch[];\n}\n\nexport default function WorkOrderDetail() {\n  const { workOrderNumber } = useParams();\n  const [, setLocation] = useLocation();\n  const { data: user } = useAuth();\n  const { toast } = useToast();\n  const [isEditingNotes, setIsEditingNotes] = useState(false);\n  const [notesText, setNotesText] = useState(\"\");\n  const [uploadingPhoto, setUploadingPhoto] = useState(false);\n\n  const { data: workOrder, isLoading } = useQuery<WorkOrderWithDetails>({\n    queryKey: [\"/api/work-orders/number\", workOrderNumber],\n  });\n\n  const { data: currentPunch } = useQuery<TimePunch | null>({\n    queryKey: [\"/api/time-punches/current\"],\n  });\n\n  const { data: allPunches = [] } = useQuery<TimePunch[]>({\n    queryKey: [\"/api/work-orders\", workOrder?.id, \"punches\"],\n    enabled: !!workOrder?.id,\n  });\n\n  const { data: punchTechUser } = useQuery<{ username: string } | null>({\n    queryKey: [\"/api/users\", currentPunch?.userId],\n    enabled: !!currentPunch?.userId,\n  });\n\n  // Set notes text when workOrder loads\n  useEffect(() => {\n    if (workOrder?.notes && notesText === \"\") {\n      setNotesText(workOrder.notes);\n    }\n  }, [workOrder?.notes]);\n\n  const closeWorkOrderMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"PATCH\", `/api/work-orders/${workOrder?.id}/close`);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/assigned\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      toast({ \n        title: \"Work order closed\", \n        description: \"Efficiency and costs calculated\" \n      });\n    },\n  });\n\n  const updateNotesMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"PATCH\", `/api/work-orders/${workOrder?.id}/notes`, { notes: notesText });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      setIsEditingNotes(false);\n      toast({ title: \"Notes saved\" });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to save notes\",\n      });\n    },\n  });\n\n  const updatePhotosMutation = useMutation({\n    mutationFn: async (photos: string[]) => {\n      const res = await apiRequest(\"PATCH\", `/api/work-orders/${workOrder?.id}/photos`, { photos });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      toast({ title: \"Photo added successfully\" });\n      setUploadingPhoto(false);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to add photo\",\n      });\n      setUploadingPhoto(false);\n    },\n  });\n\n  const handlePhotoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setUploadingPhoto(true);\n    const formData = new FormData();\n    formData.append(\"photo\", file);\n\n    try {\n      const response = await fetch(\"/api/upload/photo\", {\n        method: \"POST\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to upload photo\");\n      }\n\n      const { filePath } = await response.json();\n      const newPhotos = [...(workOrder?.photos || []), filePath];\n      updatePhotosMutation.mutate(newPhotos);\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to upload photo\",\n      });\n      setUploadingPhoto(false);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[50vh]\">\n        <div className=\"text-muted-foreground\">Loading...</div>\n      </div>\n    );\n  }\n\n  if (!workOrder) {\n    return (\n      <div className=\"flex flex-col items-center justify-center min-h-[50vh] space-y-4\">\n        <XCircle className=\"h-16 w-16 text-muted-foreground\" />\n        <div className=\"text-xl font-semibold\">Work Order Not Found</div>\n        <Button onClick={() => setLocation(\"/work-orders\")} data-testid=\"button-back\">\n          <ArrowLeft className=\"mr-2 h-4 w-4\" />\n          Back to Work Orders\n        </Button>\n      </div>\n    );\n  }\n\n  const totalBudgetedHours = workOrder.tasks?.reduce((sum, task) => sum + task.budgetedHours, 0) || 0;\n  const isAssignedToMe = workOrder.assignedTo === user?.id;\n  const canPunchIn = isAssignedToMe && workOrder.status !== \"completed\";\n  const totalActualHours = allPunches\n    .filter(p => p.punchType === \"work\" && p.clockOut)\n    .reduce((sum, punch) => {\n      const hours = (new Date(punch.clockOut!).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n      return sum + hours;\n    }, 0);\n  const canClose = isAssignedToMe && workOrder.status !== \"completed\" && totalActualHours > 0;\n\n  return (\n    <div className=\"space-y-6 max-w-6xl mx-auto pb-6\">\n      {/* Header */}\n      <div className=\"flex items-center gap-4\">\n        <Button \n          variant=\"outline\" \n          onClick={() => setLocation(\"/work-orders\")}\n          data-testid=\"button-back-top\"\n        >\n          <ArrowLeft className=\"mr-2 h-4 w-4\" />\n          Back\n        </Button>\n        <div className=\"flex-1\">\n          <h1 className=\"text-3xl font-bold\" data-testid=\"text-wo-number\">{workOrder.workOrderNumber}</h1>\n          <p className=\"text-muted-foreground\">{workOrder.title}</p>\n        </div>\n        <Badge \n          variant={\n            workOrder.status === \"completed\" ? \"default\" : \n            workOrder.status === \"in-progress\" ? \"default\" : \n            \"secondary\"\n          }\n          data-testid=\"badge-status\"\n        >\n          {workOrder.status}\n        </Badge>\n        <Badge \n          variant={\n            workOrder.priority === \"Urgent\" ? \"destructive\" : \n            workOrder.priority === \"High\" ? \"default\" : \n            \"outline\"\n          }\n        >\n          {workOrder.priority}\n        </Badge>\n      </div>\n\n      {/* Active Punch Display */}\n      {currentPunch && currentPunch.workOrderId === workOrder.id && currentPunch.punchType === \"work\" && (\n        <Card className=\"border-green-300 dark:border-green-700 bg-green-50 dark:bg-green-950\">\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-2 w-2 bg-green-500 rounded-full animate-pulse\"></div>\n                <p className=\"font-semibold text-green-900 dark:text-green-100\">Currently Working</p>\n              </div>\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm\">\n                <div>\n                  <p className=\"text-muted-foreground\">Technician</p>\n                  <p className=\"font-medium flex items-center gap-1\">\n                    <User className=\"h-4 w-4\" />\n                    {punchTechUser?.username || \"Loading...\"}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-muted-foreground\">Punched In</p>\n                  <p className=\"font-medium\">{new Date(currentPunch.clockIn).toLocaleTimeString()}</p>\n                </div>\n                <div>\n                  <p className=\"text-muted-foreground\">Duration</p>\n                  <p className=\"font-medium\">\n                    {(() => {\n                      const now = new Date();\n                      const start = new Date(currentPunch.clockIn);\n                      const minutes = Math.floor((now.getTime() - start.getTime()) / (1000 * 60));\n                      const hours = Math.floor(minutes / 60);\n                      const mins = minutes % 60;\n                      return `${hours}h ${mins}m`;\n                    })()}\n                  </p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Close Button */}\n      {canClose && (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <Button\n              onClick={() => closeWorkOrderMutation.mutate()}\n              disabled={closeWorkOrderMutation.isPending}\n              variant=\"default\"\n              size=\"lg\"\n              className=\"w-full\"\n              data-testid=\"button-close-wo\"\n            >\n              <CheckCircle className=\"mr-2 h-5 w-5\" />\n              {closeWorkOrderMutation.isPending ? \"Closing...\" : \"Close Work Order & Calculate Efficiency\"}\n            </Button>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Work Order Info */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Work Order Information</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Customer</p>\n              <p className=\"font-medium\" data-testid=\"text-customer\">{workOrder.customer}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Department</p>\n              <p className=\"font-medium\">{workOrder.department}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Headquarters</p>\n              <p className=\"font-medium\">{workOrder.headquarters}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Site Address</p>\n              <p className=\"font-medium\">{workOrder.siteAddress}</p>\n            </div>\n            <div className=\"col-span-2\">\n              <p className=\"text-sm text-muted-foreground\">Asset</p>\n              <p className=\"font-medium\" data-testid=\"text-asset\">{workOrder.asset}</p>\n            </div>\n          </div>\n\n          <Separator />\n\n          <div>\n            <p className=\"text-sm text-muted-foreground mb-2\">Problem Summary</p>\n            <p className=\"text-sm\" data-testid=\"text-problem\">{workOrder.problemSummary}</p>\n          </div>\n\n          <Separator />\n\n          {/* Notes & Attachments Section */}\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center justify-between\">\n              <p className=\"text-sm font-semibold\">Notes & Attachments</p>\n              {!isEditingNotes && (\n                <Button\n                  size=\"sm\"\n                  variant=\"ghost\"\n                  className=\"h-6 w-6 p-0\"\n                  onClick={() => setIsEditingNotes(true)}\n                  data-testid=\"button-edit-wo-notes\"\n                >\n                  <Edit2 className=\"h-3 w-3\" />\n                </Button>\n              )}\n            </div>\n\n            {/* Photos Display */}\n            {workOrder.photos && workOrder.photos.length > 0 && (\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 mb-3\">\n                {workOrder.photos.map((photo, index) => (\n                  <img\n                    key={index}\n                    src={photo}\n                    alt={`Work order photo ${index + 1}`}\n                    className=\"w-full h-32 object-cover rounded-md border\"\n                    data-testid={`img-wo-photo-${index}`}\n                  />\n                ))}\n              </div>\n            )}\n\n            {isEditingNotes ? (\n              <div className=\"space-y-2 bg-muted/30 p-3 rounded-md\">\n                <Textarea\n                  placeholder=\"Add notes or comments...\"\n                  value={notesText}\n                  onChange={(e) => setNotesText(e.target.value)}\n                  className=\"min-h-24 text-sm\"\n                  data-testid=\"textarea-wo-notes\"\n                />\n\n                <div className=\"flex gap-2 flex-wrap\">\n                  <label className=\"relative\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      disabled={uploadingPhoto}\n                      asChild\n                      data-testid=\"button-wo-upload-photo\"\n                    >\n                      <span>\n                        <FileUp className=\"h-3 w-3 mr-1\" />\n                        {uploadingPhoto ? \"Uploading...\" : \"Add Photo\"}\n                      </span>\n                    </Button>\n                    <input\n                      type=\"file\"\n                      accept=\"image/*\"\n                      onChange={handlePhotoUpload}\n                      disabled={uploadingPhoto}\n                      className=\"hidden\"\n                      data-testid=\"input-wo-photo\"\n                    />\n                  </label>\n\n                  <Button\n                    size=\"sm\"\n                    onClick={() => updateNotesMutation.mutate()}\n                    disabled={updateNotesMutation.isPending}\n                    data-testid=\"button-save-wo-notes\"\n                  >\n                    <Save className=\"h-3 w-3 mr-1\" />\n                    Save\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"outline\"\n                    onClick={() => {\n                      setIsEditingNotes(false);\n                      setNotesText(workOrder?.notes || \"\");\n                    }}\n                    data-testid=\"button-cancel-wo-notes\"\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <p className=\"text-xs text-muted-foreground py-2 min-h-6 whitespace-pre-wrap bg-muted/10 p-3 rounded-md\">\n                {workOrder.notes || \"No notes yet. Click edit to add notes or attach photos.\"}\n              </p>\n            )}\n          </div>\n\n          <Separator />\n\n          <div className=\"grid grid-cols-3 gap-4 text-center\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Budgeted Hours</p>\n              <p className=\"text-2xl font-bold\">{totalBudgetedHours.toFixed(1)}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Actual Hours</p>\n              <p className=\"text-2xl font-bold\">{totalActualHours.toFixed(1)}</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Efficiency</p>\n              <p className=\"text-2xl font-bold\">\n                {totalActualHours > 0 ? `${(totalBudgetedHours / totalActualHours * 100).toFixed(0)}%` : \"-\"}\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Tasks with Time Punching */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Tasks & Time Tracking</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {workOrder.tasks?.map((task, index) => (\n            <TaskCard\n              key={task.id}\n              task={task}\n              index={index}\n              workOrderId={workOrder.id}\n              workOrderNumber={workOrder.workOrderNumber}\n              punches={allPunches}\n              currentPunch={currentPunch ?? null}\n              canPunchIn={canPunchIn}\n            />\n          ))}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\ninterface TaskCardProps {\n  task: WorkOrderTask;\n  index: number;\n  workOrderId: string;\n  workOrderNumber: string;\n  punches: TimePunch[];\n  currentPunch: TimePunch | null;\n  canPunchIn: boolean;\n}\n\nfunction TaskCard({\n  task,\n  index,\n  workOrderId,\n  workOrderNumber,\n  punches,\n  currentPunch,\n  canPunchIn,\n}: TaskCardProps) {\n  const { toast } = useToast();\n\n  const taskPunches = punches.filter(p => p.taskId === task.id);\n  const isPunchedIntoTask = currentPunch?.taskId === task.id;\n  \n  const totalHours = taskPunches.reduce((sum, punch) => {\n    if (punch.clockOut && punch.punchType === \"work\") {\n      const hours = (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n      return sum + hours;\n    }\n    return sum;\n  }, 0);\n\n  const punchInMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", `/api/tasks/${task.id}/punch`, { workOrderId });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrderId, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      toast({ title: \"Punched in\", description: `Started: ${task.title}` });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const punchOutMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", `/api/tasks/${task.id}/punch`, { workOrderId });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrderId, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      toast({ title: \"Punched out\", description: `Stopped: ${task.title}` });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n\n  return (\n    <Card>\n      <CardHeader className=\"pb-4\">\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2\">\n              <CardTitle className=\"text-lg\">Task {index + 1}: {task.title}</CardTitle>\n            </div>\n            {task.description && (\n              <p className=\"text-sm text-muted-foreground mt-1\">{task.description}</p>\n            )}\n          </div>\n          <div className=\"space-y-3 text-right\">\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Budgeted</p>\n              <p className=\"text-lg font-semibold\">{task.budgetedHours.toFixed(1)}h</p>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Remaining</p>\n              <p className=\"text-lg font-semibold\" data-testid={`text-time-remaining-${index}`}>\n                {Math.max(0, task.budgetedHours - totalHours).toFixed(1)}h\n              </p>\n            </div>\n            {totalHours > 0 && (\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Efficiency</p>\n                <p className={`text-lg font-semibold ${\n                  (task.budgetedHours / totalHours) * 100 >= 100 ? 'text-green-600' :\n                  (task.budgetedHours / totalHours) * 100 >= 80 ? 'text-yellow-600' :\n                  'text-red-600'\n                }`} data-testid={`text-efficiency-${index}`}>\n                  {((task.budgetedHours / totalHours) * 100).toFixed(0)}%\n                </p>\n              </div>\n            )}\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {/* Punch Controls */}\n        {canPunchIn && (\n          <div className=\"flex items-center gap-2\">\n            <Button\n              onClick={() => isPunchedIntoTask ? punchOutMutation.mutate() : punchInMutation.mutate()}\n              disabled={punchInMutation.isPending || punchOutMutation.isPending || (!!currentPunch && !isPunchedIntoTask)}\n              variant={isPunchedIntoTask ? \"destructive\" : \"default\"}\n              size=\"lg\"\n              className=\"flex-1\"\n              data-testid={`button-punch-task-${index}`}\n            >\n              {isPunchedIntoTask ? (\n                <>\n                  <StopCircle className=\"mr-2 h-5 w-5\" />\n                  Stop Task\n                </>\n              ) : (\n                <>\n                  <PlayCircle className=\"mr-2 h-5 w-5\" />\n                  Start Task\n                </>\n              )}\n            </Button>\n          </div>\n        )}\n\n        {/* Time Summary */}\n        <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n          <div className=\"flex items-center gap-2\">\n            <Clock className=\"h-4 w-4 text-muted-foreground\" />\n            <span className=\"text-sm font-medium\">Total Time Worked:</span>\n          </div>\n          <span className=\"text-lg font-bold\">{totalHours.toFixed(2)} hours</span>\n        </div>\n\n        {/* Time Entries */}\n        {taskPunches.filter(p => p.punchType === \"work\").length > 0 && (\n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-medium text-muted-foreground\">Time Entries</p>\n            <div className=\"space-y-1\">\n              {taskPunches\n                .filter(p => p.punchType === \"work\")\n                .map((punch) => {\n                  const start = new Date(punch.clockIn);\n                  const end = punch.clockOut ? new Date(punch.clockOut) : null;\n                  const duration = end\n                    ? ((end.getTime() - start.getTime()) / (1000 * 60 * 60)).toFixed(2)\n                    : \"In progress\";\n\n                  return (\n                    <div\n                      key={punch.id}\n                      className=\"flex items-center justify-between p-2 border rounded text-sm\"\n                      data-testid={`punch-entry-${punch.id}`}\n                    >\n                      <span>\n                        {start.toLocaleTimeString()} - {end ? end.toLocaleTimeString() : \"Now\"}\n                      </span>\n                      <Badge variant=\"outline\">{duration}h</Badge>\n                    </div>\n                  );\n                })}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":23211},"client/src/components/DemandForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Upload, X, Image as ImageIcon, Check, ChevronsUpDown, Loader2 } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { cn } from \"@/lib/utils\";\nimport hexBg from \"@assets/IMG_6738_1763322726659.jpeg\";\n\nconst demandSchema = z.object({\n  title: z.string().min(1, \"Title is required\"),\n  priority: z.enum([\"Normal\", \"High\", \"Urgent\"]),\n  department: z.enum([\n    \"Road Technician\",\n    \"Garage Technician\",\n    \"Sales\",\n    \"Tech Advisor\",\n    \"Accounting\",\n    \"HR\",\n  ]),\n  headquarters: z.enum([\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"]),\n  customer: z.string().min(1, \"Customer is required\"),\n  siteAddress: z.string().min(1, \"Site address is required\"),\n  asset: z.string().min(1, \"Asset is required\"),\n  problemSummary: z.string().min(1, \"Problem summary is required\"),\n  demandedBy: z.string().min(1, \"Please select a technical advisor\"),\n  photos: z.array(z.string()).optional(),\n});\n\ntype FormData = z.infer<typeof demandSchema>;\n\ninterface DemandFormProps {\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n  isEmbedded?: boolean;\n}\n\ninterface FormContentProps {\n  form: any;\n  isSubmitting: boolean;\n  isUploading: boolean;\n  uploadedPhotos: string[];\n  advisors: Array<{ id: string; username: string; email?: string }> | undefined;\n  isLoadingAdvisors: boolean;\n  handleFileSelect: (e: React.ChangeEvent<HTMLInputElement>) => void;\n  removePhoto: (index: number) => void;\n  openAdvisorSelect: boolean;\n  setOpenAdvisorSelect: (open: boolean) => void;\n}\n\nconst FormContent = ({\n  form,\n  isSubmitting,\n  isUploading,\n  uploadedPhotos,\n  advisors,\n  isLoadingAdvisors,\n  handleFileSelect,\n  removePhoto,\n  openAdvisorSelect,\n  setOpenAdvisorSelect,\n}: FormContentProps) => (\n  <>\n    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n      <FormField\n        control={form.control}\n        name=\"title\"\n        render={({ field }) => (\n          <FormItem className=\"md:col-span-2\">\n            <FormLabel>Title</FormLabel>\n            <FormControl>\n              <Input placeholder=\"Short issue title\" {...field} data-testid=\"input-demand-title\" />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"priority\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Priority</FormLabel>\n            <Select onValueChange={field.onChange} defaultValue={field.value}>\n              <FormControl>\n                <SelectTrigger data-testid=\"select-demand-priority\">\n                  <SelectValue />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value=\"Normal\">Normal</SelectItem>\n                <SelectItem value=\"High\">High</SelectItem>\n                <SelectItem value=\"Urgent\">Urgent</SelectItem>\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"department\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Department</FormLabel>\n            <Select onValueChange={field.onChange} defaultValue={field.value}>\n              <FormControl>\n                <SelectTrigger data-testid=\"select-demand-department\">\n                  <SelectValue />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value=\"Road Technician\">Road Technician</SelectItem>\n                <SelectItem value=\"Garage Technician\">Garage Technician</SelectItem>\n                <SelectItem value=\"Sales\">Sales</SelectItem>\n                <SelectItem value=\"Tech Advisor\">Tech Advisor</SelectItem>\n                <SelectItem value=\"Accounting\">Accounting</SelectItem>\n                <SelectItem value=\"HR\">HR</SelectItem>\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"headquarters\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Headquarters</FormLabel>\n            <Select onValueChange={field.onChange} defaultValue={field.value}>\n              <FormControl>\n                <SelectTrigger data-testid=\"select-demand-headquarters\">\n                  <SelectValue />\n                </SelectTrigger>\n              </FormControl>\n              <SelectContent>\n                <SelectItem value=\"Montreal, QC\">Montreal, QC</SelectItem>\n                <SelectItem value=\"Quebec, QC\">Quebec, QC</SelectItem>\n                <SelectItem value=\"Saguenay, QC\">Saguenay, QC</SelectItem>\n              </SelectContent>\n            </Select>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"customer\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Customer / Company</FormLabel>\n            <FormControl>\n              <Input placeholder=\"Company name\" {...field} data-testid=\"input-demand-customer\" />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"siteAddress\"\n        render={({ field }) => (\n          <FormItem>\n            <FormLabel>Site Address</FormLabel>\n            <FormControl>\n              <Input placeholder=\"Address\" {...field} data-testid=\"input-demand-address\" />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"asset\"\n        render={({ field }) => (\n          <FormItem className=\"md:col-span-2\">\n            <FormLabel>Asset</FormLabel>\n            <FormControl>\n              <Input placeholder=\"Equipment/Asset\" {...field} data-testid=\"input-demand-asset\" />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"demandedBy\"\n        render={({ field }) => (\n          <FormItem className=\"md:col-span-2\">\n            <FormLabel>Send to Technical Advisor</FormLabel>\n            <Popover open={openAdvisorSelect} onOpenChange={setOpenAdvisorSelect}>\n              <PopoverTrigger asChild>\n                <FormControl>\n                  <Button\n                    variant=\"outline\"\n                    role=\"combobox\"\n                    aria-expanded={openAdvisorSelect}\n                    className={cn(\n                      \"w-full justify-between\",\n                      !field.value && \"text-muted-foreground\"\n                    )}\n                    data-testid=\"select-demand-advisor\"\n                  >\n                    {field.value\n                      ? advisors?.find((advisor) => advisor.id === field.value)?.username\n                      : \"Select a technical advisor\"}\n                    <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n                  </Button>\n                </FormControl>\n              </PopoverTrigger>\n              <PopoverContent className=\"w-[400px] p-0\">\n                <Command>\n                  <CommandInput placeholder=\"Search advisors...\" data-testid=\"input-search-advisors\" />\n                  <CommandList>\n                    {isLoadingAdvisors ? (\n                      <div className=\"p-2 text-sm text-muted-foreground\">Loading advisors...</div>\n                    ) : advisors && advisors.length > 0 ? (\n                      <CommandGroup>\n                        {advisors.map((advisor: { id: string; username: string; email?: string }) => (\n                          <CommandItem\n                            key={advisor.id}\n                            value={advisor.username}\n                            onSelect={() => {\n                              form.setValue(\"demandedBy\", advisor.id);\n                              setOpenAdvisorSelect(false);\n                            }}\n                            data-testid={`advisor-option-${advisor.id}`}\n                          >\n                            <Check\n                              className={cn(\n                                \"mr-2 h-4 w-4\",\n                                advisor.id === field.value ? \"opacity-100\" : \"opacity-0\"\n                              )}\n                            />\n                            {advisor.username}\n                          </CommandItem>\n                        ))}\n                      </CommandGroup>\n                    ) : (\n                      <CommandEmpty>No advisor found.</CommandEmpty>\n                    )}\n                  </CommandList>\n                </Command>\n              </PopoverContent>\n            </Popover>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n\n      <FormField\n        control={form.control}\n        name=\"problemSummary\"\n        render={({ field }) => (\n          <FormItem className=\"md:col-span-2\">\n            <FormLabel>Problem Summary</FormLabel>\n            <FormControl>\n              <Textarea \n                placeholder=\"What's wrong? Visible symptoms, codes, hazards, access notes...\" \n                className=\"min-h-24\"\n                {...field} \n                data-testid=\"input-demand-problem-summary\"\n              />\n            </FormControl>\n            <FormMessage />\n          </FormItem>\n        )}\n      />\n    </div>\n\n    <div className=\"space-y-4\">\n      <div>\n        <h3 className=\"text-lg font-semibold mb-2\">Photos (Optional)</h3>\n        <p className=\"text-sm text-muted-foreground mb-3\">\n          Attach photos to help identify the problem\n        </p>\n        \n        <div className=\"space-y-3\">\n          {uploadedPhotos.length > 0 && (\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n              {uploadedPhotos.map((photo: string, index: number) => (\n                <div key={index} className=\"relative group\">\n                  <img\n                    src={photo}\n                    alt={`Upload ${index + 1}`}\n                    className=\"w-full h-32 object-cover rounded-md border\"\n                    data-testid={`photo-preview-${index}`}\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"destructive\"\n                    size=\"icon\"\n                    className=\"absolute top-1 right-1 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity\"\n                    onClick={() => removePhoto(index)}\n                    data-testid={`button-remove-photo-${index}`}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n          )}\n\n          <div>\n            <input\n              type=\"file\"\n              id=\"photo-upload\"\n              multiple\n              accept=\"image/*\"\n              className=\"hidden\"\n              onChange={handleFileSelect}\n              disabled={isUploading}\n            />\n            <label htmlFor=\"photo-upload\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                disabled={isUploading}\n                onClick={() => document.getElementById('photo-upload')?.click()}\n                data-testid=\"button-upload-photos\"\n              >\n                {isUploading ? (\n                  <>\n                    <Upload className=\"h-4 w-4 mr-2 animate-spin\" />\n                    Uploading...\n                  </>\n                ) : (\n                  <>\n                    <ImageIcon className=\"h-4 w-4 mr-2\" />\n                    Add Photos\n                  </>\n                )}\n              </Button>\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n  </>\n);\n\nexport function DemandForm({ open = false, onOpenChange, isEmbedded = false }: DemandFormProps) {\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [uploadedPhotos, setUploadedPhotos] = useState<string[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const [openAdvisorSelect, setOpenAdvisorSelect] = useState(false);\n\n  const { data: advisors, isLoading: isLoadingAdvisors } = useQuery<Array<{id: string; username: string; email?: string}>>({\n    queryKey: [\"/api/users/technical-advisors\"],\n    enabled: isEmbedded || open,\n  });\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(demandSchema),\n    defaultValues: {\n      title: \"\",\n      priority: \"Normal\",\n      department: \"Road Technician\",\n      headquarters: \"Montreal, QC\",\n      customer: \"\",\n      siteAddress: \"\",\n      asset: \"\",\n      problemSummary: \"\",\n      demandedBy: \"\",\n    },\n  });\n\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    setIsUploading(true);\n    const newPhotos: string[] = [];\n\n    try {\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        const formData = new FormData();\n        formData.append('photo', file);\n\n        const response = await fetch('/api/upload/photo', {\n          method: 'POST',\n          body: formData,\n          credentials: 'include',\n        });\n\n        if (!response.ok) {\n          const error = await response.json();\n          throw new Error(error.message || 'Upload failed');\n        }\n\n        const data = await response.json();\n        newPhotos.push(data.filePath);\n      }\n\n      setUploadedPhotos([...uploadedPhotos, ...newPhotos]);\n      toast({\n        title: \"Photos uploaded\",\n        description: `${newPhotos.length} photo(s) added successfully`,\n      });\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Upload failed\",\n        description: error.message || \"Failed to upload photos\",\n      });\n    } finally {\n      setIsUploading(false);\n      e.target.value = '';\n    }\n  };\n\n  const removePhoto = (index: number) => {\n    setUploadedPhotos(uploadedPhotos.filter((_, i) => i !== index));\n  };\n\n  const onSubmit = async (data: FormData) => {\n    setIsSubmitting(true);\n    try {\n      await apiRequest(\"POST\", \"/api/work-orders/demands\", {\n        ...data,\n        advisorId: data.demandedBy,\n        photos: uploadedPhotos.length > 0 ? uploadedPhotos : undefined,\n      });\n\n      toast({\n        title: \"Work order demand created\",\n        description: \"Your demand has been sent to the technical advisor for review.\",\n      });\n\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      form.reset();\n      setUploadedPhotos([]);\n      if (onOpenChange) onOpenChange(false);\n    } catch (error: any) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to create work order demand\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  if (isEmbedded) {\n    return (\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <FormContent\n            form={form}\n            isSubmitting={isSubmitting}\n            isUploading={isUploading}\n            uploadedPhotos={uploadedPhotos}\n            advisors={advisors}\n            isLoadingAdvisors={isLoadingAdvisors}\n            handleFileSelect={handleFileSelect}\n            removePhoto={removePhoto}\n            openAdvisorSelect={openAdvisorSelect}\n            setOpenAdvisorSelect={setOpenAdvisorSelect}\n          />\n          <Button\n            type=\"submit\"\n            disabled={isSubmitting}\n            className=\"w-full\"\n            data-testid=\"button-submit-demand\"\n          >\n            {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n            Submit Demand\n          </Button>\n        </form>\n      </Form>\n    );\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n        <div \n          className=\"absolute inset-0 opacity-5 pointer-events-none\"\n          style={{ backgroundImage: `url(${hexBg})`, backgroundSize: 'cover' }}\n        />\n        <DialogHeader className=\"relative z-10\">\n          <DialogTitle className=\"text-2xl font-bold bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 bg-clip-text text-transparent\">\n            Request Work Order\n          </DialogTitle>\n          <DialogDescription>\n            Describe the service issue and attach photos. A technical advisor will review your request.\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6 relative z-10\">\n            <FormContent\n              form={form}\n              isSubmitting={isSubmitting}\n              isUploading={isUploading}\n              uploadedPhotos={uploadedPhotos}\n              advisors={advisors}\n              isLoadingAdvisors={isLoadingAdvisors}\n              handleFileSelect={handleFileSelect}\n              removePhoto={removePhoto}\n              openAdvisorSelect={openAdvisorSelect}\n              setOpenAdvisorSelect={setOpenAdvisorSelect}\n            />\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => {\n                  onOpenChange?.(false);\n                  form.reset();\n                  setUploadedPhotos([]);\n                }}\n                disabled={isSubmitting || isUploading}\n                data-testid=\"button-demand-cancel\"\n              >\n                Cancel\n              </Button>\n              <Button\n                type=\"submit\"\n                disabled={isSubmitting || isUploading}\n                className=\"bg-gradient-to-r from-cyan-500 via-purple-500 to-pink-500 hover:from-cyan-600 hover:via-purple-600 hover:to-pink-600\"\n                data-testid=\"button-demand-submit\"\n              >\n                {isSubmitting ? \"Submitting...\" : \"Submit Request\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":19338},"client/src/components/TaskTimePunches.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Clock, PlayCircle, PauseCircle, Edit2, Save, X, Trash2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { WorkOrderTask, TimePunch } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\ninterface TaskWithTimePunchesProps {\n  task: WorkOrderTask;\n  index: number;\n  workOrderId: string;\n  workOrderNumber: string;\n  punches: TimePunch[];\n  currentPunch: TimePunch | null;\n  canPunchIn: boolean;\n}\n\nexport function TaskWithTimePunches({\n  task,\n  index,\n  workOrderId,\n  workOrderNumber,\n  punches,\n  currentPunch,\n  canPunchIn,\n}: TaskWithTimePunchesProps) {\n  const { toast } = useToast();\n  const [editingPunch, setEditingPunch] = useState<TimePunch | null>(null);\n  const [editClockIn, setEditClockIn] = useState(\"\");\n  const [editClockOut, setEditClockOut] = useState(\"\");\n\n  const taskPunches = punches.filter(p => p.taskId === task.id);\n  const isPunchedIntoTask = currentPunch?.taskId === task.id;\n  \n  const totalHours = taskPunches.reduce((sum, punch) => {\n    if (punch.clockOut && punch.punchType === \"work\") {\n      const hours = (new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60);\n      return sum + hours;\n    }\n    return sum;\n  }, 0);\n\n  const punchInMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", `/api/tasks/${task.id}/punch`, {\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ workOrderId }),\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrderId, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      toast({ title: \"Punched in\", description: `Started working on: ${task.title}` });\n    },\n  });\n\n  const punchOutMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", `/api/tasks/${task.id}/punch`, {\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ workOrderId }),\n      });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrderId, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      toast({ title: \"Punched out\", description: `Finished working on: ${task.title}` });\n    },\n  });\n\n  const updatePunchMutation = useMutation({\n    mutationFn: async ({ punchId, clockIn, clockOut }: { punchId: string; clockIn: string; clockOut?: string }) => {\n      const res = await apiRequest(\"PATCH\", `/api/time-punches/${punchId}`, { clockIn, clockOut });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrderId, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      toast({ title: \"Time updated\", description: \"Time punch has been updated successfully\" });\n      setEditingPunch(null);\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deletePunchMutation = useMutation({\n    mutationFn: async (punchId: string) => {\n      await apiRequest(\"DELETE\", `/api/time-punches/${punchId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/number\", workOrderNumber] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\", workOrderId, \"punches\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      toast({ title: \"Time deleted\", description: \"Time punch has been removed\" });\n    },\n  });\n\n\n  const handleEditPunch = (punch: TimePunch) => {\n    setEditingPunch(punch);\n    setEditClockIn(formatDateTimeLocal(new Date(punch.clockIn)));\n    setEditClockOut(punch.clockOut ? formatDateTimeLocal(new Date(punch.clockOut)) : \"\");\n  };\n\n  const handleSaveEdit = () => {\n    if (!editingPunch) return;\n    \n    updatePunchMutation.mutate({\n      punchId: editingPunch.id,\n      clockIn: editClockIn,\n      clockOut: editClockOut || undefined,\n    });\n  };\n\n  const formatDateTimeLocal = (date: Date) => {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    return `${year}-${month}-${day}T${hours}:${minutes}`;\n  };\n\n  return (\n    <Card>\n      <CardContent className=\"pt-4 space-y-3\">\n        {/* Task Header */}\n        <div className=\"flex items-start justify-between gap-4\">\n          <div className=\"flex-1\">\n            <p className=\"font-medium\">{index + 1}. {task.title}</p>\n            {task.description && (\n              <p className=\"text-sm text-muted-foreground mt-1\">{task.description}</p>\n            )}\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"outline\">\n              <Clock className=\"mr-1 h-3 w-3\" />\n              {task.budgetedHours}h budget\n            </Badge>\n            {totalHours > 0 && (\n              <Badge variant=\"secondary\">\n                {totalHours.toFixed(2)}h actual\n              </Badge>\n            )}\n          </div>\n        </div>\n\n        {/* Punch In/Out Button and Lunch Break */}\n        {canPunchIn && (\n          <div className=\"flex gap-2\">\n            {!isPunchedIntoTask ? (\n              <Button\n                size=\"sm\"\n                onClick={() => punchInMutation.mutate()}\n                disabled={punchInMutation.isPending || !!currentPunch}\n                data-testid={`button-punch-in-task-${task.id}`}\n                title={currentPunch && !isPunchedIntoTask ? \"Clock out of current task first\" : \"\"}\n              >\n                <PlayCircle className=\"mr-2 h-4 w-4\" />\n                {punchInMutation.isPending ? \"Punching in...\" : currentPunch ? \"Clock Out First\" : \"Start Task\"}\n              </Button>\n            ) : (\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => punchOutMutation.mutate()}\n                disabled={punchOutMutation.isPending}\n                data-testid={`button-punch-out-task-${task.id}`}\n              >\n                <PauseCircle className=\"mr-2 h-4 w-4\" />\n                {punchOutMutation.isPending ? \"Punching out...\" : \"Stop Task\"}\n              </Button>\n            )}\n          </div>\n        )}\n\n        {/* Time Punches List */}\n        {taskPunches.length > 0 && (\n          <div className=\"space-y-2 pt-2 border-t\">\n            <p className=\"text-sm font-medium text-muted-foreground\">Time Entries</p>\n            {taskPunches.map((punch) => (\n              <div\n                key={punch.id}\n                className=\"flex items-center justify-between text-sm bg-muted/50 p-2 rounded-md\"\n              >\n                <div className=\"flex-1 flex items-center gap-2\">\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium\">\n                      {new Date(punch.clockIn).toLocaleString()}\n                    </p>\n                    {punch.clockOut ? (\n                      <p className=\"text-muted-foreground\">\n                        to {new Date(punch.clockOut).toLocaleString()}\n                      </p>\n                    ) : (\n                      <p className=\"text-primary font-medium\">In Progress</p>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  {punch.clockOut && (\n                    <Badge variant=\"outline\">\n                      {((new Date(punch.clockOut).getTime() - new Date(punch.clockIn).getTime()) / (1000 * 60 * 60)).toFixed(2)}h\n                    </Badge>\n                  )}\n                  {canPunchIn && punch.punchType === \"work\" && (\n                    <>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => handleEditPunch(punch)}\n                        data-testid={`button-edit-punch-${punch.id}`}\n                      >\n                        <Edit2 className=\"h-3 w-3\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => deletePunchMutation.mutate(punch.id)}\n                        disabled={deletePunchMutation.isPending}\n                        data-testid={`button-delete-punch-${punch.id}`}\n                      >\n                        <Trash2 className=\"h-3 w-3 text-destructive\" />\n                      </Button>\n                    </>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* Edit Dialog */}\n        <Dialog open={!!editingPunch} onOpenChange={() => setEditingPunch(null)}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Edit Time Punch</DialogTitle>\n              <DialogDescription>\n                Adjust the clock in and clock out times for this time entry.\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4 py-4\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Clock In</label>\n                <Input\n                  type=\"datetime-local\"\n                  value={editClockIn}\n                  onChange={(e) => setEditClockIn(e.target.value)}\n                  data-testid=\"input-edit-clock-in\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Clock Out</label>\n                <Input\n                  type=\"datetime-local\"\n                  value={editClockOut}\n                  onChange={(e) => setEditClockOut(e.target.value)}\n                  data-testid=\"input-edit-clock-out\"\n                />\n              </div>\n            </div>\n            <DialogFooter>\n              <Button\n                variant=\"outline\"\n                onClick={() => setEditingPunch(null)}\n                data-testid=\"button-cancel-edit\"\n              >\n                <X className=\"mr-2 h-4 w-4\" />\n                Cancel\n              </Button>\n              <Button\n                onClick={handleSaveEdit}\n                disabled={updatePunchMutation.isPending}\n                data-testid=\"button-save-edit\"\n              >\n                <Save className=\"mr-2 h-4 w-4\" />\n                {updatePunchMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":12302},"server/upload.ts":{"content":"import multer from 'multer';\nimport path from 'path';\nimport { randomBytes } from 'crypto';\n\nconst storage = multer.diskStorage({\n  destination: (req, file, cb) => {\n    cb(null, 'uploads/work-orders');\n  },\n  filename: (req, file, cb) => {\n    const uniqueSuffix = randomBytes(8).toString('hex');\n    const ext = path.extname(file.originalname);\n    cb(null, `wo-${Date.now()}-${uniqueSuffix}${ext}`);\n  },\n});\n\nconst fileFilter = (req: any, file: Express.Multer.File, cb: multer.FileFilterCallback) => {\n  const allowedTypes = /jpeg|jpg|png|gif|webp/;\n  const extname = allowedTypes.test(path.extname(file.originalname).toLowerCase());\n  const mimetype = allowedTypes.test(file.mimetype);\n\n  if (extname && mimetype) {\n    cb(null, true);\n  } else {\n    cb(new Error('Only image files are allowed (jpeg, jpg, png, gif, webp)'));\n  }\n};\n\nexport const upload = multer({\n  storage,\n  fileFilter,\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB max file size\n  },\n});\n","size_bytes":970},"server/email.ts":{"content":"import { Resend } from 'resend';\n\nconst resend = process.env.RESEND_API_KEY ? new Resend(process.env.RESEND_API_KEY) : null;\n\nexport interface SendWorkOrderDemandEmailParams {\n  to: string;\n  technician: string;\n  workOrderNumber: string;\n  title: string;\n  priority: string;\n  customer: string;\n  asset: string;\n  problemSummary: string;\n}\n\nexport interface SendWorkOrderAssignmentEmailParams {\n  to: string;\n  assignedTo: string;\n  workOrderNumber: string;\n  title: string;\n  priority: string;\n  customer: string;\n  asset: string;\n}\n\nexport async function sendWorkOrderDemandEmail(params: SendWorkOrderDemandEmailParams) {\n  if (!resend) {\n    console.log('Resend API key not configured. Email would have been sent to:', params.to);\n    return { id: 'mock-email-id' };\n  }\n  \n  try {\n    const { data, error } = await resend.emails.send({\n      from: 'ELEVEX ERP <onboarding@resend.dev>',\n      to: params.to,\n      subject: `New Work Order Demand: ${params.workOrderNumber} - ${params.title}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <style>\n              body {\n                font-family: Arial, sans-serif;\n                line-height: 1.6;\n                color: #333;\n              }\n              .container {\n                max-width: 600px;\n                margin: 0 auto;\n                padding: 20px;\n              }\n              .header {\n                background: linear-gradient(135deg, #8ACCD5 0%, #8E7DBE 50%, #FF90BB 100%);\n                color: white;\n                padding: 20px;\n                border-radius: 8px 8px 0 0;\n              }\n              .content {\n                background: #f9f9f9;\n                padding: 20px;\n                border: 1px solid #ddd;\n                border-radius: 0 0 8px 8px;\n              }\n              .field {\n                margin-bottom: 15px;\n              }\n              .label {\n                font-weight: bold;\n                color: #555;\n              }\n              .priority-badge {\n                display: inline-block;\n                padding: 4px 12px;\n                border-radius: 4px;\n                font-weight: bold;\n                font-size: 12px;\n                text-transform: uppercase;\n              }\n            </style>\n          </head>\n          <body>\n            <div class=\"container\">\n              <div class=\"header\">\n                <h1>New Work Order Demand</h1>\n                <p>A technician has submitted a new work order demand that requires your attention.</p>\n              </div>\n              <div class=\"content\">\n                <div class=\"field\">\n                  <span class=\"label\">Work Order:</span> ${params.workOrderNumber}\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Title:</span> ${params.title}\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Priority:</span>\n                  <span class=\"priority-badge\" style=\"background: ${\n                    params.priority === 'Urgent' ? '#ef4444' : \n                    params.priority === 'High' ? '#f97316' : '#3b82f6'\n                  }; color: white;\">${params.priority}</span>\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Submitted by:</span> ${params.technician}\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Customer:</span> ${params.customer}\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Asset:</span> ${params.asset}\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Problem Summary:</span>\n                  <p>${params.problemSummary}</p>\n                </div>\n                <p style=\"margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 14px;\">\n                  Please review this demand in the ELEVEX ERP system and convert it to a full work order with tasks and budget allocation.\n                </p>\n              </div>\n            </div>\n          </body>\n        </html>\n      `,\n    });\n\n    if (error) {\n      console.error('Failed to send email:', error);\n      throw error;\n    }\n\n    console.log('Email sent successfully:', data);\n    return data;\n  } catch (error) {\n    console.error('Error sending email:', error);\n    throw error;\n  }\n}\n\nexport async function sendWorkOrderAssignmentEmail(params: SendWorkOrderAssignmentEmailParams) {\n  if (!resend) {\n    console.log('Resend API key not configured. Assignment email would have been sent to:', params.to);\n    return { id: 'mock-assignment-email-id' };\n  }\n  \n  try {\n    const { data, error } = await resend.emails.send({\n      from: 'ELEVEX ERP <onboarding@resend.dev>',\n      to: params.to,\n      subject: `Work Order Assigned: ${params.workOrderNumber} - ${params.title}`,\n      html: `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <style>\n              body {\n                font-family: Arial, sans-serif;\n                line-height: 1.6;\n                color: #333;\n              }\n              .container {\n                max-width: 600px;\n                margin: 0 auto;\n                padding: 20px;\n              }\n              .header {\n                background: linear-gradient(135deg, #8ACCD5 0%, #8E7DBE 50%, #FF90BB 100%);\n                color: white;\n                padding: 20px;\n                border-radius: 8px 8px 0 0;\n              }\n              .content {\n                background: #f9f9f9;\n                padding: 20px;\n                border: 1px solid #ddd;\n                border-radius: 0 0 8px 8px;\n              }\n              .field {\n                margin-bottom: 15px;\n              }\n              .label {\n                font-weight: bold;\n                color: #555;\n              }\n              .priority-badge {\n                display: inline-block;\n                padding: 4px 12px;\n                border-radius: 4px;\n                font-weight: bold;\n                font-size: 12px;\n                text-transform: uppercase;\n              }\n            </style>\n          </head>\n          <body>\n            <div class=\"container\">\n              <div class=\"header\">\n                <h1>Work Order Assigned to You</h1>\n                <p>You have been assigned a new work order in ELEVEX ERP.</p>\n              </div>\n              <div class=\"content\">\n                <div class=\"field\">\n                  <span class=\"label\">Work Order:</span> ${params.workOrderNumber}\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Title:</span> ${params.title}\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Priority:</span>\n                  <span class=\"priority-badge\" style=\"background: ${\n                    params.priority === 'Urgent' ? '#ef4444' : \n                    params.priority === 'High' ? '#f97316' : '#3b82f6'\n                  }; color: white;\">${params.priority}</span>\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Customer:</span> ${params.customer}\n                </div>\n                <div class=\"field\">\n                  <span class=\"label\">Asset:</span> ${params.asset}\n                </div>\n                <p style=\"margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 14px;\">\n                  Please log in to ELEVEX ERP to review the work order details and begin work.\n                </p>\n              </div>\n            </div>\n          </body>\n        </html>\n      `,\n    });\n\n    if (error) {\n      console.error('Failed to send assignment email:', error);\n      throw error;\n    }\n\n    console.log('Assignment email sent successfully:', data);\n    return data;\n  } catch (error) {\n    console.error('Error sending assignment email:', error);\n    throw error;\n  }\n}\n","size_bytes":8029},"client/src/lib/translations.ts":{"content":"export type Language = \"en\" | \"fr\";\n\nexport const translationKeys = {\n  // Common\n  common_loading: \"Loading...\",\n  common_error: \"Error\",\n  common_success: \"Success\",\n  common_cancel: \"Cancel\",\n  common_save: \"Save\",\n  common_delete: \"Delete\",\n  common_edit: \"Edit\",\n  common_create: \"Create\",\n  common_submit: \"Submit\",\n  common_search: \"Search\",\n  common_filter: \"Filter\",\n  common_all: \"All\",\n  common_actions: \"Actions\",\n  common_status: \"Status\",\n  common_date: \"Date\",\n  common_time: \"Time\",\n  common_notes: \"Notes\",\n  common_description: \"Description\",\n  common_yes: \"Yes\",\n  common_no: \"No\",\n  common_confirm: \"Confirm\",\n  common_username: \"Username\",\n  common_password: \"Password\",\n  \n  // Navigation & Departments\n  nav_dashboard: \"Dashboard\",\n  nav_sales: \"Sales\",\n  nav_rental: \"Location / Rental\",\n  nav_work_orders: \"Work Orders\",\n  nav_gps: \"GPS Tracking\",\n  nav_parts: \"Parts\",\n  nav_appointments: \"Appointments\",\n  nav_accounting: \"Accounting\",\n  nav_warranty: \"Warranty Claims\",\n  nav_messages: \"Messages\",\n  nav_admin: \"Administration\",\n  nav_create_user: \"Create User\",\n  nav_departments: \"Departments\",\n  \n  // Login Page\n  login_title: \"Elevate your life\",\n  login_subtitle: \"Sign in to your account\",\n  login_username_placeholder: \"Enter your username\",\n  login_password_placeholder: \"Enter your password\",\n  login_button: \"Sign In\",\n  login_error: \"Invalid credentials\",\n  login_language: \"Language\",\n  \n  // Dashboard\n  dashboard_title: \"Dashboard\",\n  dashboard_subtitle: \"Elevate your life\",\n  dashboard_my_work_orders: \"My Work Orders\",\n  dashboard_all_work_orders: \"All Work Orders\",\n  dashboard_open_work_orders: \"Open Work Orders\",\n  dashboard_time_tracking: \"Time Tracking\",\n  dashboard_punch_in: \"Punch In\",\n  dashboard_punch_out: \"Punch Out\",\n  dashboard_punched_in_at: \"Punched in at\",\n  dashboard_active_users: \"Active Users\",\n  dashboard_system_stats: \"System Statistics\",\n  dashboard_total_users: \"Total Users\",\n  dashboard_total_work_orders: \"Total Work Orders\",\n  dashboard_open: \"Open\",\n  dashboard_completed: \"Completed\",\n  dashboard_in_progress: \"In Progress\",\n  \n  // Work Orders\n  wo_title: \"Work Orders\",\n  wo_subtitle: \"Manage and track work orders\",\n  wo_create_new: \"Create Work Order\",\n  wo_my_work_orders: \"My Work Orders\",\n  wo_all_work_orders: \"All Work Orders\",\n  wo_assigned_to_me: \"Assigned to Me\",\n  wo_number: \"Work Order #\",\n  wo_client: \"Client\",\n  wo_location: \"Location\",\n  wo_assigned_to: \"Assigned To\",\n  wo_unassigned: \"Unassigned\",\n  wo_priority: \"Priority\",\n  wo_low: \"Low\",\n  wo_medium: \"Medium\",\n  wo_high: \"High\",\n  wo_urgent: \"Urgent\",\n  wo_status_open: \"Open\",\n  wo_status_assigned: \"Assigned\",\n  wo_status_in_progress: \"In Progress\",\n  wo_status_on_hold: \"On Hold\",\n  wo_status_completed: \"Completed\",\n  wo_status_closed: \"Closed for Review\",\n  wo_created_by: \"Created By\",\n  wo_created_at: \"Created At\",\n  wo_updated_at: \"Updated At\",\n  wo_no_work_orders: \"No work orders found\",\n  wo_search_placeholder: \"Search by client, location, work order number...\",\n  wo_tasks: \"Tasks\",\n  wo_time_punches: \"Time Punches\",\n  wo_add_task: \"Add Task\",\n  wo_task_description: \"Task Description\",\n  wo_assign_to: \"Assign To\",\n  wo_assign_work_order: \"Assign Work Order\",\n  wo_close_work_order: \"Close Work Order\",\n  wo_reopen_work_order: \"Reopen Work Order\",\n  \n  // Work Order Form\n  wo_form_title: \"Work Order Details\",\n  wo_form_client_label: \"Client Name\",\n  wo_form_client_placeholder: \"Enter client name\",\n  wo_form_location_label: \"Location\",\n  wo_form_location_placeholder: \"Enter work location\",\n  wo_form_priority_label: \"Priority Level\",\n  wo_form_description_label: \"Description\",\n  wo_form_description_placeholder: \"Describe the work to be done...\",\n  wo_form_tasks_label: \"Tasks\",\n  wo_form_task_placeholder: \"Enter task description\",\n  wo_form_add_task_button: \"Add Task\",\n  wo_form_photos_label: \"Photos\",\n  wo_form_upload_photo: \"Upload Photo\",\n  wo_form_create_button: \"Create Work Order\",\n  wo_form_update_button: \"Update Work Order\",\n  wo_form_creating: \"Creating...\",\n  wo_form_updating: \"Updating...\",\n  \n  // Appointments\n  apt_title: \"Appointments\",\n  apt_subtitle: \"Schedule and manage customer appointments\",\n  apt_create_new: \"New Appointment\",\n  apt_customer: \"Customer\",\n  apt_customer_name: \"Customer Name\",\n  apt_customer_phone: \"Phone\",\n  apt_customer_email: \"Email\",\n  apt_service_type: \"Service Type\",\n  apt_assigned_technician: \"Assigned Technician\",\n  apt_status_scheduled: \"Scheduled\",\n  apt_status_confirmed: \"Confirmed\",\n  apt_status_in_progress: \"In Progress\",\n  apt_status_completed: \"Completed\",\n  apt_status_cancelled: \"Cancelled\",\n  apt_no_appointments: \"No appointments found\",\n  apt_search_placeholder: \"Search by customer, phone, email, service type...\",\n  apt_filter_all: \"All\",\n  apt_filter_scheduled: \"Scheduled\",\n  apt_filter_confirmed: \"Confirmed\",\n  apt_filter_completed: \"Completed\",\n  \n  // Appointment Form\n  apt_form_title_new: \"New Appointment\",\n  apt_form_title_edit: \"Edit Appointment\",\n  apt_form_subtitle_new: \"Schedule a new customer appointment\",\n  apt_form_subtitle_edit: \"Update the appointment details below\",\n  apt_form_customer_label: \"Customer Name\",\n  apt_form_customer_placeholder: \"Enter customer name\",\n  apt_form_date_label: \"Date\",\n  apt_form_time_label: \"Time\",\n  apt_form_phone_label: \"Phone (optional)\",\n  apt_form_phone_placeholder: \"(555) 123-4567\",\n  apt_form_email_label: \"Email (optional)\",\n  apt_form_email_placeholder: \"customer@example.com\",\n  apt_form_service_type_label: \"Service Type\",\n  apt_form_service_maintenance: \"Maintenance\",\n  apt_form_service_repair: \"Repair\",\n  apt_form_service_inspection: \"Inspection\",\n  apt_form_service_consultation: \"Consultation\",\n  apt_form_service_delivery: \"Delivery\",\n  apt_form_service_pickup: \"Pickup\",\n  apt_form_assigned_label: \"Assigned Technician (optional)\",\n  apt_form_assigned_placeholder: \"Unassigned\",\n  apt_form_status_label: \"Status\",\n  apt_form_notes_label: \"Notes (optional)\",\n  apt_form_notes_placeholder: \"Any special instructions or additional information...\",\n  apt_form_create_button: \"Create Appointment\",\n  apt_form_update_button: \"Update Appointment\",\n  apt_form_creating: \"Creating...\",\n  apt_form_updating: \"Updating...\",\n  \n  // Sales\n  sales_title: \"Sales Department\",\n  sales_subtitle: \"Equipment sales and customer management\",\n  \n  // Rental\n  rental_title: \"Location / Rental Department\",\n  rental_subtitle: \"Equipment rental and fleet management\",\n  \n  // GPS Tracking\n  gps_title: \"GPS Tracking\",\n  gps_subtitle: \"Real-time equipment location monitoring\",\n  \n  // Accounting\n  accounting_title: \"Accounting Department\",\n  accounting_subtitle: \"Financial management and reporting\",\n  \n  // Warranty\n  warranty_title: \"Warranty Claims\",\n  warranty_subtitle: \"Warranty claim processing and tracking\",\n  \n  // Messages\n  messages_title: \"Messages\",\n  messages_subtitle: \"Internal communication system\",\n  messages_type_placeholder: \"Type a message...\",\n  messages_connecting: \"Connecting...\",\n  \n  // Create User\n  create_user_title: \"Create New User\",\n  create_user_subtitle: \"Add a new user to the system\",\n  create_user_username_label: \"Username\",\n  create_user_username_placeholder: \"Enter username\",\n  create_user_password_label: \"Password\",\n  create_user_password_placeholder: \"Enter password\",\n  create_user_role_label: \"Role\",\n  create_user_role_admin: \"Administrator\",\n  create_user_role_tech_advisor: \"Technical Advisor\",\n  create_user_role_technician: \"Technician\",\n  create_user_department_label: \"Department\",\n  create_user_department_placeholder: \"e.g., Sales, Service, Parts\",\n  create_user_occupation_label: \"Occupation\",\n  create_user_occupation_placeholder: \"e.g., Service Technician, Parts Manager\",\n  create_user_button: \"Create User\",\n  create_user_creating: \"Creating...\",\n  create_user_success: \"User created successfully\",\n  create_user_error: \"Failed to create user\",\n  \n  // Top Bar\n  topbar_logout: \"Logout\",\n  topbar_theme_light: \"Light Mode\",\n  topbar_theme_dark: \"Dark Mode\",\n  \n  // Time Punches\n  punch_in: \"Punch In\",\n  punch_out: \"Punch Out\",\n  punch_in_success: \"Punched in successfully\",\n  punch_out_success: \"Punched out successfully\",\n  punch_error: \"Failed to punch\",\n  punch_delete_confirm: \"Are you sure you want to delete this punch?\",\n  \n  // Notifications\n  notif_work_order_created: \"Work order created successfully\",\n  notif_work_order_updated: \"Work order updated successfully\",\n  notif_work_order_assigned: \"Work order assigned successfully\",\n  notif_work_order_closed: \"Work order closed successfully\",\n  notif_appointment_created: \"Appointment created successfully\",\n  notif_appointment_updated: \"Appointment updated successfully\",\n  notif_appointment_deleted: \"The appointment has been deleted successfully\",\n  notif_error_generic: \"An error occurred\",\n  \n  // Settings\n  settings: \"Settings\",\n  profilePicture: \"Profile Picture\",\n  currentProfilePicture: \"Current Profile Picture\",\n  uploadNewPicture: \"Upload New Picture\",\n  upload: \"Upload\",\n  uploading: \"Uploading...\",\n  maxFileSize1MB: \"Maximum file size: 1MB. Images only.\",\n  preview: \"Preview\",\n  orChooseDefaultAvatar: \"Or Choose Default Avatar\",\n  accountInformation: \"Account Information\",\n  username: \"Username\",\n  role: \"Role\",\n  email: \"Email\",\n  department: \"Department\",\n  headquarters: \"Headquarters\",\n  profilePictureUpdated: \"Profile Picture Updated\",\n  profilePictureUpdatedDescription: \"Your profile picture has been updated successfully\",\n  defaultAvatarSet: \"Default avatar has been set\",\n  error: \"Error\",\n  fileSizeTooLarge: \"File size too large. Maximum size is 1MB.\",\n  onlyImagesAllowed: \"Only image files are allowed\",\n} as const;\n\nexport type TranslationKey = keyof typeof translationKeys;\n\nexport const translations: Record<Language, Record<TranslationKey, string>> = {\n  en: translationKeys,\n  fr: {\n    // Common\n    common_loading: \"Chargement...\",\n    common_error: \"Erreur\",\n    common_success: \"Succès\",\n    common_cancel: \"Annuler\",\n    common_save: \"Enregistrer\",\n    common_delete: \"Supprimer\",\n    common_edit: \"Modifier\",\n    common_create: \"Créer\",\n    common_submit: \"Soumettre\",\n    common_search: \"Rechercher\",\n    common_filter: \"Filtrer\",\n    common_all: \"Tous\",\n    common_actions: \"Actions\",\n    common_status: \"Statut\",\n    common_date: \"Date\",\n    common_time: \"Heure\",\n    common_notes: \"Notes\",\n    common_description: \"Description\",\n    common_yes: \"Oui\",\n    common_no: \"Non\",\n    common_confirm: \"Confirmer\",\n    common_username: \"Nom d'utilisateur\",\n    common_password: \"Mot de passe\",\n    \n    // Navigation & Departments\n    nav_dashboard: \"Tableau de bord\",\n    nav_sales: \"Ventes\",\n    nav_rental: \"Location\",\n    nav_work_orders: \"Bons de travail\",\n    nav_gps: \"Suivi GPS\",\n    nav_parts: \"Pièces\",\n    nav_appointments: \"Rendez-vous\",\n    nav_accounting: \"Comptabilité\",\n    nav_warranty: \"Réclamations de garantie\",\n    nav_messages: \"Messages\",\n    nav_admin: \"Administration\",\n    nav_create_user: \"Créer un utilisateur\",\n    nav_departments: \"Services\",\n    \n    // Login Page\n    login_title: \"Élevez votre vie\",\n    login_subtitle: \"Connectez-vous à votre compte\",\n    login_username_placeholder: \"Entrez votre nom d'utilisateur\",\n    login_password_placeholder: \"Entrez votre mot de passe\",\n    login_button: \"Se connecter\",\n    login_error: \"Identifiants invalides\",\n    login_language: \"Langue\",\n    \n    // Dashboard\n    dashboard_title: \"Tableau de bord\",\n    dashboard_subtitle: \"Élevez votre vie\",\n    dashboard_my_work_orders: \"Mes bons de travail\",\n    dashboard_all_work_orders: \"Tous les bons de travail\",\n    dashboard_open_work_orders: \"Bons de travail ouverts\",\n    dashboard_time_tracking: \"Suivi du temps\",\n    dashboard_punch_in: \"Pointer à l'arrivée\",\n    dashboard_punch_out: \"Pointer au départ\",\n    dashboard_punched_in_at: \"Pointé à\",\n    dashboard_active_users: \"Utilisateurs actifs\",\n    dashboard_system_stats: \"Statistiques du système\",\n    dashboard_total_users: \"Total des utilisateurs\",\n    dashboard_total_work_orders: \"Total des bons de travail\",\n    dashboard_open: \"Ouverts\",\n    dashboard_completed: \"Terminés\",\n    dashboard_in_progress: \"En cours\",\n    \n    // Work Orders\n    wo_title: \"Bons de travail\",\n    wo_subtitle: \"Gérer et suivre les bons de travail\",\n    wo_create_new: \"Créer un bon de travail\",\n    wo_my_work_orders: \"Mes bons de travail\",\n    wo_all_work_orders: \"Tous les bons de travail\",\n    wo_assigned_to_me: \"Assignés à moi\",\n    wo_number: \"Bon de travail #\",\n    wo_client: \"Client\",\n    wo_location: \"Emplacement\",\n    wo_assigned_to: \"Assigné à\",\n    wo_unassigned: \"Non assigné\",\n    wo_priority: \"Priorité\",\n    wo_low: \"Faible\",\n    wo_medium: \"Moyenne\",\n    wo_high: \"Haute\",\n    wo_urgent: \"Urgent\",\n    wo_status_open: \"Ouvert\",\n    wo_status_assigned: \"Assigné\",\n    wo_status_in_progress: \"En cours\",\n    wo_status_on_hold: \"En attente\",\n    wo_status_completed: \"Terminé\",\n    wo_status_closed: \"Fermé pour révision\",\n    wo_created_by: \"Créé par\",\n    wo_created_at: \"Créé le\",\n    wo_updated_at: \"Mis à jour le\",\n    wo_no_work_orders: \"Aucun bon de travail trouvé\",\n    wo_search_placeholder: \"Rechercher par client, emplacement, numéro...\",\n    wo_tasks: \"Tâches\",\n    wo_time_punches: \"Pointages\",\n    wo_add_task: \"Ajouter une tâche\",\n    wo_task_description: \"Description de la tâche\",\n    wo_assign_to: \"Assigner à\",\n    wo_assign_work_order: \"Assigner le bon de travail\",\n    wo_close_work_order: \"Fermer le bon de travail\",\n    wo_reopen_work_order: \"Rouvrir le bon de travail\",\n    \n    // Work Order Form\n    wo_form_title: \"Détails du bon de travail\",\n    wo_form_client_label: \"Nom du client\",\n    wo_form_client_placeholder: \"Entrez le nom du client\",\n    wo_form_location_label: \"Emplacement\",\n    wo_form_location_placeholder: \"Entrez l'emplacement du travail\",\n    wo_form_priority_label: \"Niveau de priorité\",\n    wo_form_description_label: \"Description\",\n    wo_form_description_placeholder: \"Décrivez le travail à effectuer...\",\n    wo_form_tasks_label: \"Tâches\",\n    wo_form_task_placeholder: \"Entrez la description de la tâche\",\n    wo_form_add_task_button: \"Ajouter une tâche\",\n    wo_form_photos_label: \"Photos\",\n    wo_form_upload_photo: \"Télécharger une photo\",\n    wo_form_create_button: \"Créer le bon de travail\",\n    wo_form_update_button: \"Mettre à jour le bon de travail\",\n    wo_form_creating: \"Création...\",\n    wo_form_updating: \"Mise à jour...\",\n    \n    // Appointments\n    apt_title: \"Rendez-vous\",\n    apt_subtitle: \"Planifier et gérer les rendez-vous clients\",\n    apt_create_new: \"Nouveau rendez-vous\",\n    apt_customer: \"Client\",\n    apt_customer_name: \"Nom du client\",\n    apt_customer_phone: \"Téléphone\",\n    apt_customer_email: \"Courriel\",\n    apt_service_type: \"Type de service\",\n    apt_assigned_technician: \"Technicien assigné\",\n    apt_status_scheduled: \"Planifié\",\n    apt_status_confirmed: \"Confirmé\",\n    apt_status_in_progress: \"En cours\",\n    apt_status_completed: \"Terminé\",\n    apt_status_cancelled: \"Annulé\",\n    apt_no_appointments: \"Aucun rendez-vous trouvé\",\n    apt_search_placeholder: \"Rechercher par client, téléphone, courriel, type de service...\",\n    apt_filter_all: \"Tous\",\n    apt_filter_scheduled: \"Planifié\",\n    apt_filter_confirmed: \"Confirmé\",\n    apt_filter_completed: \"Terminé\",\n    \n    // Appointment Form\n    apt_form_title_new: \"Nouveau rendez-vous\",\n    apt_form_title_edit: \"Modifier le rendez-vous\",\n    apt_form_subtitle_new: \"Planifier un nouveau rendez-vous client\",\n    apt_form_subtitle_edit: \"Mettre à jour les détails du rendez-vous ci-dessous\",\n    apt_form_customer_label: \"Nom du client\",\n    apt_form_customer_placeholder: \"Entrez le nom du client\",\n    apt_form_date_label: \"Date\",\n    apt_form_time_label: \"Heure\",\n    apt_form_phone_label: \"Téléphone (optionnel)\",\n    apt_form_phone_placeholder: \"(555) 123-4567\",\n    apt_form_email_label: \"Courriel (optionnel)\",\n    apt_form_email_placeholder: \"client@exemple.com\",\n    apt_form_service_type_label: \"Type de service\",\n    apt_form_service_maintenance: \"Entretien\",\n    apt_form_service_repair: \"Réparation\",\n    apt_form_service_inspection: \"Inspection\",\n    apt_form_service_consultation: \"Consultation\",\n    apt_form_service_delivery: \"Livraison\",\n    apt_form_service_pickup: \"Ramassage\",\n    apt_form_assigned_label: \"Technicien assigné (optionnel)\",\n    apt_form_assigned_placeholder: \"Non assigné\",\n    apt_form_status_label: \"Statut\",\n    apt_form_notes_label: \"Notes (optionnel)\",\n    apt_form_notes_placeholder: \"Instructions spéciales ou informations supplémentaires...\",\n    apt_form_create_button: \"Créer le rendez-vous\",\n    apt_form_update_button: \"Mettre à jour le rendez-vous\",\n    apt_form_creating: \"Création...\",\n    apt_form_updating: \"Mise à jour...\",\n    \n    // Sales\n    sales_title: \"Service des ventes\",\n    sales_subtitle: \"Ventes d'équipement et gestion de la clientèle\",\n    \n    // Rental\n    rental_title: \"Service de location\",\n    rental_subtitle: \"Location d'équipement et gestion de la flotte\",\n    \n    // GPS Tracking\n    gps_title: \"Suivi GPS\",\n    gps_subtitle: \"Surveillance en temps réel de l'emplacement de l'équipement\",\n    \n    // Accounting\n    accounting_title: \"Service de comptabilité\",\n    accounting_subtitle: \"Gestion financière et rapports\",\n    \n    // Warranty\n    warranty_title: \"Réclamations de garantie\",\n    warranty_subtitle: \"Traitement et suivi des réclamations de garantie\",\n    \n    // Messages\n    messages_title: \"Messages\",\n    messages_subtitle: \"Système de communication interne\",\n    messages_type_placeholder: \"Écrire un message...\",\n    messages_connecting: \"Connexion...\",\n    \n    // Create User\n    create_user_title: \"Créer un nouvel utilisateur\",\n    create_user_subtitle: \"Ajouter un nouvel utilisateur au système\",\n    create_user_username_label: \"Nom d'utilisateur\",\n    create_user_username_placeholder: \"Entrez le nom d'utilisateur\",\n    create_user_password_label: \"Mot de passe\",\n    create_user_password_placeholder: \"Entrez le mot de passe\",\n    create_user_role_label: \"Rôle\",\n    create_user_role_admin: \"Administrateur\",\n    create_user_role_tech_advisor: \"Conseiller technique\",\n    create_user_role_technician: \"Technicien\",\n    create_user_department_label: \"Service\",\n    create_user_department_placeholder: \"ex: Ventes, Service, Pièces\",\n    create_user_occupation_label: \"Occupation\",\n    create_user_occupation_placeholder: \"ex: Technicien de service, Gérant des pièces\",\n    create_user_button: \"Créer l'utilisateur\",\n    create_user_creating: \"Création...\",\n    create_user_success: \"Utilisateur créé avec succès\",\n    create_user_error: \"Échec de la création de l'utilisateur\",\n    \n    // Top Bar\n    topbar_logout: \"Fermer la session\",\n    topbar_theme_light: \"Mode clair\",\n    topbar_theme_dark: \"Mode sombre\",\n    \n    // Time Punches\n    punch_in: \"Pointer à l'arrivée\",\n    punch_out: \"Pointer au départ\",\n    punch_in_success: \"Pointage à l'arrivée réussi\",\n    punch_out_success: \"Pointage au départ réussi\",\n    punch_error: \"Échec du pointage\",\n    punch_delete_confirm: \"Êtes-vous sûr de vouloir supprimer ce pointage?\",\n    \n    // Notifications\n    notif_work_order_created: \"Bon de travail créé avec succès\",\n    notif_work_order_updated: \"Bon de travail mis à jour avec succès\",\n    notif_work_order_assigned: \"Bon de travail assigné avec succès\",\n    notif_work_order_closed: \"Bon de travail fermé avec succès\",\n    notif_appointment_created: \"Rendez-vous créé avec succès\",\n    notif_appointment_updated: \"Rendez-vous mis à jour avec succès\",\n    notif_appointment_deleted: \"Le rendez-vous a été supprimé avec succès\",\n    notif_error_generic: \"Une erreur s'est produite\",\n    \n    // Settings\n    settings: \"Paramètres\",\n    profilePicture: \"Photo de profil\",\n    currentProfilePicture: \"Photo de profil actuelle\",\n    uploadNewPicture: \"Télécharger une nouvelle photo\",\n    upload: \"Télécharger\",\n    uploading: \"Téléchargement...\",\n    maxFileSize1MB: \"Taille maximale du fichier : 1 Mo. Images seulement.\",\n    preview: \"Aperçu\",\n    orChooseDefaultAvatar: \"Ou choisir un avatar par défaut\",\n    accountInformation: \"Informations du compte\",\n    username: \"Nom d'utilisateur\",\n    role: \"Rôle\",\n    email: \"Courriel\",\n    department: \"Service\",\n    headquarters: \"Siège social\",\n    profilePictureUpdated: \"Photo de profil mise à jour\",\n    profilePictureUpdatedDescription: \"Votre photo de profil a été mise à jour avec succès\",\n    defaultAvatarSet: \"Avatar par défaut défini\",\n    error: \"Erreur\",\n    fileSizeTooLarge: \"Fichier trop volumineux. Taille maximale : 1 Mo.\",\n    onlyImagesAllowed: \"Seuls les fichiers image sont autorisés\",\n  },\n};\n","size_bytes":20830},"client/src/contexts/LanguageContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\nimport { translations, type Language, type TranslationKey } from \"@/lib/translations\";\n\ninterface LanguageContextType {\n  language: Language;\n  setLanguage: (lang: Language) => void;\n  t: (key: TranslationKey) => string;\n}\n\nconst LanguageContext = createContext<LanguageContextType | undefined>(undefined);\n\nexport function LanguageProvider({ children }: { children: ReactNode }) {\n  const [language, setLanguageState] = useState<Language>(() => {\n    const saved = localStorage.getItem(\"language\");\n    return (saved === \"en\" || saved === \"fr\") ? saved : \"en\";\n  });\n\n  const setLanguage = (lang: Language) => {\n    setLanguageState(lang);\n    localStorage.setItem(\"language\", lang);\n  };\n\n  const t = (key: TranslationKey): string => {\n    return translations[language][key] || key;\n  };\n\n  useEffect(() => {\n    localStorage.setItem(\"language\", language);\n  }, [language]);\n\n  return (\n    <LanguageContext.Provider value={{ language, setLanguage, t }}>\n      {children}\n    </LanguageContext.Provider>\n  );\n}\n\nexport function useLanguage() {\n  const context = useContext(LanguageContext);\n  if (context === undefined) {\n    throw new Error(\"useLanguage must be used within a LanguageProvider\");\n  }\n  return context;\n}\n","size_bytes":1306},"client/src/components/AppointmentForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { insertAppointmentSchema, updateAppointmentSchema, type Appointment, type User } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Calendar, Clock } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useEffect } from \"react\";\nimport { format } from \"date-fns\";\n\ntype AppointmentFormData = z.infer<typeof insertAppointmentSchema>;\n\ninterface AppointmentFormProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  appointment?: Appointment | null;\n}\n\nexport function AppointmentForm({ open, onOpenChange, appointment }: AppointmentFormProps) {\n  const { toast } = useToast();\n  const { t } = useLanguage();\n  const isEditing = !!appointment;\n\n  const { data: users } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const form = useForm<AppointmentFormData>({\n    resolver: zodResolver(isEditing ? updateAppointmentSchema : insertAppointmentSchema),\n    defaultValues: {\n      appointmentDate: format(new Date(), \"yyyy-MM-dd\"),\n      appointmentTime: \"09:00\",\n      customer: \"\",\n      customerPhone: \"\",\n      customerEmail: \"\",\n      assignedTo: \"\",\n      serviceType: \"Maintenance\",\n      notes: \"\",\n      status: \"scheduled\",\n    },\n  });\n\n  useEffect(() => {\n    if (appointment) {\n      form.reset({\n        appointmentDate: appointment.appointmentDate,\n        appointmentTime: appointment.appointmentTime,\n        customer: appointment.customer,\n        customerPhone: appointment.customerPhone || \"\",\n        customerEmail: appointment.customerEmail || \"\",\n        assignedTo: appointment.assignedTo || \"unassigned\",\n        serviceType: appointment.serviceType as any,\n        notes: appointment.notes || \"\",\n        status: appointment.status as any,\n      });\n    } else {\n      form.reset({\n        appointmentDate: format(new Date(), \"yyyy-MM-dd\"),\n        appointmentTime: \"09:00\",\n        customer: \"\",\n        customerPhone: \"\",\n        customerEmail: \"\",\n        assignedTo: \"unassigned\",\n        serviceType: \"Maintenance\",\n        notes: \"\",\n        status: \"scheduled\",\n      });\n    }\n  }, [appointment, form]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: AppointmentFormData) => {\n      // Convert \"unassigned\" to empty string for backend\n      const payload = {\n        ...data,\n        assignedTo: data.assignedTo === \"unassigned\" ? \"\" : data.assignedTo,\n      };\n      const res = await apiRequest(\"POST\", \"/api/appointments\", payload);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/appointments\"] });\n      toast({\n        title: t(\"common_success\"),\n        description: t(\"notif_appointment_created\"),\n      });\n      form.reset();\n      onOpenChange(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: t(\"common_error\"),\n        description: error.message || t(\"notif_error_generic\"),\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: AppointmentFormData) => {\n      // Convert \"unassigned\" to empty string for backend\n      const payload = {\n        ...data,\n        assignedTo: data.assignedTo === \"unassigned\" ? \"\" : data.assignedTo,\n      };\n      const res = await apiRequest(\"PATCH\", `/api/appointments/${appointment!.id}`, payload);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/appointments\"] });\n      toast({\n        title: t(\"common_success\"),\n        description: t(\"notif_appointment_updated\"),\n      });\n      onOpenChange(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: t(\"common_error\"),\n        description: error.message || t(\"notif_error_generic\"),\n      });\n    },\n  });\n\n  const onSubmit = (data: AppointmentFormData) => {\n    if (isEditing) {\n      updateMutation.mutate(data);\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const isPending = createMutation.isPending || updateMutation.isPending;\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"text-2xl font-bold\">\n            {isEditing ? t(\"apt_form_title_edit\") : t(\"apt_form_title_new\")}\n          </DialogTitle>\n          <DialogDescription>\n            {isEditing ? t(\"apt_form_subtitle_edit\") : t(\"apt_form_subtitle_new\")}\n          </DialogDescription>\n        </DialogHeader>\n\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <FormField\n                control={form.control}\n                name=\"customer\"\n                render={({ field }) => (\n                  <FormItem className=\"md:col-span-2\">\n                    <FormLabel>{t(\"apt_form_customer_label\")}</FormLabel>\n                    <FormControl>\n                      <Input placeholder={t(\"apt_form_customer_placeholder\")} {...field} data-testid=\"input-customer\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"appointmentDate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      <Calendar className=\"h-4 w-4 inline mr-2\" />\n                      {t(\"apt_form_date_label\")}\n                    </FormLabel>\n                    <FormControl>\n                      <Input type=\"date\" {...field} data-testid=\"input-date\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"appointmentTime\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>\n                      <Clock className=\"h-4 w-4 inline mr-2\" />\n                      {t(\"apt_form_time_label\")}\n                    </FormLabel>\n                    <FormControl>\n                      <Input type=\"time\" {...field} data-testid=\"input-time\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"customerPhone\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"apt_form_phone_label\")}</FormLabel>\n                    <FormControl>\n                      <Input placeholder={t(\"apt_form_phone_placeholder\")} {...field} data-testid=\"input-phone\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"customerEmail\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"apt_form_email_label\")}</FormLabel>\n                    <FormControl>\n                      <Input\n                        type=\"email\"\n                        placeholder={t(\"apt_form_email_placeholder\")}\n                        {...field}\n                        data-testid=\"input-email\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"serviceType\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"apt_form_service_type_label\")}</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-service-type\">\n                          <SelectValue />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"Maintenance\">{t(\"apt_form_service_maintenance\")}</SelectItem>\n                        <SelectItem value=\"Repair\">{t(\"apt_form_service_repair\")}</SelectItem>\n                        <SelectItem value=\"Inspection\">{t(\"apt_form_service_inspection\")}</SelectItem>\n                        <SelectItem value=\"Consultation\">{t(\"apt_form_service_consultation\")}</SelectItem>\n                        <SelectItem value=\"Delivery\">{t(\"apt_form_service_delivery\")}</SelectItem>\n                        <SelectItem value=\"Pickup\">{t(\"apt_form_service_pickup\")}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"assignedTo\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t(\"apt_form_assigned_label\")}</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value || \"unassigned\"}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-assigned-to\">\n                          <SelectValue placeholder={t(\"apt_form_assigned_placeholder\")} />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"unassigned\">{t(\"wo_unassigned\")}</SelectItem>\n                        {users?.map((user) => (\n                          <SelectItem key={user.id} value={user.id}>\n                            {user.username} - {user.department || user.role}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {isEditing && (\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{t(\"apt_form_status_label\")}</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-status\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"scheduled\">{t(\"apt_status_scheduled\")}</SelectItem>\n                          <SelectItem value=\"confirmed\">{t(\"apt_status_confirmed\")}</SelectItem>\n                          <SelectItem value=\"in-progress\">{t(\"apt_status_in_progress\")}</SelectItem>\n                          <SelectItem value=\"completed\">{t(\"apt_status_completed\")}</SelectItem>\n                          <SelectItem value=\"cancelled\">{t(\"apt_status_cancelled\")}</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              )}\n\n              <FormField\n                control={form.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem className=\"md:col-span-2\">\n                    <FormLabel>{t(\"apt_form_notes_label\")}</FormLabel>\n                    <FormControl>\n                      <Textarea\n                        placeholder={t(\"apt_form_notes_placeholder\")}\n                        className=\"min-h-24\"\n                        {...field}\n                        data-testid=\"input-notes\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <DialogFooter>\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => onOpenChange(false)}\n                disabled={isPending}\n                data-testid=\"button-cancel\"\n              >\n                {t(\"common_cancel\")}\n              </Button>\n              <Button type=\"submit\" disabled={isPending} data-testid=\"button-submit\">\n                {isPending \n                  ? (isEditing ? t(\"apt_form_updating\") : t(\"apt_form_creating\")) \n                  : (isEditing ? t(\"apt_form_update_button\") : t(\"apt_form_create_button\"))}\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":13785},"client/src/pages/Appointments.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Plus, Calendar, Clock, User, Phone, Mail, Trash2, Edit, Users } from \"lucide-react\";\nimport { AppointmentForm } from \"@/components/AppointmentForm\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { Appointment, User as UserType, Customer } from \"@shared/schema\";\nimport { format } from \"date-fns\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { useForm } from \"react-hook-form\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertCustomerSchema } from \"@shared/schema\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\nexport default function Appointments() {\n  const [formOpen, setFormOpen] = useState(false);\n  const [editingAppointment, setEditingAppointment] = useState<Appointment | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [customerFormOpen, setCustomerFormOpen] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"appointments\");\n  const { toast } = useToast();\n  const { t } = useLanguage();\n\n  const form = useForm({\n    resolver: zodResolver(insertCustomerSchema),\n    defaultValues: {\n      name: \"\",\n      phone: \"\",\n      email: \"\",\n      address: \"\",\n    },\n  });\n\n  const { data: appointments, isLoading } = useQuery<Appointment[]>({\n    queryKey: [\"/api/appointments\"],\n  });\n\n  const { data: users } = useQuery<UserType[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: customers = [] } = useQuery<Customer[]>({\n    queryKey: [\"/api/customers\"],\n  });\n\n  const deleteAppointmentMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/appointments/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/appointments\"] });\n      toast({\n        title: t(\"common_success\"),\n        description: t(\"notif_appointment_deleted\"),\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: t(\"common_error\"),\n        description: error.message || t(\"notif_error_generic\"),\n      });\n    },\n  });\n\n  const createCustomerMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/customers\", data);\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to create customer\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/customers\"] });\n      setCustomerFormOpen(false);\n      form.reset();\n      toast({\n        title: \"Customer created\",\n        description: \"Customer has been added successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: t(\"common_error\"),\n        description: error.message || t(\"notif_error_generic\"),\n      });\n    },\n  });\n\n  const handleEdit = (appointment: Appointment) => {\n    setEditingAppointment(appointment);\n    setFormOpen(true);\n  };\n\n  const handleDelete = (id: string) => {\n    if (confirm(t(\"punch_delete_confirm\"))) {\n      deleteAppointmentMutation.mutate(id);\n    }\n  };\n\n  const handleCloseForm = () => {\n    setFormOpen(false);\n    setEditingAppointment(null);\n  };\n\n  const getUserName = (userId: string | null) => {\n    if (!userId) return t(\"wo_unassigned\");\n    const user = users?.find((u) => u.id === userId);\n    return user?.username || t(\"wo_unassigned\");\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"scheduled\":\n        return \"bg-blue-500\";\n      case \"confirmed\":\n        return \"bg-green-500\";\n      case \"in-progress\":\n        return \"bg-yellow-500\";\n      case \"completed\":\n        return \"bg-gray-500\";\n      case \"cancelled\":\n        return \"bg-red-500\";\n      default:\n        return \"bg-gray-500\";\n    }\n  };\n\n  const filteredAppointments = appointments?.filter((apt) => {\n    const matchesStatus = statusFilter === \"all\" || apt.status === statusFilter;\n    const matchesSearch =\n      searchQuery === \"\" ||\n      apt.customer.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      apt.serviceType.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      (apt.customerPhone && apt.customerPhone.toLowerCase().includes(searchQuery.toLowerCase())) ||\n      (apt.customerEmail && apt.customerEmail.toLowerCase().includes(searchQuery.toLowerCase()));\n    return matchesStatus && matchesSearch;\n  }) || [];\n\n  return (\n    <div className=\"space-y-8 py-2\">\n      <div className=\"px-2 md:px-4 space-y-3\">\n        <h1 className=\"text-5xl font-bold gradient-text\">{t(\"apt_title\")}</h1>\n        <p className=\"text-lg text-muted-foreground\">{t(\"apt_subtitle\")}</p>\n      </div>\n      <div className=\"flex items-center justify-between px-2 md:px-4\">\n      </div>\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2 px-2 md:px-4\">\n          <TabsTrigger value=\"appointments\">\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            Appointments\n          </TabsTrigger>\n          <TabsTrigger value=\"customers\">\n            <Users className=\"h-4 w-4 mr-2\" />\n            Customers\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"appointments\" className=\"space-y-6 px-2 md:px-4\">\n          <div className=\"flex items-center justify-between\">\n            <Button onClick={() => setFormOpen(true)} data-testid=\"button-create-appointment\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              {t(\"apt_create_new\")}\n            </Button>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-4\">\n            <Input\n              placeholder={t(\"apt_search_placeholder\")}\n              className=\"max-w-md\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              data-testid=\"input-search-appointments\"\n            />\n\n            <div className=\"flex gap-2\">\n              <Button\n                variant={statusFilter === \"all\" ? \"default\" : \"outline\"}\n                onClick={() => setStatusFilter(\"all\")}\n                size=\"sm\"\n                data-testid=\"filter-all\"\n              >\n                {t(\"apt_filter_all\")}\n              </Button>\n              <Button\n                variant={statusFilter === \"scheduled\" ? \"default\" : \"outline\"}\n                onClick={() => setStatusFilter(\"scheduled\")}\n                size=\"sm\"\n                data-testid=\"filter-scheduled\"\n              >\n                {t(\"apt_filter_scheduled\")}\n              </Button>\n              <Button\n                variant={statusFilter === \"confirmed\" ? \"default\" : \"outline\"}\n                onClick={() => setStatusFilter(\"confirmed\")}\n                size=\"sm\"\n                data-testid=\"filter-confirmed\"\n              >\n                {t(\"apt_filter_confirmed\")}\n              </Button>\n              <Button\n                variant={statusFilter === \"completed\" ? \"default\" : \"outline\"}\n                onClick={() => setStatusFilter(\"completed\")}\n                size=\"sm\"\n                data-testid=\"filter-completed\"\n              >\n                {t(\"apt_filter_completed\")}\n              </Button>\n            </div>\n          </div>\n\n          {isLoading ? (\n            <div className=\"text-center text-muted-foreground py-8\">{t(\"common_loading\")}</div>\n          ) : filteredAppointments.length === 0 ? (\n            <Card>\n              <CardContent className=\"text-center py-12\">\n                <Calendar className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                <p className=\"text-lg text-muted-foreground\">{t(\"apt_no_appointments\")}</p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid gap-4\">\n              {filteredAppointments.map((appointment) => (\n                <Card key={appointment.id} data-testid={`appointment-card-${appointment.id}`}>\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-start justify-between gap-4\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <CardTitle className=\"text-lg\">{appointment.customer}</CardTitle>\n                          <Badge className={getStatusColor(appointment.status)}>\n                            {appointment.status}\n                          </Badge>\n                          <Badge variant=\"outline\">{appointment.serviceType}</Badge>\n                        </div>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-muted-foreground\">\n                          <div className=\"flex items-center gap-2\">\n                            <Calendar className=\"h-4 w-4\" />\n                            <span data-testid={`appointment-date-${appointment.id}`}>\n                              {format(new Date(appointment.appointmentDate), \"MMMM d, yyyy\")}\n                            </span>\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <Clock className=\"h-4 w-4\" />\n                            <span data-testid={`appointment-time-${appointment.id}`}>\n                              {appointment.appointmentTime}\n                            </span>\n                          </div>\n                          {appointment.customerPhone && (\n                            <div className=\"flex items-center gap-2\">\n                              <Phone className=\"h-4 w-4\" />\n                              <span>{appointment.customerPhone}</span>\n                            </div>\n                          )}\n                          {appointment.customerEmail && (\n                            <div className=\"flex items-center gap-2\">\n                              <Mail className=\"h-4 w-4\" />\n                              <span>{appointment.customerEmail}</span>\n                            </div>\n                          )}\n                          <div className=\"flex items-center gap-2\">\n                            <User className=\"h-4 w-4\" />\n                            <span>{t(\"wo_assigned_to\")}: {getUserName(appointment.assignedTo)}</span>\n                          </div>\n                        </div>\n                        {appointment.notes && (\n                          <p className=\"text-sm text-muted-foreground mt-2 italic\">\n                            {appointment.notes}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"icon\"\n                          onClick={() => handleEdit(appointment)}\n                          data-testid={`button-edit-${appointment.id}`}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"icon\"\n                          onClick={() => handleDelete(appointment.id)}\n                          disabled={deleteAppointmentMutation.isPending}\n                          data-testid={`button-delete-${appointment.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardHeader>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"customers\" className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-xl font-semibold\">Manage Customers</h3>\n            <Button onClick={() => setCustomerFormOpen(true)} data-testid=\"button-create-customer\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Add Customer\n            </Button>\n          </div>\n\n          {customers.length === 0 ? (\n            <Card>\n              <CardContent className=\"text-center py-12\">\n                <Users className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n                <p className=\"text-lg text-muted-foreground\">No customers yet</p>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Click \"Add Customer\" to create your first customer\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid gap-4\">\n              {customers.map((customer) => (\n                <Card key={customer.id} data-testid={`customer-card-${customer.id}`}>\n                  <CardContent className=\"pt-6\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-semibold text-lg mb-2\">{customer.name}</h4>\n                        <div className=\"space-y-1 text-sm text-muted-foreground\">\n                          {customer.phone && (\n                            <div className=\"flex items-center gap-2\">\n                              <Phone className=\"h-4 w-4\" />\n                              <span>{customer.phone}</span>\n                            </div>\n                          )}\n                          {customer.email && (\n                            <div className=\"flex items-center gap-2\">\n                              <Mail className=\"h-4 w-4\" />\n                              <span>{customer.email}</span>\n                            </div>\n                          )}\n                          {customer.address && (\n                            <div className=\"text-sm\">{customer.address}</div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      <AppointmentForm\n        open={formOpen}\n        onOpenChange={handleCloseForm}\n        appointment={editingAppointment}\n      />\n\n      <Dialog open={customerFormOpen} onOpenChange={setCustomerFormOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Create Customer</DialogTitle>\n            <DialogDescription>Add a new customer to your system</DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit((data) => createCustomerMutation.mutate(data))} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Customer Name</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"John Doe\" {...field} data-testid=\"input-customer-name\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"phone\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Phone</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"(555) 123-4567\" {...field} data-testid=\"input-customer-phone\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"email\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Email</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"customer@example.com\" type=\"email\" {...field} data-testid=\"input-customer-email\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"address\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Address</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"123 Main St, City, Province\" {...field} data-testid=\"input-customer-address\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => {\n                    setCustomerFormOpen(false);\n                    form.reset();\n                  }}\n                >\n                  Cancel\n                </Button>\n                <Button type=\"submit\" disabled={createCustomerMutation.isPending} data-testid=\"button-save-customer\">\n                  {createCustomerMutation.isPending ? \"Creating...\" : \"Create Customer\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":18029},"client/src/pages/Settings.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useQuery } from \"@tanstack/react-query\";\n\ntype FullUser = {\n  id: string;\n  username: string;\n  role: string;\n  email?: string | null;\n  department?: string | null;\n  headquarters?: string | null;\n  profilePicture?: string | null;\n  bannerImage?: string | null;\n};\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Camera, Check, UserPlus } from \"lucide-react\";\nimport { useLanguage } from \"@/contexts/LanguageContext\";\nimport { Link } from \"wouter\";\n\nconst DEFAULT_AVATARS = [\n  { id: \"elevex-logo\", path: \"/attached_assets/default-avatars/elevex-logo.jpeg\", name: \"ELEVEX Logo\" },\n];\n\nexport default function Settings() {\n  const { data: authUser } = useAuth();\n  const { data: user } = useQuery<FullUser>({\n    queryKey: [\"/api/user\"],\n    enabled: !!authUser,\n  });\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { t } = useLanguage();\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [selectedDefaultAvatar, setSelectedDefaultAvatar] = useState<string | null>(null);\n  const [selectedBannerFile, setSelectedBannerFile] = useState<File | null>(null);\n  const [bannerPreviewUrl, setBannerPreviewUrl] = useState<string | null>(null);\n\n  const uploadMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append(\"profilePicture\", file);\n      const response = await fetch(\"/api/users/profile-picture\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to upload profile picture\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      toast({\n        title: t(\"profilePictureUpdated\"),\n        description: t(\"profilePictureUpdatedDescription\"),\n      });\n      setSelectedFile(null);\n      setPreviewUrl(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t(\"error\"),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const setDefaultAvatarMutation = useMutation({\n    mutationFn: async (avatarPath: string) => {\n      return apiRequest(\"PATCH\", \"/api/users/profile-picture/default\", {\n        profilePicture: avatarPath,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      toast({\n        title: t(\"profilePictureUpdated\"),\n        description: t(\"defaultAvatarSet\"),\n      });\n      setSelectedDefaultAvatar(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t(\"error\"),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > 1024 * 1024) {\n      toast({\n        title: t(\"error\"),\n        description: t(\"fileSizeTooLarge\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!file.type.startsWith(\"image/\")) {\n      toast({\n        title: t(\"error\"),\n        description: t(\"onlyImagesAllowed\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSelectedFile(file);\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreviewUrl(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleUpload = () => {\n    if (selectedFile) {\n      uploadMutation.mutate(selectedFile);\n    }\n  };\n\n  const handleSelectDefaultAvatar = (avatarPath: string) => {\n    setSelectedDefaultAvatar(avatarPath);\n    setDefaultAvatarMutation.mutate(avatarPath);\n  };\n\n  const uploadBannerMutation = useMutation({\n    mutationFn: async (file: File) => {\n      const formData = new FormData();\n      formData.append(\"photo\", file);\n      const uploadResponse = await fetch(\"/api/upload/photo\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n      if (!uploadResponse.ok) {\n        throw new Error(\"Failed to upload banner image\");\n      }\n      const { filePath } = await uploadResponse.json();\n      \n      return apiRequest(\"PATCH\", \"/api/users/me/profile\", {\n        bannerImage: filePath,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      toast({\n        title: \"Banner Updated\",\n        description: \"Your banner image has been updated successfully\",\n      });\n      setSelectedBannerFile(null);\n      setBannerPreviewUrl(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleBannerFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > 5 * 1024 * 1024) {\n      toast({\n        title: \"Error\",\n        description: \"File size too large (max 5MB for banners)\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!file.type.startsWith(\"image/\")) {\n      toast({\n        title: \"Error\",\n        description: \"Only image files are allowed\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setSelectedBannerFile(file);\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setBannerPreviewUrl(reader.result as string);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  const handleBannerUpload = () => {\n    if (selectedBannerFile) {\n      uploadBannerMutation.mutate(selectedBannerFile);\n    }\n  };\n\n  if (!user) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen p-4 pb-20\">\n      <div className=\"max-w-2xl mx-auto space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h1 className=\"text-2xl font-bold\">{t(\"settings\")}</h1>\n          {user.role === \"admin\" && (\n            <Link href=\"/admin/create-user\">\n              <Button variant=\"outline\" data-testid=\"button-create-user-nav\">\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Create User\n              </Button>\n            </Link>\n          )}\n        </div>\n\n        <Card data-testid=\"card-profile-picture\">\n          <CardHeader>\n            <CardTitle>{t(\"profilePicture\")}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center gap-4\">\n              <Avatar className=\"h-24 w-24\" data-testid=\"img-current-avatar\">\n                <AvatarImage src={user.profilePicture || undefined} />\n                <AvatarFallback className=\"text-2xl\">\n                  {user.username.substring(0, 2).toUpperCase()}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1\">\n                <p className=\"text-sm text-muted-foreground\">{t(\"currentProfilePicture\")}</p>\n                <p className=\"font-medium\" data-testid=\"text-username\">{user.username}</p>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"profile-picture-upload\">{t(\"uploadNewPicture\")}</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"profile-picture-upload\"\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleFileChange}\n                  className=\"flex-1\"\n                  data-testid=\"input-profile-picture\"\n                />\n                {selectedFile && (\n                  <Button\n                    onClick={handleUpload}\n                    disabled={uploadMutation.isPending}\n                    data-testid=\"button-upload-picture\"\n                  >\n                    <Camera className=\"h-4 w-4 mr-2\" />\n                    {uploadMutation.isPending ? t(\"uploading\") : t(\"upload\")}\n                  </Button>\n                )}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">{t(\"maxFileSize1MB\")}</p>\n            </div>\n\n            {previewUrl && (\n              <div className=\"space-y-2\">\n                <Label>{t(\"preview\")}</Label>\n                <Avatar className=\"h-24 w-24\" data-testid=\"img-preview-avatar\">\n                  <AvatarImage src={previewUrl} />\n                  <AvatarFallback>Preview</AvatarFallback>\n                </Avatar>\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <Label>{t(\"orChooseDefaultAvatar\")}</Label>\n              <div className=\"grid grid-cols-4 gap-4\">\n                {DEFAULT_AVATARS.map((avatar) => (\n                  <button\n                    key={avatar.id}\n                    onClick={() => handleSelectDefaultAvatar(avatar.path)}\n                    className={`relative hover-elevate active-elevate-2 rounded-lg p-2 border-2 ${\n                      selectedDefaultAvatar === avatar.path\n                        ? \"border-primary\"\n                        : \"border-transparent\"\n                    }`}\n                    disabled={setDefaultAvatarMutation.isPending}\n                    data-testid={`button-avatar-${avatar.id}`}\n                  >\n                    <Avatar className=\"h-16 w-16 mx-auto\">\n                      <AvatarImage src={avatar.path} alt={avatar.name} />\n                      <AvatarFallback>{avatar.name[0]}</AvatarFallback>\n                    </Avatar>\n                    {user.profilePicture === avatar.path && (\n                      <div className=\"absolute -top-1 -right-1 bg-primary text-primary-foreground rounded-full p-1\">\n                        <Check className=\"h-3 w-3\" />\n                      </div>\n                    )}\n                  </button>\n                ))}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-banner-image\">\n          <CardHeader>\n            <CardTitle>Banner Image</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {user.bannerImage && (\n              <div className=\"w-full h-32 rounded-lg overflow-hidden border\">\n                <img \n                  src={user.bannerImage} \n                  alt=\"Current banner\" \n                  className=\"w-full h-full object-cover\"\n                  data-testid=\"img-current-banner\"\n                />\n              </div>\n            )}\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"banner-upload\">Upload New Banner</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  id=\"banner-upload\"\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleBannerFileChange}\n                  className=\"flex-1\"\n                  data-testid=\"input-banner-image\"\n                />\n                {selectedBannerFile && (\n                  <Button\n                    onClick={handleBannerUpload}\n                    disabled={uploadBannerMutation.isPending}\n                    data-testid=\"button-upload-banner\"\n                  >\n                    <Camera className=\"h-4 w-4 mr-2\" />\n                    {uploadBannerMutation.isPending ? \"Uploading...\" : \"Upload\"}\n                  </Button>\n                )}\n              </div>\n              <p className=\"text-xs text-muted-foreground\">Max file size: 5MB. Recommended size: 1200x300 pixels</p>\n            </div>\n\n            {bannerPreviewUrl && (\n              <div className=\"space-y-2\">\n                <Label>Preview</Label>\n                <div className=\"w-full h-32 rounded-lg overflow-hidden border\">\n                  <img \n                    src={bannerPreviewUrl} \n                    alt=\"Banner preview\" \n                    className=\"w-full h-full object-cover\"\n                    data-testid=\"img-preview-banner\"\n                  />\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-account-info\">\n          <CardHeader>\n            <CardTitle>{t(\"accountInformation\")}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            <div className=\"grid grid-cols-2 gap-2\">\n              <div>\n                <Label className=\"text-muted-foreground\">{t(\"username\")}</Label>\n                <p className=\"font-medium\" data-testid=\"text-account-username\">{user.username}</p>\n              </div>\n              <div>\n                <Label className=\"text-muted-foreground\">{t(\"role\")}</Label>\n                <p className=\"font-medium\" data-testid=\"text-account-role\">{user.role}</p>\n              </div>\n              {user.email && (\n                <div>\n                  <Label className=\"text-muted-foreground\">{t(\"email\")}</Label>\n                  <p className=\"font-medium\" data-testid=\"text-account-email\">{user.email}</p>\n                </div>\n              )}\n              {user.department && (\n                <div>\n                  <Label className=\"text-muted-foreground\">{t(\"department\")}</Label>\n                  <p className=\"font-medium\" data-testid=\"text-account-department\">{user.department}</p>\n                </div>\n              )}\n              {user.headquarters && (\n                <div>\n                  <Label className=\"text-muted-foreground\">{t(\"headquarters\")}</Label>\n                  <p className=\"font-medium\" data-testid=\"text-account-headquarters\">{user.headquarters}</p>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":14236},"client/src/components/TimeTrackingPanel.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Clock, Play, Square, Navigation, Briefcase, ListTodo, Coffee } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { TimePunch, WorkOrder } from \"@shared/schema\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\nexport function TimeTrackingPanel() {\n  const { data: user } = useAuth();\n  const { toast } = useToast();\n  const [activeType, setActiveType] = useState<\"work\" | \"travel\" | \"other\" | null>(null);\n  const [selectedWorkOrderId, setSelectedWorkOrderId] = useState(\"\");\n  const [showKmDialog, setShowKmDialog] = useState(false);\n  const [kmValue, setKmValue] = useState(\"0\");\n  const [elapsedSeconds, setElapsedSeconds] = useState(0);\n  const [editingPunchId, setEditingPunchId] = useState<string | null>(null);\n  const [editClockIn, setEditClockIn] = useState(\"\");\n  const [editClockOut, setEditClockOut] = useState(\"\");\n  const [editKm, setEditKm] = useState(\"0\");\n  const [showBreakDialog, setShowBreakDialog] = useState(false);\n  const [breakMinutes, setBreakMinutes] = useState(\"30\");\n\n  const today = new Date().toISOString().split(\"T\")[0];\n\n  const { data: workOrders } = useQuery<WorkOrder[]>({\n    queryKey: [\"/api/work-orders\"],\n  });\n\n  const { data: todayPunches } = useQuery<TimePunch[]>({\n    queryKey: [`/api/time-punches/${user?.id}/${today}`],\n    enabled: !!user,\n  });\n\n  const { data: activePunch } = useQuery<TimePunch | null>({\n    queryKey: [\"/api/active-punch\"],\n    enabled: !!user,\n    refetchInterval: 5000,\n    queryFn: async () => {\n      const res = await fetch(\"/api/active-punch\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch active punch\");\n      return res.json();\n    },\n  });\n\n  const clockInMutation = useMutation({\n    mutationFn: async (data: { punchType: \"work\" | \"travel\" | \"other\"; workOrderId?: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/time-punches/clock-in\", {\n        punchType: data.punchType,\n        workOrderId: data.workOrderId || null,\n        clockInTime: new Date().toISOString(),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to punch in\");\n      }\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/active-punch\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/time-punches/${user?.id}/${today}`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches\"], exact: false });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"], exact: false });\n      setActiveType(null);\n      setSelectedWorkOrderId(\"\");\n      toast({ title: \"Punch started\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n      setActiveType(null);\n    },\n  });\n\n  const clockOutMutation = useMutation({\n    mutationFn: async (data: { kilometers?: number }) => {\n      const res = await apiRequest(\"POST\", \"/api/time-punches/clock-out\", {\n        kilometers: data.kilometers || 0,\n        clockOutTime: new Date().toISOString(),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to punch out\");\n      }\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/active-punch\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/time-punches/${user?.id}/${today}`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"], exact: false });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches/current\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches\"], exact: false });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders/assigned\"], exact: false });\n      setShowKmDialog(false);\n      setKmValue(\"0\");\n      setElapsedSeconds(0);\n      toast({ title: \"Punch stopped\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n    },\n  });\n\n  const updatePunchMutation = useMutation({\n    mutationFn: async (data: { punchId: string; clockIn: string; clockOut: string; kilometers?: number }) => {\n      const clockInDate = new Date(data.clockIn + \":00\");\n      const clockOutDate = new Date(data.clockOut + \":00\");\n      \n      const res = await apiRequest(\"PATCH\", `/api/time-punches/${data.punchId}`, {\n        clockIn: clockInDate.toISOString(),\n        clockOut: clockOutDate.toISOString(),\n        kilometers: data.kilometers || 0,\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to update punch\");\n      }\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/time-punches/${user?.id}/${today}`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"], exact: false });\n      queryClient.invalidateQueries({ queryKey: [\"/api/active-punch\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches\"], exact: false });\n      setEditingPunchId(null);\n      setEditClockIn(\"\");\n      setEditClockOut(\"\");\n      setEditKm(\"0\");\n      toast({ title: \"Punch updated successfully\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n    },\n  });\n\n  const deletePunchMutation = useMutation({\n    mutationFn: async (punchId: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/time-punches/${punchId}`, {});\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to delete punch\");\n      }\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/time-punches/${user?.id}/${today}`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/work-orders\"], exact: false });\n      queryClient.invalidateQueries({ queryKey: [\"/api/active-punch\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches\"], exact: false });\n      toast({ title: \"Punch deleted\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n    },\n  });\n\n  const breakMutation = useMutation({\n    mutationFn: async (minutes: number) => {\n      const res = await apiRequest(\"POST\", \"/api/add-break\", { breakMinutes: minutes });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to add break\");\n      }\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/time-punches/${user?.id}/${today}`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/time-punches\"], exact: false });\n      setShowBreakDialog(false);\n      setBreakMinutes(\"30\");\n      toast({ title: \"Break recorded\", description: \"Break time removed from total hours\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: \"Error\", description: error.message });\n    },\n  });\n\n  const handleStartWork = () => {\n    setActiveType(\"work\");\n  };\n\n  const handleStartTravel = () => {\n    setActiveType(\"travel\");\n  };\n\n  const handleStartOther = () => {\n    setActiveType(\"other\");\n  };\n\n  const handleStartWorkOrder = (workOrderId: string) => {\n    setSelectedWorkOrderId(workOrderId);\n    clockInMutation.mutate({ punchType: \"work\", workOrderId });\n  };\n\n  const handleStop = () => {\n    if (activePunch?.punchType === \"travel\") {\n      setShowKmDialog(true);\n    } else {\n      clockOutMutation.mutate({});\n    }\n  };\n\n  const handleConfirmKm = () => {\n    const km = parseFloat(kmValue) || 0;\n    clockOutMutation.mutate({ kilometers: km });\n  };\n\n  const confirmStartPunch = (type: \"work\" | \"travel\" | \"other\") => {\n    if (type === \"work\") {\n      clockInMutation.mutate({ punchType: \"work\" });\n    } else {\n      clockInMutation.mutate({ punchType: type });\n    }\n    setActiveType(null);\n  };\n\n  // Update elapsed seconds every second\n  const [realElapsedSeconds, setRealElapsedSeconds] = useState(0);\n  \n  useEffect(() => {\n    if (!activePunch?.clockIn) {\n      setRealElapsedSeconds(0);\n      return;\n    }\n\n    const timer = setInterval(() => {\n      const now = new Date().getTime();\n      const clockInTime = new Date(activePunch.clockIn).getTime();\n      const seconds = Math.floor((now - clockInTime) / 1000);\n      setRealElapsedSeconds(seconds);\n    }, 100); // Update 10 times per second for smooth display\n\n    return () => clearInterval(timer);\n  }, [activePunch?.clockIn]);\n\n  // Format elapsed time as HH:MM:SS\n  const hours = Math.floor(realElapsedSeconds / 3600);\n  const minutes = Math.floor((realElapsedSeconds % 3600) / 60);\n  const seconds = realElapsedSeconds % 60;\n  const displayTime = `${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}:${String(seconds).padStart(2, \"0\")}`;\n\n  const workOrderOptions = workOrders?.filter(wo => wo.status !== \"completed\") || [];\n\n  return (\n    <Card data-testid=\"time-tracking-panel\" className=\"shadow-lg\">\n      <CardHeader className=\"pb-4 border-b\">\n        <CardTitle className=\"text-2xl font-bold flex items-center gap-3\">\n          <Clock className=\"h-6 w-6 text-primary\" />\n          Time Tracking\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-6 pt-6\">\n        {/* Active Punch Display */}\n        {activePunch && (\n          <div className=\"p-6 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-950 dark:to-blue-900 rounded-xl border-2 border-blue-300 dark:border-blue-700 shadow-md\">\n            <div className=\"flex items-center justify-between gap-3\">\n              <div className=\"space-y-2 flex-1\">\n                <div className=\"flex items-center gap-2\">\n                  {activePunch.punchType === \"work\" && <Briefcase className=\"h-4 w-4 text-blue-600 dark:text-blue-300\" />}\n                  {activePunch.punchType === \"travel\" && <Navigation className=\"h-4 w-4 text-blue-600 dark:text-blue-300\" />}\n                  {activePunch.punchType === \"other\" && <ListTodo className=\"h-4 w-4 text-blue-600 dark:text-blue-300\" />}\n                  <p className=\"text-sm font-semibold text-blue-600 dark:text-blue-300 uppercase tracking-wide\">\n                    {activePunch.punchType === \"work\" ? \"Working\" : activePunch.punchType === \"travel\" ? \"Traveling\" : \"Other Task\"}\n                  </p>\n                </div>\n                <p className=\"text-4xl font-bold text-blue-700 dark:text-blue-300 font-mono\">{displayTime}</p>\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  size=\"lg\"\n                  variant=\"outline\"\n                  onClick={() => setShowBreakDialog(true)}\n                  className=\"border-orange-300 text-orange-600 hover:bg-orange-50 dark:border-orange-700 dark:text-orange-400 dark:hover:bg-orange-950\"\n                  disabled={breakMutation.isPending}\n                  data-testid=\"button-take-break\"\n                  title=\"Take a break (time will be removed from total hours)\"\n                >\n                  <Coffee className=\"h-5 w-5\" />\n                </Button>\n                <Button\n                  size=\"lg\"\n                  onClick={handleStop}\n                  className=\"bg-red-600 hover:bg-red-700 text-white shadow-lg\"\n                  disabled={clockOutMutation.isPending}\n                  data-testid=\"button-stop-punch\"\n                >\n                  <Square className=\"h-5 w-5 mr-2\" />\n                  Stop\n                </Button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Quick Start Buttons */}\n        {!activePunch && (\n          <div className=\"space-y-4\">\n            {/* Punch Work Button */}\n            {activeType === \"work\" && (\n              <div className=\"p-5 bg-amber-50 dark:bg-amber-950 rounded-xl border-2 border-amber-300 dark:border-amber-700 shadow-md\">\n                <p className=\"text-base font-semibold text-foreground mb-4\">Start Work Punch?</p>\n                <div className=\"flex gap-3\">\n                  <Button\n                    size=\"lg\"\n                    onClick={() => confirmStartPunch(\"work\")}\n                    disabled={clockInMutation.isPending}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 text-white shadow-lg\"\n                    data-testid=\"button-confirm-work\"\n                  >\n                    Confirm\n                  </Button>\n                  <Button\n                    size=\"lg\"\n                    variant=\"outline\"\n                    onClick={() => setActiveType(null)}\n                    data-testid=\"button-cancel-work\"\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </div>\n            )}\n\n            {/* Punch Work Order Button */}\n            {activeType === \"work\" ? null : (\n              <div className=\"space-y-4\">\n                <Button\n                  size=\"lg\"\n                  onClick={handleStartWork}\n                  className=\"w-full bg-green-600 hover:bg-green-700 text-white flex items-center justify-center gap-3 shadow-lg text-base font-semibold py-6\"\n                  disabled={!!activePunch}\n                  data-testid=\"button-punch-work\"\n                >\n                  <Play className=\"h-5 w-5\" />\n                  Start Work\n                </Button>\n\n                {/* Work Order Selector */}\n                {workOrderOptions.length > 0 && !activePunch && (\n                  <div className=\"p-4 bg-muted rounded-xl border border-border\">\n                    <p className=\"text-sm font-semibold text-muted-foreground mb-3\">Or select a work order:</p>\n                    <Select value={selectedWorkOrderId} onValueChange={handleStartWorkOrder}>\n                      <SelectTrigger className=\"h-10\" data-testid=\"select-workorder-punch\">\n                        <SelectValue placeholder=\"Select work order...\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {workOrderOptions.map(wo => (\n                          <SelectItem key={wo.id} value={wo.id}>\n                            {wo.workOrderNumber} - {wo.customer}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Punch Travel Button */}\n            {activeType === \"travel\" && (\n              <div className=\"p-5 bg-amber-50 dark:bg-amber-950 rounded-xl border-2 border-amber-300 dark:border-amber-700 shadow-md\">\n                <p className=\"text-base font-semibold text-foreground mb-4\">Start Travel Punch?</p>\n                <div className=\"flex gap-3\">\n                  <Button\n                    size=\"lg\"\n                    onClick={() => confirmStartPunch(\"travel\")}\n                    disabled={clockInMutation.isPending}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 text-white shadow-lg\"\n                    data-testid=\"button-confirm-travel\"\n                  >\n                    Confirm\n                  </Button>\n                  <Button\n                    size=\"lg\"\n                    variant=\"outline\"\n                    onClick={() => setActiveType(null)}\n                    data-testid=\"button-cancel-travel\"\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </div>\n            )}\n\n            {activeType !== \"travel\" && (\n              <Button\n                size=\"lg\"\n                variant=\"outline\"\n                onClick={handleStartTravel}\n                className=\"w-full flex items-center justify-center gap-3\"\n                disabled={!!activePunch}\n                data-testid=\"button-punch-travel\"\n              >\n                <Navigation className=\"h-4 w-4\" />\n                Punch Travel\n              </Button>\n            )}\n\n            {/* Punch Other Button */}\n            {activeType === \"other\" && (\n              <div className=\"p-3 bg-amber-50 dark:bg-amber-950 rounded-xl border border-amber-200 dark:border-amber-800\">\n                <p className=\"text-sm font-medium text-foreground mb-2\">Start Other Task?</p>\n                <div className=\"flex gap-3\">\n                  <Button\n                    size=\"lg\"\n                    onClick={() => confirmStartPunch(\"other\")}\n                    disabled={clockInMutation.isPending}\n                    className=\"flex-1 bg-green-600 hover:bg-green-700 text-white\"\n                    data-testid=\"button-confirm-other\"\n                  >\n                    Confirm\n                  </Button>\n                  <Button\n                    size=\"lg\"\n                    variant=\"outline\"\n                    onClick={() => setActiveType(null)}\n                    data-testid=\"button-cancel-other\"\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </div>\n            )}\n\n            {activeType !== \"other\" && (\n              <Button\n                size=\"lg\"\n                variant=\"outline\"\n                onClick={handleStartOther}\n                className=\"w-full flex items-center justify-center gap-3\"\n                disabled={!!activePunch}\n                data-testid=\"button-punch-other\"\n              >\n                <Briefcase className=\"h-4 w-4\" />\n                Punch Other Task\n              </Button>\n            )}\n          </div>\n        )}\n      </CardContent>\n\n      {/* Break Dialog */}\n      <Dialog open={showBreakDialog} onOpenChange={setShowBreakDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Take a Break</DialogTitle>\n            <DialogDescription>How long is your break? (in minutes)</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label>Break Duration (minutes)</Label>\n              <Input\n                type=\"number\"\n                min=\"1\"\n                max=\"480\"\n                value={breakMinutes}\n                onChange={(e) => setBreakMinutes(e.target.value)}\n                placeholder=\"30\"\n                data-testid=\"input-break-minutes\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                This time will be subtracted from your total work hours\n              </p>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowBreakDialog(false);\n                setBreakMinutes(\"30\");\n              }}\n              data-testid=\"button-cancel-break\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={() => breakMutation.mutate(parseInt(breakMinutes) || 30)}\n              disabled={breakMutation.isPending}\n              data-testid=\"button-confirm-break\"\n            >\n              {breakMutation.isPending ? \"Recording...\" : \"Record Break\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* KM Input Dialog for Travel */}\n      <Dialog open={showKmDialog} onOpenChange={setShowKmDialog}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Travel Distance</DialogTitle>\n            <DialogDescription>Enter kilometers traveled</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label>Kilometers</Label>\n              <Input\n                type=\"number\"\n                min=\"0\"\n                step=\"0.1\"\n                value={kmValue}\n                onChange={(e) => setKmValue(e.target.value)}\n                placeholder=\"0\"\n                data-testid=\"input-travel-km\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setShowKmDialog(false);\n                setKmValue(\"0\");\n              }}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleConfirmKm}\n              disabled={clockOutMutation.isPending}\n              data-testid=\"button-confirm-km\"\n            >\n              {clockOutMutation.isPending ? \"Saving...\" : \"Confirm\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Today's Punches Section */}\n      {todayPunches && todayPunches.length > 0 && (\n        <div className=\"border-t pt-4 mt-4\">\n          <h3 className=\"text-sm font-semibold mb-3\">Today's Punches</h3>\n          <div className=\"space-y-2\">\n            {todayPunches.map((punch) => (\n              <div\n                key={punch.id}\n                className=\"flex items-center justify-between p-2 bg-muted rounded-xl text-sm\"\n                data-testid={`punch-item-${punch.id}`}\n              >\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"font-medium truncate\">\n                    {punch.punchType === \"work\"\n                      ? \"Work\"\n                      : punch.punchType === \"travel\"\n                      ? \"Travel\"\n                      : \"Other\"}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {punch.clockIn\n                      ? new Date(punch.clockIn).toLocaleTimeString()\n                      : \"No start\"}\n                    {punch.clockOut\n                      ? ` - ${new Date(punch.clockOut).toLocaleTimeString()}`\n                      : \" (ongoing)\"}\n                  </p>\n                  {punch.kilometers ? (\n                    <p className=\"text-xs text-muted-foreground\">\n                      {punch.kilometers}km\n                    </p>\n                  ) : null}\n                </div>\n                <div className=\"flex gap-1\">\n                  <Button\n                    size=\"lg\"\n                    variant=\"ghost\"\n                    onClick={() => {\n                      setEditingPunchId(punch.id);\n                      setEditClockIn(\n                        new Date(punch.clockIn).toISOString().slice(0, 16)\n                      );\n                      setEditClockOut(\n                        punch.clockOut\n                          ? new Date(punch.clockOut).toISOString().slice(0, 16)\n                          : \"\"\n                      );\n                      setEditKm((punch.kilometers || 0).toString());\n                    }}\n                    data-testid={`button-edit-punch-${punch.id}`}\n                  >\n                    Edit\n                  </Button>\n                  <Button\n                    size=\"lg\"\n                    variant=\"ghost\"\n                    onClick={() => deletePunchMutation.mutate(punch.id)}\n                    disabled={deletePunchMutation.isPending}\n                    data-testid={`button-delete-punch-${punch.id}`}\n                  >\n                    Delete\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Edit Punch Dialog */}\n      <Dialog open={!!editingPunchId} onOpenChange={(open) => !open && setEditingPunchId(null)}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Edit Punch</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label>Clock In</Label>\n              <Input\n                type=\"datetime-local\"\n                value={editClockIn}\n                onChange={(e) => setEditClockIn(e.target.value)}\n                data-testid=\"input-edit-clockin\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Clock Out</Label>\n              <Input\n                type=\"datetime-local\"\n                value={editClockOut}\n                onChange={(e) => setEditClockOut(e.target.value)}\n                data-testid=\"input-edit-clockout\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Kilometers (if travel)</Label>\n              <Input\n                type=\"number\"\n                min=\"0\"\n                step=\"0.1\"\n                value={editKm}\n                onChange={(e) => setEditKm(e.target.value)}\n                data-testid=\"input-edit-km\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setEditingPunchId(null)}\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={() => {\n                if (!editingPunchId || !editClockIn || !editClockOut) {\n                  toast({ variant: \"destructive\", title: \"Error\", description: \"Please fill in all fields\" });\n                  return;\n                }\n                updatePunchMutation.mutate({\n                  punchId: editingPunchId,\n                  clockIn: editClockIn,\n                  clockOut: editClockOut,\n                  kilometers: parseFloat(editKm) || 0,\n                });\n              }}\n              disabled={updatePunchMutation.isPending}\n              data-testid=\"button-save-punch-edit\"\n            >\n              {updatePunchMutation.isPending ? \"Saving...\" : \"Save\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </Card>\n  );\n}\n","size_bytes":26942},"client/src/pages/Admin.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertUserSchema, type User } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Redirect } from \"wouter\";\nimport { Loader2, Trash2, Edit2 } from \"lucide-react\";\n\ntype FormData = z.infer<typeof insertUserSchema>;\n\nconst updateUserSchema = z.object({\n  role: z.enum([\"admin\", \"technician\", \"technical_advisor\"]).optional(),\n  department: z.enum([\"Road Technician\", \"Garage Technician\", \"Sales\", \"Tech Advisor\", \"Accounting\", \"HR\"]).optional(),\n  headquarters: z.enum([\"Montreal, QC\", \"Quebec, QC\", \"Saguenay, QC\"]).optional(),\n  email: z.string().email().optional(),\n});\n\ntype UpdateFormData = z.infer<typeof updateUserSchema>;\n\nexport default function Admin() {\n  const { data: user } = useAuth();\n  const { toast } = useToast();\n  const [editingUserId, setEditingUserId] = useState<string | null>(null);\n\n  const { data: users = [], isLoading, refetch } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(insertUserSchema),\n    defaultValues: {\n      username: \"\",\n      employeeId: \"\",\n      email: \"\",\n      password: \"\",\n      role: \"technician\",\n      department: \"Road Technician\",\n      headquarters: \"Montreal, QC\",\n    },\n  });\n\n  const editForm = useForm<UpdateFormData>({\n    resolver: zodResolver(updateUserSchema),\n    defaultValues: {\n      role: \"technician\",\n      department: \"Road Technician\",\n      headquarters: \"Montreal, QC\",\n      email: \"\",\n    },\n  });\n\n  const createUserMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const res = await apiRequest(\"POST\", \"/api/users\", data);\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to create user\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"User created\",\n        description: \"The user has been created successfully.\",\n      });\n      form.reset();\n      refetch();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to create user\",\n      });\n    },\n  });\n\n  const updateUserMutation = useMutation({\n    mutationFn: async ({ userId, data }: { userId: string; data: UpdateFormData }) => {\n      const res = await apiRequest(\"PATCH\", `/api/users/${userId}`, data);\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.message || \"Failed to update user\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"User updated\",\n        description: \"The user has been updated successfully.\",\n      });\n      setEditingUserId(null);\n      editForm.reset();\n      refetch();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"Failed to update user\",\n      });\n    },\n  });\n\n  const handleEditClick = (targetUser: User) => {\n    setEditingUserId(targetUser.id);\n    editForm.reset({\n      role: targetUser.role as any,\n      department: targetUser.department as any,\n      headquarters: targetUser.headquarters as any,\n      email: targetUser.email || \"\",\n    });\n  };\n\n  const onEditSubmit = (data: UpdateFormData) => {\n    if (editingUserId) {\n      updateUserMutation.mutate({ userId: editingUserId, data });\n    }\n  };\n\n  if (!user || user.role !== \"admin\") {\n    return <Redirect to=\"/\" />;\n  }\n\n  return (\n    <div className=\"space-y-6 max-w-6xl mx-auto\">\n      <div>\n        <h1 className=\"text-3xl font-bold\">Admin Dashboard</h1>\n        <p className=\"text-muted-foreground mt-2\">Manage users and system settings</p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Create User Form */}\n        <Card className=\"lg:col-span-1\">\n          <CardHeader>\n            <CardTitle>Create New User</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form\n                onSubmit={form.handleSubmit((data) => createUserMutation.mutate(data))}\n                className=\"space-y-4\"\n              >\n                <FormField\n                  control={form.control}\n                  name=\"username\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Username</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"john_doe\"\n                          {...field}\n                          data-testid=\"input-username\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"employeeId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Employee ID</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"EMP001\"\n                          {...field}\n                          data-testid=\"input-employee-id\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email *</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"email\"\n                          placeholder=\"john@company.com\"\n                          {...field}\n                          data-testid=\"input-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Password</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"password\"\n                          placeholder=\"••••••\"\n                          {...field}\n                          data-testid=\"input-password\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Role</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-role\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"technician\">Technician</SelectItem>\n                          <SelectItem value=\"technical_advisor\">Technical Advisor</SelectItem>\n                          <SelectItem value=\"admin\">Admin</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"department\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Department</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value || \"\"}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-department\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Road Technician\">Road Technician</SelectItem>\n                          <SelectItem value=\"Garage Technician\">Garage Technician</SelectItem>\n                          <SelectItem value=\"Sales\">Sales</SelectItem>\n                          <SelectItem value=\"Tech Advisor\">Tech Advisor</SelectItem>\n                          <SelectItem value=\"Accounting\">Accounting</SelectItem>\n                          <SelectItem value=\"HR\">HR</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button\n                  type=\"submit\"\n                  disabled={createUserMutation.isPending}\n                  className=\"w-full\"\n                  data-testid=\"button-create-user\"\n                >\n                  {createUserMutation.isPending && (\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  )}\n                  Create User\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n\n        {/* Users List */}\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Users ({users.length})</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"text-center py-8 text-muted-foreground\">Loading users...</div>\n            ) : users.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">No users yet</div>\n            ) : (\n              <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                {users.map((u) => (\n                  <div\n                    key={u.id}\n                    className=\"flex items-center justify-between p-3 border rounded-md hover-elevate transition-all\"\n                    data-testid={`user-${u.id}`}\n                  >\n                    <div className=\"flex-1\">\n                      <p className=\"font-medium\">{u.username}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        ID: {u.employeeId} | {u.email || \"No email\"}\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant={u.role === \"admin\" ? \"destructive\" : \"secondary\"}>\n                        {u.role.replace(\"_\", \" \")}\n                      </Badge>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => handleEditClick(u)}\n                        data-testid={`button-edit-user-${u.id}`}\n                      >\n                        <Edit2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Edit User Dialog */}\n      {editingUserId && (\n        <Dialog open={!!editingUserId} onOpenChange={(open) => !open && setEditingUserId(null)}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Edit User</DialogTitle>\n              <DialogDescription>Update user role, department, and headquarters</DialogDescription>\n            </DialogHeader>\n            <Form {...editForm}>\n              <form onSubmit={editForm.handleSubmit(onEditSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={editForm.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Email</FormLabel>\n                      <FormControl>\n                        <Input type=\"email\" placeholder=\"user@example.com\" {...field} data-testid=\"input-edit-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"role\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Role</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-edit-role\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"technician\">Technician</SelectItem>\n                          <SelectItem value=\"technical_advisor\">Technical Advisor</SelectItem>\n                          <SelectItem value=\"admin\">Admin</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"department\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Department</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value || \"\"}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-edit-department\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Road Technician\">Road Technician</SelectItem>\n                          <SelectItem value=\"Garage Technician\">Garage Technician</SelectItem>\n                          <SelectItem value=\"Sales\">Sales</SelectItem>\n                          <SelectItem value=\"Tech Advisor\">Tech Advisor</SelectItem>\n                          <SelectItem value=\"Accounting\">Accounting</SelectItem>\n                          <SelectItem value=\"HR\">HR</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"headquarters\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Headquarters</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value || \"\"}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-edit-headquarters\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Montreal, QC\">Montreal, QC</SelectItem>\n                          <SelectItem value=\"Quebec, QC\">Quebec, QC</SelectItem>\n                          <SelectItem value=\"Saguenay, QC\">Saguenay, QC</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex gap-2 justify-end pt-4\">\n                  <Button variant=\"outline\" onClick={() => setEditingUserId(null)}>\n                    Cancel\n                  </Button>\n                  <Button type=\"submit\" disabled={updateUserMutation.isPending} data-testid=\"button-save-user-edit\">\n                    {updateUserMutation.isPending && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n                    Save Changes\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      )}\n    </div>\n  );\n}\n","size_bytes":17284},"client/src/pages/AdvisorDashboard.tsx":{"content":"import { useAuth } from \"@/lib/auth\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { WorkOrderCardNew } from \"@/components/WorkOrderCardNew\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Redirect } from \"wouter\";\nimport type { WorkOrder } from \"@shared/schema\";\n\nexport default function AdvisorDashboard() {\n  const { data: user } = useAuth();\n  const { toast } = useToast();\n\n  const { data: demands = [], isLoading } = useQuery<WorkOrder[]>({\n    queryKey: [\"/api/work-orders/demands\"],\n  });\n\n  if (!user || (user.role !== \"technical_advisor\" && user.role !== \"admin\")) {\n    return <Redirect to=\"/\" />;\n  }\n\n  return (\n    <div className=\"space-y-6 max-w-6xl mx-auto\">\n      <div>\n        <h1 className=\"text-3xl font-bold\">\n          {user.role === \"admin\" ? \"Work Order Review\" : \"Pending Demands\"}\n        </h1>\n        <p className=\"text-muted-foreground mt-2\">\n          {user.role === \"admin\"\n            ? \"Review and manage all work order demands\"\n            : \"Review work order demands from technicians\"}\n        </p>\n      </div>\n\n      {isLoading ? (\n        <div className=\"text-center py-12 text-muted-foreground\">Loading demands...</div>\n      ) : demands.length === 0 ? (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center py-12 text-muted-foreground\">\n              No pending demands to review\n            </div>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid gap-4\">\n          <div className=\"text-sm text-muted-foreground\">\n            Found {demands.length} pending demand{demands.length !== 1 ? \"s\" : \"\"}\n          </div>\n          {demands.map((demand) => (\n            <WorkOrderCardNew\n              key={demand.id}\n              workOrder={demand}\n              showPunchButtons={false}\n              showAssignButtons={true}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":2085},"client/src/pages/CreateWorkOrder.tsx":{"content":"import { useAuth } from \"@/lib/auth\";\nimport { Redirect } from \"wouter\";\nimport { WorkOrderForm } from \"@/components/WorkOrderForm\";\nimport { DemandForm } from \"@/components/DemandForm\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\n\nexport default function CreateWorkOrder() {\n  const { data: user } = useAuth();\n\n  if (!user) {\n    return <Redirect to=\"/login\" />;\n  }\n\n  return (\n    <div className=\"space-y-6 max-w-4xl mx-auto\">\n      <div>\n        <h1 className=\"text-3xl font-bold\">Create Work Order</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          {user.role === \"technician\"\n            ? \"Submit a work demand to your technical advisor\"\n            : \"Create a new work order with tasks and budgets\"}\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>\n            {user.role === \"technician\" ? \"Work Demand Form\" : \"Work Order Form\"}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {user.role === \"technician\" ? (\n            <DemandForm />\n          ) : (\n            <WorkOrderForm open={true} onOpenChange={() => {}} isEmbedded={true} />\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":1231},"client/src/components/NewMessageDialog.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/lib/auth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Input } from \"@/components/ui/input\";\nimport { PlusCircle, Search } from \"lucide-react\";\nimport type { User, Conversation } from \"@shared/schema\";\n\ninterface NewMessageDialogProps {\n  onConversationCreated?: (conversation: Conversation) => void;\n}\n\nexport function NewMessageDialog({ onConversationCreated }: NewMessageDialogProps) {\n  const { data: currentUser } = useAuth();\n  const [open, setOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  // Fetch all users\n  const { data: users = [] } = useQuery<User[]>({\n    queryKey: ['/api/users'],\n    enabled: open,\n  });\n\n  // Filter users based on search query and exclude current user\n  const filteredUsers = users.filter((user) => {\n    if (user.id === currentUser?.id) return false;\n    if (!searchQuery) return true;\n    \n    const query = searchQuery.toLowerCase();\n    return (\n      user.username.toLowerCase().includes(query) ||\n      user.email?.toLowerCase().includes(query)\n    );\n  });\n\n  const handleSelectUser = async (otherUserId: string) => {\n    try {\n      const response = await apiRequest(\"POST\", \"/api/conversations\", { otherUserId });\n      const conversation = await response.json() as Conversation;\n\n      // Invalidate conversations list to refresh\n      await queryClient.invalidateQueries({ queryKey: ['/api/conversations'] });\n\n      if (onConversationCreated) {\n        onConversationCreated(conversation);\n      }\n\n      setOpen(false);\n      setSearchQuery(\"\");\n    } catch (error) {\n      console.error(\"Failed to create conversation:\", error);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button size=\"icon\" variant=\"ghost\" className=\"h-6 w-6\" data-testid=\"button-new-dm\">\n          <PlusCircle className=\"h-4 w-4\" />\n        </Button>\n      </DialogTrigger>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>New Direct Message</DialogTitle>\n          <DialogDescription>\n            Select a user to start a conversation\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search users...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9\"\n              data-testid=\"input-search-users\"\n            />\n          </div>\n\n          <ScrollArea className=\"h-[300px] border rounded-md\">\n            <div className=\"p-2\">\n              {filteredUsers.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground text-center py-8\">\n                  No users found\n                </p>\n              ) : (\n                <div className=\"space-y-1\">\n                  {filteredUsers.map((user) => (\n                    <Button\n                      key={user.id}\n                      variant=\"ghost\"\n                      className=\"w-full justify-start gap-3 h-auto py-3\"\n                      onClick={() => handleSelectUser(user.id)}\n                      data-testid={`button-select-user-${user.id}`}\n                    >\n                      <Avatar className=\"h-10 w-10\">\n                        <AvatarImage src={user.profilePicture || undefined} />\n                        <AvatarFallback>\n                          {user.username?.[0]?.toUpperCase() || \"?\"}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex flex-col items-start flex-1 min-w-0\">\n                        <span className=\"font-medium text-sm truncate w-full\">\n                          {user.username}\n                        </span>\n                        <span className=\"text-xs text-muted-foreground truncate w-full\">\n                          {user.email || `@${user.username}`}\n                        </span>\n                      </div>\n                    </Button>\n                  ))}\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":4714},"client/src/components/WeeklyHoursProgress.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Clock } from \"lucide-react\";\n\ninterface WeeklyHoursProgressProps {\n  weeklyHours: number;\n  isLoading?: boolean;\n}\n\nexport function WeeklyHoursProgress({ weeklyHours, isLoading = false }: WeeklyHoursProgressProps) {\n  const [displayHours, setDisplayHours] = useState(weeklyHours);\n  \n  useEffect(() => {\n    setDisplayHours(weeklyHours);\n  }, [weeklyHours]);\n\n  const TARGET_HOURS = 40;\n  const isOvertime = displayHours >= TARGET_HOURS;\n  const overtimeHours = isOvertime ? displayHours - TARGET_HOURS : 0;\n  const progressPercentage = isOvertime ? 100 : (displayHours / TARGET_HOURS) * 100;\n  \n  // Colors for normal vs overtime\n  const circleColor = isOvertime ? \"#a855f7\" : \"#06b6d4\"; // purple for overtime, cyan for normal\n  const backgroundColor = isOvertime ? \"rgba(168, 85, 247, 0.1)\" : \"rgba(6, 182, 212, 0.1)\"; // very subtle bg\n\n  const circumference = 2 * Math.PI * 45;\n  const strokeDashoffset = circumference - (progressPercentage / 100) * circumference;\n\n  return (\n    <Card data-testid=\"weekly-hours-progress\">\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\n          <Clock className=\"h-4 w-4\" />\n          Weekly Progress {isOvertime && <span className=\"text-xs font-semibold text-purple-600 dark:text-purple-400\">OVERTIME</span>}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col items-center space-y-4\">\n          {/* Circular Progress */}\n          <div className=\"relative w-32 h-32 flex items-center justify-center\">\n            <svg\n              width=\"140\"\n              height=\"140\"\n              viewBox=\"0 0 140 140\"\n              className=\"transform -rotate-90\"\n              data-testid=\"hours-progress-circle\"\n            >\n              {/* Background circle */}\n              <circle\n                cx=\"70\"\n                cy=\"70\"\n                r=\"45\"\n                fill=\"none\"\n                stroke=\"currentColor\"\n                strokeWidth=\"8\"\n                className=\"text-muted-foreground/20\"\n              />\n              {/* Progress circle */}\n              <circle\n                cx=\"70\"\n                cy=\"70\"\n                r=\"45\"\n                fill=\"none\"\n                stroke={circleColor}\n                strokeWidth=\"8\"\n                strokeDasharray={circumference}\n                strokeDashoffset={strokeDashoffset}\n                strokeLinecap=\"round\"\n                className=\"transition-all duration-500\"\n              />\n            </svg>\n            {/* Center text */}\n            <div className=\"absolute flex flex-col items-center\">\n              <span className=\"text-3xl font-bold\" data-testid=\"hours-display\">\n                {displayHours.toFixed(1)}\n              </span>\n              <span className=\"text-xs text-muted-foreground\">of {TARGET_HOURS}h</span>\n              {isOvertime && (\n                <span className=\"text-xs font-semibold text-purple-600 dark:text-purple-400 mt-1\">\n                  +{overtimeHours.toFixed(1)}h OT\n                </span>\n              )}\n            </div>\n          </div>\n\n          {/* Status Text */}\n          <div className=\"text-center space-y-1\">\n            {!isLoading && (\n              <>\n                {isOvertime ? (\n                  <p className=\"text-sm font-semibold text-purple-600 dark:text-purple-400\">\n                    Overtime Mode Active\n                  </p>\n                ) : (\n                  <p className=\"text-sm text-muted-foreground\">\n                    {displayHours < TARGET_HOURS ? (\n                      <>\n                        {(TARGET_HOURS - displayHours).toFixed(1)}h until target\n                      </>\n                    ) : (\n                      <>Target reached!</>\n                    )}\n                  </p>\n                )}\n              </>\n            )}\n            {isLoading && (\n              <p className=\"text-sm text-muted-foreground\">Loading...</p>\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4197},"client/src/components/PrivateChatWindow.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Card } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { X, Send, MessageSquare, ChevronDown, ChevronUp } from \"lucide-react\";\nimport type { User as UserType, Message, Conversation } from \"@shared/schema\";\n\nexport function PrivateChatWindow() {\n  const { data: currentUser } = useAuth();\n  const [isOpen, setIsOpen] = useState(false);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [users, setUsers] = useState<Map<string, UserType>>(new Map());\n  const [inputValue, setInputValue] = useState(\"\");\n  const [ws, setWs] = useState<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  \n  // Draggable position state\n  const [position, setPosition] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\n  const windowRef = useRef<HTMLDivElement>(null);\n  const buttonRef = useRef<HTMLDivElement>(null);\n\n  // Load position from localStorage\n  useEffect(() => {\n    const saved = localStorage.getItem(\"chatWindowPosition\");\n    if (saved) {\n      try {\n        setPosition(JSON.parse(saved));\n      } catch {\n        setPosition({ x: 0, y: 0 });\n      }\n    }\n  }, []);\n\n  // Save position to localStorage\n  useEffect(() => {\n    localStorage.setItem(\"chatWindowPosition\", JSON.stringify(position));\n  }, [position]);\n\n  // Handle mouse down on button\n  const handleButtonMouseDown = (e: React.MouseEvent) => {\n    if (!isOpen) {\n      setDragStart({ x: e.clientX - position.x, y: e.clientY - position.y });\n      setIsDragging(true);\n    }\n  };\n\n  // Handle mouse move for dragging\n  useEffect(() => {\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!isDragging || isOpen) return;\n\n      const windowWidth = window.innerWidth;\n      const windowHeight = window.innerHeight;\n      const buttonWidth = 140; // approximate button width\n      const buttonHeight = 40; // approximate button height\n\n      let newX = e.clientX - dragStart.x;\n      let newY = e.clientY - dragStart.y;\n\n      // Keep within bounds\n      newX = Math.max(0, Math.min(newX, windowWidth - buttonWidth));\n      newY = Math.max(0, Math.min(newY, windowHeight - buttonHeight));\n\n      setPosition({ x: newX, y: newY });\n    };\n\n    const handleMouseUp = () => {\n      setIsDragging(false);\n    };\n\n    if (isDragging) {\n      document.addEventListener(\"mousemove\", handleMouseMove);\n      document.addEventListener(\"mouseup\", handleMouseUp);\n      return () => {\n        document.removeEventListener(\"mousemove\", handleMouseMove);\n        document.removeEventListener(\"mouseup\", handleMouseUp);\n      };\n    }\n  }, [isDragging, dragStart]);\n\n  // Fetch conversations\n  const { data: conversations = [] } = useQuery<Conversation[]>({\n    queryKey: ['/api/conversations'],\n    enabled: !!currentUser,\n  });\n\n  // Fetch user data for all conversation participants\n  useEffect(() => {\n    async function fetchConversationUsers() {\n      if (conversations.length === 0 || !currentUser) return;\n\n      const userIds = new Set<string>();\n      conversations.forEach((conv) => {\n        if (conv.participant1 !== currentUser.id) {\n          userIds.add(conv.participant1);\n        }\n        if (conv.participant2 !== currentUser.id) {\n          userIds.add(conv.participant2);\n        }\n      });\n\n      const newUsers = new Map(users);\n      for (const userId of Array.from(userIds)) {\n        if (!users.has(userId)) {\n          try {\n            const response = await fetch(`/api/users/${userId}`, {\n              credentials: \"include\",\n            });\n            if (response.ok) {\n              const userData = await response.json();\n              newUsers.set(userId, userData);\n            }\n          } catch (error) {\n            console.error(`Failed to fetch user ${userId}:`, error);\n          }\n        }\n      }\n      setUsers(newUsers);\n    }\n\n    fetchConversationUsers();\n  }, [conversations, currentUser]);\n\n  // Scroll to bottom on new message\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  // Fetch messages for selected conversation\n  useEffect(() => {\n    async function fetchMessages() {\n      if (!selectedConversation) return;\n\n      try {\n        const response = await fetch(`/api/messages/conversation/${selectedConversation.id}`, {\n          credentials: \"include\",\n        });\n        if (response.ok) {\n          const data = await response.json();\n          setMessages(data);\n\n          // Fetch user data\n          const senderIds = Array.from(new Set(data.map((m: Message) => m.senderId)));\n          const userMap = new Map<string, UserType>();\n\n          for (const senderId of senderIds) {\n            try {\n              const userResponse = await fetch(`/api/users/${String(senderId)}`, {\n                credentials: \"include\",\n              });\n              if (userResponse.ok) {\n                const userData = await userResponse.json();\n                userMap.set(String(senderId), userData);\n              }\n            } catch (error) {\n              console.error(`Failed to fetch user ${senderId}:`, error);\n            }\n          }\n\n          setUsers(userMap);\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch messages:\", error);\n      }\n    }\n\n    fetchMessages();\n  }, [selectedConversation]);\n\n  // WebSocket connection\n  useEffect(() => {\n    if (!currentUser) return;\n\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const host = window.location.hostname;\n    const port = window.location.port ? `:${window.location.port}` : \"\";\n    const wsUrl = `${protocol}//${host}${port}/ws`;\n\n    try {\n      const socket = new WebSocket(wsUrl);\n\n      socket.onopen = () => {\n        console.log(\"Private chat WebSocket connected\");\n        setIsConnected(true);\n        socket.send(JSON.stringify({ type: \"auth\", userId: currentUser.id }));\n      };\n\n      socket.onmessage = async (event) => {\n        const data = JSON.parse(event.data);\n\n        if (data.type === \"auth_success\") {\n          console.log(\"Private chat WebSocket authenticated\");\n        } else if (data.type === \"new_message\") {\n          const newMsg = data.message;\n\n          // Only add if it's for the current conversation and is direct\n          if (selectedConversation && newMsg.channelType === \"direct\" && newMsg.conversationId === selectedConversation.id) {\n            setMessages((prev) => [...prev, newMsg]);\n\n            // Fetch user data if not cached\n            if (!users.has(newMsg.senderId)) {\n              try {\n                const userResponse = await fetch(`/api/users/${newMsg.senderId}`, {\n                  credentials: \"include\",\n                });\n                if (userResponse.ok) {\n                  const userData = await userResponse.json();\n                  setUsers((prev) => new Map(prev).set(newMsg.senderId, userData));\n                }\n              } catch (error) {\n                console.error(`Failed to fetch user ${newMsg.senderId}:`, error);\n              }\n            }\n          }\n        } else if (data.type === \"error\") {\n          console.error(\"Private chat WebSocket error:\", data.message);\n        }\n      };\n\n      socket.onclose = () => {\n        console.log(\"Private chat WebSocket disconnected\");\n        setIsConnected(false);\n      };\n\n      socket.onerror = (error) => {\n        console.error(\"Private chat WebSocket error:\", error);\n      };\n\n      setWs(socket);\n\n      return () => {\n        socket.close();\n      };\n    } catch (error) {\n      console.error(\"Failed to create WebSocket:\", error);\n    }\n  }, [currentUser]);\n\n  const handleSendMessage = () => {\n    if (!inputValue.trim() || !ws || !isConnected || !selectedConversation) return;\n\n    const messagePayload: any = {\n      type: \"chat_message\",\n      content: inputValue,\n      channelType: \"direct\",\n      conversationId: selectedConversation.id,\n    };\n\n    ws.send(JSON.stringify(messagePayload));\n    setInputValue(\"\");\n  };\n\n  const formatTime = (date: string | Date) => {\n    const d = typeof date === \"string\" ? new Date(date) : date;\n    return d.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n  };\n\n  const getOtherUserName = () => {\n    if (!selectedConversation || !currentUser) return \"User\";\n    const otherUserId =\n      selectedConversation.participant1 === currentUser.id\n        ? selectedConversation.participant2\n        : selectedConversation.participant1;\n    const otherUser = users.get(otherUserId);\n    return otherUser?.username || \"User\";\n  };\n\n  if (!currentUser) {\n    return null;\n  }\n\n  return (\n    <div\n      ref={windowRef}\n      className={`fixed z-50`}\n      style={{\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n      }}\n      data-testid=\"private-chat-window\"\n    >\n      {!isOpen ? (\n        <div\n          ref={buttonRef}\n          onMouseDown={handleButtonMouseDown}\n          style={{ cursor: isDragging ? \"grabbing\" : \"grab\" }}\n        >\n          <Button\n            onClick={() => setIsOpen(true)}\n            size=\"lg\"\n            className=\"rounded-full shadow-lg\"\n            data-testid=\"button-open-chat\"\n          >\n            <MessageSquare className=\"h-5 w-5 mr-2\" />\n            Messages\n          </Button>\n        </div>\n      ) : (\n        <Card className=\"flex flex-col h-96 shadow-2xl w-80\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-3 border-b bg-card\">\n            <div className=\"flex items-center gap-2 flex-1 min-w-0\">\n              {selectedConversation ? (\n                <>\n                  <Avatar className=\"h-6 w-6 flex-shrink-0\">\n                    <AvatarImage src={users.get(selectedConversation.participant1 === currentUser.id ? selectedConversation.participant2 : selectedConversation.participant1)?.profilePicture || undefined} />\n                    <AvatarFallback className=\"text-xs\">U</AvatarFallback>\n                  </Avatar>\n                  <span className=\"text-sm font-medium truncate\">{getOtherUserName()}</span>\n                </>\n              ) : (\n                <span className=\"text-sm font-medium\">Direct Messages</span>\n              )}\n            </div>\n            <div className=\"flex items-center gap-1 flex-shrink-0\">\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                onClick={() => setIsMinimized(!isMinimized)}\n                className=\"h-6 w-6\"\n                data-testid=\"button-minimize-chat\"\n              >\n                {isMinimized ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n              </Button>\n              {selectedConversation && (\n                <Button\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  onClick={() => {\n                    setSelectedConversation(null);\n                    setMessages([]);\n                  }}\n                  className=\"h-6 w-6\"\n                  data-testid=\"button-back-chat\"\n                >\n                  ←\n                </Button>\n              )}\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                onClick={() => {\n                  setIsOpen(false);\n                  setSelectedConversation(null);\n                  setMessages([]);\n                }}\n                className=\"h-6 w-6\"\n                data-testid=\"button-close-chat\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n\n          {!isMinimized && (\n            <>\n              {/* Conversations List or Messages */}\n              {!selectedConversation ? (\n                <ScrollArea className=\"flex-1 p-3\">\n                  <div className=\"space-y-2\">\n                    {conversations.length === 0 ? (\n                      <p className=\"text-sm text-muted-foreground text-center py-4\">\n                        No conversations yet. Start chatting on the Messages page.\n                      </p>\n                    ) : (\n                      conversations.map((conv) => {\n                        const otherUserId =\n                          conv.participant1 === currentUser.id\n                            ? conv.participant2\n                            : conv.participant1;\n                        const otherUser = users.get(otherUserId);\n                        return (\n                          <Button\n                            key={conv.id}\n                            variant=\"ghost\"\n                            onClick={() => setSelectedConversation(conv)}\n                            className=\"w-full justify-start h-auto py-2\"\n                            data-testid={`button-conversation-${conv.id}`}\n                          >\n                            <Avatar className=\"h-8 w-8 mr-2 flex-shrink-0\">\n                              <AvatarImage src={otherUser?.profilePicture || undefined} />\n                              <AvatarFallback>U</AvatarFallback>\n                            </Avatar>\n                            <span className=\"truncate text-sm\">\n                              {otherUser?.username || \"User\"}\n                            </span>\n                          </Button>\n                        );\n                      })\n                    )}\n                  </div>\n                </ScrollArea>\n              ) : (\n                <>\n                  {/* Messages */}\n                  <ScrollArea className=\"flex-1 p-3 bg-background\">\n                    <div className=\"space-y-2\">\n                      {messages.length === 0 ? (\n                        <p className=\"text-xs text-muted-foreground text-center py-4\">\n                          Start the conversation...\n                        </p>\n                      ) : (\n                        messages.map((msg) => (\n                          <div\n                            key={msg.id}\n                            className={`flex gap-2 ${\n                              msg.senderId === currentUser.id ? \"justify-end\" : \"justify-start\"\n                            }`}\n                            data-testid={`message-${msg.id}`}\n                          >\n                            <div\n                              className={`max-w-xs px-3 py-2 rounded-lg text-xs ${\n                                msg.senderId === currentUser.id\n                                  ? \"bg-primary text-primary-foreground\"\n                                  : \"bg-muted text-foreground\"\n                              }`}\n                            >\n                              <p className=\"break-words\">{msg.content}</p>\n                              <p className={`text-xs mt-1 opacity-70`}>\n                                {formatTime(msg.createdAt)}\n                              </p>\n                            </div>\n                          </div>\n                        ))\n                      )}\n                      <div ref={messagesEndRef} />\n                    </div>\n                  </ScrollArea>\n\n                  {/* Input */}\n                  <div className=\"p-2 border-t bg-muted/30 flex gap-1\">\n                    <Input\n                      placeholder=\"Message...\"\n                      value={inputValue}\n                      onChange={(e) => setInputValue(e.target.value)}\n                      onKeyPress={(e) => {\n                        if (e.key === \"Enter\") {\n                          handleSendMessage();\n                        }\n                      }}\n                      disabled={!isConnected}\n                      className=\"text-xs h-8\"\n                      data-testid=\"input-chat-message\"\n                    />\n                    <Button\n                      size=\"icon\"\n                      onClick={handleSendMessage}\n                      disabled={!isConnected || !inputValue.trim()}\n                      className=\"h-8 w-8\"\n                      data-testid=\"button-send-message\"\n                    >\n                      <Send className=\"h-3 w-3\" />\n                    </Button>\n                  </div>\n                </>\n              )}\n            </>\n          )}\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":16881},"client/src/pages/Machines.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Search, Wrench, Package } from \"lucide-react\";\nimport type { Machine, Part } from \"@shared/schema\";\n\nexport default function Machines() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [activeTab, setActiveTab] = useState<\"machines\" | \"parts\">(\"machines\");\n\n  const { data: machines = [] } = useQuery<Machine[]>({\n    queryKey: [\"/api/machines\"],\n  });\n\n  const { data: parts = [] } = useQuery<Part[]>({\n    queryKey: [\"/api/parts\"],\n  });\n\n  const filteredMachines = machines.filter(m =>\n    m.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    m.model.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    m.serialNumber.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const filteredParts = parts.filter(p =>\n    p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    p.partNumber.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"active\": return \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\";\n      case \"maintenance\": return \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\";\n      case \"retired\": return \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\";\n      case \"in-stock\": return \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\";\n      default: return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getCategoryColor = (category: string) => {\n    switch (category) {\n      case \"Motor\": return \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\";\n      case \"Gear\": return \"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200\";\n      case \"Bearing\": return \"bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200\";\n      case \"Hydraulic\": return \"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\";\n      case \"Electrical\": return \"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200\";\n      case \"Fastener\": return \"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200\";\n      default: return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  return (\n    <div className=\"space-y-8 py-2\">\n      {/* Header */}\n      <div className=\"space-y-3 px-2 md:px-4\">\n        <h1 className=\"text-5xl font-bold gradient-text\">Equipment & Parts</h1>\n        <p className=\"text-lg text-muted-foreground\">Manage machines, parts, and inventory</p>\n      </div>\n\n      {/* Search Bar */}\n      <div className=\"flex gap-3 px-2 md:px-4\">\n        <div className=\"flex-1 relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder={activeTab === \"machines\" ? \"Search machines...\" : \"Search parts...\"}\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-inventory\"\n          />\n        </div>\n      </div>\n\n      {/* Tabs */}\n      <div className=\"flex gap-3 px-2 md:px-4\">\n        <Button\n          onClick={() => setActiveTab(\"machines\")}\n          variant={activeTab === \"machines\" ? \"default\" : \"outline\"}\n          className=\"gap-2\"\n          data-testid=\"button-tab-machines\"\n        >\n          <Wrench className=\"h-4 w-4\" />\n          <span className=\"hidden sm:inline\">Machines</span>\n          <span className=\"sm:hidden text-xs\">({filteredMachines.length})</span>\n        </Button>\n        <Button\n          onClick={() => setActiveTab(\"parts\")}\n          variant={activeTab === \"parts\" ? \"default\" : \"outline\"}\n          className=\"gap-2\"\n          data-testid=\"button-tab-parts\"\n        >\n          <Package className=\"h-4 w-4\" />\n          \n          <span className=\"hidden sm:inline\">Parts</span>\n          <span className=\"sm:hidden text-xs\">({filteredParts.length})</span>\n        </Button>\n      </div>\n\n      {/* Machines Tab */}\n      {activeTab === \"machines\" && (\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3 px-2 md:px-4\">\n          {filteredMachines.length === 0 ? (\n            <div className=\"md:col-span-2 lg:col-span-3 text-center py-12\">\n              <Wrench className=\"h-12 w-12 mx-auto text-muted-foreground mb-3\" />\n              <p className=\"text-muted-foreground\">No machines found</p>\n            </div>\n          ) : (\n            filteredMachines.map((machine) => (\n              <Card key={machine.id} className=\"hover-elevate transition-all\" data-testid={`card-machine-${machine.id}`}>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1 min-w-0\">\n                      <CardTitle className=\"text-lg truncate\">{machine.name}</CardTitle>\n                      <CardDescription className=\"text-xs\">{machine.model}</CardDescription>\n                    </div>\n                    <span className={`text-xs px-2 py-1 rounded-full whitespace-nowrap ${getStatusColor(machine.status)}`}>\n                      {machine.status}\n                    </span>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">Serial #</p>\n                      <p className=\"font-mono text-xs break-all\">{machine.serialNumber}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">Category</p>\n                      <p className=\"capitalize text-xs\">{machine.category}</p>\n                    </div>\n                    {machine.location && (\n                      <div className=\"col-span-2\">\n                        <p className=\"text-xs text-muted-foreground\">Location</p>\n                        <p className=\"text-xs\">{machine.location}</p>\n                      </div>\n                    )}\n                    {machine.lastServiceDate && (\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Last Service</p>\n                        <p className=\"text-xs\">{new Date(machine.lastServiceDate).toLocaleDateString()}</p>\n                      </div>\n                    )}\n                    {machine.nextServiceDate && (\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Next Service</p>\n                        <p className=\"text-xs\">{new Date(machine.nextServiceDate).toLocaleDateString()}</p>\n                      </div>\n                    )}\n                  </div>\n                  {machine.notes && (\n                    <p className=\"text-xs text-muted-foreground border-t pt-2\">{machine.notes}</p>\n                  )}\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      )}\n\n      {/* Parts Tab */}\n      {activeTab === \"parts\" && (\n        <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3 px-2 md:px-4\">\n          {filteredParts.length === 0 ? (\n            <div className=\"md:col-span-2 lg:col-span-3 text-center py-12\">\n              <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-3\" />\n              <p className=\"text-muted-foreground\">No parts found</p>\n            </div>\n          ) : (\n            filteredParts.map((part) => (\n              <Card key={part.id} className=\"hover-elevate transition-all\" data-testid={`card-part-${part.id}`}>\n                <CardHeader className=\"pb-3\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"flex-1 min-w-0\">\n                      <CardTitle className=\"text-lg truncate\">{part.name}</CardTitle>\n                      <CardDescription className=\"text-xs font-mono\">{part.partNumber}</CardDescription>\n                    </div>\n                    <span className={`text-xs px-2 py-1 rounded-full whitespace-nowrap ${getCategoryColor(part.category)}`}>\n                      {part.category}\n                    </span>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">Quantity</p>\n                      <p className=\"text-lg font-bold\">{part.quantity}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-xs text-muted-foreground\">Reorder Level</p>\n                      <p className={part.quantity <= (part.reorderLevel || 5) ? \"text-red-600 dark:text-red-400 font-semibold\" : \"text-foreground\"}>\n                        {part.reorderLevel || 5}\n                      </p>\n                    </div>\n                    {part.unitCost && (\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Unit Cost</p>\n                        <p className=\"font-semibold\">${part.unitCost.toFixed(2)}</p>\n                      </div>\n                    )}\n                    {part.supplier && (\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Supplier</p>\n                        <p className=\"text-xs\">{part.supplier}</p>\n                      </div>\n                    )}\n                    {part.location && (\n                      <div className=\"col-span-2\">\n                        <p className=\"text-xs text-muted-foreground\">Location</p>\n                        <p className=\"text-xs\">{part.location}</p>\n                      </div>\n                    )}\n                  </div>\n                  {part.description && (\n                    <p className=\"text-xs text-muted-foreground border-t pt-2\">{part.description}</p>\n                  )}\n                </CardContent>\n              </Card>\n            ))\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":10329},"client/src/components/FloatingMessageButton.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { MessageSquare } from \"lucide-react\";\nimport { ChatPanel } from \"@/components/ChatPanel\";\n\nexport function FloatingMessageButton() {\n  const [position, setPosition] = useState<{ x: number; y: number }>({ x: 20, y: 20 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState<{ x: number; y: number }>({ x: 0, y: 0 });\n  const [isOpen, setIsOpen] = useState(false);\n  const buttonRef = useRef<HTMLDivElement>(null);\n\n  // Load position from localStorage\n  useEffect(() => {\n    const saved = localStorage.getItem(\"floatingMessageButtonPosition\");\n    if (saved) {\n      try {\n        setPosition(JSON.parse(saved));\n      } catch {\n        setPosition({ x: 20, y: 20 });\n      }\n    }\n  }, []);\n\n  // Save position to localStorage\n  useEffect(() => {\n    localStorage.setItem(\"floatingMessageButtonPosition\", JSON.stringify(position));\n  }, [position]);\n\n  // Handle mouse down on button\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (isOpen) return;\n    e.preventDefault();\n    setIsDragging(true);\n    setDragStart({ x: e.clientX - position.x, y: e.clientY - position.y });\n  };\n\n  // Handle mouse move for dragging\n  useEffect(() => {\n    const handleMouseMove = (e: MouseEvent) => {\n      if (!isDragging || isOpen) return;\n\n      const windowWidth = window.innerWidth;\n      const windowHeight = window.innerHeight;\n      const buttonWidth = 140;\n      const buttonHeight = 40;\n\n      let newX = e.clientX - dragStart.x;\n      let newY = e.clientY - dragStart.y;\n\n      // Keep within bounds\n      newX = Math.max(0, Math.min(newX, windowWidth - buttonWidth));\n      newY = Math.max(0, Math.min(newY, windowHeight - buttonHeight));\n\n      setPosition({ x: newX, y: newY });\n    };\n\n    const handleMouseUp = () => {\n      setIsDragging(false);\n    };\n\n    if (isDragging) {\n      document.addEventListener(\"mousemove\", handleMouseMove);\n      document.addEventListener(\"mouseup\", handleMouseUp);\n      return () => {\n        document.removeEventListener(\"mousemove\", handleMouseMove);\n        document.removeEventListener(\"mouseup\", handleMouseUp);\n      };\n    }\n  }, [isDragging, dragStart]);\n\n  return (\n    <div\n      ref={buttonRef}\n      className=\"fixed z-50\"\n      style={{\n        left: `${position.x}px`,\n        top: `${position.y}px`,\n        cursor: isDragging ? \"grabbing\" : isOpen ? \"default\" : \"grab\",\n      }}\n      data-testid=\"floating-message-button\"\n    >\n      {!isOpen ? (\n        <Button\n          onMouseDown={handleMouseDown}\n          onClick={() => setIsOpen(true)}\n          size=\"lg\"\n          className=\"rounded-full shadow-lg\"\n          data-testid=\"button-open-messages\"\n        >\n          <MessageSquare className=\"h-5 w-5 mr-2\" />\n          Messages\n        </Button>\n      ) : (\n        <ChatPanel onClose={() => setIsOpen(false)} />\n      )}\n    </div>\n  );\n}\n","size_bytes":2972},"client/src/components/ChatPanel.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Card } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { X, Send, ChevronDown, ChevronUp } from \"lucide-react\";\nimport type { User as UserType, Message, Conversation } from \"@shared/schema\";\n\ninterface ChatPanelProps {\n  onClose: () => void;\n}\n\nexport function ChatPanel({ onClose }: ChatPanelProps) {\n  const { data: currentUser } = useAuth();\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [users, setUsers] = useState<Map<string, UserType>>(new Map());\n  const [inputValue, setInputValue] = useState(\"\");\n  const [ws, setWs] = useState<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Fetch conversations\n  const { data: conversations = [] } = useQuery<Conversation[]>({\n    queryKey: ['/api/conversations'],\n    enabled: !!currentUser,\n  });\n\n  // Scroll to bottom on new message\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  // Fetch messages for selected conversation\n  useEffect(() => {\n    async function fetchMessages() {\n      if (!selectedConversation) return;\n\n      try {\n        const response = await fetch(`/api/messages/conversation/${selectedConversation.id}`, { credentials: \"include\" });\n        if (response.ok) {\n          const data = await response.json();\n          setMessages(data);\n\n          // Fetch user data for all senders\n          const senderIds = Array.from(new Set(data.map((m: Message) => m.senderId)));\n          const userMap = new Map<string, UserType>();\n\n          for (const senderId of senderIds) {\n            try {\n              const userResponse = await fetch(`/api/users/${String(senderId)}`, { credentials: \"include\" });\n              if (userResponse.ok) {\n                const userData = await userResponse.json();\n                userMap.set(String(senderId), userData);\n              }\n            } catch (error) {\n              console.error(`Failed to fetch user ${senderId}:`, error);\n            }\n          }\n\n          setUsers(userMap);\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch messages:\", error);\n      }\n    }\n\n    fetchMessages();\n  }, [selectedConversation]);\n\n  // WebSocket connection\n  useEffect(() => {\n    if (!currentUser) return;\n\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const host = window.location.hostname;\n    const port = window.location.port ? `:${window.location.port}` : \"\";\n    const wsUrl = `${protocol}//${host}${port}/ws`;\n\n    try {\n      const socket = new WebSocket(wsUrl);\n\n      socket.onopen = () => {\n        console.log(\"Chat WebSocket connected\");\n        setIsConnected(true);\n        socket.send(JSON.stringify({ type: \"auth\", userId: currentUser.id }));\n      };\n\n      socket.onmessage = async (event) => {\n        try {\n          const data = JSON.parse(event.data);\n\n          if (data.type === \"auth_success\") {\n            console.log(\"Chat WebSocket authenticated\");\n          } else if (data.type === \"new_message\") {\n            const newMsg = data.message;\n\n            // Only add if it's for the current conversation and is direct\n            if (selectedConversation && newMsg.channelType === \"direct\" && newMsg.conversationId === selectedConversation.id) {\n              setMessages((prev) => [...prev, newMsg]);\n\n              // Fetch user data if not cached\n              if (!users.has(newMsg.senderId)) {\n                try {\n                  const userResponse = await fetch(`/api/users/${newMsg.senderId}`, { credentials: \"include\" });\n                  if (userResponse.ok) {\n                    const userData = await userResponse.json();\n                    setUsers((prev) => new Map(prev).set(newMsg.senderId, userData));\n                  }\n                } catch (error) {\n                  console.error(`Failed to fetch user ${newMsg.senderId}:`, error);\n                }\n              }\n            }\n          } else if (data.type === \"error\") {\n            console.error(\"Chat WebSocket error:\", data.message);\n          }\n        } catch (error) {\n          console.error(\"Error handling WebSocket message:\", error);\n        }\n      };\n\n      socket.onclose = () => {\n        console.log(\"Chat WebSocket disconnected\");\n        setIsConnected(false);\n      };\n\n      socket.onerror = (error) => {\n        console.error(\"Chat WebSocket error:\", error);\n      };\n\n      setWs(socket);\n\n      return () => {\n        socket.close();\n      };\n    } catch (error) {\n      console.error(\"Failed to create WebSocket:\", error);\n    }\n  }, [currentUser]);\n\n  const handleSendMessage = () => {\n    if (!inputValue.trim() || !ws || !isConnected || !selectedConversation) return;\n\n    const messagePayload = {\n      type: \"chat_message\",\n      content: inputValue,\n      channelType: \"direct\",\n      conversationId: selectedConversation.id,\n    };\n\n    ws.send(JSON.stringify(messagePayload));\n    setInputValue(\"\");\n  };\n\n  const formatTime = (date: string | Date) => {\n    const d = typeof date === \"string\" ? new Date(date) : date;\n    return d.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n  };\n\n  const getOtherUserName = () => {\n    if (!selectedConversation || !currentUser) return \"User\";\n    const otherUserId =\n      selectedConversation.participant1 === currentUser.id\n        ? selectedConversation.participant2\n        : selectedConversation.participant1;\n    const otherUser = users.get(otherUserId);\n    return otherUser?.username || \"User\";\n  };\n\n  if (!currentUser) {\n    return null;\n  }\n\n  return (\n    <Card className=\"flex flex-col h-96 shadow-2xl w-80\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-3 border-b bg-primary text-primary-foreground rounded-t-lg\">\n        <div className=\"flex items-center gap-2 flex-1\">\n          {selectedConversation ? (\n            <>\n              <Avatar className=\"h-6 w-6\">\n                <AvatarImage src={users.get(selectedConversation.participant1 === currentUser.id ? selectedConversation.participant2 : selectedConversation.participant1)?.profilePicture || undefined} />\n                <AvatarFallback>U</AvatarFallback>\n              </Avatar>\n              <span className=\"text-sm font-medium truncate\">{getOtherUserName()}</span>\n            </>\n          ) : (\n            <span className=\"text-sm font-medium\">Messages</span>\n          )}\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={() => setIsMinimized(!isMinimized)}\n            className=\"h-6 w-6 text-primary-foreground hover:bg-primary-foreground/20\"\n            data-testid=\"button-minimize-chat-panel\"\n          >\n            {isMinimized ? <ChevronUp className=\"h-4 w-4\" /> : <ChevronDown className=\"h-4 w-4\" />}\n          </Button>\n          {selectedConversation && (\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              onClick={() => {\n                setSelectedConversation(null);\n                setMessages([]);\n              }}\n              className=\"h-6 w-6 text-primary-foreground hover:bg-primary-foreground/20\"\n              data-testid=\"button-back-chat-panel\"\n            >\n              ←\n            </Button>\n          )}\n          <Button\n            size=\"icon\"\n            variant=\"ghost\"\n            onClick={onClose}\n            className=\"h-6 w-6 text-primary-foreground hover:bg-primary-foreground/20\"\n            data-testid=\"button-close-chat-panel\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      {!isMinimized && (\n        <>\n          {/* Conversations List or Messages */}\n          {!selectedConversation ? (\n            <ScrollArea className=\"flex-1 p-3\">\n              <div className=\"space-y-2\">\n                {conversations.length === 0 ? (\n                  <p className=\"text-sm text-muted-foreground text-center py-4\">\n                    No conversations yet. Go to Messages page to start chatting.\n                  </p>\n                ) : (\n                  conversations.map((conv) => {\n                    const otherUserId =\n                      conv.participant1 === currentUser.id\n                        ? conv.participant2\n                        : conv.participant1;\n                    const otherUser = users.get(otherUserId);\n                    return (\n                      <Button\n                        key={conv.id}\n                        variant=\"ghost\"\n                        onClick={() => setSelectedConversation(conv)}\n                        className=\"w-full justify-start h-auto py-2\"\n                        data-testid={`button-conv-${conv.id}`}\n                      >\n                        <Avatar className=\"h-8 w-8 mr-2 flex-shrink-0\">\n                          <AvatarImage src={otherUser?.profilePicture || undefined} />\n                          <AvatarFallback>U</AvatarFallback>\n                        </Avatar>\n                        <span className=\"truncate text-sm\">\n                          {otherUser?.username || \"User\"}\n                        </span>\n                      </Button>\n                    );\n                  })\n                )}\n              </div>\n            </ScrollArea>\n          ) : (\n            <>\n              {/* Messages */}\n              <ScrollArea className=\"flex-1 p-3 bg-muted/30\">\n                <div className=\"space-y-3\">\n                  {messages.map((msg) => (\n                    <div\n                      key={msg.id}\n                      className={`flex gap-2 ${\n                        msg.senderId === currentUser.id ? \"justify-end\" : \"justify-start\"\n                      }`}\n                      data-testid={`msg-${msg.id}`}\n                    >\n                      <div\n                        className={`max-w-xs px-3 py-2 rounded-lg text-sm ${\n                          msg.senderId === currentUser.id\n                            ? \"bg-primary text-primary-foreground\"\n                            : \"bg-background border\"\n                        }`}\n                      >\n                        <p className=\"break-words\">{msg.content}</p>\n                        <p className={`text-xs mt-1 ${\n                          msg.senderId === currentUser.id\n                            ? \"text-primary-foreground/70\"\n                            : \"text-muted-foreground\"\n                        }`}>\n                          {formatTime(msg.createdAt)}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                  <div ref={messagesEndRef} />\n                </div>\n              </ScrollArea>\n\n              {/* Input */}\n              <div className=\"p-3 border-t bg-background flex gap-2\">\n                <Input\n                  placeholder=\"Type a message...\"\n                  value={inputValue}\n                  onChange={(e) => setInputValue(e.target.value)}\n                  onKeyPress={(e) => {\n                    if (e.key === \"Enter\") {\n                      handleSendMessage();\n                    }\n                  }}\n                  disabled={!isConnected}\n                  className=\"text-sm\"\n                  data-testid=\"input-chat-msg\"\n                />\n                <Button\n                  size=\"icon\"\n                  onClick={handleSendMessage}\n                  disabled={!isConnected || !inputValue.trim()}\n                  data-testid=\"button-send-msg\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </>\n          )}\n        </>\n      )}\n    </Card>\n  );\n}\n","size_bytes":12291},"client/src/components/icons/QuebecFlag.tsx":{"content":"export function QuebecFlag({ className = \"w-4 h-4\" }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 900 600\" xmlns=\"http://www.w3.org/2000/svg\">\n      <rect width=\"900\" height=\"600\" fill=\"#003399\"/>\n      <rect x=\"0\" y=\"250\" width=\"900\" height=\"100\" fill=\"#ffffff\"/>\n      <rect x=\"400\" y=\"0\" width=\"100\" height=\"600\" fill=\"#ffffff\"/>\n      <g transform=\"translate(225, 125)\">\n        <path d=\"M0,-50 C-5,-45 -10,-40 -10,-30 C-10,-20 -5,-15 0,-10 L-15,-10 L-15,10 L15,10 L15,-10 L0,-10 C5,-15 10,-20 10,-30 C10,-40 5,-45 0,-50 M-20,-25 C-25,-20 -25,-10 -20,-5 L-10,-5 C-12,-10 -12,-20 -15,-25 M20,-25 C15,-20 12,-10 10,-5 L20,-5 C25,-10 25,-20 20,-25\" fill=\"#ffffff\"/>\n      </g>\n      <g transform=\"translate(675, 125)\">\n        <path d=\"M0,-50 C-5,-45 -10,-40 -10,-30 C-10,-20 -5,-15 0,-10 L-15,-10 L-15,10 L15,10 L15,-10 L0,-10 C5,-15 10,-20 10,-30 C10,-40 5,-45 0,-50 M-20,-25 C-25,-20 -25,-10 -20,-5 L-10,-5 C-12,-10 -12,-20 -15,-25 M20,-25 C15,-20 12,-10 10,-5 L20,-5 C25,-10 25,-20 20,-25\" fill=\"#ffffff\"/>\n      </g>\n      <g transform=\"translate(225, 475)\">\n        <path d=\"M0,-50 C-5,-45 -10,-40 -10,-30 C-10,-20 -5,-15 0,-10 L-15,-10 L-15,10 L15,10 L15,-10 L0,-10 C5,-15 10,-20 10,-30 C10,-40 5,-45 0,-50 M-20,-25 C-25,-20 -25,-10 -20,-5 L-10,-5 C-12,-10 -12,-20 -15,-25 M20,-25 C15,-20 12,-10 10,-5 L20,-5 C25,-10 25,-20 20,-25\" fill=\"#ffffff\"/>\n      </g>\n      <g transform=\"translate(675, 475)\">\n        <path d=\"M0,-50 C-5,-45 -10,-40 -10,-30 C-10,-20 -5,-15 0,-10 L-15,-10 L-15,10 L15,10 L15,-10 L0,-10 C5,-15 10,-20 10,-30 C10,-40 5,-45 0,-50 M-20,-25 C-25,-20 -25,-10 -20,-5 L-10,-5 C-12,-10 -12,-20 -15,-25 M20,-25 C15,-20 12,-10 10,-5 L20,-5 C25,-10 25,-20 20,-25\" fill=\"#ffffff\"/>\n      </g>\n    </svg>\n  );\n}\n","size_bytes":1768},"client/src/components/icons/CanadaFlag.tsx":{"content":"export function CanadaFlag({ className = \"w-4 h-4\" }: { className?: string }) {\n  return (\n    <svg className={className} viewBox=\"0 0 36 18\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <rect width=\"36\" height=\"18\" fill=\"white\"/>\n      <rect width=\"9\" height=\"18\" fill=\"#FF0000\"/>\n      <rect x=\"27\" width=\"9\" height=\"18\" fill=\"#FF0000\"/>\n      <path d=\"M18 4L19 7H22L19.5 9L20.5 12L18 10L15.5 12L16.5 9L14 7H17L18 4Z\" fill=\"#FF0000\"/>\n    </svg>\n  );\n}\n","size_bytes":464},"client/src/pages/Parts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { StatCard } from \"@/components/StatCard\";\nimport { \n  Search, Plus, Edit2, Trash2, AlertTriangle, Package, Warehouse, AlertCircle,\n  Zap, Wrench, Cog, Cpu\n} from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger \n} from \"@/components/ui/dialog\";\nimport { \n  Form, FormControl, FormField, FormItem, FormLabel, FormMessage\n} from \"@/components/ui/form\";\nimport { \n  Select, SelectContent, SelectItem, SelectTrigger, SelectValue\n} from \"@/components/ui/select\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertPartSchema } from \"@shared/schema\";\nimport type { Part } from \"@shared/schema\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { z } from \"zod\";\n\ntype PartFormData = z.infer<typeof insertPartSchema>;\n\nexport default function Parts() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [addDialogOpen, setAddDialogOpen] = useState(false);\n  const [editingPart, setEditingPart] = useState<Part | null>(null);\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\n  const { toast } = useToast();\n\n  const { data: parts = [], isLoading } = useQuery<Part[]>({\n    queryKey: [\"/api/parts\"],\n  });\n\n  // Filter parts based on search\n  const filteredParts = parts.filter(p =>\n    p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    p.partNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    (p.supplier?.toLowerCase().includes(searchQuery.toLowerCase()) ?? false)\n  );\n\n  // Calculate stats\n  const totalParts = parts.length;\n  const totalValue = parts.reduce((sum, p) => sum + ((p.unitCost || 0) * p.quantity), 0);\n  const lowStockParts = parts.filter(p => p.quantity <= (p.reorderLevel || 5)).length;\n  const totalQuantity = parts.reduce((sum, p) => sum + p.quantity, 0);\n\n  // Add part form\n  const addForm = useForm<PartFormData>({\n    resolver: zodResolver(insertPartSchema),\n    defaultValues: {\n      name: \"\",\n      partNumber: \"\",\n      category: \"Motor\",\n      quantity: 0,\n      unitCost: undefined,\n      supplier: \"\",\n      location: \"\",\n      description: \"\",\n      reorderLevel: 5,\n    },\n  });\n\n  // Edit part form\n  const editForm = useForm<PartFormData>({\n    resolver: zodResolver(insertPartSchema),\n    defaultValues: {\n      name: editingPart?.name || \"\",\n      partNumber: editingPart?.partNumber || \"\",\n      category: (editingPart?.category || \"Motor\") as any,\n      quantity: editingPart?.quantity ?? 0,\n      unitCost: editingPart?.unitCost ?? undefined,\n      supplier: editingPart?.supplier || \"\",\n      location: editingPart?.location || \"\",\n      description: editingPart?.description || \"\",\n      reorderLevel: editingPart?.reorderLevel ?? 5,\n    },\n  });\n\n  const createPartMutation = useMutation({\n    mutationFn: async (data: PartFormData) => {\n      const res = await apiRequest(\"POST\", \"/api/parts\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/parts\"] });\n      toast({ title: \"Success\", description: \"Part added to inventory\" });\n      setAddDialogOpen(false);\n      addForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updatePartMutation = useMutation({\n    mutationFn: async (data: PartFormData) => {\n      if (!editingPart) throw new Error(\"No part selected\");\n      const res = await apiRequest(\"PATCH\", `/api/parts/${editingPart.id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/parts\"] });\n      toast({ title: \"Success\", description: \"Part updated successfully\" });\n      setEditDialogOpen(false);\n      setEditingPart(null);\n      editForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deletePartMutation = useMutation({\n    mutationFn: async (partId: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/parts/${partId}`);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/parts\"] });\n      toast({ title: \"Success\", description: \"Part deleted from inventory\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Error\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const getCategoryIcon = (category: string) => {\n    switch (category) {\n      case \"Motor\": return Zap;\n      case \"Gear\": return Cog;\n      case \"Bearing\": return Wrench;\n      case \"Hydraulic\": return Cpu;\n      case \"Electrical\": return Zap;\n      case \"Fastener\": return Package;\n      default: return Package;\n    }\n  };\n\n  const getStockStatus = (quantity: number, reorderLevel: number) => {\n    if (quantity === 0) return \"out-of-stock\";\n    if (quantity <= reorderLevel) return \"low-stock\";\n    return \"in-stock\";\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"out-of-stock\":\n        return \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\";\n      case \"low-stock\":\n        return \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\";\n      case \"in-stock\":\n        return \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const handleEditPart = (part: Part) => {\n    setEditingPart(part);\n    editForm.reset({\n      name: part.name,\n      partNumber: part.partNumber,\n      category: part.category,\n      quantity: part.quantity,\n      unitCost: part.unitCost,\n      supplier: part.supplier || \"\",\n      location: part.location || \"\",\n      description: part.description || \"\",\n      reorderLevel: part.reorderLevel || 5,\n    });\n    setEditDialogOpen(true);\n  };\n\n  const handleAddPart = (data: PartFormData) => {\n    createPartMutation.mutate(data);\n  };\n\n  const handleUpdatePart = (data: PartFormData) => {\n    updatePartMutation.mutate(data);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground\">Parts Inventory</h1>\n          <p className=\"text-muted-foreground mt-1\">Manage replacement parts and stock levels</p>\n        </div>\n        <Dialog open={addDialogOpen} onOpenChange={setAddDialogOpen}>\n          <DialogTrigger asChild>\n            <Button data-testid=\"button-add-part\">\n              <Plus className=\"w-4 h-4 mr-2\" />\n              Add Part\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-md max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>Add Part to Inventory</DialogTitle>\n            </DialogHeader>\n            <Form {...addForm}>\n              <form onSubmit={addForm.handleSubmit(handleAddPart)} className=\"space-y-4\">\n                <FormField\n                  control={addForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Part Name</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"e.g., Electric Motor\" {...field} data-testid=\"input-part-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={addForm.control}\n                  name=\"partNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Part Number</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"e.g., MOTOR-001\" {...field} data-testid=\"input-part-number\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={addForm.control}\n                  name=\"category\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Category</FormLabel>\n                      <Select value={field.value} onValueChange={field.onChange}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-category\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Motor\">Motor</SelectItem>\n                          <SelectItem value=\"Gear\">Gear</SelectItem>\n                          <SelectItem value=\"Bearing\">Bearing</SelectItem>\n                          <SelectItem value=\"Hydraulic\">Hydraulic</SelectItem>\n                          <SelectItem value=\"Electrical\">Electrical</SelectItem>\n                          <SelectItem value=\"Fastener\">Fastener</SelectItem>\n                          <SelectItem value=\"Other\">Other</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={addForm.control}\n                  name=\"quantity\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Initial Quantity</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          min=\"0\"\n                          {...field}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                          data-testid=\"input-quantity\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={addForm.control}\n                  name=\"unitCost\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Unit Cost ($)</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          placeholder=\"0.00\"\n                          value={field.value ?? \"\"}\n                          onChange={(e) => field.onChange(e.target.value ? parseFloat(e.target.value) : undefined)}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-unit-cost\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={addForm.control}\n                  name=\"reorderLevel\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Reorder Level</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\"\n                          min=\"0\"\n                          value={field.value ?? 5}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 5)}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-reorder-level\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={addForm.control}\n                  name=\"supplier\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Supplier</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"e.g., AcmeCorp\" \n                          value={field.value ?? \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-supplier\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={addForm.control}\n                  name=\"location\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Storage Location</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"e.g., Warehouse A-5\" \n                          value={field.value ?? \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-location\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={addForm.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Optional details\" \n                          value={field.value ?? \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-description\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <Button \n                  type=\"submit\" \n                  className=\"w-full\"\n                  disabled={createPartMutation.isPending}\n                  data-testid=\"button-create-part\"\n                >\n                  {createPartMutation.isPending ? \"Adding...\" : \"Add Part\"}\n                </Button>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"Total Parts\"\n          value={String(totalParts)}\n          icon={Package}\n          trend={`${totalQuantity} units in stock`}\n        />\n        <StatCard\n          title=\"Inventory Value\"\n          value={`$${totalValue.toLocaleString(\"en-US\", { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`}\n          icon={Warehouse}\n          trend=\"Total stock value\"\n        />\n        <StatCard\n          title=\"Low Stock\"\n          value={String(lowStockParts)}\n          icon={AlertTriangle}\n          trend={`${lowStockParts} parts need reorder`}\n          trendUp={lowStockParts > 0}\n        />\n        <StatCard\n          title=\"Categories\"\n          value={String(new Set(parts.map(p => p.category)).size)}\n          icon={Package}\n          trend=\"Different types\"\n        />\n      </div>\n\n      {/* Search */}\n      <div className=\"flex gap-3\">\n        <div className=\"flex-1 relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search parts, part numbers, suppliers...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search-parts\"\n          />\n        </div>\n      </div>\n\n      {/* Parts Grid */}\n      <div>\n        {isLoading ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground\">Loading parts inventory...</p>\n          </div>\n        ) : filteredParts.length === 0 ? (\n          <div className=\"text-center py-12 bg-muted/30 rounded-lg border border-dashed\">\n            <Package className=\"w-12 h-12 text-muted-foreground mx-auto mb-3\" />\n            <p className=\"text-muted-foreground\">No parts found</p>\n          </div>\n        ) : (\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {filteredParts.map((part) => {\n              const IconComponent = getCategoryIcon(part.category);\n              const stockStatus = getStockStatus(part.quantity, part.reorderLevel || 5);\n              return (\n                <Card \n                  key={part.id}\n                  className=\"hover-elevate transition-all overflow-hidden\"\n                  data-testid={`card-part-${part.id}`}\n                >\n                  <CardHeader className=\"pb-3 bg-gradient-to-r from-cyan-500/5 to-purple-500/5\">\n                    <div className=\"flex items-start justify-between gap-3\">\n                      <div className=\"flex items-start gap-3 flex-1 min-w-0\">\n                        <div className=\"h-10 w-10 rounded-lg bg-primary/20 flex items-center justify-center flex-shrink-0\">\n                          <IconComponent className=\"w-5 h-5 text-primary\" />\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <CardTitle className=\"text-lg truncate\">{part.name}</CardTitle>\n                          <p className=\"text-sm text-muted-foreground font-mono truncate\">{part.partNumber}</p>\n                        </div>\n                      </div>\n                      <Badge className={`${getStatusColor(stockStatus)} border-0 flex-shrink-0`}>\n                        {stockStatus === \"out-of-stock\" ? \"Out\" : stockStatus === \"low-stock\" ? \"Low\" : \"OK\"}\n                      </Badge>\n                    </div>\n                  </CardHeader>\n\n                  <CardContent className=\"space-y-3\">\n                    <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Quantity</p>\n                        <p className={`text-lg font-bold ${\n                          part.quantity === 0 ? \"text-red-600 dark:text-red-400\" :\n                          part.quantity <= (part.reorderLevel || 5) ? \"text-yellow-600 dark:text-yellow-400\" : \"\"\n                        }`}>\n                          {part.quantity}\n                        </p>\n                      </div>\n\n                      <div>\n                        <p className=\"text-xs text-muted-foreground\">Reorder Level</p>\n                        <p className=\"font-medium\">{part.reorderLevel || 5}</p>\n                      </div>\n\n                      {part.unitCost && (\n                        <div>\n                          <p className=\"text-xs text-muted-foreground\">Unit Cost</p>\n                          <p className=\"font-semibold\">${part.unitCost.toFixed(2)}</p>\n                        </div>\n                      )}\n\n                      {part.supplier && (\n                        <div>\n                          <p className=\"text-xs text-muted-foreground\">Supplier</p>\n                          <p className=\"text-xs truncate\">{part.supplier}</p>\n                        </div>\n                      )}\n\n                      <div className=\"col-span-2\">\n                        <p className=\"text-xs text-muted-foreground\">Category</p>\n                        <p className=\"text-sm font-medium\">{part.category}</p>\n                      </div>\n\n                      {part.location && (\n                        <div className=\"col-span-2\">\n                          <p className=\"text-xs text-muted-foreground\">Location</p>\n                          <p className=\"text-sm\">{part.location}</p>\n                        </div>\n                      )}\n\n                      {part.description && (\n                        <div className=\"col-span-2\">\n                          <p className=\"text-xs text-muted-foreground\">Description</p>\n                          <p className=\"text-xs text-muted-foreground\">{part.description}</p>\n                        </div>\n                      )}\n                    </div>\n\n                    {part.quantity === 0 && (\n                      <div className=\"flex items-center gap-2 bg-red-50 dark:bg-red-950/30 p-2 rounded text-red-700 dark:text-red-300 text-xs\">\n                        <AlertCircle className=\"w-4 h-4 flex-shrink-0\" />\n                        <span>Out of stock - Order immediately</span>\n                      </div>\n                    )}\n\n                    {part.quantity > 0 && part.quantity <= (part.reorderLevel || 5) && (\n                      <div className=\"flex items-center gap-2 bg-yellow-50 dark:bg-yellow-950/30 p-2 rounded text-yellow-700 dark:text-yellow-300 text-xs\">\n                        <AlertTriangle className=\"w-4 h-4 flex-shrink-0\" />\n                        <span>Low stock - Reorder soon</span>\n                      </div>\n                    )}\n\n                    <div className=\"flex gap-2 pt-2\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        className=\"flex-1\"\n                        onClick={() => handleEditPart(part)}\n                        data-testid={`button-edit-part-${part.id}`}\n                      >\n                        <Edit2 className=\"w-4 h-4 mr-1\" />\n                        Edit\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        className=\"flex-1\"\n                        onClick={() => deletePartMutation.mutate(part.id)}\n                        disabled={deletePartMutation.isPending}\n                        data-testid={`button-delete-part-${part.id}`}\n                      >\n                        <Trash2 className=\"w-4 h-4 mr-1\" />\n                        Delete\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        )}\n      </div>\n\n      {/* Edit Part Dialog */}\n      <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\n        <DialogContent className=\"max-w-md max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit Part: {editingPart?.name}</DialogTitle>\n          </DialogHeader>\n          {editingPart && (\n            <Form {...editForm}>\n              <form onSubmit={editForm.handleSubmit(handleUpdatePart)} className=\"space-y-4\">\n                <FormField\n                  control={editForm.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Part Name</FormLabel>\n                      <FormControl>\n                        <Input {...field} data-testid=\"input-edit-part-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"category\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Category</FormLabel>\n                      <Select value={field.value} onValueChange={field.onChange}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-edit-category\">\n                            <SelectValue />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"Motor\">Motor</SelectItem>\n                          <SelectItem value=\"Gear\">Gear</SelectItem>\n                          <SelectItem value=\"Bearing\">Bearing</SelectItem>\n                          <SelectItem value=\"Hydraulic\">Hydraulic</SelectItem>\n                          <SelectItem value=\"Electrical\">Electrical</SelectItem>\n                          <SelectItem value=\"Fastener\">Fastener</SelectItem>\n                          <SelectItem value=\"Other\">Other</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"quantity\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Quantity</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          min=\"0\"\n                          value={field.value ?? 0}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-edit-quantity\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"unitCost\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Unit Cost ($)</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"0\"\n                          value={field.value ?? \"\"}\n                          onChange={(e) => field.onChange(e.target.value ? parseFloat(e.target.value) : undefined)}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-edit-unit-cost\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"reorderLevel\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Reorder Level</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\"\n                          min=\"0\"\n                          value={field.value ?? 5}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 5)}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-edit-reorder-level\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"supplier\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Supplier</FormLabel>\n                      <FormControl>\n                        <Input \n                          value={field.value ?? \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-edit-supplier\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"location\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Storage Location</FormLabel>\n                      <FormControl>\n                        <Input \n                          value={field.value ?? \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-edit-location\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={editForm.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Description</FormLabel>\n                      <FormControl>\n                        <Input \n                          value={field.value ?? \"\"}\n                          onChange={field.onChange}\n                          onBlur={field.onBlur}\n                          name={field.name}\n                          data-testid=\"input-edit-description\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex gap-3\">\n                  <Button \n                    type=\"button\"\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                    onClick={() => setEditDialogOpen(false)}\n                    data-testid=\"button-cancel-edit\"\n                  >\n                    Cancel\n                  </Button>\n                  <Button \n                    type=\"submit\"\n                    className=\"flex-1\"\n                    disabled={updatePartMutation.isPending}\n                    data-testid=\"button-save-part\"\n                  >\n                    {updatePartMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":30863},"client/src/components/UnifiedChat.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useAuth } from \"@/lib/auth\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Send, Hash, Building2, MessageSquare, User, MessageCircle, X } from \"lucide-react\";\nimport { NewMessageDialog } from \"@/components/NewMessageDialog\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { User as UserType, Message, Conversation } from \"@shared/schema\";\n\ninterface Channel {\n  id: string;\n  type: 'headquarters' | 'department';\n  name: string;\n  icon: typeof Hash | typeof Building2;\n}\n\nexport function UnifiedChat() {\n  const { data: currentUser } = useAuth();\n  const [selectedChannel, setSelectedChannel] = useState<Channel | null>(null);\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [users, setUsers] = useState<Map<string, UserType>>(new Map());\n  const [inputValue, setInputValue] = useState(\"\");\n  const [ws, setWs] = useState<WebSocket | null>(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const [conversationUsers, setConversationUsers] = useState<Map<string, UserType>>(new Map());\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Build channel list\n  const channels: Channel[] = [];\n  if (currentUser?.headquarters) {\n    channels.push({\n      id: currentUser.headquarters,\n      type: 'headquarters',\n      name: `${currentUser.headquarters} HQ`,\n      icon: Building2,\n    });\n  }\n  if (currentUser?.department) {\n    channels.push({\n      id: currentUser.department,\n      type: 'department',\n      name: currentUser.department,\n      icon: Hash,\n    });\n  }\n\n  // Fetch conversations\n  const { data: conversations = [], refetch: refetchConversations } = useQuery<Conversation[]>({\n    queryKey: ['/api/conversations'],\n    enabled: !!currentUser,\n    refetchInterval: 5000, // Refetch every 5 seconds for new conversations\n  });\n\n  // Fetch user data for conversation participants\n  useEffect(() => {\n    async function fetchConversationUsers() {\n      if (conversations.length === 0 || !currentUser) return;\n\n      const userIds = new Set<string>();\n      conversations.forEach((conv) => {\n        if (conv.participant1 !== currentUser.id) userIds.add(conv.participant1);\n        if (conv.participant2 !== currentUser.id) userIds.add(conv.participant2);\n      });\n\n      const newUsers = new Map(conversationUsers);\n      for (const userId of Array.from(userIds)) {\n        if (!newUsers.has(userId)) {\n          try {\n            const response = await fetch(`/api/users/${userId}`, { credentials: \"include\" });\n            if (response.ok) {\n              const userData = await response.json();\n              newUsers.set(userId, userData);\n            }\n          } catch (error) {\n            console.error(`Failed to fetch user ${userId}:`, error);\n          }\n        }\n      }\n      setConversationUsers(newUsers);\n    }\n\n    fetchConversationUsers();\n  }, [conversations, currentUser]);\n\n  // Set default channel on mount\n  useEffect(() => {\n    if (channels.length > 0 && !selectedChannel && !selectedConversation) {\n      setSelectedChannel(channels[0]);\n    }\n  }, [channels.length]);\n\n  // Fetch messages\n  useEffect(() => {\n    async function fetchMessages() {\n      try {\n        let url = '';\n        if (selectedChannel) {\n          url = selectedChannel.type === 'headquarters' \n            ? `/api/messages/headquarters/${selectedChannel.id}`\n            : `/api/messages/department/${selectedChannel.id}`;\n        } else if (selectedConversation) {\n          url = `/api/messages/conversation/${selectedConversation.id}`;\n        }\n\n        if (url) {\n          const response = await fetch(url, { credentials: \"include\" });\n          if (response.ok) {\n            const data = await response.json();\n            setMessages(data);\n\n            // Fetch sender user data\n            const senderIds = Array.from(new Set(data.map((m: Message) => m.senderId)));\n            const userMap = new Map<string, UserType>();\n\n            for (const senderId of senderIds) {\n              try {\n                const userResponse = await fetch(`/api/users/${String(senderId)}`, {\n                  credentials: \"include\",\n                });\n                if (userResponse.ok) {\n                  const userData = await userResponse.json();\n                  userMap.set(String(senderId), userData);\n                }\n              } catch (error) {\n                console.error(`Failed to fetch user ${senderId}:`, error);\n              }\n            }\n\n            setUsers(userMap);\n          }\n        }\n      } catch (error) {\n        console.error(\"Failed to fetch messages:\", error);\n      }\n    }\n\n    if (currentUser) {\n      fetchMessages();\n    }\n  }, [selectedChannel, selectedConversation, currentUser]);\n\n  // Auto-scroll\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  // WebSocket setup\n  useEffect(() => {\n    if (!currentUser) return;\n\n    const protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n    const host = window.location.hostname;\n    const port = window.location.port ? `:${window.location.port}` : \"\";\n    const wsUrl = `${protocol}//${host}${port}/ws`;\n\n    try {\n      const socket = new WebSocket(wsUrl);\n\n      socket.onopen = () => {\n        setIsConnected(true);\n        socket.send(JSON.stringify({ type: \"auth\", userId: currentUser.id }));\n      };\n\n      socket.onmessage = async (event) => {\n        const data = JSON.parse(event.data);\n\n        if (data.type === \"chat\") {\n          // Add message to current view if it matches\n          if (data.channelType === \"direct\") {\n            const convMatch = selectedConversation?.id === data.conversationId;\n            if (convMatch) {\n              setMessages(prev => [...prev, data]);\n              // Fetch sender data if not already cached\n              if (!users.has(data.senderId)) {\n                try {\n                  const userResponse = await fetch(`/api/users/${data.senderId}`, {\n                    credentials: \"include\",\n                  });\n                  if (userResponse.ok) {\n                    const userData = await userResponse.json();\n                    setUsers(prev => new Map(prev).set(data.senderId, userData));\n                  }\n                } catch (error) {\n                  console.error(\"Failed to fetch sender:\", error);\n                }\n              }\n              // Refresh conversations to update last message timestamp\n              refetchConversations();\n            }\n          } else {\n            const channelMatch = selectedChannel?.id === data.headquarters || selectedChannel?.id === data.department;\n            if (channelMatch) {\n              setMessages(prev => [...prev, data]);\n              // Fetch sender if needed\n              if (!users.has(data.senderId)) {\n                try {\n                  const userResponse = await fetch(`/api/users/${data.senderId}`, {\n                    credentials: \"include\",\n                  });\n                  if (userResponse.ok) {\n                    const userData = await userResponse.json();\n                    setUsers(prev => new Map(prev).set(data.senderId, userData));\n                  }\n                } catch (error) {\n                  console.error(\"Failed to fetch sender:\", error);\n                }\n              }\n            }\n          }\n        }\n      };\n\n      socket.onerror = (error) => {\n        console.error(\"WebSocket error:\", error);\n        setIsConnected(false);\n      };\n\n      socket.onclose = () => {\n        setIsConnected(false);\n      };\n\n      setWs(socket);\n\n      return () => {\n        socket.close();\n      };\n    } catch (error) {\n      console.error(\"Failed to connect WebSocket:\", error);\n    }\n  }, [currentUser]);\n\n  const sendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!inputValue.trim() || !ws || !isConnected || (!selectedChannel && !selectedConversation)) return;\n\n    const messageData: any = {\n      type: \"chat\",\n      content: inputValue,\n    };\n\n    if (selectedChannel) {\n      if (selectedChannel.type === 'headquarters') {\n        messageData.channelType = 'headquarters';\n        messageData.headquarters = selectedChannel.id;\n      } else {\n        messageData.channelType = 'department';\n        messageData.department = selectedChannel.id;\n      }\n    } else if (selectedConversation) {\n      messageData.channelType = 'direct';\n      messageData.conversationId = selectedConversation.id;\n    }\n\n    ws.send(JSON.stringify(messageData));\n    setInputValue(\"\");\n  };\n\n  const getOtherUserFromConversation = (conv: Conversation) => {\n    const otherUserId = conv.participant1 === currentUser?.id ? conv.participant2 : conv.participant1;\n    return conversationUsers.get(otherUserId);\n  };\n\n  return (\n    <div className=\"h-full flex flex-col gap-4\">\n      <Tabs value={selectedConversation ? \"direct\" : \"channels\"} className=\"h-full flex flex-col\">\n        <TabsList className=\"w-full justify-start\" data-testid=\"tabs-chat\">\n          <TabsTrigger value=\"channels\" onClick={() => setSelectedConversation(null)} data-testid=\"tab-channels\">\n            <Hash className=\"w-4 h-4 mr-2\" />\n            Channels\n          </TabsTrigger>\n          <TabsTrigger value=\"direct\" data-testid=\"tab-direct\">\n            <MessageCircle className=\"w-4 h-4 mr-2\" />\n            Direct Messages\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"channels\" className=\"flex-1 flex gap-4\">\n          {/* Channels Sidebar */}\n          <div className=\"w-48 border-r space-y-2 p-3\">\n            <p className=\"text-xs font-semibold text-muted-foreground\">CHANNELS</p>\n            {channels.map((channel) => (\n              <Button\n                key={channel.id}\n                variant={selectedChannel?.id === channel.id ? \"default\" : \"ghost\"}\n                className=\"w-full justify-start text-left\"\n                onClick={() => {\n                  setSelectedChannel(channel);\n                  setSelectedConversation(null);\n                }}\n                data-testid={`button-channel-${channel.id}`}\n              >\n                <channel.icon className=\"w-4 h-4 mr-2 flex-shrink-0\" />\n                <span className=\"truncate\">{channel.name}</span>\n              </Button>\n            ))}\n          </div>\n\n          {/* Messages Area */}\n          <div className=\"flex-1 flex flex-col\">\n            {selectedChannel && (\n              <>\n                <div className=\"border-b p-3 bg-muted/30\">\n                  <p className=\"font-semibold\">{selectedChannel.name}</p>\n                </div>\n                <ScrollArea className=\"flex-1\">\n                  <div className=\"p-4 space-y-3\">\n                    {messages.map((msg, idx) => {\n                      const sender = users.get(msg.senderId);\n                      const fallback = sender?.username ? sender.username[0].toUpperCase() : \"?\";\n                      return (\n                        <div key={idx} className=\"flex gap-2\" data-testid={`message-${idx}`}>\n                          <Avatar className=\"h-8 w-8 flex-shrink-0\">\n                            <AvatarImage src={sender?.profilePicture || undefined} />\n                            <AvatarFallback>{fallback}</AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1\">\n                            <p className=\"text-sm font-semibold\">{sender?.username || \"Unknown\"}</p>\n                            <p className=\"text-sm text-muted-foreground\">{msg.content}</p>\n                          </div>\n                        </div>\n                      );\n                    })}\n                    <div ref={messagesEndRef} />\n                  </div>\n                </ScrollArea>\n                <form onSubmit={sendMessage} className=\"p-3 border-t flex gap-2\">\n                  <Input\n                    placeholder=\"Message...\"\n                    value={inputValue}\n                    onChange={(e) => setInputValue(e.target.value)}\n                    data-testid=\"input-message\"\n                  />\n                  <Button type=\"submit\" size=\"icon\" data-testid=\"button-send\">\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                </form>\n              </>\n            )}\n          </div>\n        </TabsContent>\n\n        <TabsContent value=\"direct\" className=\"flex-1 flex gap-4\">\n          {/* Direct Messages Sidebar */}\n          <div className=\"w-56 border-r space-y-2 p-3\">\n            <div className=\"flex items-center justify-between gap-2 mb-3\">\n              <p className=\"text-xs font-semibold text-muted-foreground\">DIRECT MESSAGES</p>\n              <NewMessageDialog />\n            </div>\n            <ScrollArea className=\"h-[calc(100vh-200px)]\">\n              {conversations.length === 0 ? (\n                <p className=\"text-xs text-muted-foreground p-2\">No conversations yet</p>\n              ) : (\n                conversations.map((conv) => {\n                  const otherUser = getOtherUserFromConversation(conv);\n                  const fallback = otherUser?.username ? otherUser.username[0].toUpperCase() : \"?\";\n                  \n                  const moodEmojis: Record<string, string> = {\n                    happy: \"😊\",\n                    focused: \"😤\",\n                    tired: \"😴\",\n                    stressed: \"😢\",\n                    neutral: \"😐\",\n                  };\n                  const moodEmoji = moodEmojis[otherUser?.mood || \"neutral\"] || \"😐\";\n                  \n                  return (\n                    <Button\n                      key={conv.id}\n                      variant={selectedConversation?.id === conv.id ? \"default\" : \"ghost\"}\n                      className=\"w-full justify-start text-left mb-1\"\n                      onClick={() => {\n                        setSelectedConversation(conv);\n                        setSelectedChannel(null);\n                      }}\n                      data-testid={`button-conversation-${conv.id}`}\n                    >\n                      <Avatar className=\"h-6 w-6 mr-2 flex-shrink-0\">\n                        <AvatarImage src={otherUser?.profilePicture || undefined} />\n                        <AvatarFallback>{fallback}</AvatarFallback>\n                      </Avatar>\n                      <span className=\"truncate text-sm flex-1\">{otherUser?.username || \"Unknown\"}</span>\n                      <span className=\"text-sm ml-1\">{moodEmoji}</span>\n                    </Button>\n                  );\n                })\n              )}\n            </ScrollArea>\n          </div>\n\n          {/* Messages Area */}\n          <div className=\"flex-1 flex flex-col\">\n            {selectedConversation && getOtherUserFromConversation(selectedConversation) && (\n              <>\n                <div className=\"border-b p-3 bg-muted/30 flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    {(() => {\n                      const otherUser = getOtherUserFromConversation(selectedConversation);\n                      const fallback = otherUser?.username ? otherUser.username[0].toUpperCase() : \"?\";\n                      \n                      const moodEmojis: Record<string, string> = {\n                        happy: \"😊\",\n                        focused: \"😤\",\n                        tired: \"😴\",\n                        stressed: \"😢\",\n                        neutral: \"😐\",\n                      };\n                      const moodEmoji = moodEmojis[otherUser?.mood || \"neutral\"] || \"😐\";\n                      \n                      return (\n                        <>\n                          <Avatar className=\"h-8 w-8\">\n                            <AvatarImage src={otherUser?.profilePicture || undefined} />\n                            <AvatarFallback>{fallback}</AvatarFallback>\n                          </Avatar>\n                          <p className=\"font-semibold\">{otherUser?.username || \"Unknown\"}</p>\n                          <span className=\"text-lg\">{moodEmoji}</span>\n                        </>\n                      );\n                    })()}\n                  </div>\n                </div>\n                <ScrollArea className=\"flex-1\">\n                  <div className=\"p-4 space-y-3\">\n                    {messages.map((msg, idx) => {\n                      const sender = users.get(msg.senderId);\n                      const isCurrentUser = sender?.id === currentUser?.id;\n                      const fallback = sender?.username ? sender.username[0].toUpperCase() : \"?\";\n                      return (\n                        <div\n                          key={idx}\n                          className={`flex gap-2 ${isCurrentUser ? \"justify-end\" : \"justify-start\"}`}\n                          data-testid={`dm-message-${idx}`}\n                        >\n                          {!isCurrentUser && (\n                            <Avatar className=\"h-8 w-8 flex-shrink-0\">\n                              <AvatarImage src={sender?.profilePicture || undefined} />\n                              <AvatarFallback>{fallback}</AvatarFallback>\n                            </Avatar>\n                          )}\n                          <div className={`flex-1 max-w-xs ${isCurrentUser ? \"text-right\" : \"\"}`}>\n                            <div\n                              className={`inline-block px-3 py-2 rounded-lg ${\n                                isCurrentUser\n                                  ? \"bg-primary text-primary-foreground\"\n                                  : \"bg-muted text-muted-foreground\"\n                              }`}\n                            >\n                              <p className=\"text-sm\">{msg.content}</p>\n                            </div>\n                          </div>\n                        </div>\n                      );\n                    })}\n                    <div ref={messagesEndRef} />\n                  </div>\n                </ScrollArea>\n                <form onSubmit={sendMessage} className=\"p-3 border-t flex gap-2\">\n                  <Input\n                    placeholder=\"Type a message...\"\n                    value={inputValue}\n                    onChange={(e) => setInputValue(e.target.value)}\n                    data-testid=\"input-dm-message\"\n                  />\n                  <Button type=\"submit\" size=\"icon\" data-testid=\"button-send-dm\">\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                </form>\n              </>\n            )}\n            {!selectedConversation && (\n              <div className=\"flex-1 flex items-center justify-center text-muted-foreground\">\n                Select a conversation to start messaging\n              </div>\n            )}\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":19450},"client/src/components/MoodSelector.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\n\nconst moods = [\n  { value: \"happy\", emoji: \"😊\", label: \"Happy\" },\n  { value: \"focused\", emoji: \"😤\", label: \"Focused\" },\n  { value: \"tired\", emoji: \"😴\", label: \"Tired\" },\n  { value: \"stressed\", emoji: \"😢\", label: \"Stressed\" },\n  { value: \"neutral\", emoji: \"😐\", label: \"Neutral\" },\n];\n\ninterface MoodSelectorProps {\n  currentMood?: string;\n}\n\nexport function MoodSelector({ currentMood = \"neutral\" }: MoodSelectorProps) {\n  const { theme } = useTheme();\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleMoodChange = async (mood: string) => {\n    setIsLoading(true);\n    try {\n      await apiRequest(\"PATCH\", \"/api/auth/user/mood\", { mood });\n      await queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n    } catch (error) {\n      console.error(\"Failed to update mood:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const currentMoodEmoji = moods.find(m => m.value === currentMood)?.emoji || \"😐\";\n\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center gap-2\">\n        <label className=\"text-sm font-medium\">How's your mood today?</label>\n        <span className=\"text-2xl\">{currentMoodEmoji}</span>\n      </div>\n      <div className=\"flex gap-2 flex-wrap\">\n        {moods.map((mood) => (\n          <Button\n            key={mood.value}\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => handleMoodChange(mood.value)}\n            disabled={isLoading}\n            className={`\n              transition-all\n              ${currentMood === mood.value ? \n                theme === 'unicorn' ? 'bg-gradient-to-r from-cyan-400 to-pink-400 border-0 text-white' :\n                'bg-primary/20 border-primary text-primary' \n                : ''\n              }\n            `}\n            data-testid={`button-mood-${mood.value}`}\n          >\n            <span className=\"text-lg mr-1\">{mood.emoji}</span>\n            {mood.label}\n          </Button>\n        ))}\n      </div>\n    </div>\n  );\n}\n","size_bytes":2209}},"version":2}